article id="http://dx.doi.org/10.1073/pnas.1603693113"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Demographic noise can reverse the direction of deterministic selection  #@NEW_LINE#@#  

Significance  #@NEW_LINE#@#  
Demographic stochasticitythe population-level randomness that emerges when the timing of birth, death, and interaction events is unpredictablecan profoundly alter the dynamics of a system.  #@NEW_LINE#@#  We find that phenotypes that pay a cost to their birth rate to modify the environment by increasing the global carrying capacity can be stochastically selected for, where they would otherwise be deterministically disfavored.  #@NEW_LINE#@#  Our results hold for a general class of mathematical models but we use a model of public good production for illustration.  #@NEW_LINE#@#  In this case, demographic stochasticity is exploited by populations of cooperators to turn selection in their favor; it therefore operates as a mechanism that supports the evolution of public good production.  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
Deterministic evolutionary theory robustly predicts that populations displaying altruistic behaviors will be driven to extinction by mutant cheats that absorb common benefits but do not themselves contribute.  #@NEW_LINE#@#  Here we show that when demographic stochasticity is accounted for, selection can in fact act in the reverse direction to that predicted deterministically, instead favoring cooperative behaviors that appreciably increase the carrying capacity of the population.  #@NEW_LINE#@#  Populations that exist in larger numbers experience a selective advantage by being more stochastically robust to invasions than smaller populations, and this advantage can persist even in the presence of reproductive costs.  #@NEW_LINE#@#  We investigate this general effect in the specific context of public goods production and find conditions for stochastic selection reversal leading to the success of public good producers.  #@NEW_LINE#@#  This insight, developed here analytically, is missed by the deterministic analysis as well as by standard game theoretic models that enforce a fixed population size.  #@NEW_LINE#@#  The effect is found to be amplified by space; in this scenario we find that selection reversal occurs within biologically reasonable parameter regimes for microbial populations.  #@NEW_LINE#@#  Beyond the public good problem, we formulate a general mathematical framework for models that may exhibit stochastic selection reversal.  #@NEW_LINE#@#  In this context, we describe a stochastic analog to rK theory, by which small populations can evolve to higher densities in the absence of disturbance.  #@NEW_LINE#@#  

Public_Good_Model  #@NEW_LINE#@#  
It is generally accepted that random events play a strong role in the evolution of cooperative behavior, which is deterministically selected against (4).  #@NEW_LINE#@#  The standard formulation of evolutionary game theory involves setting the problem in terms of a modified Moran model (20, 21).  #@NEW_LINE#@#  The Moran model is a population genetic model first developed as an abstract illustration of the effect of genetic drift in a haploid population of two phenotypes; an individual is picked to reproduce with a probability proportional to its fitness, whereas simultaneously a second individual is chosen randomly to die (22).  #@NEW_LINE#@#  Coupling birth and death events keeps the population size fixed, which increases the tractability of the system.  #@NEW_LINE#@#  
The specification of fixed population size is, however, restrictive and can be problematic.  #@NEW_LINE#@#  Most prominently, a phenotype with increased fitness can be no more abundant in isolation than its ailing counterpart.  #@NEW_LINE#@#  Additional difficulties are encountered if one attempts to use simple game-theoretic models to quantitatively understand more complex experimental data.  #@NEW_LINE#@#  Whereas, for example, assuming some arbitrary nonlinearity in the models game payoff matrix may enable experimental findings to be elegantly recapitulated, it is more difficult to justify the origin of these assumptions on a mechanistic level (23).  #@NEW_LINE#@#  In light of such issues, it has been suggested that a more ecologically grounded take on the dynamics of cooperation might be preferable (24, 25), one in which the population size is not fixed and that is sufficiently detailed that mechanistic (rather than phenomenological) parameters can be inferred experimentally.  #@NEW_LINE#@#  In the following, we take such an approach.  #@NEW_LINE#@#  We begin by considering a prototypical model of public good production and consumption.  #@NEW_LINE#@#  
In our model, we consider a phenotype X having the ability to produce a public good Q that catalyzes its growth.  #@NEW_LINE#@#  We wish to capture the stochastic dynamics of the system.  #@NEW_LINE#@#  To this end we assume that the system is described by a set of probability transition rates, which describe the probability per unit time of each reaction occurring:X/R2bxX+X,X+Qr/R2X+X+Q,XpxX+Q,Q.  #@NEW_LINE#@#  [1]In the absence of the public good, the producer phenotype X reproduces at a baseline birthrate bx.  #@NEW_LINE#@#  The phenotypes encounter each other and the public good at a rate R2; the quantity R2 can be interpreted as a measure of the area (or volume) to which the system is confined.  #@NEW_LINE#@#  Death of the phenotype occurs solely due to crowding effects at rate , multiplied by the encounter rate.  #@NEW_LINE#@#  Phenotypes encounter and use the public good at a rate r/R2.  #@NEW_LINE#@#  We study the case where this reaction is catalytic (i.e., the public good is conserved) and leads to a phenotype reproduction.  #@NEW_LINE#@#  Examples of catalytic (reusable) public goods are the enzyme invertase produced by the yeast Saccharomyces cerevisiae (26) or the siderophore pyoverdine produced by the bacterium Pseudomonas aeruginosa (27).  #@NEW_LINE#@#  The total rate at which the phenotype reproduces is thus increased in the presence of the public good.  #@NEW_LINE#@#  The public good itself is produced by the producer phenotype at a rate px and decays at a rate .  #@NEW_LINE#@#  Note that as well as controlling the spatial scale of the well-mixed system, the magnitude of R will also control the typical number of individuals in the system, because larger R (more space) allows the population to grow to greater numbers.  #@NEW_LINE#@#  We next introduce a mutant phenotype Y that does not produce the public good (i.e., py=0); consequently, it has a different baseline birth rate by that we expect to be at least as high as that of the producer, due to the nonproducers reduced metabolic expenditure.  #@NEW_LINE#@#  Its interactions with the public good are otherwise similar to those of X (Eq.  #@NEW_LINE#@#  1).  #@NEW_LINE#@#  
The state of the system is specified by the discrete variables nx, ny, and nq, the number of each phenotype and public good, respectively.  #@NEW_LINE#@#  For the system described, we wish to know the probability of being in any given state at any given time.  #@NEW_LINE#@#  To answer this, we set up an infinite set of ordinary differential equations (ODEs) [one for each unique state (nx,ny,nq)] that measures the flow of probability between neighboring states (controlled by the transitions in Eq.  #@NEW_LINE#@#  1).  #@NEW_LINE#@#  These equations govern the time evolution of a probability density function P(nx,ny,nq,t) (Eq.  #@NEW_LINE#@#  S2).  #@NEW_LINE#@#  Such a model is sometimes termed a microscopic description (28), because it takes account of the dynamics of discrete interactions between the system variables.  #@NEW_LINE#@#  
Although the probabilistic model is straightforward to formalize, it is difficult to solve in its entirety.  #@NEW_LINE#@#  We apply an approximation that makes the model more tractable, while maintaining the systems probabilistic nature.  #@NEW_LINE#@#  Such approximations, which assume that the system under consideration has a large but finite number of individuals, are well practiced and understood (28) and are analogous to the diffusion approximation (22) of population genetics.  #@NEW_LINE#@#  Assuming that R is large, but finite (which implies a large number of individuals in the system), we transform the system into the approximately continuous variables (x,y,q)=(nx,ny,nq)/R2 and expand the partial difference equations in 1/R2.  #@NEW_LINE#@#  This allows us to express the infinite set of ODEs as a single partial differential equation in four continuous variables, (x,y,q,t).  #@NEW_LINE#@#  However, because the partial differential equation (PDE) results from a Taylor expansion, it has infinite order.  #@NEW_LINE#@#  Truncating the expression after the first term (at order R2), one obtains a deterministic approximation of the dynamics (valid for R or equivalently for infinite population sizes).  #@NEW_LINE#@#  Because we aim to make the system tractable but still retain some stochastic element in the dynamics, we truncate the expansion after the second term (at order R4; Eq.  #@NEW_LINE#@#  S4).  #@NEW_LINE#@#  The resulting model can be conveniently expressed as a set of It stochastic differential equations (SDEs):x=x[bx+rq(x+y)]+R1x(t),y=y[by+rq(x+y)]+R1y(t),q=pxxq+R1q(t).  #@NEW_LINE#@#  [2]The i(t) represent Gaussian white noise terms whose correlations depend on the state of the system (the noise is multiplicative).  #@NEW_LINE#@#  Importantly, because Eq.  #@NEW_LINE#@#  2 has been developed as a rigorous approximation of the underlying stochastic model, Eq.  #@NEW_LINE#@#  1, the precise functional form of the noise can be determined explicitly, rather than posited on an ad hoc basis (SI Obtaining the SDE System from the Microscopic Individual-Based Model).  #@NEW_LINE#@#  Setting R, the population size increases with the interaction scale and one recovers the deterministic limit.  #@NEW_LINE#@#  Because Eq.  #@NEW_LINE#@#  2 is a course-grained approximation of the underlying microscopic model but retains an inherent stochasticity, it is often referred to as the mesoscopic limit (29).  #@NEW_LINE#@#  
First, we analyze the dynamics of Eq.  #@NEW_LINE#@#  2 in the deterministic, R limit.  #@NEW_LINE#@#  There exist three fixed points or equilibria.  #@NEW_LINE#@#  The first one, at the origin, is always unstable.  #@NEW_LINE#@#  The remaining fixed points occur when the system contains only a single phenotype: the producer fixed point, (x,y,q)=(Kx,0,pxKx/), and the nonproducer fixed point, (x,y,q)=(0,Ky,0).  #@NEW_LINE#@#  Thus, Kx and Ky are measures of the phenotypes frequency (carrying capacity) in isolation, with precise formsKx=bxpxr,Ky=by.  #@NEW_LINE#@#  [3]If by greater than bx, then the nonproducer fixed point is always stable whereas the producer fixed point is always unstable.  #@NEW_LINE#@#  However, the nonproducer fixed point is globally attracting only if  greater than rpx.  #@NEW_LINE#@#  If this condition is not met, then there exist initial conditions for which the producers produce and process the public good faster than they die and faster than the public good degrades, resulting in unbounded exponential growth of the system.  #@NEW_LINE#@#  This biologically unrealistic behavior comes from the fact that we have assumed for simplicity that the public good uptake does not saturate.  #@NEW_LINE#@#  Because this behavior is unrealistic, we work in the regime  greater than rpx for the remainder of this paper.  #@NEW_LINE#@#  Finally, we are interested in systems where the size of the producer population in isolation is larger than that of the nonproducer, Kx greater than Ky; this is true if the condition bx greater than by(1rpx/) holds.  #@NEW_LINE#@#  Thus, deterministically, a nonproducing mutant will always take over a producer population and, due to the absence of the public good, it will yield a smaller population at equilibrium.  #@NEW_LINE#@#  
This deterministic analysis predicts, unsurprisingly, that a population composed entirely of nonproducers is the only stable state.  #@NEW_LINE#@#  We next explore the behavior of the system in Eq.  #@NEW_LINE#@#  1 when demographic stochasticity is considered.  #@NEW_LINE#@#  
Mesoscopic_Selection_Reversal  #@NEW_LINE#@#  
Due to noise, a stochastic system will not be positioned precisely on deterministic fixed points, but rather it will fluctuate around them.  #@NEW_LINE#@#  In the above system, these fluctuations will occur along the y axis for the nonproducer fixed point whereas in the absence of nonproducers they will occur in the (x,q) plane for the producer fixed point.  #@NEW_LINE#@#  We can define Nx=R2Kx and Ny=R2Ky to be the mean number of the phenotypes X and Y in isolation in the respective stationary states.  #@NEW_LINE#@#  We assume that the nonproducing phenotype has a greater per capita birth rate than the producer phenotype, i.e., by greater than bx, and we introduce a single nonproducing mutant into a producer population.  #@NEW_LINE#@#  Whereas the deterministic theory predicts that the nonproducer should sweep through the population until it reaches fixation, in the stochastic setting fixation of the nonproducer is by no means guaranteed: There is a high probability that the single mutant might be lost due to demographic noise.  #@NEW_LINE#@#  However, because the nonproducer is deterministically selected for, we might expect the probability of a nonproducer mutant invading and fixating in a resident producer population to be greater than the probability of a producer mutant invading and fixating in a resident nonproducer population.  #@NEW_LINE#@#  We explore this question below.  #@NEW_LINE#@#  
To make analytic predictions about the stochastic model, we need to reduce the complexity of the system.  #@NEW_LINE#@#  This can be done if we use methods based on the elimination of fast variables (30) to obtain an effective one-dimensional description of the system dynamics.  #@NEW_LINE#@#  To this end, we begin by assuming that the public good production and decay, px and , and the phenotypes reproduction and death, bx, by, and , occur on a much faster timescale than the rate of change of population composition, which is governed by the difference in birth rates, bxby.  #@NEW_LINE#@#  Essentially this assumption requires that the cost of public good production is marginal.  #@NEW_LINE#@#  In the case of S. cerevisiae, this assumption is supported by empirical work (Table S2).  #@NEW_LINE#@#  To mathematically investigate this timescale separation we definebx=b(1),by=b,[4]where the parameter  represents the metabolic cost that X pays for producing the public good.  #@NEW_LINE#@#  The parameter  now controls the rate of change of the population composition, and if 1, we have our desired timescale separation in the deterministic system.  #@NEW_LINE#@#  Because the parameters Kx, Ky, Nx, and Ny depend on , we find it convenient to define their values when =0 as Kx(0), Ky(0), Nx(0), and Ny(0), respectively.  #@NEW_LINE#@#  To maintain our assumption that the composition of the phenotype population changes slowly in the stochastic system, we additionally require that the noise is small.  #@NEW_LINE#@#  However, this assumption has already been implicitly made in the derivation of Eq.  #@NEW_LINE#@#  2, where it is assumed that R is large, and thus R1, the prefactor for the noise terms, is small.  #@NEW_LINE#@#  To formalize this, we find it convenient to assume R2O().  #@NEW_LINE#@#  
Under the above assumptions, the system features a separation of timescales.  #@NEW_LINE#@#  Next, we take advantage of this timescale separation to reduce the complexity of the system.  #@NEW_LINE#@#  Deterministically, the existence of a set of fast timescales suggests the existence of a lower-dimensional subspace, the slow manifold (SM), shown in Fig 1A, to which the system quickly relaxes, and along which it slowly moves, until it reaches the systems stable fixed point.  #@NEW_LINE#@#  This behavior can be exploited if we assume that the system reaches the SM instantaneously.  #@NEW_LINE#@#  We can then describe the dynamics of the entire system in this lower-dimensional space and thus reduce the number of variables in our description of the deterministic system.  #@NEW_LINE#@#  However, we are interested in the stochastic dynamics.  #@NEW_LINE#@#  
The stochastic trajectories initially collapse to the region around the SM, about which they are confined, but along which they can move freely until one of the phenotypes fixates (Fig 1A).  #@NEW_LINE#@#  Fluctuations that take the system off the SM are quickly quashed back to another point on the SM; however, the average position on the SM to which a fluctuation returns is not necessarily the same as that from which the fluctuation originated.  #@NEW_LINE#@#  A crucial element of the dynamics in this stochastic setting is that the form of the noise, combined with that of the trajectories back to the SM, can induce a bias in the dynamics along the SM (Fig 1B and Fig S1).  #@NEW_LINE#@#  This bias is the origin of the stochastic selection reversal that we explore.  #@NEW_LINE#@#  To capture this behavior while simultaneously removing the fast timescales in the stochastic system, we map all fluctuations off the SM along deterministic trajectories back to the SM (30).  #@NEW_LINE#@#  This procedure essentially assumes that any noisy event that takes the system off the SM is instantaneously projected back to another point on the SM.  #@NEW_LINE#@#  
For clarity, we briefly describe the dynamics when =0.  #@NEW_LINE#@#  In this case the birth rates of phenotypes X and Y are identical.  #@NEW_LINE#@#  Instead of the two nonzero fixed points, Kx and Ky, found above, the deterministic system now has a line of fixed points, referred to as a center manifold (CM) (31).  #@NEW_LINE#@#  The CM is identical to the SM in the limit 0.  #@NEW_LINE#@#  It is given byy=Ky(0)Kx(0)(Kx(0)x),q=pxx,[5]and shown graphically in Fig 1B.  #@NEW_LINE#@#  The separation of timescales in the system is now at its most pronounced, because there are strictly no deterministic dynamics along the CM following the fast transient to the CM.  #@NEW_LINE#@#  However, the stochastic system still features dynamics along the CM.  #@NEW_LINE#@#  Applying the procedure outlined in ref.  #@NEW_LINE#@#  30, we arrive at a description of the stochastic dynamics in a single variable, the frequency of producers along the CM,x=bR2x(1xKx(0))(x)+1R(t),[6]where(x)=2(Kx(0)Ky(0)(Kx(0)Ky(0))2)[Kx(0)Ky(0)+(Kx(0)Ky(0))x].Here (t) is a Gaussian white noise term with a correlation structure given in Eq.  #@NEW_LINE#@#  S18.  #@NEW_LINE#@#  Together with Eq.  #@NEW_LINE#@#  5, Eq.  #@NEW_LINE#@#  6 approximates the dynamics of the entire system.  #@NEW_LINE#@#  Note that whereas Eq.  #@NEW_LINE#@#  6 predicts a noise-induced directional drift along the CM [controlled by (x)], a deterministic analysis predicts no dynamics, because the CM is by definition a line of fixed points.  #@NEW_LINE#@#  This directional drift along the CM results from the projection bias illustrated in Fig 1B.  #@NEW_LINE#@#  If px greater than 0, then Kx(0) greater than Ky(0), and so (x) greater than 0; thus the public good production by phenotype X induces a selective pressure that selects for X along the center manifold.  #@NEW_LINE#@#  
The origin of the term (x) in Eq.  #@NEW_LINE#@#  6 can be understood more fully by exploring its implications for the invasion probabilities of X and Y, denoted x and y.  #@NEW_LINE#@#  These can be straightforwardly calculated because the system is one dimensional (SI Probability of Fixation for the Reduced Public Good Model).  #@NEW_LINE#@#  We findx=1Ny,andy=1Nx,[7]where x greater than y as long as px greater than 0 (Eq.  #@NEW_LINE#@#  3).  #@NEW_LINE#@#  The term (x) can thus be interpreted as resulting from the stochastic advantage the producers have at the population level from reaching higher carrying capacities in isolation, which makes them more stochastically robust to invasion attempts.  #@NEW_LINE#@#  This result is independent of the spatial scale R (and therefore of the population size) as long as R is finite.  #@NEW_LINE#@#  
If 0, the system does not collapse to the CM, but rather to the SM.  #@NEW_LINE#@#  At leading order in , the equation for the SM is given by Eq.  #@NEW_LINE#@#  5.  #@NEW_LINE#@#  Upon removing the fast dynamics, the effective dynamics of x can now be shown to take the form (Eq.  #@NEW_LINE#@#  S23)x=bx(1xKx(0))(1R2(x))+1R(t),[8]where (t) and (x) are the same as in Eq.  #@NEW_LINE#@#  6.  #@NEW_LINE#@#  The SDE now consists of two components.  #@NEW_LINE#@#  The deterministic contribution, governed by , exerts a selective pressure against phenotype X, due to its reduced birth rate.  #@NEW_LINE#@#  The stochastic term (x) exerts a pressure in favor of phenotype X, resulting, as in the case =0 discussed above, from the producers stochastic robustness to invasions.  #@NEW_LINE#@#  
Thus, when  greater than 0, a trade-off emerges in the stochastic system between the stochastic advantage to public good production (due to increased population sizes) and the deterministic cost producers pay (in terms of birth rates).  #@NEW_LINE#@#  If the birth costs are not too high, producers will be selected for, which constitutes a reversal in the direction of selection from the deterministic prediction.  #@NEW_LINE#@#  Specifically, we can calculate the condition on the metabolic cost that ensures that the producers are fitter than the nonproducers (i.e., x greater than y):less_thanbR2log[pxr].  #@NEW_LINE#@#  [9]Whereas for no metabolic cost producers consistently have a stochastic advantage regardless of typical population size (Eq.  #@NEW_LINE#@#  7), for nonzero production costs, the population must be sufficiently small that stochastic effects, governed by R2, are dominant.  #@NEW_LINE#@#  Fig 2 and Fig S2 show that the theory predicts well the trade-off in the underlying stochastic model [1].  #@NEW_LINE#@#  
We have shown that stochastic selection reversal is more prevalent when R is not large.  #@NEW_LINE#@#  Meanwhile our analytic results have been obtained under the assumption that R is large, which allowed us to use the diffusion approximation leading to Eq.  #@NEW_LINE#@#  2 and aided the timescale elimination procedure that yielded Eq.  #@NEW_LINE#@#  8.  #@NEW_LINE#@#  We therefore expect that although stochastic selection reversal will become more prominent as R is reduced, the quality of our analytic predictions may suffer.  #@NEW_LINE#@#  Despite this caveat, it is the small R regime, in which stochastic selection reversal is a more prominent force, that is interesting to us.  #@NEW_LINE#@#  Small values of R are associated with small population sizes.  #@NEW_LINE#@#  Although it is conceivable that populations of macroorganisms may consist of a small number of individuals, this limit is not so pertinent to the study of microorganisms.  #@NEW_LINE#@#  In the next section, however, we show that by incorporating space, the constraint of small population size can be relaxed.  #@NEW_LINE#@#  


Spatial_Amplification  #@NEW_LINE#@#  
In this section we consider a metapopulation on a grid: Each subpopulation (patch) has a small size so that demographic noise continues to be relevant locally, but the number of subpopulations is large so that the overall population in the system is large.  #@NEW_LINE#@#  This method of incorporating demographic stochasticity into spatial systems has proved to be successful in the modeling of microbial populations (7).  #@NEW_LINE#@#  We consider a grid of C patches.  #@NEW_LINE#@#  The dynamics within each patch are given by the transitions in Eq.  #@NEW_LINE#@#  1 and coupled to the surrounding patches by the movement of the phenotypes and public good.  #@NEW_LINE#@#  A patch will produce migrants at a rate proportional to its density.  #@NEW_LINE#@#  Producers X and nonproducers Y disperse with a probability rate m to a surrounding region, whereas the public good diffuses into neighboring regions at a rate D. Once again the diffusion approximation can be applied to obtain a set of SDEs approximating the system dynamics,dxijd=xij(bx+rqij(xij+yij))+m(Lx)ij+xij(t)R,dyijd=yij(by+rqij(xij+yij))+m(Ly)ij+yij(t)R,dqijd=pxxijqij+D(Lq)ij+qij(t)R,[10]where ij is the patch on row i and column j.  #@NEW_LINE#@#  The operator L is the discrete Laplacian operator (Lx)ij=4xij+x(i1)j+x(i+1)j+xi(j1)+xi(j+1).  #@NEW_LINE#@#  If by greater than bx, the deterministic dynamics predict that the producers will always go extinct.  #@NEW_LINE#@#  
First, we discuss some important limit case behavior for this system.  #@NEW_LINE#@#  In the limit of large dispersal rate m and diffusion rate D, the stochastic system behaves like a well-mixed population with a spatial scale cR2 (i.e., the spatial structure is lost).  #@NEW_LINE#@#  In this case, as the size of the spatial system is increased, the effective population size also increases, and as a consequence selection reversal for producing phenotypes becomes less likely (Eq.  #@NEW_LINE#@#  9).  #@NEW_LINE#@#  
We next consider the low-dispersal, zero diffusion limit.  #@NEW_LINE#@#  For sufficiently low dispersal, any incoming mutant will first either fixate or go to extinction locally before any further dispersal event occurs.  #@NEW_LINE#@#  Because each dispersal/invasion/extinction event resolves quickly, at the population level, the system behaves like a Moran process on a graph (4), with each node representing a patch.  #@NEW_LINE#@#  The fitness of a patch is the probability that it produces a migrant and that that migrant successfully invades a homogeneous patch of the opposite type, following the approach used in ref.  #@NEW_LINE#@#  17.  #@NEW_LINE#@#  Denoting the fitness of producing and nonproducing patches by Wx and Wy, respectively, we haveWx=mNxx,Wy=mNyy,[11]where Ni (i=x,y) is the mean carrying capacity of phenotype i in a homogeneous patch, and i are the invasion probabilities of a type i mutant in a type ji patch.  #@NEW_LINE#@#  The fixation probabilities of a homogeneous patch in a population of the opposite phenotype can now be calculated using standard results (4).  #@NEW_LINE#@#  Let i (i=x,y) denote the probability that type i takes over the metapopulation when starting from one patch of type i in a population otherwise composed entirely of patches of the opposite phenotype.  #@NEW_LINE#@#  Theni=1ri11riC,fori=x,yandrx=WxWy,ry=WyWx.  #@NEW_LINE#@#  [12]If we start from a single invading mutant, the probability that it takes over the entire population (i.e., invasion probability) is the product between the probability that it takes over its home patch, i, and the probability that the newly invaded home patch fixates into the metapopulation, i:x=xx,y=yy.  #@NEW_LINE#@#  [13]In the infinite patch limit (C), x and y depend on rx, the patch fitness ratio defined in Eq.  #@NEW_LINE#@#  12.  #@NEW_LINE#@#  If rx greater than 1, x1rx1 and y0, whereas if rxless_than1, the converse is true.  #@NEW_LINE#@#  This means that, in the infinite patch, low dispersal, zero diffusion limit, the condition for the stochastic reversal of selection is weakened from x greater than y toNxx greater than Nyy.  #@NEW_LINE#@#  [14]Spatial structure therefore has the ability to enhance the stochastic reversal observed in the small well-mixed system.  #@NEW_LINE#@#  An approximate analytic form for the above condition can be obtained in terms of the original parameters:less_than2bR2log[pxr].  #@NEW_LINE#@#  [15]Once again, our analytical results are well supported by simulations (Fig 3).  #@NEW_LINE#@#  The critical production rate for the invasion probability of producers to exceed that of nonproducers has been decreased, as predicted by Eqs.  #@NEW_LINE#@#  9 and 15.  #@NEW_LINE#@#  Producers can therefore withstand higher production costs in spatially structured environments.  #@NEW_LINE#@#  
It is important to note that whereas Eq.  #@NEW_LINE#@#  14 depends on the mean number of producers and nonproducers on a homogeneous patch (Nx and Ny), it is independent of the number of individuals in the entire metapopulation in the large C limit.  #@NEW_LINE#@#  The interaction between these two spatial scales leads to results that can appear counterintuitive.  #@NEW_LINE#@#  Demographic noise, as we have discussed, leads to producing patches being more fit at the patch level (Eq.  #@NEW_LINE#@#  11).  #@NEW_LINE#@#  However, when a large number of patches are considered, the demographic noise at the metapopulation level is reduced.  #@NEW_LINE#@#  This leads to the system following trajectories that appear deterministic at the level of the metapopulation, even though the path they follow is entirely the result of demographic stochasticity at the within-patch level (Fig 4).  #@NEW_LINE#@#  Movie S1 displays the individual dynamics of the patches that compose the trajectory illustrated in Fig 4.  #@NEW_LINE#@#  
Away from the small dispersal, zero diffusion limit, the dramatic selection reversal predicted by the analytical results is clearly weakened (Fig 3).  #@NEW_LINE#@#  Although selection reversal is still found across a range of m and D values, if either dispersal or diffusion is too high, the selection reversal breaks down.  #@NEW_LINE#@#  It is therefore important to understand what order of magnitude estimates for the values of m and D may be biologically reasonable.  #@NEW_LINE#@#  
Insights_from_S_cerevisiae  #@NEW_LINE#@#  
In the following section, we attempt to contextualize our model with reference to a S. cerevisiae yeast system, which has been previously identified as a biological example of a population that features public good producers and nonproducers.  #@NEW_LINE#@#  The model we have presented is general and therefore it could not capture the full biological detail of this particular system.  #@NEW_LINE#@#  For instance, it has been noted that some degree of privatization of the public good occurs in even the well-mixed experimental system (23), a behavior we do not consider in our model.  #@NEW_LINE#@#  However, setting our model in this context can provide some insight into the scenarios in which we might expect stochastic selection reversal to be a biologically relevant phenomenon.  #@NEW_LINE#@#  
An S. cerevisiae yeast cell metabolizes simple sugars, such as glucose, to function.  #@NEW_LINE#@#  However, when simple sugars are scarce, the yeast can produce invertase, an enzyme that breaks down complex sugars, such as sucrose, to release glucose (32).  #@NEW_LINE#@#  Invertase is produced at a metabolic cost and, because digestion of sucrose occurs extracellularly, most of the benefits of its production are shared by the population.  #@NEW_LINE#@#  Specifically in the case of S. cerevisiae, SUC2, the wild-type strain, produces invertase, whereas the laboratory-cultured mutant suc2 does not (33).  #@NEW_LINE#@#  In terms of our model parameters, the baseline birth rates, bx and by, represent, respectively, SUC2 and suc2 reproduction in the absence of invertase.  #@NEW_LINE#@#  This could be understood as arising from yeast directly metabolizing sucrose [a less energetically beneficial metabolic route (32)] or as the result of some extrinsically imposed low glucose concentration in the system.  #@NEW_LINE#@#  The rate r would then represent the additional birth rate in the presence of invertase.  #@NEW_LINE#@#  The form of our specified reactions (Eq.  #@NEW_LINE#@#  1) assumes that the presence of invertase leads directly to a yeast reproduction event.  #@NEW_LINE#@#  In reality invertase must break down the sucrose into glucose and then slowly absorb the glucose.  #@NEW_LINE#@#  We are therefore essentially assuming that the sucrose is abundant, its breakdown by invertase instantaneous, and the glucose absorption rapid and occurring in discrete packets, with each packet absorbed leading to a reproduction event.  #@NEW_LINE#@#  
In the well-mixed system, our analytic predictions indicate that stochastic selection reversal can occur only if the population is very small.  #@NEW_LINE#@#  Because this is an unrealistic assumption in the case of yeast cultures, we would predict that nonproducers should come to dominate a well-mixed population.  #@NEW_LINE#@#  In a spatially structured population, however, this constraint is relaxed because it requires only small interaction regions.  #@NEW_LINE#@#  For S. cerevisiae, we can obtain order of magnitude estimates for the majority of parameters in our model, including the rate of public good diffusion (SI Order of Magnitude Parameter Estimates and Table S1).  #@NEW_LINE#@#  Using these estimates together with our analytic results for the spatial public goods system, we find that stochastic selection reversal could feasibly be an important phenomenon for promoting the evolution of microbial public goods production in spatial settings (Fig 3B).  #@NEW_LINE#@#  Given this finding, we now consider a spatial experiment on S. cerevisiae and ask how its results might be interpreted in light of the insights developed with our simple model.  #@NEW_LINE#@#  
In ref.  #@NEW_LINE#@#  33, SUC2 and suc2 were experimentally competed on an agar plate.  #@NEW_LINE#@#  It was found that nonproducing suc2 could not invade from rare (1% of initial yeast population) and in fact decreased in frequency, becoming undetectable at long times (around 800 generations).  #@NEW_LINE#@#  This result suggests that in a spatial setting, invertase-producing SUC2 yeast are robust to invasions, which is in qualitative agreement with our theoretical predictions.  #@NEW_LINE#@#  The experiments yielded an additional result, the appearance of a hyperproducing mutant.  #@NEW_LINE#@#  This hyperproducing phenotype produced invertase at 1.5 times the rate of standard producers and existed at higher densities.  #@NEW_LINE#@#  The hyperproducer appeared to evolve naturally and establish robust colonies during the competition experiments between nonproducers and producers.  #@NEW_LINE#@#  However, when separate competition experiments were conducted between the hyperproducers and the producers, the hyperproducers failed to demonstrate any appreciable fitness advantage over the producers.  #@NEW_LINE#@#  This finding potentially suggests an optimal invertase production rate, whereby the hyperproducers managed to establish and grow during the SUC2suc2 competition experiments by exploiting nonproducing regions due to a relative fitness advantage, but could not invade regions of space occupied by producers.  #@NEW_LINE#@#  Interestingly, our model also predicts that an intermediate optimal production rate may exist, depending on how the cost of production scales with the production rate.  #@NEW_LINE#@#  Suppose a hyperproducer, U, produces at a rate pu=appx, paying a metabolic cost ab to its birth rate, such that bu=b(1ab).  #@NEW_LINE#@#  The pairwise invasion probabilities of each phenotype can then be calculated (SI Pairwise Invasibility for Nonproducers, Producers, and Hyperproducers).  #@NEW_LINE#@#  We define the fitter phenotype in a pair as that with the larger invasion probability.  #@NEW_LINE#@#  The potential fitness rankings are investigated in Fig 5 as a function of px and  (which we recall also alter pu and bu).  #@NEW_LINE#@#  We draw particular attention to Fig 5, Right, in which ab greater than ap.  #@NEW_LINE#@#  In this scenario, the hyperproducers pay a disproportionate cost for their increased production rate compared with the producers.  #@NEW_LINE#@#  This can be interpreted as diminishing returns for production.  #@NEW_LINE#@#  In this case, there exist regions where the producer is the optimal phenotype (regions A and B, in purple and cyan, respectively).  #@NEW_LINE#@#  Specifically, region A displays a similar behavior to that observed in ref.  #@NEW_LINE#@#  33, in which producers win out over both nonproducers and hyperproducers, but hyperproducers are more likely to invade nonproducing populations.  #@NEW_LINE#@#  


Generality_of_Results  #@NEW_LINE#@#  
We have shown that demographic stochasticity can reverse the direction of selection in a public good model.  #@NEW_LINE#@#  In this section we show that the mechanism responsible for this phenomenon is by no means particular to this model.  #@NEW_LINE#@#  We consider a general scenario, with a phenotype X1, which is the focus of our study, and a number of discrete ecosystem constituents, Ei.  #@NEW_LINE#@#  In the public good model for instance, we would label the public good itself as an ecosystem constituent; however, more generally this could be a food source, a predator, or anything else that interacts with the phenotypes.  #@NEW_LINE#@#  The state of the ecosystem influences the birth and death of the phenotype and in turn the presence of the phenotype influences the state of the ecosystem, altering the abundances of the constituents.  #@NEW_LINE#@#  We assume that the system lies at a unique, stable stationary state, precluding the possibility of periodic behavior.  #@NEW_LINE#@#  Suppose that a new phenotype, X2, arises.  #@NEW_LINE#@#  We assume that the second phenotype is only slightly better at exploiting the ecosystem than X1, although its influence on the ecosystem may be very different.  #@NEW_LINE#@#  For instance, in the public good model, nonproducers have a small birth rate advantage over producers, but do not produce the public good.  #@NEW_LINE#@#  Which phenotype is more likely to invade and fixate in a resident population of the opposite type?  #@NEW_LINE#@#  
The stochastic model for this system can be constructed in a similar manner to the public good model; the dynamics are described by a set of probability transition rates (analogous to Eq.  #@NEW_LINE#@#  1).  #@NEW_LINE#@#  We restrict the transitions by specifying that although the two phenotypes compete, there is no reaction that instantaneously changes both of their numbers in the population.  #@NEW_LINE#@#  This final condition simply means that they should not, for instance, be able to mutate from one type to another during their lifetime or to prey on each other.  #@NEW_LINE#@#  A parameter R is introduced, to once again govern the typical scale of the system.  #@NEW_LINE#@#  The model is analyzed in the mesoscopic limit, by introducing the continuous phenotype (x1,x2) and ecosystem (ei) variables as (x1,x2,e)=(nx1,nx2,ne)/R2 and applying the diffusion approximation.  #@NEW_LINE#@#  For large but finite R, the mesoscopic description takes the formx1=x1F(0)(x,e)x1F()(x,e)+R11(t),x2=x2F(0)(x,e)+R12(t),ei=Fi(x,e)+R1i(t),i=3,J,[16]where  is small and governs selective pressure against X1.  #@NEW_LINE#@#  The assumption that there is no reaction that instantaneously changes the number of both phenotypes ensures that the correlation structure of the noise terms takes the form1(t)1(t)=(tt)x1H(0)(x,e),2(t)2(t)=(tt)x2H(0)(x,e),1(t)2(t)=0,with  taken to be of order R2.  #@NEW_LINE#@#  This assumption, made here to isolate the effect of varying carrying capacity from any other intraspecies dynamics, means that whereas the magnitude of fluctuations in the number of both phenotypes is dependent on the state of the system, (x,e), the fluctuations themselves are not correlated with each other.  #@NEW_LINE#@#  Restrictions on the microscopic model that yield the above SDE description are addressed more thoroughly in SI Generality of Results.  #@NEW_LINE#@#  The form of Eq.  #@NEW_LINE#@#  16 makes the nature of the system we describe more clear; it consists of two competing phenotypes, which reproduce according to replicator dynamics (1) with equal fitness at leading order in .  #@NEW_LINE#@#  
In the special case =0, both phenotypes are equally fit, regardless of their influence on the ecosystem variables ei.  #@NEW_LINE#@#  The degeneracy of the dynamics in x1 and x2 ensures the existence of a deterministic CM.  #@NEW_LINE#@#  We assume that the structure of F(0)(x) and Fi(x) is such that the CM is one dimensional (there are no further degenerate ecosystem variables) and that it is the only stable state in the interior region xi greater than 0.  #@NEW_LINE#@#  A separation of timescales is present if the system collapses to the CM much faster than the stochastic dynamics.  #@NEW_LINE#@#  In practical terms, the timescale of collapse can be inferred as the inverse of the nonzero eigenvalues of the system, linearized about the CM (34), whereas the timescale of fluctuations will be of order R2 (35).  #@NEW_LINE#@#  When  greater than 0, the timescale elimination procedure can still be applied if O(R2).  #@NEW_LINE#@#  The effective one-dimensional description of the system now takes the formx1=D(x1)+R2S(x1)+R1(t),[17]where the term D(x1) is the deterministic contribution to the effective dynamics and S(x1) is the stochastic contribution, whereas (t) is an effective noise term.  #@NEW_LINE#@#  The form these functions take is dependent on F(0)(x,e), F()(x,e), and Fi(x,e), as well as on the noise correlation structure, H(0)(x,e); however, it is independent of the structure of the demographic noise acting on the ecosystem variables (Eqs.  #@NEW_LINE#@#  S55, S56, and S66).  #@NEW_LINE#@#  
The core assumption we have made to derive Eq.  #@NEW_LINE#@#  17 is essentially that the systems ecological processes act on a faster timescale than its evolutionary processes.  #@NEW_LINE#@#  Even in this general setting, insights about the systems stochastic dynamics can still be drawn (SI Generality of Results).  #@NEW_LINE#@#  If =0, the fixation probability of phenotype X1 is independent of the initial conditions of the ecosystem variables e. In fact, it is equal to the initial fraction of X1 in the population, n10/(n10+n20).  #@NEW_LINE#@#  The invasion probability of mutant X1 phenotype fixating in a resident X2 population, however, depends on the stationary state of the X2 population; this stationary state defines the initial invasion conditions (the denominator for the fixation probability of X1).  #@NEW_LINE#@#  Denoting by N1 and N2 the average numbers of phenotypes X1 and X2 in their respective stationary states, we find 1=1/N2 and 2=1/N1, generalizing Eq.  #@NEW_LINE#@#  7.  #@NEW_LINE#@#  Therefore, for =0 the phenotype that exists at higher densities is more likely to invade and fixate than its competitor, a consequence of its robustness to invasions.  #@NEW_LINE#@#  This result holds for any choice of finite R. In an ensemble of disconnected populations subject to repeated invasions, we would observe the emergence of high-density phenotypes if this phenotype does not carry a cost.  #@NEW_LINE#@#  Although this seems like a reasonable and indeed natural conclusion, it is one entirely absent from the deterministic analysis.  #@NEW_LINE#@#  
If  greater than 0, general results for the phenotype fixation probabilities cannot be obtained.  #@NEW_LINE#@#  However, if N1 greater than N2, in the limit 0 we have shown that 1 greater than 2.  #@NEW_LINE#@#  From this result, it can be inferred that the term S(x1) is positive on average along the slow manifold (Eq.  #@NEW_LINE#@#  S62).  #@NEW_LINE#@#  Therefore, if phenotype X1 exists in isolation at higher densities than phenotype X2, there will exist a stochastically induced pressure favoring the invasion of phenotype X1.  #@NEW_LINE#@#  Meanwhile, by construction we expect D(x1) to be positive along the SM because phenotype X1 exploits the ecosystem environment less effectively than phenotype X2.  #@NEW_LINE#@#  There is therefore a trade-off for competing phenotypes between increasing their phenotype population density and increasing their per capita growth rate.  #@NEW_LINE#@#  Note that the noise-induced selection function S(x1) need not be strictly positive; indeed it may become negative along regions of the SM.  #@NEW_LINE#@#  This behavior potentially allows for stochastically induced fixed points along the SM, around which the system might remain for unusually large periods of time.  #@NEW_LINE#@#  This result may provide a theoretical understanding of the coexistence behavior observed in ref.  #@NEW_LINE#@#  36.  #@NEW_LINE#@#  
The term S(x1) is moderated by a factor R2 (Eq.  #@NEW_LINE#@#  8) or, more physically, by the typical size of the population.  #@NEW_LINE#@#  The stochastically induced selection for the high-density phenotype therefore becomes weaker as typical system sizes increase.  #@NEW_LINE#@#  The trade-off will be most crucial in small populations or, as illustrated in the public good model, in systems with a spatial component.  #@NEW_LINE#@#  If the phenotypes and ecosystem variables move sufficiently slowly in space, the results of Eqs.  #@NEW_LINE#@#  13 and 14 can be imported, with the understanding that 1 and 2 must be calculated for the new model under consideration.  #@NEW_LINE#@#  
It is worth noting that the precise functional form of 1 and 2 identified in the deterministically neutral case (=0) is dependent on the assumption that phenotype noise fluctuations are uncorrelated.  #@NEW_LINE#@#  Although correlated fluctuations (for instance, resulting from mutual predation of the phenotypes) can still be addressed with similar methods to those used here, there is then the potential for the emergence of further noise-induced selection terms (SI Generality of Results).  #@NEW_LINE#@#  Careful specification of the phenotype interaction terms is therefore needed to determine to what degree these additional processes might amplify or dampen the induced selection we have identified.  #@NEW_LINE#@#  

Discussion  #@NEW_LINE#@#  
In this paper, we have shown that stochastic effects can profoundly alter the dynamics of systems of phenotypes that change the carrying capacity of the total population.  #@NEW_LINE#@#  Most strikingly, selection can act in the opposite direction from that of the deterministic prediction if the phenotype that is deterministically selected for also reduces the carrying capacity of the population.  #@NEW_LINE#@#  The methods used to analyze the models outlined in this paper are based on the removal of fast degrees of freedom (30).  #@NEW_LINE#@#  The conclusions drawn are therefore expected to remain valid as long as the rate of change of the phenotype population composition occurs on a shorter timescale than that of the remaining ecological processes.  #@NEW_LINE#@#  
By illustrating this phenomenon in the context of public good production, we have revealed a mechanism by which the dilemma of cooperation can be averted in a very natural way: by removing the unrealistic assumptions of fixed population size inherent in Moran-type game theoretic models.  #@NEW_LINE#@#  The potential for such behavior has been previously illustrated with the aid of a modified Moran model (17) and a single-variable WrightFisher-type model (18) that assumes discrete generations.  #@NEW_LINE#@#  However, we have shown that the mechanism can manifest more generally in multivariate continuous-time systems.  #@NEW_LINE#@#  Our analysis may also provide a mathematical insight into the related phenomenon of fluctuation-induced coexistence that has been observed in simulations of a similar public good model featuring exogenous additive noise (36): Such coexistence may rely on a similar conflict between noise-induced selection for producing phenotypes and deterministic selection against them.  #@NEW_LINE#@#  
For biologically reasonable public good production costs, selection reversal is observed only in systems that consist of a very small number of individuals.  #@NEW_LINE#@#  However, by building a metapopulation analog of the model to account for spatial structure, the range of parameters over which selection reversal is observed can be dramatically increased, as long as public good diffusion and phenotype dispersal between populations are not large.  #@NEW_LINE#@#  Two distinct mechanisms are responsible for these results.  #@NEW_LINE#@#  First, including spatial structure allows for small, local effective population sizes, even as the total size of the population increases.  #@NEW_LINE#@#  This facilitates the stochastic effects that lead to selection reversal.  #@NEW_LINE#@#  Second, because producer populations tend to exist at greater numbers (or higher local densities), they produce more migrants.  #@NEW_LINE#@#  The stochastic advantage received by producers is thus amplified, as they are not only more robust stochastically to invasions, but also more likely to produce invaders.  #@NEW_LINE#@#  Away from the low-dispersal, zero public good diffusion limit, the effect of selection reversal is diminished, but is still present across a range of biologically reasonable parameters.  #@NEW_LINE#@#  The analytical framework we have outlined may prove insightful for understanding the simulation results observed in ref.  #@NEW_LINE#@#  37, where a similar metapopulation public good model was considered.  #@NEW_LINE#@#  In addition to fixation of producers (in the low dispersaldiffusion limit) and fixation of nonproducers (in the high dispersaldiffusion limit), ref.  #@NEW_LINE#@#  37 observed an intermediate parameter range in which noise-induced coexistence was possible.  #@NEW_LINE#@#  Although our model does not feature such a regime, extending our mathematical analysis to their model would be an interesting area for future investigations.  #@NEW_LINE#@#  However, it must be noted that coexistence in a stochastic setting is inherently difficult to quantify analytically, as for infinite times some phenotype will always go extinct.  #@NEW_LINE#@#  
That space can aid the maintenance of cooperation is well known (38, 39).  #@NEW_LINE#@#  Generally, however, this is a result of spatial correlations between related phenotypes, so that cooperators are likely to be born neighboring other cooperators (and share the benefits of cooperation) whereas defectors can extract benefits only at the perimeter of a cooperating cluster.  #@NEW_LINE#@#  This is not what occurs in the model presented in this paper.  #@NEW_LINE#@#  Indeed, whereas we have assumed in our analytic derivation of the invasion probability that dispersal is small enough that each patch essentially contains a single phenotype, we find that the phenomenon of selection reversal manifests outside this limit (see Movie S2 in which a majority of patches contain a mix of producers and nonproducers).  #@NEW_LINE#@#  Instead, producing phenotypes have a selective advantage due to the correlation between the fraction of producers on a patch and the total number of individuals on a patch, which provides both resistance to invasions and an increased dispersal rate.  #@NEW_LINE#@#  
Most commonly in spatial game theoretic models of cooperationdefection, individuals are placed at discrete locations on a graph (40, 41).  #@NEW_LINE#@#  In contrast, by using a metapopulation modeling framework we have been able to capture the effect of local variations in phenotype densities across space, which is the driver of selection amplification in our model.  #@NEW_LINE#@#  Nevertheless, the question that remains is which modeling methodology is more biologically reasonable.  #@NEW_LINE#@#  The answer clearly depends on the biological situation.  #@NEW_LINE#@#  However, in terms of testability, our model makes certain distinct predictions.  #@NEW_LINE#@#  In ref.  #@NEW_LINE#@#  41, producers and nonproducers were modeled as residing on nodes of a spatial network, with a public good diffusing between them.  #@NEW_LINE#@#  The investigation concludes that both lower public good diffusion and lower spatial dimensions (e.g., systems on a surface rather than in a volume) should encourage public good production, essentially by limiting the surface area of producing clusters.  #@NEW_LINE#@#  Whereas our investigation certainly predicts that lower public good diffusion is preferable, stochastic selection reversal does not require that the spatial dimension of the system is low.  #@NEW_LINE#@#  In fact, the result used in Eq.  #@NEW_LINE#@#  12 holds for patches arranged on any regular graph (where each vertex has the same number of neighbors) and thus could be used to describe patches arranged on a cubic, or even hexagonal, lattice.  #@NEW_LINE#@#  
In our final investigation, we have shown that stochastic selection reversal is not an artifact of a specific model choice, but may be expected across a wide range of models.  #@NEW_LINE#@#  These models consist of two phenotypes, competing under weak deterministic selection strength, reproducing according to replicator dynamics and interacting with their environment.  #@NEW_LINE#@#  Thus, the phenomenon of selection reversal is very general; however, it depends strongly on how one specifies a selective gradient.  #@NEW_LINE#@#  We take one phenotype to have a stochastic selective advantage over the other if a single mutant is more likely to invade a resident population of the opposite type.  #@NEW_LINE#@#  Such a definition is also used in standard stochastic game theoretic models (4).  #@NEW_LINE#@#  A key difference here, however (where the population size is not fixed), is that the invasion probability is not specified by a unique initial condition; we must also specify the size of the resident population.  #@NEW_LINE#@#  We have assumed that the invading mutant encounters a resident population in its stationary state.  #@NEW_LINE#@#  This is by no means an unusual assumption; it is the natural analog of the initial conditions in a fixed population size model.  #@NEW_LINE#@#  Essentially it assumes a very large time between invasion or mutation events, an approach often taken in adaptive dynamics (42).  #@NEW_LINE#@#  
If instead we assumed a well-mixed system far from the steady state, our results would differ.  #@NEW_LINE#@#  For instance, suppose the system initially contains equal numbers of the two phenotypes.  #@NEW_LINE#@#  For the case when the two phenotypes have equal reproductive rates (=0), the phenotypes have equal fixation probability.  #@NEW_LINE#@#  For  greater than 0, the phenotype with the higher birth rate has the larger fixation probability, regardless of its influence on the systems carrying capacity.  #@NEW_LINE#@#  This apparent contradiction with the results we developed in the body of this paper echoes the observations of rK selection theory (43): Selection for higher birth rates (r selection) acts on frequently disturbed systems that lie far from equilibrium, whereas selection for improved competitive interactions or carrying capacities (K selection) acts on rarely disturbed systems.  #@NEW_LINE#@#  In addition, rK selection theory suggests that K-selected species are typically larger in size and, as a consequence, consist of a lower number of individuals (19).  #@NEW_LINE#@#  This finding indicates a further parallel with our stochastic model framework, because selection for higher carrying capacities requires that the typical number of individuals (of both the low and high carrying capacity phenotypes) is small.  #@NEW_LINE#@#  Although the mechanism that leads us to these conclusions is distinct, our stochastic analysis provides a complementary view of rK-selection theory, which may be applicable to simple microorganisms.  #@NEW_LINE#@#  In exploring this analogous behavior further, future investigations may also benefit from considering the results of ref.  #@NEW_LINE#@#  15, where it was shown that stochastically induced selection can change direction near carrying capacity.  #@NEW_LINE#@#  
Although we have implicitly developed our results in the low mutation limit, including mutation explicitly in the modeling framework is possible.  #@NEW_LINE#@#  This would be an interesting extension to the framework.  #@NEW_LINE#@#  In the well-mixed scenario, it is likely that the inclusion of mutation will complicate the intuition developed here: Although larger populations are more robust to invasions, they are also more prone to mutations, by virtue of their size.  #@NEW_LINE#@#  Whereas this result may be offset by the additional benefits garnered in the spatial analog of the model, a complex set of timescale-dependent behaviors is likely to emerge.  #@NEW_LINE#@#  
Finally, we propose a rigorous analytical investigation of existing models that conform to the framework we have outlined; an example is the work conducted in refs.  #@NEW_LINE#@#  36 and 37, which we believe to be mathematically explainable within our formalism.  #@NEW_LINE#@#  In the context of induced selection, whereby deterministically neutral systems become nonneutral in the stochastic setting, similar ideas have already been extended to disease dynamics (16) and the evolution of dispersal (44, 45).  #@NEW_LINE#@#  The extension of selection reversal to such novel ecological models may provide further insight.  #@NEW_LINE#@#  Furthermore, this general scheme may be of relevance to many other systems in ecological and biological modeling, such as cancer, for which the evolution of phenotypes that profoundly alter the carrying capacity of a cell type can be of primary importance.  #@NEW_LINE#@#  

SI_Obtaining_the_SDE_System_from_the_Microscopic_Individual-Based_Model  #@NEW_LINE#@#  
We begin with a model consisting of a discrete number of entities, two phenotypes of a species, X and Y and a public good Q.  #@NEW_LINE#@#  They interact according to the transitionsX/R2bxX+X,Y+X/R2X,X+Qr/R2X+X+Q,XpxX+Q,Y/R2byY+Y,Y+X/R2Y,Y+Qr/R2Y+Y+Q,Q.  #@NEW_LINE#@#  [S1]The term R2 occurs in all terms involving two reactants.  #@NEW_LINE#@#  It thus controls the interaction probability between instances of the phenotypes and the public good.  #@NEW_LINE#@#  Taking larger R decreases the interaction probability of phenotypes X and Y and the public good and allows the populations to grow to greater numerical abundances.  #@NEW_LINE#@#  The parameter R can thus be understood as a measure of the spatial scale of the system; when R is increased, the probability of interactions in the well-mixed system is decreased whereas the number of individuals the system can contain is increased.  #@NEW_LINE#@#  
Let us denote n=(nx,ny,nq) the numbers of X, Y, and Q, respectively.  #@NEW_LINE#@#  Then the dynamics of this system can be described by the set of ODEsdP(n,t)dt=nn[T(n|n)P(n,t)T(n|n)P(n,t)],[S2]where P(n,t) is the probability of the state being in state n at time t, and T(n|n), the probability transition rate, is the probability per unit time of transitioning from state n to n. Formally this is known as the master equation (47).  #@NEW_LINE#@#  Given the reactions in Eq.  #@NEW_LINE#@#  S1 the probability transition rates can be expressed asT1(nx+1,ny,nq|nx,ny,nq)=bxnx+rR2nxnq,T2(nx,ny+1,nq|nx,ny,nq)=byny+rR2nynq,T3(nx1,ny,nq|nx,ny,nq)=R2nx(nx+ny),T4(nx,ny1,nq|nx,ny,nq)=R2ny(nx+ny),T5(nx,ny,nq+1|nx,ny,nq)=pxnx,T6(nx,ny,nq1|nx,ny,nq)=nq.  #@NEW_LINE#@#  [S3]Let us now make a change of variables into the scaled expressions x=(x,y,q)=(nx,ny,nq)/R2.  #@NEW_LINE#@#  Substituting the probability transition rates into Eq.  #@NEW_LINE#@#  S2, we find recurrent factors of 1/R2 appearing in the resulting expression.  #@NEW_LINE#@#  These terms are associated with the local transitions from state n to the surrounding states.  #@NEW_LINE#@#  If R2 is sufficiently large, the population grows larger (as the crowding terms in Eq.  #@NEW_LINE#@#  S1 grow small).  #@NEW_LINE#@#  We may then Taylor expand Eq.  #@NEW_LINE#@#  S2 in R1, assuming that the variables (x,y,q) are approximately continuous (28).  #@NEW_LINE#@#  Truncating at second order in R4, we arrive at a PDE for p(x,y,q,t) of the formp(x,t)t=1R2ixi[Ai(x)p(x,t)]+12R4i,j2xixj[Bij(x)p(x,t)],x=(x1,x2,x3)(x,y,q).  #@NEW_LINE#@#  [S4]This is a diffusion approximation in a population genetics context (22), but more generally is akin to the KramersMoyal expansion (28) or a nonlinear analog of the van Kampen expansion (47).  #@NEW_LINE#@#  The forms of A(x) and B(x), given transition rates in Eq.  #@NEW_LINE#@#  S3, are found to beAx(x)=x(bx+rq(x+y)),Ay(x)=y(by+rq(x+y)),Aq(x)=pxxq,[S5]andBxx(x)=x(bx+rq+x+y),Byy(x)=y(by+rq+x+y),Bqq(x)=pxx+q,Bij=0ij.  #@NEW_LINE#@#  [S6]Further, it can be shown that the above PDE is equivalent to the set of It SDEs (48)dxd=A(x)+1R(),[S7]where =tR2 and (t) are Gaussian white noise terms with zero mean and correlationsi()j()=()Bij(x).  #@NEW_LINE#@#  [S8]Note that the correlations are multiplicative and thus dependent on the state of the system.  #@NEW_LINE#@#  

SI_Obtaining_a_One-Dimensional_Effective_Public_Good_Model  #@NEW_LINE#@#  
In this section we seek to identify and remove the fast modes of the SDE system (Eq.  #@NEW_LINE#@#  S7) and thus obtain an effective one-dimensional description of the dynamics.  #@NEW_LINE#@#  We make use of methods of fast-mode elimination described in ref.  #@NEW_LINE#@#  30.  #@NEW_LINE#@#  First, we note that the deterministic nullcline for q is given byq=pxxZq(x,y).  #@NEW_LINE#@#  [S9]Therefore, if the production and decay of public good occur much faster than the processes associated with the phenotypes, we would expect the public good to quickly attain this value, after which its dynamics would be slaved to those of x and y.  #@NEW_LINE#@#  Note that deterministically, substituting Eq.  #@NEW_LINE#@#  S9 into Eq.  #@NEW_LINE#@#  S5 recovers a LotkaVolterra competition model for two competing species.  #@NEW_LINE#@#  
To make further analytic progress, we begin by considering the quasi-neutral limit in which bx=byb.  #@NEW_LINE#@#  Under these conditions, the deterministic system exhibits a CM given by Eq.  #@NEW_LINE#@#  S9 andy=[b(rpx)x]Zy(x).  #@NEW_LINE#@#  [S10]The CM is stable for  greater than rpx, and we assume that this condition holds throughout this paper.  #@NEW_LINE#@#  Calculating the intersection of the CM at the boundaries y=0 and x=0 allows us to determine the mean population size in the quasi-neutral (=0) limit when it consists of only producers and nonproducers, respectively:Nx(0)=R2Kx(0),Kx(0)=(brpx),[S11]Ny(0)=R2Ky(0),Ky(0)=(brpy).  #@NEW_LINE#@#  [S12]These parameters will be useful in the following analysis.  #@NEW_LINE#@#  
Deterministically, the system comes to rest on a point along the CM (defined by Eqs.  #@NEW_LINE#@#  S9 and S10), which depends on the systems initial conditions.  #@NEW_LINE#@#  When stochasticity is included, the CM ceases to exist in any true sense.  #@NEW_LINE#@#  However, when the noise is small [already assumed in the derivation of SDEs (Eq.  #@NEW_LINE#@#  S7)], we can say that far from the CM, we expect the dynamics to be dominated by the deterministic collapse to the CM, whereas in the vicinity of the CM, we expect noise to play a more important role, driving the slow change in population composition until one or the other of the phenotypes fixates.  #@NEW_LINE#@#  We wish to exploit this timescale separation and obtain an effective description of the dynamics in terms of a single variable.  #@NEW_LINE#@#  
To begin, we note that the stochastic dynamics along the CM have two components.  #@NEW_LINE#@#  First, noise can move the system neutrally along the CM.  #@NEW_LINE#@#  Second, noise can take the system off the CM, at which point we expect the deterministic component of the dynamics to become more prevalent, driving the system back to the CM.  #@NEW_LINE#@#  To capture the effect of both of these processes on the effective dynamics along the CM, we implement a nonlinear projection of the stochastic system to the CM.  #@NEW_LINE#@#  Essentially this assumes that fluctuations that take the system away from the manifold are instantaneously mapped along deterministic trajectories back to the CM.  #@NEW_LINE#@#  To formalize this, the mapping z=f(x,y,q) is introduced, where f(x,Zy(x),Zq(x))=x; that is, z gives the position on the CM, parameterized by x, which intersects a deterministic trajectory beginning at (x,y,q).  #@NEW_LINE#@#  The mapping can be determined analytically from the observation that the quantity x/y in Eq.  #@NEW_LINE#@#  S7 is invariant in this quasi-neutral (bx=by) scenario.  #@NEW_LINE#@#  ThereforezZy(z)=xy,z=bx(pr)x+y.  #@NEW_LINE#@#  [S13]The effective dynamics for z can now be straightforwardly calculated by differentiating Eq.  #@NEW_LINE#@#  S13 with respect to t. We must note, however, that because the original SDE system is defined in the It sense, the normal rules of calculus no longer apply.  #@NEW_LINE#@#  Applying Its rules of calculus appropriately (30, 47), we find that the effective dynamics along the CM take the formz=1R2S(z)+1R(t),[S14]whereS(z)=12(2zx2Bxx(x)+2zy2Byy(x))|x=z,y=Zy(z),q=Zq(z),[S15]=2pxrz{1+1b22z[b(2pxr)+pxr(pxr)z]},=2b(Kx(0)Ky(0)(Kx(0))3(Ky(0))2)z(Kx(0)z)[Kx(0)Ky(0)+(Kx(0)Ky(0))z],[S16]and(t)=0,(t)(t)=(tt)(z),with(z)=([zx]2Bxx(x)+[zy]2Byy(x))|x=z,y=Zy(z),q=Zq(z),=2z{b+1b23z[b22(3pxr)+bpxr(3pxr2)z+px2r2(pxr)z2]},[S17]=2b(1(Kx(0))3(Ky(0))2)z(Kx(0)z)[Kx(0)Ky(0)+(Kx(0)Ky(0))z]2.  #@NEW_LINE#@#  [S18]Note that because the mapping in Eq.  #@NEW_LINE#@#  S13 is independent of q, both Eq.  #@NEW_LINE#@#  S15 and Eq.  #@NEW_LINE#@#  S17 do not depend on the noise correlations in q.  #@NEW_LINE#@#  
Whereas the deterministic system features no dynamics along the CM, the effective SDE (Eq.  #@NEW_LINE#@#  S14) does feature a drift in the mean state, embodied by S(z).  #@NEW_LINE#@#  Understanding the origin of this induced drift term requires considering the following.  #@NEW_LINE#@#  We envisage fluctuations arising from a single point on the CM, x(0), which take the system to a point off the CM, x(1) (Fig S1).  #@NEW_LINE#@#  The point x(1) is clearly stochastic, but its distribution is approximately Gaussian, with a variance defined by B(x(0)).  #@NEW_LINE#@#  The fluctuation is now mapped back along a deterministic trajectory to a point x(2) on the CM.  #@NEW_LINE#@#  The location x(2) is also stochastic [dependent as it is on x(1)] and has its own distribution.  #@NEW_LINE#@#  The presence of the term S(z) in Eq.  #@NEW_LINE#@#  S14 is indicative of the fact that the mean of the distribution of x(2) is not x(0); fluctuation events on average are mapped back to the CM with a preferred direction, inducing drift along the CM.  #@NEW_LINE#@#  Note that S(z) is positive along the length of the CM, which is defined on the interval [0,Kx(0)].  #@NEW_LINE#@#  
We now turn our attention to the case when  greater than 0.  #@NEW_LINE#@#  As long as  is small, a separation of timescales is still present, although now no CM exists.  #@NEW_LINE#@#  Instead there is a SM, to which the deterministic system quickly relaxes, before slowly moving along it until phenotype Y fixates.  #@NEW_LINE#@#  The equations for the population size at the boundaries of the SM are formally given byNx=R2Kx,Kx=(bxrpx)Kx(0)+O(),[S19]Ny=R2Ky,Ky=(byrpy)Kx(0)+O().  #@NEW_LINE#@#  [S20]To proceed with the stochastic calculation, we assume O(R2) and work order by order in R1.  #@NEW_LINE#@#  At leading order, the equation for the SM is identical to that for the CM, Eqs.  #@NEW_LINE#@#  S9 and S10.  #@NEW_LINE#@#  The mapping to the SM is also unchanged at leading order from the quasi-neutral case (Eq.  #@NEW_LINE#@#  S13).  #@NEW_LINE#@#  We proceed as before to obtain an effective description of the system dynamics in terms of z (30), now obtaining the dynamicsz=D(z)+1R2S(z)+1R(t),[S21]whereD(z)=(dzdxAx(x)+dzdyAy(x))|x=z,y=Zy(z),q=Zq(z),=bz[1(pxrb)z],=bKx(0)z(Kx(0)z),[S22]and S(t) and (t) retain their form from the quasi-neutral case, Eqs.  #@NEW_LINE#@#  S16 and S18.  #@NEW_LINE#@#  The function D(z) is the deterministic contribution to the dynamics along the SM.  #@NEW_LINE#@#  This expression is what would be obtained using standard fast variable elimination techniques on the deterministic system.  #@NEW_LINE#@#  From Eq.  #@NEW_LINE#@#  S22, we can see that D(z) is positive along the length of the SM and therefore acts (as we would expect) to increase the selective advantage of the nonproducers, phenotype Y.  #@NEW_LINE#@#  There is therefore a conflict between the two components of the drift in the system.  #@NEW_LINE#@#  The term D(z) works against producers along the length of the SM, whereas S(z) creates a selective pressure in favor of producers.  #@NEW_LINE#@#  Ultimately, which term is more prevalent is dependent on the parameters  and R (Eq.  #@NEW_LINE#@#  S21); small R leads to a small population size in which stochastic effects are stronger, and so producers are more likely to be selected for.  #@NEW_LINE#@#  In contrast, when the deterministic cost for good production is increased, the nonproducers have an increased advantage over producers.  #@NEW_LINE#@#  
Adopting the notation used in the main text, in which we set z=x (which is valid on the CM and SM at leading order), the expression for the SDE (Eq.  #@NEW_LINE#@#  S21) can alternatively be writtenx=bKx(0)x(Kx(0)x)(1R2(x))+1R(t),[S23]where(x)=2(Kx(0)Ky(0)(Kx(0))2(Ky(0))2)[Kx(0)Ky(0)+(Kx(0)Ky(0))x].  #@NEW_LINE#@#  [S24]  #@NEW_LINE#@#  

SI_Probability_of_Fixation_for_the_Reduced_Public_Good_Model  #@NEW_LINE#@#  
The fixation probability for a phenotype in a single variable system can be calculated using standard methods (28).  #@NEW_LINE#@#  To conduct the calculation, we need expressions for the absorbing boundaries of the problem.  #@NEW_LINE#@#  For the reduced system given in Eq.  #@NEW_LINE#@#  S21, these lie at z=0 and z=Kx(0).  #@NEW_LINE#@#  The fact that the boundary for the problem exists at z=Kx(0), rather than at z=Kx, is a consequence of the order to which we are working in .  #@NEW_LINE#@#  At this order the SM is approximated by the expression for the CM, which intersects the absorbing boundaries x=0 and y=0 at z=0 and z=Kx(0), respectively.  #@NEW_LINE#@#  Denoting Q(z0) the fixation probability of producing phenotype X given an initial frequency z0 on the CM/SM, the fixation probability can be conveniently be expressed asQ(z0)=z=0z0(z)dzz=0Kx(z)dz,(z)=exp[0z2(RD(z)+S(z))(z)dz].  #@NEW_LINE#@#  [S25]Substituting for D(z), S(z), and (z) from Eqs.  #@NEW_LINE#@#  S22, S16, and S18, we findQ(z0)=1G(z0)1G(Kx),G(z0)=exp[(Ny(0)Kx(0)z0)(Kx(0)Ky(0)+(Kx(0)Ky(0))z)].  #@NEW_LINE#@#  [S26]The nature of these expressions can be understood more intuitively if we move from considering the initial frequency of X on the CM, z0=nx0/R2, to considering the initial fraction of phenotype X on the CM, fz0.  #@NEW_LINE#@#  The fraction and number of phenotype X on the CM are related byfz0=zz+Zy(z),z=Kx(0)Ky(0)fz0Kx(0)(Kx(0)Ky(0))fz0.  #@NEW_LINE#@#  [S27]Substituting this into Eq.  #@NEW_LINE#@#  S26, we findQ(fz0)=1exp[Ny(0)fz0]1exp[Ny(0)],Q(fz0)|=0=fz0.  #@NEW_LINE#@#  [S28]On first appraisal, the fixation probabilities in Eq.  #@NEW_LINE#@#  S28 appear to share the form of the well-mixed Moran model with weak selection.  #@NEW_LINE#@#  There is, however, one crucial distinction: The relation between fz0 and (x0,y0,q0) is dependent on the form of the CM/SM and is not necessarily symmetric under the interchange of X and Y.  #@NEW_LINE#@#  For instance, let us consider the quasi-neutral case (=0) with the population initially consisting of a mutant X in a population of the Y phenotype in its stationary state.  #@NEW_LINE#@#  Then fz0=1/Ny.  #@NEW_LINE#@#  In contrast, if the mutant is of phenotype Y, and the resident population consists of phenotype X in the stationary state, fz0=11/Nx.  #@NEW_LINE#@#  Because Nx and Ny are distinct, these frequencies are not the same, and Eq.  #@NEW_LINE#@#  S28 is not symmetric under the interchange of phenotypes, undermining its apparent similarities to the Moran model.  #@NEW_LINE#@#  
In this section a crucial aspect of the selection reversal has been elucidated.  #@NEW_LINE#@#  The selection reversal along the SM is a result of the differing densities at which the populations of X and Y phenotypes reside in isolation.  #@NEW_LINE#@#  In a deterministic system, we would define the fitter phenotype as the one that fixates at long times.  #@NEW_LINE#@#  In a stochastic Moran-type model, the fitter phenotype is defined as that with the greater invasion probability.  #@NEW_LINE#@#  Because Moran-type models feature a constant population size, N, the invasion probability of a mutant phenotype is defined by a unique initial condition, a single mutant, and N1 residents.  #@NEW_LINE#@#  In systems such as the public good model discussed in this paper, the invasion probability is no longer defined uniquely by the specification of a single invading mutant; we must also define the size of the resident phenotype population and the public good density.  #@NEW_LINE#@#  If the system has been allowed to relax to a stationary state before the mutant is introduced, then selection reversal along the CM may be present, and it is possible for the producing phenotype to have a larger fixation probability than the nonproducing phenotype.  #@NEW_LINE#@#  Thus, the producing phenotype may be fitter.  #@NEW_LINE#@#  

SI_Pairwise_Invasibility_for_Nonproducers__Producers__and_Hyperproducers  #@NEW_LINE#@#  
In this section we explore the pairwise invasibility of three separate phenotypes, nonproducers, producers, and hyperproducers.  #@NEW_LINE#@#  We begin by noting that, under the assumption that the birth rates differ by only a small amount from phenotype to phenotype, the invasion probability of phenotype i in a resident population j, i|j, can be expressed asi|j=1exp[(bibj)/(Nj(0))]1exp[(bibj)R2/].  #@NEW_LINE#@#  [S29]We therefore define phenotype i as fitter than phenotype j if i|j greater than j|i.  #@NEW_LINE#@#  Let us now explicitly express the birth rates of each of the phenotypes asNonproducer:by=b,Producer:bx=b(1),Hyperproducer:bu=b(1ab).  #@NEW_LINE#@#  [S30]We now wish to obtain an expression for the critical costs to birth rate  at which producers are fitter than nonproducers, hyperproducers are fitter than nonproducers, and hyperproducers are fitter than producers.  #@NEW_LINE#@#  To do this we must solve i|j=j|i for  for each pair of phenotypes.  #@NEW_LINE#@#  An analytic solution is available if we set =R2 with  of order one and Taylor expand in R2.  #@NEW_LINE#@#  Truncating at first order, we find that the critical cost for species i to be fitter than species j, i|j is given byi|j=log[(pir)/(pjr)][(bibj)/]R2.  #@NEW_LINE#@#  [S31]We note that this provides eight different possible scenarios of fitness ranking, described in Fig S3.  #@NEW_LINE#@#  Substituting in our equations for the birth rates, Eq.  #@NEW_LINE#@#  S30, these expressions becomex|y=bR2log[pxr],[S32]u|y=abbR2log[pur],[S33]u|x=(ab1)bR2log[pxrpur].  #@NEW_LINE#@#  [S34]Clearly the exact scenarios that emerge for a given set of parameters depend on the relationship between px and pu.  #@NEW_LINE#@#  We make the assumptionpu=appx.  #@NEW_LINE#@#  [S35]For ap greater than ab, the hyperproducer pays a discounted cost to its birth rate for its additional good production.  #@NEW_LINE#@#  In this situation, only scenarios CF are possible in Fig S3.  #@NEW_LINE#@#  It is always better to be a hyperproducer or a nonproducer, depending on the production rate px and .  #@NEW_LINE#@#  This all or nothing result makes intuitive sense; if the hyperproducer produces much more than the producer, but pays only fractionally more to its birth rate, any region in which production is favored will be disproportionately advantageous to the hyperproducers.  #@NEW_LINE#@#  In contrast, if apless_thanab, the hyperproducer receives decreasing production returns as a function of the cost it pays to birth in comparison with the producer.  #@NEW_LINE#@#  In this case, scenarios in Fig S3 A and B and Fig S3 E and F are possible.  #@NEW_LINE#@#  Either producers or nonproducers are favored, and hyperproducers are never favored.  #@NEW_LINE#@#  

SI_Generality_of_Results  #@NEW_LINE#@#  
We begin by specifying in a very general way the dynamics of an arbitrary individual based model (IBM) with m distinct types of constituent, fully described by a set of u reaction rates.  #@NEW_LINE#@#  The model can be expressed in chemical reaction notation asi=1maiXiri=1mbiXi,=1,u,[S36]where ai and bi respectively specify the reactants and products of the th reaction, and py are the reaction rate constants (for example, Eq.  #@NEW_LINE#@#  S1).  #@NEW_LINE#@#  The stoichiometric matrix is defined by i=biai, whose elements give the change in number of the ith species due to the th reaction.  #@NEW_LINE#@#  Together with the rate constants r, the stoichiometric matrix allows us to express the transition ratesT(n+|n)=ri=1mainiR2,[S37]where R2 once again is a controlled measure of how often constituents interact (Eq.  #@NEW_LINE#@#  S3).  #@NEW_LINE#@#  In the well-mixed model, it therefore directly controls the typical area of the system.  #@NEW_LINE#@#  Together with the master equation [S2], the full stochastic dynamics are specified.  #@NEW_LINE#@#  
With a general notation now in hand, we now begin to define the specific type of system we will analyze.  #@NEW_LINE#@#  We consider a system consisting of two phenotypes, X1 and X2, who interact with a set of discrete ecosystem variables Xi, for i=3,,N.  #@NEW_LINE#@#  The state of the system at any time is given by the number of each phenotype and ecosystem constituent n=(n1,n2,n3,,nN).  #@NEW_LINE#@#  The situation we envisage is as follows: Whereas the interplay between the phenotypes and the ecosystem is relevant for the dynamics, we are primarily interested in the evolutionary dynamics and outcome of competition between the two phenotypes.  #@NEW_LINE#@#  We make the following assumptions on their dynamics;  #@NEW_LINE#@#  
The phenotypes may, however, differ significantly in their effect on the ecosystem, so that one phenotype may deplete or increase ecosystem constituents in an entirely distinct way from the other (for instance, the production of a public good by phenotype X in Eq.  #@NEW_LINE#@#  S1).  #@NEW_LINE#@#  
As R is increased so too does the number of each phenotype and ecosystem constituent.  #@NEW_LINE#@#  If R is sufficiently large, once again a system-size expansion of the master equation can be conducted.  #@NEW_LINE#@#  Making the change of variables x1=n1/R2, x2=n2/R2, and ei=ni2/R2, we obtain the set of It SDEsdx1dt=x1[F(0)(x,e)F(1)(x,e)]+1R1(t),dx2dt=x2F(0)(x,e)+1R2(t),deidt=hi(x,e)+1Ri(t),i=1,N.  #@NEW_LINE#@#  [S41]The deterministic contribution to the SDEs can be determined from the transitions viax1[F(0)(x,e)F(1)(x,e)]==1u1T[R2(x,e)T+|(x,e)T],[S42]x2F(0)(x,e)==1u2T[R2(x,e)T+|(x,e)T],[S43]hi(x,e)==1u(i+2)T[R2(x,e)T+|(x,e)T].  #@NEW_LINE#@#  [S44]Note that the relationship between Eqs.  #@NEW_LINE#@#  S42 and S43 is controlled by assumption ii.  #@NEW_LINE#@#  The correlations in the noise meanwhile are given by1(t)1(t)=(tt)lim0=1u12T[R(x,e)+|(x,e)],[S45]2(t)2(t)=(tt)lim0=1u22T[R(x,e)+|(x,e)],[S46]1(t)2(t)=0,[S47]i(t)j(t)=(tt)lim0=1ui(j+2)T[R(x,e)+|(x,e)],[S48]i(t)j(t)=(tt)lim0=1u(i+2)(j+2)T[R(x,e)+|(x,e)],[S49]at leading order in .  #@NEW_LINE#@#  The lack of noise correlation between the phenotypes, Eq.  #@NEW_LINE#@#  S47, is a consequence of assumption iii.  #@NEW_LINE#@#  Assumption ii allows us to rewrite Eqs.  #@NEW_LINE#@#  S45 and S46 as1(t)1(t)=(tt)x1H(x,e),2(t)2(t)=(tt)x2H(x,e).  #@NEW_LINE#@#  [S50]An example of a system where this condition is not enforced is explored in SI Illustrating Generality with Reference to a Complementary System: The Stochastic LotkaVolterra System.  #@NEW_LINE#@#  
To begin our analysis of the SDEs, a quasi-neutral limit is considered in which =0.  #@NEW_LINE#@#  Then the deterministic ODEs for the system (the SDEs in the limit R) lead to a manifold of fixed points associated with the focus phenotypes.  #@NEW_LINE#@#  We now make two additional assumptions:  #@NEW_LINE#@#  
We then choose to parameterize the manifold in terms of x1, which for clarity we label z on the CM.  #@NEW_LINE#@#  The CM is then defined by the set of equationsx1=z,x2=Z2(z),ei=Zei(z)i=2,N.  #@NEW_LINE#@#  [S51]The system dynamics are now entirely analogous to those of the public good model in the quasi-neutral limit.  #@NEW_LINE#@#  Deterministically, the system comes to rest at a point on the CM (which depends on the systems initial conditions) at which it stays indefinitely and, when stochasticity is included the system, moves along the CM until one of the phenotypes fixates.  #@NEW_LINE#@#  A timescale separation is present as long as the composition of the population changes on a slower timescale than that of the collapse to the CM.  #@NEW_LINE#@#  In practice, the timescale of the collapse to the CM can be inferred from the eigenvalues of Eq.  #@NEW_LINE#@#  S41 linearized about the CM.  #@NEW_LINE#@#  The magnitude of the smallest nonzero eigenvalue is indicative of the slowest component of collapse to the CM (34).  #@NEW_LINE#@#  This should be much larger than the timescale at which the system moves along the CM, which is of order R1 (35).  #@NEW_LINE#@#  
To implement the timescale separation, a nonlinear projection is applied to the system that maps fluctuations back to the CM.  #@NEW_LINE#@#  This can be seen to be equivalent to transforming into the deterministically invariant variable whose existence is guaranteed by the existence of the CM (31), setting the dynamics in all other variables equal to zero, and evaluating the variables themselves on the CM.  #@NEW_LINE#@#  What form does this mapping take, in the quasi-neutral limit, for Eq.  #@NEW_LINE#@#  S41?  #@NEW_LINE#@#  Because the dynamical equations for the phenotypes take on the form of degenerate replicator equations in the limit 0, the ratio x1/x2 is deterministically invariant, regardless of the other parameters.  #@NEW_LINE#@#  Therefore, the nonlinear mapping may be obtained by solving the following equation for z:zZ2(z)=x1x2,z=Y(x1,x2).  #@NEW_LINE#@#  [S52]The resulting effective description for the quasi-neutral system on the CM can be denotedz=1RS(z)+1R(t).  #@NEW_LINE#@#  [S53]Note that whereas the deterministic system evaluated on the CM had no drift dynamics, the reduced system may.  #@NEW_LINE#@#  Mathematically, this is a consequence of the fact that the equations are defined strictly in the It sense (from the underlying IBM) and therefore the normal rules of calculus do not apply.  #@NEW_LINE#@#  Instead, any nonlinear transformation induces a drift, in general given byS(z)=12[ij2(2zxixjBij)+ijN(2zeiejBeij)]|x1=z,x2=Z2(z),ei=Zei(z).  #@NEW_LINE#@#  [S54]However, because the mapping z is independent of the ecosystem variables e (Eq.  #@NEW_LINE#@#  S52), Eq.  #@NEW_LINE#@#  S54 can be simplified toS(z)=12ij2(2zxixjBij)|x1=z,x2=Z2(z),ei=Zei(z).  #@NEW_LINE#@#  [S55]The form of the correlations in (t) is now given by(z)=ij2([zxi]i[zxj]jBij(x))|x=z,x2=Z2(z),ei=Zei(z),[S56]where once again we have taken advantage of the property (dz/dei)=0 for all i.  #@NEW_LINE#@#  
In this very general scenario, what inferences can we make about S(z)?  #@NEW_LINE#@#  To answer this question, it is convenient to return to our original SDEs, Eq.  #@NEW_LINE#@#  S41, and implement the timescale separation in a different fashion.  #@NEW_LINE#@#  We begin by transforming into variables measuring the total size of the x1 and x2 population and the fraction of type x1:NT=x1+x2,f1=x1x1+x2,x1=f1NT,x2=NT(1f1).  #@NEW_LINE#@#  [S57]Applying this transformation, taking care to account for the impact of It calculus, we arrive at the following SDEs for the system:df1dt=12R2i,j=122f1xixjBij+1R1(t),dNTdt=NTF(0)(x,e)+1R2(t),deidt=hi(x,e)+1Ri(t),i=1,N.  #@NEW_LINE#@#  [S58]By conducting the transformation, we immediately notice a few things.  #@NEW_LINE#@#  Most trivially, the forms of the noise correlations are now altered in all variables.  #@NEW_LINE#@#  Second, because the transformation into the variable NT was linear, its governing SDE contains no noise-induced elements.  #@NEW_LINE#@#  Finally, the nonlinear transformation into f1 has resulted in a noise-induced drift term.  #@NEW_LINE#@#  This drift term, however, is dependent only on the noise correlation structure between x1 and x2.  #@NEW_LINE#@#  Evaluating the dynamics for NT and e on the CM and substituting in the remaining expressions from Eqs.  #@NEW_LINE#@#  S47 and S50, we obtain the following one-dimensional SDE for f1,df1dt=1R1(t),[S59]where 1(t) is evaluated on the CM.  #@NEW_LINE#@#  There are no deterministic dynamics in our reduced-dimension description of f1.  #@NEW_LINE#@#  This result is a consequence of assumptions ii and iii.  #@NEW_LINE#@#  The equation for the fixation probability of phenotype X1 given an initial fraction f10 on the CM, Q(f10), is then, regardless of the noise form,Q(f10)=f10.  #@NEW_LINE#@#  [S60]Crucially however, f1 is evaluated on the CM, which may vary depending on the constitution of the population:f10=x10x10+Z2(x10).  #@NEW_LINE#@#  [S61]If [dZ2(x10)/dx10]less_than1, then the total phenotype population decreases with increasing x20, and phenotype X1 has a larger invasion probability than X2.  #@NEW_LINE#@#  From this we can infer that S(z) will be positive on average along the length of the CM:z=0N1/R2S(z)dz greater than 0.  #@NEW_LINE#@#  [S62]Therefore, the phenotype with the higher carrying capacity will be stochastically selected for in this quasi-neutral case, regardless of their interaction with the environment.  #@NEW_LINE#@#  We note once again that this result is in general dependent on assumption ii.  #@NEW_LINE#@#  If assumption ii does not hold, then there will be correlations between the fluctuations 1(t) and 2(t) and, rather than the equation for the time evolution of f1 featuring no mean drift (as in Eq.  #@NEW_LINE#@#  S59), there will be a noise-induced drift term favoring one or the other of the phenotypes.  #@NEW_LINE#@#  The exact form of this term will be highly dependent on the exact form of the interactions between the phenotypes, a full treatment of which lies outside the scope of this paper.  #@NEW_LINE#@#  
Now suppose that  greater than 0, so that the system is nonneutral.  #@NEW_LINE#@#  Now no CM exists.  #@NEW_LINE#@#  There is no line of deterministic fixed points and therefore no invariant variable to project our variables onto and reduce the problem.  #@NEW_LINE#@#  However, under the assumption that  is small there is still a separation of timescales.  #@NEW_LINE#@#  If  is sufficiently small, the slow manifold (and the projection to it) can be approximated by the results from the quasi-neutral case (Eqs.  #@NEW_LINE#@#  S51 and S52), plus an  correction.  #@NEW_LINE#@#  A perturbative analysis can thus be conducted, and, under the assumption the O(R2), at leading order we havez=D(z)+1R2S(z)+1R(t).  #@NEW_LINE#@#  [S63]The form of S(z) is unchanged from Eq.  #@NEW_LINE#@#  S54, whereas the new deterministic contribution to the drift takes the formD(z)=i=1N(dzdxidxidt)|x1=z,x2=Z2(z),e=Ze(z).  #@NEW_LINE#@#  [S64]Once again, however, the projection is simply a function of x1 and x2, and soD(z)=(x1F(0)(x)dzdx1+x2F(0)(x)dzdx2x1F(1)dzdx1)|x1=z,x2=Z2(z),e=Ze(z).  #@NEW_LINE#@#  [S65]Finally, we also know that in the limit 0 this deterministic contribution to the dynamics on the CM, D(z), should disappear.  #@NEW_LINE#@#  Therefore, the first two terms in the above equation must cancel, leaving us withD(z)=z(F(1)(x)dzdx1)|x1=z,xi=Zi(z).  #@NEW_LINE#@#  [S66]We now have a much simpler system to deal with.  #@NEW_LINE#@#  Say that F(1)(x) is strictly positive.  #@NEW_LINE#@#  Then this will be a term that consistently decreases the value of x1.  #@NEW_LINE#@#  Based on physical arguments, we would expect that, regardless of the form of , D(z) must be positive.  #@NEW_LINE#@#  We still require the exact form of z (Eq.  #@NEW_LINE#@#  S52) to make analytic progress and specific predictions.  #@NEW_LINE#@#  Generally, however, we have shown that S(z) will be positive as long as species X1 has a larger carrying capacity (subject to the above conditions).  #@NEW_LINE#@#  A consideration of Eq.  #@NEW_LINE#@#  S63 shows that even when the system is nonneutral, for sufficiently weak selection/small R, there will be a trade-off between stochastic strength in numbers and deterministic costs for high-density behavior.  #@NEW_LINE#@#  

SI_Illustrating_Generality_with_Reference_to_a_Complementary_System__The_Stochastic_LotkaVolterra_System  #@NEW_LINE#@#  
In SI Obtaining a One-Dimensional Effective Public Good Model it was noted that deterministically the public good model reduces to a competitive LotkaVolterra model under the elimination of the fast public good dynamics.  #@NEW_LINE#@#  However, it is important to note that although they may be deterministically equivalent at long times, due to alterations in the demographic noise structure the two systems have distinct behaviors.  #@NEW_LINE#@#  Despite this, the qualitative picture remains the same; for the quasi-neutral system, the fixation probability of each type is simply proportional to its initial fraction in the population, whereas when selection is introduced, there is playoff between stochastic and deterministic effects.  #@NEW_LINE#@#  To illustrate this finding, we investigate the stochastic LotkaVolterra competition model (SLVC), derived from first principles.  #@NEW_LINE#@#  
In this section we analyze a stochastic LotkaVolterra competition model, using the methods developed in SI Generality of Results.  #@NEW_LINE#@#  We assume a population composed of two phenotypes, X1 and X2, whose numbers in the system are measured by Nu.  #@NEW_LINE#@#  The phenotypes are born, die, and compete with each other.  #@NEW_LINE#@#  In particular, we define the system to be governed by the probability transition ratesT1(n1+1,n2|n1,n2)=b1n1,T2(n11,n2|n1,n2)=d1n1+c1R2n12+c2R2n1n2,T3(n1,n2+1|n1,n2)=b2n2,T4(n1,n21|n1,n2)=d2n2+c1R2n1n2+c2R2n22.Together with Eq.  #@NEW_LINE#@#  S2, this system fully specifies the stochastic dynamics.  #@NEW_LINE#@#  Taking the limit of large R, we can once again obtain a mesoscopic description of the system,dx1dt=x1((b1d1)c1x1c2x2)+1R1(t),dx2dt=x2((b2d2)c1x1c2x2)+1R2(t),[S67]where i(t) have correlation structure Eq.  #@NEW_LINE#@#  S8 with the Bij(x) term given byB11(x)=x1((b1+d1)+c1x1+c2x2),B22(x)=x2((b2+d2)+c1x1+c2x2),B12(x)B21(x)=0.  #@NEW_LINE#@#  [S68]Note that the noise structure is not the same as that in Eq.  #@NEW_LINE#@#  S50; two phenotypes with an equal effective reproduction rate b1d1=b2d2 have the same deterministic fitness, but distinct multiplicative noise.  #@NEW_LINE#@#  Phenotypes that are reproducing and dying more quickly are subject to greater noise as they have a larger rate of population turnover.  #@NEW_LINE#@#  We will, however, proceed to consider this more general scenario to illustrate what can happen when this assumption is not enforced.  #@NEW_LINE#@#  Finally, we impose a separation of timescales by settingb1d1=b(1),b2d2=b.  #@NEW_LINE#@#  [S69]A CM thus exists if =0 and an SM when  is small.  #@NEW_LINE#@#  The parameter b is an effective birth rate encompassing birth and death, whereas  is a fitness cost paid by phenotype X1 in terms of either a decreased birth rate or an increased death rate, relative to phenotype X2.  #@NEW_LINE#@#  
In the case =0, the system is quasi-neutral, and so a CM exists.  #@NEW_LINE#@#  The equation for the CM x2=Z2(x1) (Eq.  #@NEW_LINE#@#  S51) and its intersection with the boundaries x2=0 and x1=0, K1(0) and K2(0), respectively, areZ2(x1)=1c2(bc1x1),K1(0)=bc1,K2(0)=bc2.  #@NEW_LINE#@#  [S70]The parameters K1(0) and K2(0) give the frequency of X1 and X2 phenotypes in isolation.  #@NEW_LINE#@#  We assume that c2 greater than c1 and thus that phenotype X1 exists at higher densities than phenotype X2.  #@NEW_LINE#@#  Finally, the mapping from any point (x1,x2) to a coordinate z=x1 on the CM is determined from Eq.  #@NEW_LINE#@#  S52:z=bx1c1x1+c2x2.  #@NEW_LINE#@#  [S71]We can now obtain expressions for D(z), S(z), and (z) directly from Eqs.  #@NEW_LINE#@#  S66, S54, and S56:D(z)=z(bc1z),[S72]S(z)=2b2z(bc1z)(c2(b+d2)c1(b+d1)),[S73](z)=2b2z(bc1z)[z(c2(b+d2)c1(b+d1))+b(d1+)].  #@NEW_LINE#@#  [S74]The equation can now be solved to calculate the fixation probability of phenotype X1 along the CM.  #@NEW_LINE#@#  In terms of the initial fraction of X1, f1, we findQ(f1)=1(f1)1(1),(f1)=[(K1(0)d1+b)(d1(1f1)+d2f1+bK1(0)(1f1)+f1K2(0))],[S75]where  is a parameter given by=(1+K1(0)K2(0)R2bK2(0)(d1+b)K1(0)(d2+b)).  #@NEW_LINE#@#  [S76]Let us consider the special case =0.  #@NEW_LINE#@#  The fixation probability then becomesQ(f1)|=0=f1(d2+b)d1(1f1)+d2f1+b.  #@NEW_LINE#@#  [S77]The species with the lower death rate (and birth rate, because b is fixed) has a greater probability of fixation than the species with the higher birth rate/death rate.  #@NEW_LINE#@#  This insight, made in refs.  #@NEW_LINE#@#  9 and 10, is a result of the higher levels of noise experienced by the phenotype with the high birth and death rates.  #@NEW_LINE#@#  The higher levels of demographic noise experienced by the short-lived phenotype make it easier for the longer-lived phenotype (lower birth/death rates) to invade and fixate.  #@NEW_LINE#@#  For the purposes of this paper, we ignore such effects to focus on systems in which the carrying capacity of the phenotypes alone is responsible for the differences in noise experienced by the phenotypes on the CM/SM.  #@NEW_LINE#@#  
To this end, we now focus on the case b1=b2b, d1=d2d.  #@NEW_LINE#@#  In this case, Q(f1)|=0=f1, and Q(f1) in general becomesQ(f1)=1(f1)1(1),(f1)=(K1(0)K1(1f1)+f1K2(0)),[S78]where  is now given by=(1+K1(0)K2(0)R2(bd)(K2(0)K1(0))b).  #@NEW_LINE#@#  [S79]The invasion probabilities 1 and nq meanwhile are given by1=Q(N21),2=1Q(1N11).  #@NEW_LINE#@#  [S80]We can use the above expressions to obtain an approximate value for the maximum cost to birth rate that can be paid such that selection reversal is observed.  #@NEW_LINE#@#  Assuming N11 and N21 are of order  and Taylor expanding in , we find the cost to birth must obey1N2(bbd)(1N2N1) greater than [S81]for the direction of selection to be reversed.  #@NEW_LINE#@#  This is analogous to Eq.  #@NEW_LINE#@#  8 in the main text.  #@NEW_LINE#@#  

SI_Order_of_Magnitude_Parameter_Estimates  #@NEW_LINE#@#  
In this section we seek to identify an illustrative set of parameters to use in the model in order to emphasize that the insights developed are biologically reasonable.  #@NEW_LINE#@#  We wish to obtain order of magnitude estimates for the set of parameters b, px, pu, r, , , R, m, and D. We choose the yeast S. cerevisiae as our model organism.  #@NEW_LINE#@#  Whereas our model is more physically realistic than many mathematical public good models, we note that there are still choices that must be made in relating this physical system to our general framework.  #@NEW_LINE#@#  
Our model is constructed such that the uptake of one constituent of the public good, Q, by a phenotype, results in a reproduction event.  #@NEW_LINE#@#  In the context of S. cerevisiae, the type Q is thus shorthand for the amount of invertase that must be present in the system to break down sucrose into sufficient glucose for a reproduction event of the yeast.  #@NEW_LINE#@#  Let us define  to be the scaling between nq and the total number of invertase molecules, such that the number of invertase molecules is nq.  #@NEW_LINE#@#  To understand the relationship between our model parameters and physically measurable parameters, we begin by considering a simplified ODE system of our model:dxdt=x(b+rqx),[S82]dqdt=pxq.  #@NEW_LINE#@#  [S83]Whereas the total number of discrete invertase constituents is nqR2q, the total number of invertase molecules is R2q.  #@NEW_LINE#@#  Let  be a measure of the number of invertase molecules, such that =q.  #@NEW_LINE#@#  The ODEs in this more natural variable readdxdt=x(b+rx),[S84]ddt=px.  #@NEW_LINE#@#  [S85]The decay rate  is independent of the number of molecules that make up an invertase constituent Q, so we can take experimental measurements of the invertase molecular decay rate as values for .  #@NEW_LINE#@#  Meanwhile the molecular invertase production rate and reproduction rate due to invertase take on scaled forms of the parameters in our original ODEs:rmol=r,[S86]pmol=p.  #@NEW_LINE#@#  [S87]Whereas measurements of pmol are obtainable in the literature (Table S1), our estimation of rmol is complicated by the fact that it is an effective parameter.  #@NEW_LINE#@#  It must capture the increase in the reproductive rate due to invertase, which in reality is coupled to the reaction rate of invertase and sucrose into glucose, as well as to the uptake rate of glucose by yeast and the energy conversion to reproduction.  #@NEW_LINE#@#  We do, however, know the typical range of yeast reproduction rates.  #@NEW_LINE#@#  Let us define exp as the yeast reproduction rate measured experimentally.  #@NEW_LINE#@#  In turn, let eff be the effective per capita reproduction rate of yeast in the model:eff=b+rq.  #@NEW_LINE#@#  [S88]The yeast reproduction rate clearly depends on the amount of public good in the system, typically varying fromeff=b(allnonproducers)toeff=bpxr(allproducers).  #@NEW_LINE#@#  [S89]In reality, the reproduction rate of yeast in a system without any invertase is effectively zero; we have assumed some baseline birth rate for convenience in the model, which could be physically interpreted as being associated with an exogenous glucose concentration in the system.  #@NEW_LINE#@#  We assume that this is typically low, such that b is small, whereas the yeast approaches its maximum reproductive rate when it consists entirely of producers.  #@NEW_LINE#@#  
The parameter  controls death due to crowding.  #@NEW_LINE#@#  For simplicity this is the only form of death in the model.  #@NEW_LINE#@#  This choice leads, perhaps unnaturally, to the nonproducers (who exist at typically lower densities) having a much smaller death rate than producers.  #@NEW_LINE#@#  For the parameters chosen, however, we obtain per capita death rates on the order of 1 h for producers and 10 h for nonproducers.  #@NEW_LINE#@#  The parameter R meanwhile measures the assumed spatial interaction scale.  #@NEW_LINE#@#  It determines the typical number of individuals on each patch.  #@NEW_LINE#@#  We can use this value to infer the size of a patch.  #@NEW_LINE#@#  Denoting the diameter of a yeast cell as Lc and assuming that the hyperproducing cells in the stationary state can be packed on a grid, the size of each patch, Lp, can be approximated byLp=LcNu,[S90]=LcRKu.  #@NEW_LINE#@#  [S91]The parameters m and D are effective migration and diffusion rates in our model.  #@NEW_LINE#@#  To map these physical parameters these must be in turn scaled by the patch length.  #@NEW_LINE#@#  The public good diffusion rate must also be scaled by , which maps the discrete amount of invertase constituents Q to the number of invertase molecules.  #@NEW_LINE#@#  Denoting mexp and Dexp the physical migration and public good diffusion rate rates, it can be shown that (28)Dexp=Lp2D,mexp=Lp2m.  #@NEW_LINE#@#  [S92]The parameter choices that follow from these calculations are summarized in Table S2.  #@NEW_LINE#@#  
When considering the parameter choices summarized in Table S2, it is important to make a final point.  #@NEW_LINE#@#  Whereas both the approximations we have used, the system size expansion in SI Obtaining the SDE System from the Microscopic Individual-Based Model and the fast-variable elimination in SI Obtaining a One-Dimensional Effective Public Good Model, rely formally on R2 being large and  being small (O(R2) greater than ), in practical terms the procedures are relatively robust to this restriction.  #@NEW_LINE#@#  Indeed, throughout the body of the main text, R=4, whereas  is varied on the interval [0,0.1].  #@NEW_LINE#@#  In fact, we find that the approximate analytic expression we obtain for the invasion probabilities of the phenotypes, Eq.  #@NEW_LINE#@#  S28, describes the results obtained from simulation well, up to =R2, as illustrated in Fig S2.  #@NEW_LINE#@#  
In terms of the system size expansion, this robustness can in part be explained by the fact that the typical population sizes (Nx, Ny, and Nq) are proportional to R. For populations of fixed size N, SDEs for the system can be obtained by means of a Taylor expansion of the master equation (for example, Eq.  #@NEW_LINE#@#  S2) as a series in 1/N.  #@NEW_LINE#@#  A crucial feature of the system we are concerned with here, however, is that population sizes may vary, and so this technique is unavailable.  #@NEW_LINE#@#  Instead we conduct an expansion in the interaction scale R, which is proportional to the mean population size.  #@NEW_LINE#@#  Although R may not be a large number itself, increasing R leads to an associated increase in population size (Table S2).  #@NEW_LINE#@#  In turn, this leads to terms of higher order in the Taylor expansion of the master equation becoming subdominant (47), justifying the truncation that leads to Eq.  #@NEW_LINE#@#  S4.  #@NEW_LINE#@#  In contrast, the resilience of the fast-variable elimination approximation to such large values of  is surprising.  #@NEW_LINE#@#  

Acknowledgments  #@NEW_LINE#@#  
T.R.  #@NEW_LINE#@#  acknowledges funding from the Royal Society of London.  #@NEW_LINE#@#  C.E.T.  #@NEW_LINE#@#  acknowledges support from the Alfred P. Sloan Foundation (FR-2015-65382).  #@NEW_LINE#@#  

Footnotes  #@NEW_LINE#@#  


