article id="http://dx.doi.org/10.1073/pnas.1524685113"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Hierarchical decision processes that operate over distinct timescales underlie choice and changes in strategy  #@NEW_LINE#@#  

Significance  #@NEW_LINE#@#  
Decisions are guided by available information and strategies that link information to action.  #@NEW_LINE#@#  Following a bad outcome, two potential sources of errorflawed strategy and poor informationmust be distinguished to improve future performance.  #@NEW_LINE#@#  In a direction discrimination task where subjects decide by accumulating sensory evidence to a bound, we show that humans disambiguate sources of error by integrating expected accuracy and outcome over multiple choices.  #@NEW_LINE#@#  The strategy switches when the integral reaches a threshold.  #@NEW_LINE#@#  A hierarchy of decision processes in which lower levels integrate sensory evidence over short timescales, and higher levels interact with lower levels over longer timescales, quantitatively explains the behavior.  #@NEW_LINE#@#  Expected accuracy links these two levels and enables adaptive changes of decision strategy.  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
Decision-making in a natural environment depends on a hierarchy of interacting decision processes.  #@NEW_LINE#@#  A high-level strategy guides ongoing choices, and the outcomes of those choices determine whether or not the strategy should change.  #@NEW_LINE#@#  When the right decision strategy is uncertain, as in most natural settings, feedback becomes ambiguous because negative outcomes may be due to limited information or bad strategy.  #@NEW_LINE#@#  Disambiguating the cause of feedback requires active inference and is key to updating the strategy.  #@NEW_LINE#@#  We hypothesize that the expected accuracy of a choice plays a crucial rule in this inference, and setting the strategy depends on integration of outcome and expectations across choices.  #@NEW_LINE#@#  We test this hypothesis with a task in which subjects report the net direction of random dot kinematograms with varying difficulty while the correct stimulusresponse association undergoes invisible and unpredictable switches every few trials.  #@NEW_LINE#@#  We show that subjects treat negative feedback as evidence for a switch but weigh it with their expected accuracy.  #@NEW_LINE#@#  Subjects accumulate switch evidence (in units of log-likelihood ratio) across trials and update their response strategy when accumulated evidence reaches a bound.  #@NEW_LINE#@#  A computational framework based on these principles quantitatively explains all aspects of the behavior, providing a plausible neural mechanism for the implementation of hierarchical multiscale decision processes.  #@NEW_LINE#@#  We suggest that a similar neural computationbounded accumulation of evidenceunderlies both the choice and switches in the strategy that govern the choice, and that expected accuracy of a choice represents a key link between the levels of the decision-making hierarchy.  #@NEW_LINE#@#  

Results  #@NEW_LINE#@#  
Six human subjects performed a task in which they adapted their decision strategy in response to unpredictable changes in the environment.  #@NEW_LINE#@#  In this changing environment task (Fig 1A), subjects viewed a patch of stochastic moving dots (22) and reported the net motion direction (right or left) with a saccadic eye movement to a corresponding peripheral target.  #@NEW_LINE#@#  However, unlike conventional direction discrimination tasks, subjects were provided with two rightward and two leftward targets.  #@NEW_LINE#@#  The targets were arranged in two rightleft pairs above and below the dot patch and represented two distinct environments.  #@NEW_LINE#@#  On each trial, only one environment was correct.  #@NEW_LINE#@#  The correct environment stayed fixed for several trials and then changed without an explicit signal to subjects (Fig 1B).  #@NEW_LINE#@#  In addition to changes in the environment, we controlled the difficulty of the motion direction discrimination by randomly varying motion strength and duration across trials.  #@NEW_LINE#@#  Subjects received positive feedback only if their chosen target corresponded to both the correct motion direction and the correct environment.  #@NEW_LINE#@#  Negative feedback, however, could arise from choosing the wrong environment or direction target.  #@NEW_LINE#@#  Therefore, to determine when to shift their decision strategy from persisting in the old environment to exploring the new one, subjects needed to resolve ambiguous negative feedbacks based on the history of the experienced sensory evidence, choices, and feedbacks.  #@NEW_LINE#@#  
Before engaging in the changing environment task, subjects were introduced to a simple direction discrimination task with two targets that corresponded to the motion directions (22).  #@NEW_LINE#@#  Motion direction discrimination training continued until subjects achieved a high level of performance as indicated by low psychophysical thresholds (less_than17.0% for all subjects, pooled threshold = 13.1 ± 1.45%).  #@NEW_LINE#@#  This training extended to the changing environment task.  #@NEW_LINE#@#  Subjects maintained a high level of direction discrimination accuracy and low psychophysical thresholds for motion direction choices, irrespective of the reported environment (pooled threshold = 13.3 ± 0.24%).  #@NEW_LINE#@#  Similarly, all subjects exhibited improved motion choice accuracy for higher motion strength (Fig 2A and Fig S1A; Eq.  #@NEW_LINE#@#  1, 1 = 10.1 ± 0.26, P less_than 1010) and duration (Fig S2A; Eq.  #@NEW_LINE#@#  1, 2 = 0.4 ± 0.09, P = 3.8 × 107), consistent with previous studies (22, 23).  #@NEW_LINE#@#  Thus, a subjects ability to perform the direction discrimination was not compromised by the increased complexity of the changing environment task.  #@NEW_LINE#@#  
A crucial feature of the task design is that it explicitly dissociates choices about motion direction (direction choices, left versus right choice targets) and choices about the environment (environment choices, upper versus lower choice targets).  #@NEW_LINE#@#  This dissociation enabled us to directly measure when subjects switched environments and to assess the factors that shaped subjects decisions.  #@NEW_LINE#@#  Below, we report experimental results that elucidate those factors.  #@NEW_LINE#@#  Then, we explore the underlying computational mechanisms and provide a model that offers a quantitative explanation for the motion direction and environment choices based on within-trial accumulation of sensory evidence and across-trial integration of expected accuracy and feedback.  #@NEW_LINE#@#  
Environment_Choices_Were_Shaped_by_Integration_of_Feedback_and_Uncertainty_About_Motion_Direction_Across_Trials  #@NEW_LINE#@#  
Subjects rarely switched environments following positive feedback [P(switch) = 0.005; Fig 2B and Fig S1B], indicating that they understood the relative stability of the environments.  #@NEW_LINE#@#  In contrast, subjects switched environments frequently following negative feedback [P(switch) = 0.39], and more so when negative feedback was given on trials with higher motion strength (Fig 2B and Fig S1B; Eq.  #@NEW_LINE#@#  2, 1 = 6.2 ± 0.23, P less_than 1010) and duration (Fig S2B; Eq.  #@NEW_LINE#@#  2, 2 = 0.3 ± 0.15, P = 0.03), that is, the trials in which they were more likely to have accurate direction responses (Fig 2A and Figs.  #@NEW_LINE#@#  S1A and S2A).  #@NEW_LINE#@#  Indeed, feedback and expected direction choice accuracy seemed to be the critical factors in determining whether subjects switched.  #@NEW_LINE#@#  The probability of switching environments after negative feedback increased monotonically with subjects' accuracy (Fig S3), and different combinations of motion strength and duration that produced the same expected accuracy also produced a similar probability of switching.  #@NEW_LINE#@#  In fact, the expected accuracy on a trial with negative feedback explained 90.7% of the variance in switch probabilities on the next trial (Eq.  #@NEW_LINE#@#  9, R2 = 0.907), whereas additional knowledge about the motion strength and duration explained only an additional 1% (Eq.  #@NEW_LINE#@#  10, R2 = 0.917).  #@NEW_LINE#@#  Thus, subjects environment switches seemed to be primarily informed by the feedback and expected direction choice accuracy.  #@NEW_LINE#@#  
The effect of feedback and motion strength on future environment switches extended for multiple trials.  #@NEW_LINE#@#  Because of subjects uncertainty about the correct motion direction, they did not always switch environment choices immediately after one negative feedback.  #@NEW_LINE#@#  When the environment changed, subjects frequently continued to choose the previous (incorrect) environment for two to four trials (43.9% of all environment changes).  #@NEW_LINE#@#  However, subjects were also more likely to switch as the number of consecutive negative feedbacks mounted (Fig 3A and Fig S4A; Eq.  #@NEW_LINE#@#  3, 3 = 1.5 ± 0.06, P less_than 1010), suggesting that the effect of negative feedback lasted for multiple trials (13, 24).  #@NEW_LINE#@#  Importantly, this persistence was also dependent on motion strength, ruling out the possibility that subjects simply counted the number of errors to decide when to switch.  #@NEW_LINE#@#  The presence of a trial with low motion strength in the sequence of negative feedbacks reduced the likelihood of switching both on the next trial (Fig 3B and Fig S4B; Eq.  #@NEW_LINE#@#  3, 1 = 5.9 ± 0.26, P less_than 1010) and on the subsequent ones (Fig 3C and Fig S4C; Eq.  #@NEW_LINE#@#  5, P less_than 106 for 13).  #@NEW_LINE#@#  Conversely, negative feedback on trials with higher motion strength was more likely to trigger a switch in subjects environment choice and terminate the sequence of consecutive errors (Fig 3C and Fig S4C).  #@NEW_LINE#@#  The decision to switch environment choices, therefore, depended on integration of feedback and expected direction choice accuracy across multiple trials.  #@NEW_LINE#@#  
For a more formal test of the properties of the multitrial integration process, we focused on sequences of two consecutive errors in the same environment, because they were the most frequent type of consecutive errors (80.6%).  #@NEW_LINE#@#  We asked how the motion strength on those trials influenced subjects decisions to switch or persist on the subsequent trial.  #@NEW_LINE#@#  We found that the probability of switching was significantly influenced by the motion strength of both the first (Eq.  #@NEW_LINE#@#  6, 2 = 1.9 ± 0.76, P = 0.01) and second (1 = 4.9 ± 0.58, P less_than 1010) negative feedback.  #@NEW_LINE#@#  In addition, we found that the motion strength of the more recent negative feedback exerted a stronger influence on the probability of switching (Eq.  #@NEW_LINE#@#  7, 2 = 1.8 ± 0.37, P = 1.5 × 106).  #@NEW_LINE#@#  The stronger influence of more recent trials could be indicative of two possible mechanisms.  #@NEW_LINE#@#  Switch evidence may be leaky (22, 25, 26), in which case newer information more strongly influences the decision to switch or stay.  #@NEW_LINE#@#  Alternatively, subjects could be switching environment choices after accumulated evidence reaches a bound, in which case the latest samples of evidence are more likely to exceed the bound, if bound crossing has not occurred thus far.  #@NEW_LINE#@#  We will evaluate these possibilities in the following sections.  #@NEW_LINE#@#  

An_Uncertainty_Accumulation_Model_Explained_Motion_Direction_and_Environment_Choices  #@NEW_LINE#@#  
We developed a computational framework to understand how expected direction choice accuracy and feedback support adaptive changes in the environment choice (Fig 4).  #@NEW_LINE#@#  The model is based on the following three key principles: (i) Direction choices result from the accumulation of sensory evidence within trials (10, 22, 26, 27), (ii) subjects compute expected accuracy of their direction choices (311), and (iii) environment choices (to switch or not) result from the integration of expected direction choice accuracy and feedback across trials (1417, 20, 21).  #@NEW_LINE#@#  Thus, the model provides a unified framework to explain perceptual decisions, the confidence associated with those decisions, and the mechanisms by which confidence supports adaptive behavior.  #@NEW_LINE#@#  
We modeled subjects direction choices using a bounded accumulation model.  #@NEW_LINE#@#  Integration of sensory evidence toward a decision bound (Fig 4A) (22) accurately explains choices, response times, confidence, and several other aspects of decision-making, including speedaccuracy tradeoff, across a broad range of perceptual tasks (3, 4, 22, 2732).  #@NEW_LINE#@#  In addition, neurophysiological recordings from parietal cortex, frontal cortex, basal ganglia, and superior colliculus of animals engaged in basic motion direction discrimination tasks exhibit dynamics consistent with integration of evidence over time to a bound (26, 3035).  #@NEW_LINE#@#  We used a simplified variant of the bounded accumulation model known as the driftdiffusion model to account for direction choices.  #@NEW_LINE#@#  In this model, noisy sensory evidence is integrated over time in a domain bounded by two absorbing decision thresholds that represent the two choices.  #@NEW_LINE#@#  The direction choice is determined when the accumulated sensory evidence (the sensory decision variable) reaches one of the two thresholds.  #@NEW_LINE#@#  If a threshold is not reached by the end of the motion stimulus, then the sign of the sensory decision variable dictates the choice (22, 36, 37).  #@NEW_LINE#@#  
The same bounded accumulation model can also explain the confidence associated with direction choices (3, 4, 38, 39).  #@NEW_LINE#@#  The crucial point is that both the magnitude of accumulated evidence and elapsed time provide information about the probability of being correct.  #@NEW_LINE#@#  To illustrate this mapping, Fig 4B shows the probability distribution of accumulated sensory evidence at each possible decision time for a rightward stimulus with a particular motion strength (6.4% coherence).  #@NEW_LINE#@#  By applying the decision rule described above, we can compute the probability that the decision variable at a particular magnitude and time would result in a correct response given the full set of stimuli experienced by the subject (Fig 4C).  #@NEW_LINE#@#  By learning this mapping through experience, subjects could estimate their expected direction choice accuracy based directly on accumulated sensory evidence and elapsed time.  #@NEW_LINE#@#  
This expected direction choice accuracy can guide environment choices.  #@NEW_LINE#@#  From a normative perspective, each instance of negative feedback provides some evidence that the current environment has changed (switch evidence, SI Text).  #@NEW_LINE#@#  The cause of negative feedback is ambiguous, and the magnitude of switch evidence for a single negative feedback is a function of the expected direction choice accuracy for that trial (Fig 4D).  #@NEW_LINE#@#  Subjects would maximize the accuracy of environment choices by switching when the posterior probability of a new environment exceeds that of the current environment given the history of feedback, expected direction choice accuracy, and belief about the probability of an environment change given that one has not yet occurred (i.e., subjective hazard rate).  #@NEW_LINE#@#  Such a Bayes optimal solution can be formulated as an accumulation of switch evidence over trials to a bound (SI Text).  #@NEW_LINE#@#  The optimal switch evidence is in units of log-likelihood ratio of a negative feedback under the two environments (Fig 4D): log[p(F|En,C,)/p(F|Eo,C,)]=log[1/(1A^)] (Eq.  #@NEW_LINE#@#  S6), where A^ is the expected direction choice accuracy derived from the sensory decision variable and elapsed time, F is negative feedback, En and Eo are the new and current (old) environments, respectively, and C and  are motion strength and duration, respectively.  #@NEW_LINE#@#  In other words, just as integration of sensory evidence, in units of log-likelihood ratio of sensory signals, is the optimal computation for two-alternative perceptual choices (28, 4042), integration of switch evidence over multiple trials of negative feedback to construct a switch decision variable is the optimal computation for environment choices.  #@NEW_LINE#@#  
We hypothesized that subjects approximate the normative computation to decide when to switch environment choices (Materials and Methods).  #@NEW_LINE#@#  We tested this hypothesis by fitting subjects direction and environment choices simultaneously with a model based on the principles outlined above: integration of sensory evidence within a trial to explain direction choices, computation of direction choice confidence, and, finally, integration of confidence and feedback across trials to a dynamic bound (Fig 4E).  #@NEW_LINE#@#  The model used only five free parameters (Table S1 and Materials and Methods), and, despite its low degrees of freedom, it provided a quantitative explanation for all key aspects of subjects direction and environment choices (Figs.  #@NEW_LINE#@#  2, 3, and 5 and Figs.  #@NEW_LINE#@#  S1, S2, and S4, lines), including (i) changes of direction choice accuracy with motion strength and duration; (ii) increased likelihood of switching with negative feedback for stronger and longer motion stimuli; and (iii) the long-term, multitrial influence of feedback and motion strength through integration of switch evidence over trials.  #@NEW_LINE#@#  Altogether, the close match between the model and data strongly suggests that the model captures the computations that guided subjects behavior.  #@NEW_LINE#@#  

Accumulation_of_Switch_Evidence_Across_Trials_Is_Not_Leaky_but_It_Resets_After_Positive_Feedback_and_Reflects_Across-Trial_Urgency  #@NEW_LINE#@#  
Subjects patterns of environment choices revealed key properties of the switch evidence accumulation across trials.  #@NEW_LINE#@#  We highlight three of these properties.  #@NEW_LINE#@#  First, subjects were likelier to switch environment choices after negative feedback when they stayed in an environment for more trials (Fig 5 A and B; Eq.  #@NEW_LINE#@#  8, 3 = 0.3 ± 0.01, P less_than 1010).  #@NEW_LINE#@#  This increased switch rate was not due to the increased chance of consecutive errors for longer environment durations, because similar results were obtained when we confined the analysis to sequences with only one error (Eq.  #@NEW_LINE#@#  8, P less_than 1010).  #@NEW_LINE#@#  Instead, it likely reflects a growing urgency to switch environments.  #@NEW_LINE#@#  This growing urgency to switch environment choices is akin to the urgency to respond observed in perceptual decision-making tasks (29, 30), except that it happens at much longer timescales (over trials, not within single trials).  #@NEW_LINE#@#  
Our model provided further support for this urgency signal and its necessity to explain behavior.  #@NEW_LINE#@#  The optimal form of the switch bound, Be, should collapse over trials as a function of the subjective hazard rate and the number of consecutive negative feedbacks (Eq.  #@NEW_LINE#@#  S6).  #@NEW_LINE#@#  A lower switch bound promotes switches with less accumulated evidence, increasing the likelihood of switches over trials.  #@NEW_LINE#@#  Our model implemented this bound collapse based on two assumptions.  #@NEW_LINE#@#  First, subjects could estimate the hazard rate of environment changes based on the negative feedbacks they experienced in the task (Materials and Methods).  #@NEW_LINE#@#  Second, subjective hazard rates were related to the experienced hazard rates based on a probability weighting function (43) (Eq.  #@NEW_LINE#@#  16 and Fig 5C, Inset) that slightly distorted subjective probabilities, as reported previously (44).  #@NEW_LINE#@#  The best fitting probability weighting function and the optimal switch bound based on the subjective hazard functions are shown in Fig 5C.  #@NEW_LINE#@#  For all subjects, the quality of fit was consistently worse when this collapsing switch bound was replaced with the best-fitting static bound for the data (likelihood ratio test, P less_than 0.01 for all subjects).  #@NEW_LINE#@#  Therefore, the integration mechanism that underlies environment switches seems to be susceptible to evidence-independent urgency signals that modulate the termination criterion for the switch decisions.  #@NEW_LINE#@#  The dynamics of the urgency signal could accommodate various statistics of environment duration, for example, larger urgency for more short-lived environments, providing a basis for adaptive adjustment of behavior (Fig S5).  #@NEW_LINE#@#  We revisit this point in Discussion.  #@NEW_LINE#@#  
The optimal form of switch bound predicts that the urgency signal can be divided into two components: one that depends on the subjective hazard rate for an initial negative feedback and a second that increases with subsequent negative feedbacks (Eq.  #@NEW_LINE#@#  S6).  #@NEW_LINE#@#  The preceding analyses establish the necessity of the first urgency component to explain increased switching with time spent in an environment.  #@NEW_LINE#@#  To test the necessity of the second form of urgency, we added a weight, , on the magnitude of bound collapse with additional negative feedbacks and fitted the value as a free parameter (Eq.  #@NEW_LINE#@#  15).  #@NEW_LINE#@#  Three subjects collapsed their bound after subsequent negative feedbacks as evidenced by a significant positive weight (S3:  = 1.8 ± 0.48, P = 5.3 × 105; S4:  = 5.6 ± 1.68, P = 4.1 × 104; S5:  = 19.3 ± 6.07, P = 7.3 × 104).  #@NEW_LINE#@#  The remaining three subjects showed negligible bound collapse after the initial negative feedback (S1:  = 0.05 ± 0.17, P = 0.38; S2:  = 0.004 ± 0.007, P = 0.30; S6:  = 0.03 ± 0.17, P = 0.43).  #@NEW_LINE#@#  The short environment durations in our experiment promoted switching after few consecutive negative feedbacks, and may have reduced the cost of ignoring this urgency component.  #@NEW_LINE#@#  
Second, the data suggest a reset of accumulated switch evidence (ve) to zero after positive feedbacks.  #@NEW_LINE#@#  Although repeated negative feedbacks increased the subjects likelihood of switching, a single positive feedback immediately dropped the likelihood of switching to almost zero regardless of the number of preceding errors and the magnitude of accumulated switch evidence (Fig 5D; Eq.  #@NEW_LINE#@#  4, 1 = 0.5 ± 0.69, P = 0.49), indicating that the switch evidence accumulated before the positive feedback is entirely eliminated.  #@NEW_LINE#@#  Further support for this conclusion comes from our model, where we allowed the change of ve after positive feedback to be a free parameter (q).  #@NEW_LINE#@#  This extended model provides the possibility that positive feedback is treated merely as partial evidence against an environment change.  #@NEW_LINE#@#  However, for all subjects (6/6), the model fits indicated that the reduction of switch evidence after positive feedback significantly exceeded the maximal switch bound (bootstrap, P less_than 0.001 for all subjects), large enough to enforce a complete reset in accumulated switch evidence.  #@NEW_LINE#@#  This reset is appropriate for our task because the probability of a change is always minimal immediately after a positive feedback.  #@NEW_LINE#@#  
Lastly, the integration of switch evidence is unsusceptible to leakagepassive decayacross trials.  #@NEW_LINE#@#  A leaky integration hypothesis has been suggested previously (45) and is widely assumed to account for sequential learning phenomena in the reinforcement learning literature.  #@NEW_LINE#@#  The long timescale for the integration of switch evidence and potential biophysical limitations of integration circuits make leaky integration a plausible hypothesis.  #@NEW_LINE#@#  Therefore, we extended the model to include a free parameter for the leakage of ve (, Eq.  #@NEW_LINE#@#  14).  #@NEW_LINE#@#  Like the model above, we also allowed the change of ve following positive feedback to be a free parameter to ensure that estimation of the leakage parameter is not disrupted by forced resets of accumulated switch evidence.  #@NEW_LINE#@#  The model did not support the leaky integration hypothesis.  #@NEW_LINE#@#  For all but one subject (5/6), the value of leakage was indistinguishable from zero (S1:  = 0.0880 ± 0.2148, P = 0.34; S2:  = 0.0698 ± 0.1462, P = 0.32; S3:  = 0.0095 ± 0.0114, P = 0.20; S4:  = 0.0010 ± 0.0035, P = 0.39; S5:  = 0.0000 ± 0.0005, P = 0.50; S6:  = 0.1582 ± 0.0253, P = 1.9 × 1010), indicating that leakage of switch evidence after negative feedback is not necessary to explain subjects behavior.  #@NEW_LINE#@#  Further, eliminating switch noise from the model produced significantly worse fits for all subjects, even when leakage was included (likelihood ratio test, all P less_than 1010), indicating that leakage is not a replacement for switch noise.  #@NEW_LINE#@#  Finally, compatible with the previous models, the ve change after positive feedback was greater than the maximum switch bound for all subjects (bootstrap, all P less_than 0.001), indicating complete evidence resets even when leaky integration was allowed in the model.  #@NEW_LINE#@#  
Altogether, these results confirm that adaptive decision-making in the dynamic environment of our task depended both on a growing urgency to switch environment choices over trials and on perfect resetting of accumulated evidence following a single positive feedback.  #@NEW_LINE#@#  In contrast, leakage of switch evidence across trials was minimal and did not play a major role in shaping behavior.  #@NEW_LINE#@#  


Discussion  #@NEW_LINE#@#  
Our task is a simplified instance of the hierarchical decisions commonly made in complex environments.  #@NEW_LINE#@#  To obtain ones goals, one must adopt an appropriate decision strategy and also make wise choices using that strategy.  #@NEW_LINE#@#  Failing to detect changes in the environment or adopt the right strategy for a new environment is a major source of error in natural settings.  #@NEW_LINE#@#  Identifying such errors is often nontrivial, because changes in the environment are rarely cued.  #@NEW_LINE#@#  Rather, decision makers must infer the changes, often from feedback for their own past choices.  #@NEW_LINE#@#  Inferring the changes creates a hierarchical multiscale decision-making process in which outcomes of lower-level choices inform revisions of decision strategy at higher levels.  #@NEW_LINE#@#  Our task makes such hierarchical decision processes accessible in a well-controlled experimental setting.  #@NEW_LINE#@#  By doing so, it enables us to study neural mechanisms that underlie (i) resolution of ambiguous feedback (e.g., perceptual or environment errors), (ii) interactions of lower- and higher-level decision processes, (iii) simultaneous integration of evidence over multiple timescales, and (iv) commitment to a new decision strategy.  #@NEW_LINE#@#  
Detailed analysis of subjects behavior demonstrated that expected accuracy in our perceptual choices resolves ambiguity about negative feedback by providing evidence that the environment has changed (switch evidence).  #@NEW_LINE#@#  Each negative feedback represents a sample of switch evidence that is weighted by expected accuracy.  #@NEW_LINE#@#  Negative feedback conferred stronger evidence for a switch when expected accuracy was high, and less evidence for a switch when expected accuracy was low.  #@NEW_LINE#@#  We found that the optimal solution to the task was to accumulate switch evidence over multiple trials (in units of log-likelihood ratio) and commit to a new environment when the accumulated switch evidence reached a bound that collapses dynamically over trials (40, 41).  #@NEW_LINE#@#  A computational framework based on these principles quantitatively explained all aspects of the behavior, providing a plausible mechanism for hierarchical, multiscale decision-making.  #@NEW_LINE#@#  
The observation that expected accuracy of the perceptual choice contributes to computation of switch evidence sheds light on why confidence is so prevalently computed and accompanies our choices.  #@NEW_LINE#@#  In a hierarchical decision process, a choice is not merely a commitment at a particular point in time; it is also part of a sequence that feeds into a higher level of the decision hierarchy for choices about strategy.  #@NEW_LINE#@#  Confidence is the subjective belief, before feedback, that a decision is correct (4, 27, 4648).  #@NEW_LINE#@#  The match between this subjective expectation and the actual feedback can be used for learning about the environment (48) by serving as input for decisions about updating the current strategy.  #@NEW_LINE#@#  Several other functions have been attributed to the computation of confidence, including optimal cue combination (49), arbitration among multiple systems that compete for a behavioral choice (50), and guidance of sequential decisions when immediate feedback is unavailable (3).  #@NEW_LINE#@#  We suggest that confidence is also the critical link that connects different levels of the decision hierarchy.  #@NEW_LINE#@#  Automatic computation of confidence, even in experimental settings that do not demand it (14, 51, 52), suggests that decision hierarchies are an indispensible and ingrained component of our behavioral repertoire.  #@NEW_LINE#@#  
In our model, subjective expected accuracy was derived directly from accumulated sensory evidence and elapsed time.  #@NEW_LINE#@#  This framework can explain choices, reaction times, and certainty judgments during motion discrimination tasks (4), and it predicts the dynamics of parietal neurons (3).  #@NEW_LINE#@#  However, it is likely that alternative models of confidence based on the state of the perceptual decision-making process would also be successful in our framework (611), so long as they explain the variation of confidence with motion strength and duration.  #@NEW_LINE#@#  The key point is that the perceptual decision process drives computation of choice confidence that, in turn, drives decisions about strategy, establishing a mechanistic link across levels of the decision-making hierarchy.  #@NEW_LINE#@#  
This mechanistic link stems from the utility of confidence for disentangling two potential sources of errorflawed strategy or poor information.  #@NEW_LINE#@#  We directly tested the role of confidence in a follow-up study in which subjects reported confidence in their motion direction choice during the changing environment task (Materials and Methods and SI Text).  #@NEW_LINE#@#  In this experiment, a single saccadic eye movement simultaneously indicated the environment and motion direction choices together with the confidence associated with the direction choice (Fig S6A) (4).  #@NEW_LINE#@#  As predicted by our model and results of the main task, subjects were more likely to switch environments following trials in which a choice associated with higher confidence produced negative feedback (Fig S6B).  #@NEW_LINE#@#  Importantly, the effect of confidence on switch behavior was not explained away by physical characteristics of the motion stimulus (coherence and duration; Fig S6C), demonstrating that subjective confidence, and not objective stimulus strength, are key to interpreting negative feedback.  #@NEW_LINE#@#  
More elaborate versions of our follow-up study with direct measurements of both the motion direction and environment confidence have the potential to shed light on another aspect of the model.  #@NEW_LINE#@#  To explain subjects behavior, our model requires a term for switch noise.  #@NEW_LINE#@#  This noise reflects two quantities that we cannot separate in the current experiment: (i) fluctuations in subjective expected accuracy and (ii) potential noise in integration of switch evidence.  #@NEW_LINE#@#  Direct measurement of confidence will remove the first source of variability, enabling us to better characterize integration of switch evidence across trials.  #@NEW_LINE#@#  Recall that, due to the absence of direct confidence measurements, we had to use an estimate of expected accuracy generated by marginalization over different decision times and sensory decision variables compatible with the subjects direction choice on each trial (Materials and Methods).  #@NEW_LINE#@#  We suspect that a substantial part of switch noise is due to the difference between subjective expected accuracy and the marginalized values we plugged into the model.  #@NEW_LINE#@#  Therefore, we predict that, by removing this measurement noise, future work will demonstrate more accurate across-trial integration than shown here and will provide even better quantitative fits for the switch behavior.  #@NEW_LINE#@#  
The breadth of our framework allows it to connect with a broad number of existing models for perception, learning and decision-making, but, also, several critical aspects of our study distinguish it from previous studies.  #@NEW_LINE#@#  We briefly mention three commonly used classes of model in this paragraph.  #@NEW_LINE#@#  Model-free reinforcement learning can use choice certainty to improve perception and categorization in a stable environment (5355).  #@NEW_LINE#@#  These powerful models, however, say little about how subjects decide that the environment statistics have changed.  #@NEW_LINE#@#  Our framework also connects with a broad class of hierarchical control models (2, 56), but many of those models lack the clear bridge between perceptual decision-making and decisions about changes in strategy that our model provides.  #@NEW_LINE#@#  The hierarchical control models thus far have focused on a different, but equally important, aspect of guiding behavior: how task complexity can be reduced by grouping sequences of actions related to a common goal (i.e., temporal abstraction) (2).  #@NEW_LINE#@#  Combining temporal abstraction with our framework for adaptive hierarchical decisions will be a fruitful endeavor.  #@NEW_LINE#@#  The third class of models that should be mentioned here is the predictive coding framework, which is also hierarchical in structure (57).  #@NEW_LINE#@#  These models have recently been extended to perceptual decision tasks (58) by assuming that the precision or reliability of sensory encoding influences the weighting of sensory evidence for decisions.  #@NEW_LINE#@#  However, the predictive coding framework has not yet been extended to decisions about when to revise a strategy.  #@NEW_LINE#@#  Unlike standard predictive coding, a prediction generated at a higher level in our framework is not used to explain away lower-level representations, but is used to guide the lower-level decisions.  #@NEW_LINE#@#  Our framework goes beyond existing models by explaining how adaptive behavior in dynamic environments depends on a specific form of interactions between lower- and higher-level decision processes.  #@NEW_LINE#@#  Our model quantitatively explains details of behavior with remarkable accuracy, connects to the normative solution to the task, and is built upon neurally plausible mechanisms that can be directly tested through neurophysiological experiments.  #@NEW_LINE#@#  
By accumulating switch evidence to a bound, our model establishes a simple termination rule by which an evolving belief about the environment can be translated into a concrete decision strategy.  #@NEW_LINE#@#  This approach also distinguishes our framework from a broad family of learning models based on delta update rules (1315, 18, 45, 59).  #@NEW_LINE#@#  These models explain learning through sequential updates in a probabilistic belief about the current environment.  #@NEW_LINE#@#  In real-world environments, however, it is often necessary to explicitly commit to a strategy to effectively guide future choices (12, 13, 16, 60), for example, when alternative strategies are incompatible.  #@NEW_LINE#@#  Bounded accumulation of switch evidence offers a powerful method to select among alternative hypotheses about the true state of the world before committing to a strategy.  #@NEW_LINE#@#  This approach quantitatively captured subjects switching behavior in our task, and similar mechanisms have been shown to explain switching behavior when environment statistics change along a continuum (16).  #@NEW_LINE#@#  
The success of this approach suggests that the brain uses the same bounded accumulation mechanism over different timescales to carry out both perceptual decisions and higher-level decisions about strategy (59).  #@NEW_LINE#@#  Neural mechanisms of accumulation of sensory evidence for perceptual choices are relatively well understood (36), but far less is known about the neural mechanisms underlying integration of switch evidence over multiple trials.  #@NEW_LINE#@#  Neural responses in parietal and prefrontal cortexes are influenced by past rewards (24) and modulate their responses when subjects shift their decision strategy (13, 59, 60).  #@NEW_LINE#@#  Neural responses in the medial prefrontal cortex also exhibit peri-saccadic bursts that reach a fixed firing rate peak immediately before switches in a dynamic foraging task (24), suggestive of a mechanism similar to a switch bound.  #@NEW_LINE#@#  Human imaging data also support the role of prefrontal and parietal cortexes in updating belief about a changing environment (12, 17).  #@NEW_LINE#@#  Our task provides a framework to study whether and how these areas could support long-term integration of switch evidence, perhaps via interactions with identified neural representations of perceptual confidence (3, 5, 6).  #@NEW_LINE#@#  
Our model also revealed several fundamental properties of the higher-level decision process.  #@NEW_LINE#@#  Leakage or gradual loss of accumulated switch evidence was negligible for the timescales tested in this experiment and unnecessary to explain environment switches.  #@NEW_LINE#@#  We cannot rule out more complex scenarios that involve leak rates that vary with task parameters.  #@NEW_LINE#@#  Variable leakage can be advantageous in some scenarios (25, 37, 61), but perfect integration over consecutive negative feedbacks is optimal for this task (SI Text).  #@NEW_LINE#@#  Also predicted by the normative solution, we found that accumulated switch evidence resets after positive feedback, consistent with abrupt behavioral and neural changes observed in other learning tasks (19, 60).  #@NEW_LINE#@#  Further, subjects showed a higher propensity to switch the longer they stayed in an environment, indicating a gradual drop in their switch bound (i.e., urgency), most likely due to a growing subjective hazard rate or the prior odds that the environment has changed (16, 21).  #@NEW_LINE#@#  The optimal form of switch bound incorporates this growing subjective hazard rate and provided an excellent account of behavior, suggesting a normative basis for this growing urgency signal.  #@NEW_LINE#@#  Changes of urgency can augment the behavioral flexibility achieved by the static shifts of the switch bound.  #@NEW_LINE#@#  These static and dynamic changes of switch bound enable adjustment of switch rate based on the volatility of the environment, which can be learned through experience (14, 16, 61).  #@NEW_LINE#@#  Indeed, increasing the average duration of the environment in our experiment reduced the switch rate largely by increasing the switch boundsubjects accumulated more evidence before a switch (Fig S5).  #@NEW_LINE#@#  
To summarize, we showed how expected accuracy in perceptual choices disambiguates negative feedback and bridges levels of the decision-making hierarchy by furnishing evidence for changes of strategy.  #@NEW_LINE#@#  Both perceptual and higher-level decision processes use similar bounded accumulation mechanisms that operate concurrently at different timescales.  #@NEW_LINE#@#  We showed how this framework uses neurally plausible mechanisms to implement the optimal solution to the task.  #@NEW_LINE#@#  Our task is simple enough to be performed by nonhuman primates, laying the groundwork for critical experiments to determine the neural implementation of these mechanisms.  #@NEW_LINE#@#  

Materials_and_Methods  #@NEW_LINE#@#  
Six human subjects (five male and one female) participated in the main experiment.  #@NEW_LINE#@#  Observers had normal or corrected-to-normal vision.  #@NEW_LINE#@#  All subjects were naïve to the purpose of the experiment and provided informed written consent before participation.  #@NEW_LINE#@#  All procedures were approved by the Institutional Review Board at New York University.  #@NEW_LINE#@#  
Behavioral_Tasks  #@NEW_LINE#@#  
Here, we summarize the behavioral tasks; details are provided in SI Text.  #@NEW_LINE#@#  Subjects were first trained to perform a direction discrimination task.  #@NEW_LINE#@#  Subjects initiated a trial by shifting gaze to a central fixation point (FP).  #@NEW_LINE#@#  After a short delay, two targets appeared on opposite sides of the screen, followed by a random dot motion stimulus.  #@NEW_LINE#@#  The subjects task was to determine the net direction of motion (left or right).  #@NEW_LINE#@#  The percentage of coherently moving dots (motion strength) and the duration of stimulus presentation varied from trial to trial and determined the difficulty of the motion direction discrimination.  #@NEW_LINE#@#  After a second short delay, FP turned off, signaling subjects to report the perceived direction of motion by shifting gaze to the left or right choice target.  #@NEW_LINE#@#  Distinct auditory tones delivered positive or negative feedback if the choice was correct or wrong.  #@NEW_LINE#@#  
Subjects were introduced to the changing environment task (Fig 1A) following motion direction discrimination training.  #@NEW_LINE#@#  The experimental setup, motion stimulus, and timing of events were unchanged from training.  #@NEW_LINE#@#  However, instead of one pair of choice targets, subjects were presented with two pairs of choice targets, one pair above and one pair below the FP (four total), corresponding to the two environments.  #@NEW_LINE#@#  The right and left targets in each environment represented the two possible motion directions.  #@NEW_LINE#@#  Subjects received positive feedback for choosing the target that corresponded to both the correct environment and the correct motion direction.  #@NEW_LINE#@#  We refer to the choice of left versus right targets as the direction choice and the choice of upper versus lower targets as the environment choice.  #@NEW_LINE#@#  The active environment stayed fixed for a variable number of trials (for the main experiment, 215 trials, mean = 6, truncated geometric distribution) and then changed without explicit cue (Fig 1B).  #@NEW_LINE#@#  
We conducted two follow-up experiments that further tested the mechanisms underlying revisions of decision strategy.  #@NEW_LINE#@#  In the first experiment, the active environment persisted longer (320 trials, mean = 10) to test the influence of changes in environment stability on behavior.  #@NEW_LINE#@#  In the second follow-up experiment, subjects simultaneously reported their direction choice confidence along with their direction and environment choices using a single saccadic eye movement to an elongated bar (4).  #@NEW_LINE#@#  See SI Text for details.  #@NEW_LINE#@#  

Behavioral_Analyses  #@NEW_LINE#@#  
We assessed the effects of motion strength and duration on direction choices independent of environment choices using the following logistic regression:Logit[PT(correctdir)]=1CT+2T,[1]  #@NEW_LINE#@#  
where Logit(p)=log(p1p), and PT(correctdir) is the probability of a correct motion direction choice on trial T. CT and T are the motion strength and duration on the same trial, respectively.  #@NEW_LINE#@#  The i are regression coefficients.  #@NEW_LINE#@#  1 tests for a main effect of motion strength on the proportion of correct motion direction choices, 2 tests for a main effect of stimulus duration.  #@NEW_LINE#@#  Regression coefficients in Eq.  #@NEW_LINE#@#  1 and all subsequent logistic regressions were calculated using maximum likelihood fitting and are summarized in Table S2.  #@NEW_LINE#@#  In Eq.  #@NEW_LINE#@#  1 and other logistic regressions in this paper, the probabilities on the left-hand side of the equations are conditional on the factors listed on the right-hand side.  #@NEW_LINE#@#  For simplicity and to keep the equations short, we do not list these factors in the conditional probabilities.  #@NEW_LINE#@#  
To quantify the effect of the last trial on the decision to switch environment choices, we used the following logistic regression:Logit[PT,F(switch)]=0+1CT1+2T1,[2]  #@NEW_LINE#@#  
where PT,F(switch) is the probability that the environment choice on trial T does not match the environment choice on trial T  1 (i.e., the subject switched environment choices) given positive (F+) or negative (F) feedback on trial T  1.  #@NEW_LINE#@#  CT1 and T1 indicate the motion strength and duration on the previous trial, T  1.  #@NEW_LINE#@#  This regression was performed separately for trials in which feedback was positive or negative on trial T  1.  #@NEW_LINE#@#  
We tested for the effect of consecutive negative feedbacks on environment choices using the following equation:Logit[PT,F(switch)]=0+1CT1+2T1+3N,[3]  #@NEW_LINE#@#  
where N indicates the number of consecutive negative feedbacks that preceded trial T .  #@NEW_LINE#@#  The null hypothesis is that subjects did not take feedback history into account beyond the last trial and that their decisions to switch environment choices were mainly influenced by the last trial (H0:3=0).  #@NEW_LINE#@#  
We tested whether the history of negative feedback was negated by a single positive feedback using the following equation:Logit[PT,F+(switch)]=0+1K,[4]  #@NEW_LINE#@#  
where K indicates the number of consecutive negative feedbacks followed by a single positive feedback before trial T. 1 tests whether the influence of repeated negative feedbacks remains following a single positive feedback.  #@NEW_LINE#@#  
We used several additional analyses to investigate the effects of consecutive errors on environment choices.  #@NEW_LINE#@#  First, we evaluated how motion strength on the trial in which the environment changed (and the subject received negative feedback) influenced the accuracy of future environment choices.  #@NEW_LINE#@#  The following logistic regression was used:Logit[PT+i(correctenv)]=0+j=14jCTij,[5]  #@NEW_LINE#@#  
where PT+i(correctenv) indicates the probability of choosing the correct environment i trials after the environment change on trial T. Here ij is a Dirac delta function, which is 1 when i equals j and 0 otherwise.  #@NEW_LINE#@#  Up to four trials after the environment change are considered for this analysis.  #@NEW_LINE#@#  Subjects almost always received negative feedback on trial T because they were unaware of the environment change and chose the previous environment.  #@NEW_LINE#@#  Each j tests the hypothesis that the motion strength of the change trial influences environment accuracy j trials into the future.  #@NEW_LINE#@#  
Second, we analyzed sequences of two consecutive errors to test how the motion strength for each error trial influenced the subsequent environment choice.  #@NEW_LINE#@#  We used the following regression equation:Logit[PT,F(switch)]=0+1CT1+2CT2+3CT1CT2,[6]  #@NEW_LINE#@#  
where CT2 and CT1 are the motion strengths of the first and second trials in the sequence, respectively.  #@NEW_LINE#@#  The 1 coefficient tests for a main effect of motion strength on the decision to switch environment choices on the next trial, the 2 coefficient tests for a main effect of motion strength two trials in the future, and the 3 coefficient tests for an interaction of the two preceding trials.  #@NEW_LINE#@#  We focused on sequences of two errors, because of their abundance in the dataset.  #@NEW_LINE#@#  Similar trends were obtained for longer error sequences.  #@NEW_LINE#@#  
Third, we used the following equation to test whether the influence of consecutive errors on the decision to switch environment choices depended on the ordering of the trials:Logit[PT,F(switch)]=0+1(CT2+CT1)+2(CT2CT1).  #@NEW_LINE#@#  [7]  #@NEW_LINE#@#  
The null hypothesis is no effect of ordering (H0:2=0).  #@NEW_LINE#@#  If 2  0, then the probability of switching is greater when the motion strength for the first error (trial T  2) is greater than the motion strength for the second error (trial T  1).  #@NEW_LINE#@#  The opposite is true if 2 less_than 0.  #@NEW_LINE#@#  We obtained identical results when we instead defined a set of contrasts for CT2 and CT1 in Eq.  #@NEW_LINE#@#  6, but we report coefficients from Eq.  #@NEW_LINE#@#  7, for simplicity.  #@NEW_LINE#@#  
Finally, we used the following regression to assess whether subjects decisions to switch environment choices were influenced by the number of trials spent in the current environment:Logit[PT,F(switch)]=0+1CT1+2T1+3LT1,[8]  #@NEW_LINE#@#  
where LT1 is the number of trials since the subject switched into the new environment.  #@NEW_LINE#@#  In the actual task design, the environment duration was sampled from a truncated geometric distribution with a relatively flat hazard rate between trials 3 and 10 and an increasing hazard rate closer to the point of truncation.  #@NEW_LINE#@#  Subjects could inform their switching behavior by learning the statistics of environment duration [either the hazard rate or the prior odds (16) that the environment has changed since the last switch] through experience.  #@NEW_LINE#@#  The null hypothesis is that subjects were not influenced by the number of trials in the current environment (H0:3=0).  #@NEW_LINE#@#  We obtained identical results when we confined the analysis to the trials preceded by only a single error (T  2 was correct), indicating that the increased tendency to switch with the experienced duration of the current environment is not explained by the increased likelihood of multiple preceding errors.  #@NEW_LINE#@#  
We sought further support for the role of expected accuracy in determining environment switches by computing the variance explained (R2) for two nested logistic regressions.  #@NEW_LINE#@#  The first regression predicted switching after negative feedback based only on the expected accuracy of the preceding trial,Logit[PT,F(switch)]=0+1log(11AT1).  #@NEW_LINE#@#  [9]  #@NEW_LINE#@#  
The second regression included additional terms for both motion strength and duration,Logit[PT,F(switch)]=0+1log(11AT1)+2CT1+3T1.  #@NEW_LINE#@#  [10]  #@NEW_LINE#@#  
Only trials following negative feedback (F) were included in this analysis.  #@NEW_LINE#@#  Variance explained was computed based on a comparison of model fits to observed probability of switches for different motion strengths and durations.  #@NEW_LINE#@#  If expected accuracy is the primary factor in explaining switching behavior, then it should explain the majority of variance in the probability of switching without the inclusion of the motion strength and duration terms (i.e., the variance explained by the second regression should not greatly exceed the variance explained by the first).  #@NEW_LINE#@#  

Uncertainty_Accumulation_Model  #@NEW_LINE#@#  
Perceptual and environment choices in our task can be explained through three core mechanisms.  #@NEW_LINE#@#  Direction choices are produced by integrating momentary sensory evidence within trials (22, 26, 27, 34).  #@NEW_LINE#@#  Direction choice confidence (expected accuracy) is derived from accumulated sensory evidence and elapsed time (3, 4).  #@NEW_LINE#@#  Environment choices are guided by integrating feedback and expected accuracy across trials (14, 16, 17, 21).  #@NEW_LINE#@#  We developed a model that combines these core mechanisms to simultaneously explain subjects direction and environment choices across a session.  #@NEW_LINE#@#  We further show how this framework implements the Bayes optimal computation to maximize environment choice accuracy given the experienced trial sequence.  #@NEW_LINE#@#  Below, we outline the details of this model.  #@NEW_LINE#@#  
Direction choices are produced by accumulating noisy sensory evidence to a threshold (decision bound) (36).  #@NEW_LINE#@#  A simplified version of this process can be formulated by a driftdiffusion model, which has been shown to successfully explain choice, reaction time, and confidence judgments for a broad range of cognitive and perceptual decision-making tasks, including motion direction discrimination (4, 22, 2730).  #@NEW_LINE#@#  According to this model, the decision terminates when accumulated sensory evidence reaches a positive or negative bound or when the incoming sensory evidence stops (i.e., the motion stimulus ceases).  #@NEW_LINE#@#  The choice is determined by the bound that is reached (upper or lower) or, if a bound is not reached, by the sign of the accumulated sensory evidence (positive or negative) at the end of the stimulus duration.  #@NEW_LINE#@#  
The accumulated sensory evidence undergoes drift plus diffusion according to the following stochastic differential equation (Fig 4 A and B):dvd=dtd+dtd,vd(0)=0,[11]  #@NEW_LINE#@#  
where vd is the state of the accumulated sensory evidence (i.e., the sensory decision variable for motion direction) (36), t is time in milliseconds, d is the mean of momentary sensory evidence, and d is a Wiener process with unit SD.  #@NEW_LINE#@#  The distribution of momentary sensory evidence is stationary over time, and its mean is linearly related to the motion strength; d=kC, where k is a sensitivity parameter and C is motion strength (3); vd starts at zero on each trial.  #@NEW_LINE#@#  A sensory decision bound parameter, Bd, defines positive and negative absorbing bounds for the direction choices.  #@NEW_LINE#@#  
There is a unique mapping between the magnitude of accumulated evidence, decision time, and the probability that the direction choice is correct (3, 4).  #@NEW_LINE#@#  Given the set of motion strengths in the experiment, one can calculate the expected direction choice accuracy, A, for all possible values of accumulated sensory evidence and decision times (Fig 4C),A=p(D1|vd,td)=ip(vd,td|D1,Ci,)p(Ci)jip(vd,td|Dj,Ci)p(Ci),[12]  #@NEW_LINE#@#  
where td is the decision time, vd is accumulated evidence at decision time, and D1 and D2 are the correct and incorrect motion direction choices, respectively.  #@NEW_LINE#@#  P(D1|vd,td) is the probability that the chosen direction will turn out to be correct for a particular sensory decision variable and time.  #@NEW_LINE#@#  Ci and p(Ci) are the set of motion strengths and their probabilities in the experiment.  #@NEW_LINE#@#  The summation term on the right-hand numerator implements marginalization over motion strength, and the summation terms in the denominator implement marginalization over motion strength and direction.  #@NEW_LINE#@#  As shown in Fig 4C, this equation implies that expected accuracy depends on both the magnitude of accumulated sensory evidence (i.e., greater accumulated evidence is associated with greater confidence) and also elapsed time (longer decision times are associated with lower confidence), a relationship that has been experimentally verified (3, 4).  #@NEW_LINE#@#  By learning this mapping through experience, subjects could gauge the expected accuracy of their direction choices in individual trials based on their accumulated sensory evidence and decision time.  #@NEW_LINE#@#  
We estimated the expected direction choice accuracy on individual trials, A^, by marginalizing over possible accumulated evidence and decision times associated with each choice and stimulus,A^=p^(D1|C,R,)=1p(D1|vd,td)p(vd,td,|C,R,)g(vd,td,R)dvddtd,[13]  #@NEW_LINE#@#  
where C is the motion strength,  is the motion duration, R is the direction choice, and  is the normalization factor; g(vd,td,R) is an indicator function that implements the decision rule explained above,g(vd,td,R)={1ifvdandtdterminatetheprocessandleadtoR,0otherwise.  #@NEW_LINE#@#  
The marginalization in Eq.  #@NEW_LINE#@#  13 reflects the fact that, in this experiment, subjects could have committed to a direction choice before the Go signal.  #@NEW_LINE#@#  The expected probability of an erroneous direction choice would bep^(D2|C,R,)=1p^(D1|C,R,).  #@NEW_LINE#@#  
A key feature of the changing environment task design is that both feedback and expected direction choice accuracy furnish evidence bearing on the decision to switch or repeat the previous environment choice.  #@NEW_LINE#@#  Positive feedback always minimizes the probability that the environment will change on the next trial.  #@NEW_LINE#@#  Negative feedback, on the other hand, is always ambiguous, but expected accuracy of the direction choice can resolve this ambiguity.  #@NEW_LINE#@#  Higher expected accuracy translates to a larger probability that the environment has changed.  #@NEW_LINE#@#  That offers a principle that subjects must take into account to optimize their environment choices.  #@NEW_LINE#@#  Hereafter, we use the term switch evidence to refer to the combined evidence that feedback and expected accuracy of direction choices provide about the probability that the environment has changed.  #@NEW_LINE#@#  
A Bayesian decision maker would switch environment when the posterior probability of a new environment exceeds the old one given the history of feedback, expected direction choice accuracy, and trials spent in the old environment (SI Text).  #@NEW_LINE#@#  This Bayes optimal solution can be formulated as integration of switch evidence over trials, where switch evidence is defined as the log-likelihood ratio of an error feedback for the new and old environments: log[1/(1A)] (Eq.  #@NEW_LINE#@#  S6), where A is the expected direction choice accuracy (Eq.  #@NEW_LINE#@#  12).  #@NEW_LINE#@#  The intuition for the formulation of switch evidence is as follows.  #@NEW_LINE#@#  The probability of negative feedback for staying in the old environment following an environment change is 1.  #@NEW_LINE#@#  However, if the old environment is still effective, the probability of negative feedback for staying in the environment is 1A.  #@NEW_LINE#@#  The log of the ratio of these two likelihoods constitutes evidence for a change in the environment.  #@NEW_LINE#@#  Because we do not know the decision time on each trial, we use the expected direction choice accuracy, A^ (Eq.  #@NEW_LINE#@#  13), as a substitute for A.  #@NEW_LINE#@#  Subjects should switch environments when integrated switch evidence exceeds a bound dictated by the hazard rate and the number of consecutive negative feedbacks (Eq.  #@NEW_LINE#@#  S6).  #@NEW_LINE#@#  Overall, just as accumulating sensory evidence to a bound is the optimal computation for making a decision based on incoming sensory evidence (28, 40, 41), integrating switch evidence over trials to a bound is the optimal solution to decide when to switch environment in our task.  #@NEW_LINE#@#  
The optimal model replicates all of the major trends in subjects behavior (Fig S7).  #@NEW_LINE#@#  A quantitative fit to the data, however, requires knowledge about subjective hazard rates and properties of the accumulation process.  #@NEW_LINE#@#  We developed a series of plausible models to explore these properties.  #@NEW_LINE#@#  In our models, switch evidence is integrated across trials according to the following nonstationary diffusion process:dve=dT[e,Tve]+dTe,ve(0)=0,[14]  #@NEW_LINE#@#  
where, ve is the accumulated switch evidence (i.e., switch decision variable), T is time in units of trials, e,T is the switch evidence on trial T, e is a Wiener process with SD e (switch noise), and  is a leakage term that discounts past evidence.  #@NEW_LINE#@#  The leakage parameter controls the time constant of integration across trials and ranges from 0 (perfect integration) to 1 (no integration).  #@NEW_LINE#@#  The switch noise reflects fluctuations of subjective expected accuracy and potential noise in the accumulation of switch evidence.  #@NEW_LINE#@#  Following negative feedback on trial T, e is the switch evidence as explained above.  #@NEW_LINE#@#  Following positive feedback, e is a negative constant q.  #@NEW_LINE#@#  Thus, negative feedback increases switch evidence according to the expected accuracy, and positive feedback decreases it.  #@NEW_LINE#@#  The process is nonstationary because e depends on the specific sequence of feedbacks, motion strengths, motion durations, and choices across trials.  #@NEW_LINE#@#  The model predicts that a switch in the current environment choice is initiated when a switch bound, Be, is exceeded.  #@NEW_LINE#@#  Following the switch, ve is reset back to zero.  #@NEW_LINE#@#  The model also assumes a lower reflecting bound at 0 that prevents ve from becoming negative.  #@NEW_LINE#@#  The fact that the probability of another environment change can only grow after a correct switch justifies such a lower bound.  #@NEW_LINE#@#  The exact location of this reflecting lower bound is not critical for our conclusions, and so we did not make it a free parameter in the model.  #@NEW_LINE#@#  
We explored alternative nested models that made different assumptions about the presence or absence of leakage, noise, and the influence of positive feedback on accumulated switch evidence.  #@NEW_LINE#@#  For our main model, we fixed q= to impose a complete reset of switch evidence following positive feedbacks.  #@NEW_LINE#@#  We also fixed =0, assuming that integration of switch evidence does not suffer from leakage.  #@NEW_LINE#@#  This formulation is consistent with the optimal solution (Eq.  #@NEW_LINE#@#  S6), but we also evaluated several plausible alternatives.  #@NEW_LINE#@#  In a second model, we relaxed the constraint on q and allowed it to be a free parameter, to formally test whether a reset of accumulated switch evidence is a warranted assumption.  #@NEW_LINE#@#  In a third model, we also allowed  to be a free parameter, to estimate the amount of leak in the integration process.  #@NEW_LINE#@#  The results of these three models are explained in Results.  #@NEW_LINE#@#  In a fourth model, we tested the necessity of switch noise by forcing it to zero and comparing the fits with the main model.  #@NEW_LINE#@#  The results verified that switch noise was necessary to explain behavior (likelihood ratio test, P less_than 1010 for all subjects).  #@NEW_LINE#@#  Finally, in a fifth model, we forced switch noise to zero and allowed  and q to be free parameters to assess whether leakage can compensate for switch noise.  #@NEW_LINE#@#  The fits were generally inferior to our main model or the third model above (likelihood ratio test with the third model, P less_than 1010 for all subjects).  #@NEW_LINE#@#  
The switch bound, Be, is informed by the subjective hazard rate of environment changes and the consecutive negative feedbacks experienced before the current trial (SI Text).  #@NEW_LINE#@#  Because environment durations were sampled from a truncated geometric distribution, the true hazard rate gradually increased as the number of trials in an environment approached the truncation point.  #@NEW_LINE#@#  Subjects were not told about the distribution of environment duration but could develop a subjective estimate by experience.  #@NEW_LINE#@#  The increasing hazard rate created an urgency to switch by collapsing Be over trials.  #@NEW_LINE#@#  According to the Bayesian optimal solution, consecutive errors would further accelerate this bound collapse.  #@NEW_LINE#@#  We tested the influence of consecutive errors using a modified version of Eq.  #@NEW_LINE#@#  S6,Be(T)=log[H^(Tn)]+log[1H^(Tn)]+i=n10log[1H^(Ti)],[15]  #@NEW_LINE#@#  
where Be(T) is the switch bound and H^(T) is the subjective hazard rate on trial T; n is the number of consecutive negative feedbacks preceding the negative feedback on trial T (total number of consecutive errors in the sequence is n+1).  #@NEW_LINE#@#  The first and second terms in Eq.  #@NEW_LINE#@#  15 establish a positive baseline for the first negative feedback that is modulated by the subsequent negative feedbacks up to the current trial (third term in Eq.  #@NEW_LINE#@#  15).  #@NEW_LINE#@#  Because H^(T) is bounded between zero and 1, log[1H^(Ti)] are negative and decrease the bound from the baseline;  is a weighting parameter that scales the magnitude of the bound collapse due to subsequent negative feedbacks.  #@NEW_LINE#@#  In our main model, we fix  to 1 to implement the optimal bound, but we also evaluated alternative models in which  was a free parameter to test whether modulation by subsequent negative feedbacks is a necessary form of switch urgency (Results).  #@NEW_LINE#@#  
We estimated subjective hazard rates based on experienced environment changes and well-known distortions in perception of objective probabilities.  #@NEW_LINE#@#  First, we measured the experienced hazard rate, H(T), for the trial sequences in the task.  #@NEW_LINE#@#  To do so, we calculated the likelihood that the subject received a negative feedback on trial i within an environment and subtracted a baseline likelihood for negative feedback due to motion direction errors.  #@NEW_LINE#@#  These experienced hazard rates were similar across subjects and matched expectations based on the truncated geometric distribution of environment durations.  #@NEW_LINE#@#  Second, we allowed for the possibility that subjective hazard rates, H^(T), may deviate systematically from the experienced hazard rates, because subjects tend to overweight lower probabilities and underweight higher probabilities (44).  #@NEW_LINE#@#  To account for individual differences in subjective hazard rates, we implemented a probability weighting function following (43)H^(T)=B0+(H(T){H(T)+[1H(T)]}1)(1B0),[16]  #@NEW_LINE#@#  
where B0 and  are free parameters that determine the mapping between actual and subjective probabilities.  #@NEW_LINE#@#  Because the form of H(T) was derived directly from the data and Eq.  #@NEW_LINE#@#  15 directly relates H^(T) to Be(T), these are the only free parameters needed to describe the switch bound.  #@NEW_LINE#@#  The form of the optimal bound resulting from the best fitting probability weighting functions are shown in Fig 5C.  #@NEW_LINE#@#  To test the necessity of the bound collapse, we also evaluated a model in which the bound was static over all trials using a single parameter (Results).  #@NEW_LINE#@#  

Model_Fitting  #@NEW_LINE#@#  
In total, our nested models have between two and seven free parameters, depending on whether leakage (), negative switch evidence (q), switch noise (e), and switch bound parameters (, B0, and ) are fixed or free to change.  #@NEW_LINE#@#  Motion direction choices depend on the stimulus sensitivity, k, and sensory decision bound, Bd.  #@NEW_LINE#@#  These parameters, along with q, determine the mean switch evidence, e, on each trial.  #@NEW_LINE#@#  In addition to e, environment choices depend on a switch noise parameter, e, leakage, , and the switch bound parameters, B0, , and  (Eqs.  #@NEW_LINE#@#  15 and 16).  #@NEW_LINE#@#  The main model in the paper has five free parameters (k, Bd, e, B0, and ; Table S1, Figs.  #@NEW_LINE#@#  2, 3, and 5, and Figs.  #@NEW_LINE#@#  S1, S2, S4, and S5).  #@NEW_LINE#@#  
For each model, the parameters were simultaneously fit to individual subjects data by maximizing the joint likelihood of direction choices (correct or error) and environment choices (switch or nonswitch) across trials.  #@NEW_LINE#@#  We calculated the likelihood of each direction choice using numerical solutions to the FokkerPlanck formulation of Eq.  #@NEW_LINE#@#  11 (3).  #@NEW_LINE#@#  We calculated the likelihood of each environment choice using Monte Carlo simulations (15,000 iterations) to solve Eq.  #@NEW_LINE#@#  14.  #@NEW_LINE#@#  The exact sequences of motion strengths, motion durations, and choices experienced by the subjects were used for these calculations.  #@NEW_LINE#@#  Further, to ensure that the model used a trial history that matched the subjects experience, we reset accumulated switch evidence to zero on trials after subjects switched environments.  #@NEW_LINE#@#  The trial following a switch error was excluded from fitting, because subjects were explicitly told when they incorrectly switched environments (see Behavioral Tasks and SI Text).  #@NEW_LINE#@#  
We estimated the SE of best-fitting parameter values using a bootstrap procedure.  #@NEW_LINE#@#  Typical bootstrapping involves randomly sampling individual trials, but our model predictions depend on trial history.  #@NEW_LINE#@#  Therefore, we instead sampled, with replacement, consecutive runs of trials between environment switches.  #@NEW_LINE#@#  This preserves the effective trial history, because evidence accumulation always resets following the switches.  #@NEW_LINE#@#  The total number of runs sampled was equal to the total number of runs in each data set.  #@NEW_LINE#@#  We repeated this process 100 times and identified the parameters that maximized the likelihood of the sampled data in each iteration.  #@NEW_LINE#@#  The SD of the resulting parameter distribution provided an estimate of the SE of model parameters.  #@NEW_LINE#@#  


SI_Text  #@NEW_LINE#@#  
Motion_Direction_Discrimination_Training  #@NEW_LINE#@#  
Throughout the experiment, subjects were seated in an adjustable chair in a semidark room with chin and forehead supported before a Cathode Ray Tube (CRT) display monitor (20, EIZO FlexScan T966; refresh rate 75 Hz, screen resolution 1,600 × 1,200; viewing distance 53 cm).  #@NEW_LINE#@#  Stimulus presentation was controlled with Psychophysics Toolbox (62) and Matlab.  #@NEW_LINE#@#  Eye movements were monitored using a high-speed infrared camera (Eyelink; SR-Research).  #@NEW_LINE#@#  Gaze positions were recorded at 1 kHz.  #@NEW_LINE#@#  
The trial started when the subject looked at a small red fixation point (FP, 0.3° diameter circle) at the center of the screen.  #@NEW_LINE#@#  Following a variable delay (200500 ms; truncated exponential), two red targets (0.5°) appeared on opposite sides of the screen equidistant from the FP (8° eccentricity).  #@NEW_LINE#@#  Following another random delay (200500 ms; truncated exponential), a dynamic random dots stimulus appeared within a 5° circular aperture centered on the FP.  #@NEW_LINE#@#  The dots were white 4 × 4 pixel squares (0.096° × 0.096°) on black background (dot density, 16.7 dots per square degree per second).  #@NEW_LINE#@#  The stimulus consisted of three independent sets of moving dots shown in consecutive frames.  #@NEW_LINE#@#  Each set of dots was shown for one video frame and then replotted three video frames later (t = 40 ms).  #@NEW_LINE#@#  When replotted, a subset of dots were offset coherently from their original location to create apparent motion (speed, 5° per second) while the remaining dots were placed randomly within the aperture.  #@NEW_LINE#@#  Following the offset of the motion stimulus, a delay period (4001,000 ms; truncated exponential) was imposed before the Go signal (FP offset).  #@NEW_LINE#@#  Subjects were instructed to maintain gaze on the FP throughout the trial until the Go signal.  #@NEW_LINE#@#  If the gaze deviated more than 2° from the FP, the trial was aborted.  #@NEW_LINE#@#  Following the Go signal, subjects reported their perceived direction of motion by shifting gaze to the choice target in the direction of motion and maintaining the gaze within 3° of the target for 200 ms.  #@NEW_LINE#@#  Subjects received distinct auditory feedback for correct (positive feedback) and error (negative feedback) responses.  #@NEW_LINE#@#  Aborted trials had a neutral, uninformative auditory feedback and were excluded from the analyses.  #@NEW_LINE#@#  Training on the basic motion discrimination task continued until subjects achieved high performance as indicated by psychophysical thresholds less_than17% (Results).  #@NEW_LINE#@#  
We manipulated the difficulty of the motion direction discrimination in two ways.  #@NEW_LINE#@#  First, the motion stimulus duration on each trial was randomly sampled from a truncated exponential distribution (100900 ms, mean = 330 ms).  #@NEW_LINE#@#  Second, the motion strength varied randomly across trials.  #@NEW_LINE#@#  The motion strength was determined by the percentage of coherently displaced dots: 0%, 3.2%, 6.4%, 12.8%, 25.6%, and 51.2%.  #@NEW_LINE#@#  On trials with 0% coherence, positive feedback was randomly delivered for half of the trials, and negative feedback was delivered on the other half.  #@NEW_LINE#@#  Training on the basic motion discrimination task continued until subjects achieved high performance, as indicated by psychophysical thresholds of less_than17% (Results).  #@NEW_LINE#@#  

Changing_Environment_Task  #@NEW_LINE#@#  
Subjects were introduced to the changing environment task (Fig 1A) following motion direction discrimination training.  #@NEW_LINE#@#  The experimental setup, motion stimulus, and timing of events were unchanged from training.  #@NEW_LINE#@#  However, instead of one pair of choice targets, subjects were presented with two pairs of choice targets (four targets total), one pair above and one pair below the FP (10° eccentricity; ±3.5° above/below FP; ±9.4° left/right of FP).  #@NEW_LINE#@#  The right and left targets in each pair corresponded to the right and left motion directions, respectively.  #@NEW_LINE#@#  We refer to the upper and lower pairs of choice targets as two environments.  #@NEW_LINE#@#  On any given trial, only one environment was correct.  #@NEW_LINE#@#  Subjects were instructed to choose the target that corresponded to the correct motion direction and correct environment.  #@NEW_LINE#@#  We refer to the choice of left versus right targets as the direction choice and the choice of upper versus lower targets as the environment choice.  #@NEW_LINE#@#  An environment remained stable for several trials according to a truncated geometric distribution (range 215 trials, mean 6) and then changed (Fig 1B).  #@NEW_LINE#@#  Subjects were not explicitly cued about the correct environment or when it changedthey had to discover it.  #@NEW_LINE#@#  They received positive feedback only when both the environment and direction choice were correct.  #@NEW_LINE#@#  Negative feedback, however, was ambiguous; it occurred when either the environment or the direction choice were incorrect.  #@NEW_LINE#@#  Subjects had to resolve this ambiguity based on feedback and their expected accuracy in past choices.  #@NEW_LINE#@#  The auditory tones corresponding to positive and negative feedback were identical to those used for direction discrimination training.  #@NEW_LINE#@#  During training, subjects were told that their goal was to maximize the proportion of correct trials and that, to do this, they should try to identify environment changes as accurately and as soon as possible.  #@NEW_LINE#@#  
We adjusted the changing environment task design to simplify the interpretation of experimental results.  #@NEW_LINE#@#  First, to eliminate mistakes due to misremembering of the previously chosen environment, the targets for the environment chosen in the last trial were slightly brighter.  #@NEW_LINE#@#  In other words, choosing a brighter target always corresponded to staying in the same environment, whereas choosing a dimmer target always corresponded to an environment switch.  #@NEW_LINE#@#  This task design reduced the burden on subjects working memory, helping them fully focus on the decision about motion direction and environment on the current trial.  #@NEW_LINE#@#  In a second modification, trials in which subjects incorrectly switched environment (i.e., switch errors) were followed by presentation of the text, Switch error, Go back!  #@NEW_LINE#@#  This prevented prolonged confusion following incorrect switches and simplified the interpretation of results.  #@NEW_LINE#@#  Neither of these modifications was critical for our resultsvery similar results were obtained in earlier versions of the task without these modifications.  #@NEW_LINE#@#  
Each subject contributed several sessions of data across days.  #@NEW_LINE#@#  In each session, subjects performed three or four blocks of 100200 trials (mean trials per subject = 2,958 trials; range = 2,3593,485; total trials across subjects = 17,749).  #@NEW_LINE#@#  
To test for an influence of environment statistics on subjects switching behavior, we conducted a follow-up experiment in which five subjects performed the task with longer environments.  #@NEW_LINE#@#  The training procedure, experimental setup, stimulus, instructions, and timing of events within trials were identical to those described above.  #@NEW_LINE#@#  The only difference was that we increased the mean and range of environment durations experienced by the subjects (truncated geometric distribution, range 320 trials, mean 10).  #@NEW_LINE#@#  This allowed us to assess how subjects switching behavior changed with longer environment durations and, most importantly, how these changes could be explained by our modeling framework (Fig S5).  #@NEW_LINE#@#  
To verify that subjects used confidence to disambiguate the causes of negative feedbackflawed strategy or poor informationwe conducted a follow-up experiment in which six subjects reported their direction choice confidence on each trial (Fig S6).  #@NEW_LINE#@#  The task was identical to the main experiment, except that targets were replaced by elongated bars (7° long, 0.75° wide) and the environment duration distribution was matched to our first follow-up experiment (truncated geometric distribution, range 320, mean 10).  #@NEW_LINE#@#  The targets were placed at 7° eccentricity and oriented 45° (upper left and lower right targets) or 135° (upper right and lower left targets) to create a diamond pattern around the FP (Fig S6A).  #@NEW_LINE#@#  As before, subjects indicated their environment choices by responding to the upper or lower targets and indicated their direction choices by responding to the left or right targets.  #@NEW_LINE#@#  In addition, subjects indicated their degree of confidence that their direction choice was correct by varying the landing point of their saccade along the length of the chosen target (4).  #@NEW_LINE#@#  We report subjects confidence as the saccade end point in units of degrees along the target in the direction of increasing confidence (min = 4.5°, max = +4.5°, which includes the response window surrounding each target).  #@NEW_LINE#@#  Each target was colored with a spectrum ranging from red at one end (maximal certainty) to green at the other end (minimal certainty) in 10 discrete steps.  #@NEW_LINE#@#  Subjects were instructed that their confidence ratings should reflect only direction choice confidence and not environment choice confidence.  #@NEW_LINE#@#  To test whether motion direction choice confidence predicted subjects environment choices independent of stimulus properties, we removed the trial-to-trial variability of the motion stimulus for half of the trials by using a fixed seed for the pseudorandom number generator (one per coherence and direction) (3).  #@NEW_LINE#@#  

Supplemental_Behavioral_Analyses  #@NEW_LINE#@#  
Our follow-up experiment allowed us to test whether subjects direction choice confidence predicted environment choices independent of stimulus properties by analyzing only the subset of trials in which trial-to-trial stimulus variability was removed.  #@NEW_LINE#@#  For these trials, we computed saccade end point residuals by subtracting the mean saccade end point for each motion strength and duration quantile (20 quantiles; other numbers of quantiles produced similar results).  #@NEW_LINE#@#  The resulting saccade end point residuals were symmetrically distributed around zero.  #@NEW_LINE#@#  We obtained identical results using a parametric approach in which we fit saccade end points with a linear regression using motion strength, duration, and their interaction as predictors and then computed residuals by subtracting model predictions.  #@NEW_LINE#@#  

Optimal_Solution_for_the_Changing_Environment_Task  #@NEW_LINE#@#  
Switching from an old environment (E=1) to a new environment (E=2) should happen when the posterior odds of the new environment exceeds 1.  #@NEW_LINE#@#  The posterior odds arePO=p[E(T)=2|C(Tn,...,T),F(Tn,...,T)]p[E(T)=1|C(Tn,...,T),F(Tn,...,T)]=p[E(T)=2,C(Tn,...,T),F(Tn,...,T)]p[E(T)=1,C(Tn,...,T),F(Tn,...,T)],[S1]where E(T), C(T), and F(T) are the environment, motion strength (coherence and duration), and feedback on trial T, respectively.  #@NEW_LINE#@#  We use C to refer to both the motion coherence and duration only to shorten the equationsseparating the two will not change the final conclusion.  #@NEW_LINE#@#  The equality is based on Bayes rule.  #@NEW_LINE#@#  It can be shown that the posterior odds ratio becomes 0 for positive feedback on trial T. Therefore, we focus only on sequences of consecutive negative feedbacks that result from staying in the old environment from trial Tn to trial T(trial Tn is the first trial with negative feedback in the sequence, and feedback on trial Tn1 is positive).  #@NEW_LINE#@#  The numerator and denominator on the second line of Eq.  #@NEW_LINE#@#  S1 can be calculated as follows.  #@NEW_LINE#@#  The denominator isp[E(T)=1,C(Tn,...,T),F(Tn,...,T)]=p[E(Tn,...,T)=1,C(Tn,...,T),F(Tn,...,T)]=p[F(Tn,...,T)|E(Tn,...,T)=1,C(Tn,...,T)]×p[E(Tn,...,T)=1]p[C(Tn,...,T)]=p[C(Tn,...,T)]p[E(Tn,...,T)=1]×i=n0p[F(Ti)|E(Ti)=1,C(Ti)]=p[C(Tn,...,T)]i=n0[1H(Ti)]i=n0[1A(Ti)],[S2]where A(T) is the expected accuracy (confidence) for the direction choice on trial T. The second line in Eq.  #@NEW_LINE#@#  S2 results from our task design that ensures an environment change does not revert until the subject switches and samples the new environment.  #@NEW_LINE#@#  Put in equations,p[E(T1)=1|E(T)=1]=1,which can be rearranged using Bayes rule to showp[E(T1)=1,E(T)=1]=p[E(T)=1].A similar logic applies to trials before T1 in the sequence.  #@NEW_LINE#@#  
The numerator of posterior odds isp[E(T)=2,C(Tn,...,T),F(Tn,...,T)]=sp[E(T)=2,E(Tn,...,T1)=s,C(Tn,...,T),F(Tn,...,T)]=p[C(Tn,...,T)]s{p[E(T)=2,E(Tn,...,T1)=s]×i=n0p[F(Ti)|C(Ti),E(Ti)]}=p[C(Tn,...,T)]{H(Tn)+[1H(Tn)]H(Tn+1)[1A(Tn)]+...},[S3]where s denotes plausible combinations of environments in the previous n trials (e.g., a switch on trial T  n, T n + 1, etc.).  #@NEW_LINE#@#  Putting Eqs.  #@NEW_LINE#@#  S2 and S3 in Eq.  #@NEW_LINE#@#  S1, we havePO=[H(Tn)+H(Tn+1)[1H(Tn)][1A(Tn)]+H(Tn+2)[1H(Tn)][1H(Tn+1)][1A(Tn)][1A(Tn+1)]++H(T)i=n1{[1H(Ti)][1A(Ti)]}]i=n0[1H(Ti)]i=n0[1A(Ti)]H(Tn)i=n0[1H(Ti)]i=n0[1A(Ti)][S4]The approximation in the second line of the equation is justified because the higher terms in the numerator become exponentially smaller.  #@NEW_LINE#@#  This approximation makes Eqs.  #@NEW_LINE#@#  S5 and S6 deviate slightly from the true optimal solution.  #@NEW_LINE#@#  For simplicity, however, we use the term optimal (instead of nearly optimal) for those equations throughout the paper.  #@NEW_LINE#@#  
Subjects should switch environment when PO1, that is, when1i=n0[1A(Ti)]i=n0[1H(Ti)]H(Tn)[S5]ori=n0log11A(Ti)log[H(Tn)]+i=n0log[1H(Ti)].[S6]Eq.  #@NEW_LINE#@#  S6 suggests that accumulation of switch evidence, represented by log{1/[1A(T)]}, toward a switch bound, represented by log[H(Tn)]+i=n0log[1H(Ti)], is an optimal solution for this task.  #@NEW_LINE#@#  The first term in the right-hand side of Eq.  #@NEW_LINE#@#  S6, log[H(Tn)], shows that the switch bound depends on the location of the first negative feedback in the sequence of trials within the environment.  #@NEW_LINE#@#  This dependence contributes to switch urgency if subjective hazard rates grow over time.  #@NEW_LINE#@#  The second term in the right-hand side of Eq.  #@NEW_LINE#@#  S6, log[1H(Ti)], is negative because H(T) is bounded between zero and 1.  #@NEW_LINE#@#  This bound collapse contributes to the switch urgency as the number of consecutive negative feedbacks increases.  #@NEW_LINE#@#  


Acknowledgments  #@NEW_LINE#@#  
We thank Bill Newsome, Mike Shadlen, Josh Gold, and Valerio Mante for useful discussions and Saleh Esteki for assistance with data collection.  #@NEW_LINE#@#  This study was supported by a Simons Collaboration on the Global Brain postdoctoral fellowship (to B.A.P.)  #@NEW_LINE#@#  and National Institutes of Health Grant R01 MH109180-01, a Whitehall Foundation research grant, and a NARSAD Young Investigator Award (to R.K.).  #@NEW_LINE#@#  

Footnotes  #@NEW_LINE#@#  


