article id="http://dx.doi.org/10.1073/pnas.1711927114"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Molecular ensembles make evolution unpredictable  #@NEW_LINE#@#  

Significance  #@NEW_LINE#@#  
A long-standing goal in evolutionary biology is predicting evolution.  #@NEW_LINE#@#  Here, we show that the architecture of macromolecules fundamentally limits evolutionary predictability.  #@NEW_LINE#@#  Under physiological conditions, macromolecules, like proteins, flip between multiple structures, forming an ensemble of structures.  #@NEW_LINE#@#  A mutation affects all of these structures in slightly different ways, redistributing the relative probabilities of structures in the ensemble.  #@NEW_LINE#@#  As a result, mutations that follow the first mutation have a different effect than they would if introduced before.  #@NEW_LINE#@#  This implies that knowing the effects of every mutation in an ancestor would be insufficient to predict evolutionary trajectories past the first few steps, leading to profound unpredictability in evolution.  #@NEW_LINE#@#  We, therefore, conclude that detailed evolutionary predictions are not possible given the chemistry of macromolecules.  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
Evolutionary prediction is of deep practical and philosophical importance.  #@NEW_LINE#@#  Here we show, using a simple computational protein model, that protein evolution remains unpredictable, even if one knows the effects of all mutations in an ancestral protein background.  #@NEW_LINE#@#  We performed a virtual deep mutational scanrevealing the individual and pairwise epistatic effects of every mutation to our model proteinand then used this information to predict evolutionary trajectories.  #@NEW_LINE#@#  Our predictions were poor.  #@NEW_LINE#@#  This is a consequence of statistical thermodynamics.  #@NEW_LINE#@#  Proteins exist as ensembles of similar conformations.  #@NEW_LINE#@#  The effect of a mutation depends on the relative probabilities of conformations in the ensemble, which in turn, depend on the exact amino acid sequence of the protein.  #@NEW_LINE#@#  Accumulating substitutions alter the relative probabilities of conformations, thereby changing the effects of future mutations.  #@NEW_LINE#@#  This manifests itself as subtle but pervasive high-order epistasis.  #@NEW_LINE#@#  Uncertainty in the effect of each mutation accumulates and undermines prediction.  #@NEW_LINE#@#  Because conformational ensembles are an inevitable feature of proteins, this is likely universal.  #@NEW_LINE#@#  

Results  #@NEW_LINE#@#  
We set out to predict trajectories that increased the stability of a lattice protein.  #@NEW_LINE#@#  Lattice models have been used extensively in studies of protein folding and evolution (1317).  #@NEW_LINE#@#  A lattice model captures the fact that the weak interactions that define the structure of a protein stochastically break and form under cellular conditions, causing proteins to fluctuate between multiple conformations (1820).  #@NEW_LINE#@#  These structural ensembles are critical to functions, such as allostery (20, 21), enzyme activity (19), complex assembly (22), and regulation (23).  #@NEW_LINE#@#  
A lattice model describes a protein ensemble as a collection of conformations on a grid.  #@NEW_LINE#@#  Some conformations will be favored, and others will be disfavored.  #@NEW_LINE#@#  The favorability of each conformation is quantified by its internal energy (Ec), which depends on the contacts between amino acids in that conformation.  #@NEW_LINE#@#  Conformations with more favorable contacts are more likely than those with fewer contacts.  #@NEW_LINE#@#  The overall stability of the protein is described by the free energy of the native conformation (GN), which quantifies the population of the native conformation relative to all other conformations in the ensemble (Fig 1A).  #@NEW_LINE#@#  Using reduced temperature units, this is given byGN=EN+ln(eEN+i=1CeEi),[1]where EN is the internal energy of the native conformation, and the sum on the right goes over all C conformations in the ensemble.  #@NEW_LINE#@#  
We studied evolution in a strong selection, weak mutation regime (24).  #@NEW_LINE#@#  This assumes that the population size is large and that mutations fix sequentiallya reasonable assumption for a single gene for which recombination is rare.  #@NEW_LINE#@#  This also removes uncertainty caused by drift.  #@NEW_LINE#@#  We defined fitness as proportional to the fraction of the molecules in the native conformation, w=1/[1+exp(GN)], because the fraction of molecules foldednot the free energyis under selection in most biological contexts (11).  #@NEW_LINE#@#  
We generated a random 12-amino acid protein sequence with w0.7 as our starting point (Materials and Methods).  #@NEW_LINE#@#  We calculated w for all genotypes differing by a single mutation relative to the ancestor and then determined the relative fixation probability for all point mutants.  #@NEW_LINE#@#  We then stepped out to all accessible genotypes and repeated the protocol.  #@NEW_LINE#@#  Any mutation with a nonzero fixation probability was considered accessible.  #@NEW_LINE#@#  Iterating this procedure generates a branching set of trajectories that improve the stability of the original native conformation.  #@NEW_LINE#@#  By comparing the relative fixation probabilities for each mutation along each trajectory, we can calculate the total probability flux through each possible trajectory (Materials and Methods).  #@NEW_LINE#@#  
We started by calculating ground truth evolutionary trajectories against which to compare our predictions (Fig 1B).  #@NEW_LINE#@#  For the sequence in Fig 1B, we found one main evolutionary trajectory (shown in orange in Fig 1B) leading to a fitness peak six mutations away.  #@NEW_LINE#@#  There were also several lower probability trajectories accessible (shown in gray in Fig 1B).  #@NEW_LINE#@#  
We next set out to predict these trajectories using information extracted from a virtual deep mutational scanning experiment.  #@NEW_LINE#@#  We calculated the change in GN for all 228 possible point mutants to the ancestral genotype.  #@NEW_LINE#@#  Using this information, we could then predict GN for any genotype as the free energy of the ancestor plus the sum of the effects of all mutations in the genotype.  #@NEW_LINE#@#  Finally, we could use these predicted GN values to calculate probable evolutionary trajectories.  #@NEW_LINE#@#  
These predictions were quite poor (Fig 1C).  #@NEW_LINE#@#  While the first move is correctly identified, the next move is incorrect.  #@NEW_LINE#@#  For the sequence shown in Fig 1C, our predicted trajectories are limited to a peak directly adjacent to the ancestral genotype rather than the actual peak six mutations away.  #@NEW_LINE#@#  
This result is unsurprising: we did not include any epistasis in our predictions.  #@NEW_LINE#@#  Like real proteins, residues in a lattice model form direct contacts with each other.  #@NEW_LINE#@#  We would, therefore, expect to see pairwise epistasisa difference in GN when mutations are introduced together versus separately.  #@NEW_LINE#@#  We, therefore, reran our predictions of trajectories accounting for both the individual effects of mutations and pairwise epistasis between them.  #@NEW_LINE#@#  Practically, this involved another, larger, virtual deep mutational scanning experiment: we calculated GN for all 228 possible single mutants and all 22,836 possible double mutants.  #@NEW_LINE#@#  By comparing the effects of each mutation together and in pairs, we could build a more sophisticated prediction model that accounts for pairwise interactions between mutations (Materials and Methods).  #@NEW_LINE#@#  
Addition of pairwise epistasis improved our predictions relative to the additive model, but we still performed quite poorly (Fig 1D).  #@NEW_LINE#@#  Although the addition of pairwise epistasis allows the trajectories to escape the local region of the ancestral genotype, the predicted and actual trajectories diverge after the second step.  #@NEW_LINE#@#  Many genotypes are visited that were not seen in the actual trajectories, while many genotypes in the actual trajectories were missed (purple crosses in Fig 1D).  #@NEW_LINE#@#  This includes the actual fitness peak.  #@NEW_LINE#@#  
To verify that this was a robust feature of lattice proteins, we then repeated our pairwise epistasis predictions for 1,000 different random starting sequences.  #@NEW_LINE#@#  To characterize the quality of our predictions, we calculated the difference in the probabilities of matched trajectories between our predicted and actual maps ().  #@NEW_LINE#@#  This metric ranges from 0.0 (no difference) to 1.0 (complete difference) (Materials and Methods and SI Appendix) (25).  #@NEW_LINE#@#  We then calculated  as a function of the number of steps from the ancestral genotype for all 1,000 spaces (Fig 1E).  #@NEW_LINE#@#  In all spaces, we correctly predict the first two moves.  #@NEW_LINE#@#  (This is because we built the prediction model using the fitness of these genotypeshardly a difficult prediction.)  #@NEW_LINE#@#  Addition of the third mutation, however, causes immediate divergence between the predicted and actual trajectories.  #@NEW_LINE#@#  This divergence continues until, by the seventh step, the predicted and actual maps have an average divergence of 0.9.  #@NEW_LINE#@#  
Ensembles_Induce_Epistasis  #@NEW_LINE#@#  
Our predictions accounted for all pairwise epistasis but still failed.  #@NEW_LINE#@#  It follows that there must be three-way (or greater) epistatic interactions between mutations.  #@NEW_LINE#@#  This is surprising, as lattice models are built from pairwise contacts alone.  #@NEW_LINE#@#  What is the source of this high-order epistasis?  #@NEW_LINE#@#  We know that these interactions must be indirect at a structural level, as the only direct interactions are pairwise.  #@NEW_LINE#@#  We, therefore, searched for mechanisms that would lead to indirect interactions between mutations.  #@NEW_LINE#@#  
Allostery, where binding at one site indirectly affects activity at a distant site, is a useful analog of this problem.  #@NEW_LINE#@#  One way that allostery can arise is through a conformational ensemble (20, 21).  #@NEW_LINE#@#  Binding at one site perturbs the relative populations of different structures in the conformational ensemble.  #@NEW_LINE#@#  This can, indirectly, change activity at another site.  #@NEW_LINE#@#  We hypothesized that a similar phenomenon was leading to evolutionary unpredictability.  #@NEW_LINE#@#  
Fig 2 shows a highly simplified lattice model that illustrates indirect, ensemble-induced epistasis between a pair of mutations.  #@NEW_LINE#@#  (The logic can be extended to indirect multiway interactions between mutations, but visualization of the phenomenon is much easier for pairwise epistasis.)  #@NEW_LINE#@#  In this example, we have a 6-amino acid protein, where each site can be either hydrophobic (H) or polar (P).  #@NEW_LINE#@#  We will consider introducing two mutations that do not contact one another in the structure: H2P (Fig 2, orange) and H4P (Fig 2, purple).  #@NEW_LINE#@#  We start with the nonepistatic case (Fig 2A).  #@NEW_LINE#@#  This ensemble has only two conformations: A and B. GA is simply the difference in the contact energy between conformation A and conformation B (Fig 2A and Table 1).  #@NEW_LINE#@#  H2P destabilizes conformation A, and H4P indirectly stabilizes conformation A by destabilizing conformation B.  #@NEW_LINE#@#  If we sum the effects of the mutations, we obtain the correct stability of the double mutant.  #@NEW_LINE#@#  
What if we add a third conformation (C) to the thermodynamic ensemble?  #@NEW_LINE#@#  This is shown in Fig 2B.  #@NEW_LINE#@#  GA is now the difference between the contact energy of A and the log of the Boltzmann-weighted sum of the contact energies of B and C (Fig 2B and Table 1).  #@NEW_LINE#@#  The mutations now no longer behave additively.  #@NEW_LINE#@#  In the WT background, H2P is destabilizing by 0.6 (reduced energy units).  #@NEW_LINE#@#  In the H4P background, H2P is destabilizing by only 0.4.  #@NEW_LINE#@#  This is indirect, ensemble-induced epistasis.  #@NEW_LINE#@#  In the WT background, H2P destabilizes conformation A, such that it has the same contact energy as conformation B.  #@NEW_LINE#@#  These states strongly compete with one another, causing H2P to have a relatively large effect (0.6).  #@NEW_LINE#@#  H4P alters this effect by destabilizing conformation B.  #@NEW_LINE#@#  This means that, when H2P is introduced, conformation B does not compete effectively with conformation A.  #@NEW_LINE#@#  As a result, H2P has a more mild effect (0.4).  #@NEW_LINE#@#  
The presence of the third state in the ensemble leads to epistasis between these mutations and an incorrect prediction of the double-mutant stability.  #@NEW_LINE#@#  Predicting the effect of a mutation in a future genetic background, therefore, requires knowing its effect on every member of the ensemble, not simply its aggregate effect on the entire population of states.  #@NEW_LINE#@#  This is, in practice, impossible to measure.  #@NEW_LINE#@#  Ensemble-induced epistasis is directly analogous to ensemble-induced allostery (20, 21); however, we have now substituted mutations for binding events and binding sites.  #@NEW_LINE#@#  

Evolutionary_Trajectories_Exhibit_Extensive_Ensemble-Induced_Epistasis  #@NEW_LINE#@#  
From our reasoning above, we would predict that ensemble-induced epistasis would arise for any conformational ensemble with more than two states and that it could lead to epistasis of any order.  #@NEW_LINE#@#  We, therefore, set out to quantify the epistasis present in our evolutionary trajectories.  #@NEW_LINE#@#  Quantitatively, epistasis accounts for variation not accounted for by lower ordered effects of mutations.  #@NEW_LINE#@#  Pairwise epistasis is the difference in the effects of two mutations introduced together versus separately.  #@NEW_LINE#@#  Three-way epistasis is the difference in GN for a triple mutant versus the predicted GN from the individual and pairwise epistatic coefficients.  #@NEW_LINE#@#  In thermodynamic terms, individual effects are GN, pairwise interactions are GN, and three-way interactions are GN.  #@NEW_LINE#@#  This can be extended to any order of interaction (2628).  #@NEW_LINE#@#  
Measuring an Lth-order interaction requires characterizing 2L combinations of mutations.  #@NEW_LINE#@#  To access a collection of 2L genotypes, we constructed binary genotypephenotype maps containing all possible combinations of the mutations between the ancestral genotypes and their highest probability genotype six mutations away (e.g., between the ancestor and the peak in Fig 1B).  #@NEW_LINE#@#  We decomposed epistasis in GN using a linear model capturing the individual effects of mutations and any interactions between them (2628) using the ancestral genotype as the reference state (27).  #@NEW_LINE#@#  
We detected high-order epistasis in every calculated trajectory.  #@NEW_LINE#@#  Fig 3A shows the average magnitude of epistatic coefficients of increasing order for all spaces.  #@NEW_LINE#@#  The magnitude decays with increasing order but is still detectable up to the sixth order in all spaces.  #@NEW_LINE#@#  
If the ensemble is, indeed, the source of this epistasis, we predicted that it would disappear if we removed the ensemble.  #@NEW_LINE#@#  We, therefore, generated truncated lattice models that had only two or three conformations in their ensemble.  #@NEW_LINE#@#  The two-state ensemble had the native state and the lowest energy nonnative conformation (N and U).  #@NEW_LINE#@#  The three-state ensemble had the native state and the two lowest energy nonnative conformations (N, U, and U).  #@NEW_LINE#@#  
We predicted that the two-state model would exhibit only pairwise epistasis, while the three-state model would exhibit higher ordered epistasis.  #@NEW_LINE#@#  This can be understood from the energy function for each ensemble.  #@NEW_LINE#@#  GN for the two-state model is linear with respect to contact energy (Table 1).  #@NEW_LINE#@#  The only epistasis that arises is via direct interactions encoded in the contact energy.  #@NEW_LINE#@#  In a three-state (or higher) ensemble, GN no longer reduces to a linear difference in contact energies (Table 1).  #@NEW_LINE#@#  This means that mutations have nonlinear effects on the probabilities of conformations within the ensemble, leading to ensemble-induced epistasis (Fig 2).  #@NEW_LINE#@#  
To investigate epistasis in these reduced ensembles, we generated binary maps as before: we used either a two-state or three-state ensemble to calculate GN for each genotype, calculated evolutionary trajectories, and then built binary maps between the ancestor and most probable final genotype.  #@NEW_LINE#@#  We then decomposed these maps to extract epistasis.  #@NEW_LINE#@#  As predicted, the two-state ensembles exhibited only pairwise epistasis (Fig 3B).  #@NEW_LINE#@#  In contrast, the three-state ensemble exhibited extensive high-order epistasis (Fig 3C)just like the full ensemble (Fig 3A).  #@NEW_LINE#@#  
We next asked whether reducing the ensembles altered predictability.  #@NEW_LINE#@#  If the unpredictability that we initially observed arises from epistasis induced by the ensemble, we would predict high predictability for two-state ensemble but poor predictability for the three-state ensemble.  #@NEW_LINE#@#  We observed precisely this pattern.  #@NEW_LINE#@#  A pairwise prediction model was able to perfectly predict evolutionary trajectories for two-state ensemble (Fig 3E) but failed to predict evolutionary trajectories for the three-state ensemble (Fig 3F).  #@NEW_LINE#@#  The unpredictability observed for the three-state ensemble is directly comparable with the unpredictability observed for the full ensemble (Fig 3D).  #@NEW_LINE#@#  

Predictions_Fail_Even_When_High-Order_Epistasis_Is_Included  #@NEW_LINE#@#  
If molecular ensembles lead to epistasis, which undermines evolutionary prediction, an obvious solution is to characterize even higher orders of epistasis.  #@NEW_LINE#@#  What if we knew all three-way interactions?  #@NEW_LINE#@#  Or four-way interactions?  #@NEW_LINE#@#  Is there some order of epistasis that, when characterized, allows long-range evolutionary predictions?  #@NEW_LINE#@#  
We cannot ask this question for open-ended evolutionary trajectories, as it rapidly becomes intractable.  #@NEW_LINE#@#  (Even for our 12-site lattice protein, quantifying all possible three-way interactions would require characterizing 1,533,034 genotypes.)  #@NEW_LINE#@#  Instead, we chose to try to predict trajectories from ancestral to derived genotype through the binary maps above, each containing 26 genotypes.  #@NEW_LINE#@#  We built increasingly complex epistatic models ranging from first order (constructed from characterization of six point mutants in the ancestral background) to sixth order (constructed from characterization of all combinations of point mutants in the ancestral background).  #@NEW_LINE#@#  
We found that incorporation of high-order epistasis led to little improvement in our predictions.  #@NEW_LINE#@#  Fig 4 shows the deviation between our predicted and actual trajectories for models incorporating increasingly higher orders of epistasis.  #@NEW_LINE#@#  Fig 4A shows predictions using the full ensemble.  #@NEW_LINE#@#  The additive model begins to deviate from the actual trajectories after the first step, the pairwise model begins to deviate after the second step, and the three-way model begins to deviate after the third step.  #@NEW_LINE#@#  As soon as the model has to make a prediction beyond the phenotypes that were used to build the model, trajectories begin to deviate.  #@NEW_LINE#@#  Even our fifth-order modelwhich required knowing the phenotypes of 63 of 64 genotypes in the spacedoes not always correctly predict the final step (Fig 4, purple curve).  #@NEW_LINE#@#  
This unpredictability arises from the thermodynamic ensemble.  #@NEW_LINE#@#  Fig 4 B and C shows the same analysis for the two-state and three-state ensembles, respectively.  #@NEW_LINE#@#  For the two-state ensemble, we were able to predict trajectories perfectly with the addition of pairwise epistasis.  #@NEW_LINE#@#  For the three-state model, we see similar behavior to the full ensemble: inclusion of high-order epistasis does not improve predictions.  #@NEW_LINE#@#  This is because the epistasis does not capture specific interactions but instead, reveals that the ensemble is changing quantitatively and nonlinearly as mutations accumulate.  #@NEW_LINE#@#  No matter what order of epistasis is characterized, the future remains obscure.  #@NEW_LINE#@#  


Discussion  #@NEW_LINE#@#  
Our work shows that the physical properties of proteins can lead to profound evolutionary unpredictability.  #@NEW_LINE#@#  Because each mutation alters the relative probabilities of all conformations of a protein, the quantitative effect of a mutation is different in every genetic background.  #@NEW_LINE#@#  As a result, the effect of a mutation early in a trajectory does not predict its effect later, and evolutionary trajectories become unpredictable.  #@NEW_LINE#@#  Because thermodynamic ensembles are a natural aspect of molecular architecture and ubiquitous for function, we expect that this is a universal link between the biochemistry of macromolecules and their evolution.  #@NEW_LINE#@#  
A key point from our work is that unpredictability can arise even in this extraordinary simple system.  #@NEW_LINE#@#  The problem of predicting evolution will only become harder as the complexity and realism of the models increase.  #@NEW_LINE#@#  Using a larger protein, for example, would increase the number of possible options and degeneracy of trajectories, making predictions more challenging.  #@NEW_LINE#@#  Likewise, constructing a more realistic evolutionary modelincorporating drift for exampleincreases the number of available trajectories and makes evolutionary prediction more challenging than the strong selection case (SI Appendix).  #@NEW_LINE#@#  
Ensemble-Induced_Epistasis_Is_Likely_Common  #@NEW_LINE#@#  
Our work suggests that any macromolecule that populates three or more conformations can exhibit ensemble-induced epistasis.  #@NEW_LINE#@#  This is an extraordinarily common set of conditions, as most macromolecular functions require populating multiple states (1821).  #@NEW_LINE#@#  For example, consider an allosterically inhibited enzyme that takes two conformations: E (inactive) and E (active).  #@NEW_LINE#@#  An inhibitor I binds to E, shifting the population from E to E. The fraction of the enzyme in the active form given [I] isEII+EEfactive=[E][E]+[E]+[EI].This protein has three distinct statesE, E, and EIthat have different structures and would, thus, respond differentially to mutations.  #@NEW_LINE#@#  We would, therefore, expect ensemble-induced epistasis in factive.  #@NEW_LINE#@#  
In addition to theoretical considerations, there is experimental evidence that ensemble-induced epistasis shapes evolution (29, 30).  #@NEW_LINE#@#  The most direct is an engineered evolutionary trajectory that converts a protein from one fold to another (13, 29).  #@NEW_LINE#@#  Midway through the trajectory, a single mutation switches the fold.  #@NEW_LINE#@#  If introduced earlier in the trajectory, the mutation does not have the same effect.  #@NEW_LINE#@#  The fold-switching mutation has its singular effect, because other mutations have prestabilized the alternate fold.  #@NEW_LINE#@#  This is ensemble-induced epistasis: mutations perturb the relative stability of a nonnative conformation, opening up a new evolutionary trajectory.  #@NEW_LINE#@#  
Another observation is the presence of high-order epistasis in every combinatorial protein genotypephenotype studied (28, 31).  #@NEW_LINE#@#  The phenotypes studied are diverse, including binding affinity, spectroscopic properties, and enzyme activity.  #@NEW_LINE#@#  Although there is no direct evidence that the high-order epistasis in these maps arises from underlying ensembles, ensemble-induced epistasis provides a simple, universal explanation that unites these disparate observations of high-order epistasis.  #@NEW_LINE#@#  
One question that remains is how our observations in lattice models map quantitatively to real proteins.  #@NEW_LINE#@#  What is the magnitude of ensemble-induced epistasis in real systems?  #@NEW_LINE#@#  How many steps can be predicted before real evolutionary predictions diverge?  #@NEW_LINE#@#  This will depend on the details of the sequence and its associated ensemble.  #@NEW_LINE#@#  Our results suggest, however, that ensemble-induced epistasis will eventually lead to divergence between predicted and actual trajectories in any protein genotypephenotype map.  #@NEW_LINE#@#  
It also remains to be seen if something analogous to ensemble-induced epistasis exists on a larger scale, such as in a signaling network.  #@NEW_LINE#@#  Such networks do exhibit ensemble-like behavior, populating a collection of different configurations that rearrange in response to stimuli and sometimes even exhibiting stable three-state character (32, 33) We might, therefore, be able to explain high-order epistasis in such systems using an ensemble framework (28, 31).  #@NEW_LINE#@#  

Interpreting_Epistasis  #@NEW_LINE#@#  
Our analysis also sheds light on the question of the origin and interpretation of high-order epistasis.  #@NEW_LINE#@#  First, our work shows that it is relatively easy to create a system with irreducible high-order epistasis, even with a very simple lattice protein.  #@NEW_LINE#@#  There is no simple scale that reduces the epistasis (28, 34): it is an integral part of the system.  #@NEW_LINE#@#  
Second, our work shows that there is no mechanistic interpretation for epistatic coefficients that arise by such a process.  #@NEW_LINE#@#  The epistasis is fundamentally statistical rather than biological (34).  #@NEW_LINE#@#  The ensemble effectively encrypts the interactions that give rise to the epistasis.  #@NEW_LINE#@#  A three-way interaction cannot be interpreted in a direct physical manner or in a way to predict which conformations changed.  #@NEW_LINE#@#  It quantifies the effect of the mutation, integrated over its effect on all conformations in the ensemble.  #@NEW_LINE#@#  In our view, the best interpretation of epistasis in macroevolutionary trajectories is as a means to quantify uncertainty in future predictionsnot necessarily as a way to gain mechanistic insight into the system.  #@NEW_LINE#@#  

Evolution_Is_Unpredictable  #@NEW_LINE#@#  
Epistasis makes a relatively small contribution to variation in our lattice models (Fig 3A) as well as real datasets (28, 31).  #@NEW_LINE#@#  This allows prediction of phenotypes with relatively high accuracy, as has been noted before in lattice models (17).  #@NEW_LINE#@#  Approximate phenotypes are, however, insufficient for predicting trajectories.  #@NEW_LINE#@#  Because evolutionary trajectories are a contingent series of steps, small uncertainties in phenotypes are amplified into large uncertainties in trajectories (25).  #@NEW_LINE#@#  Practically, this means that you can predict a multimutation phenotype from a deep mutational scanning experiment but likely not its evolutionary accessibility from the ancestral state.  #@NEW_LINE#@#  
Many previous discussions of unpredictability have revolved around robustness of trajectories to external factors, such as environmental perturbation (2), genetic drift (4), or a change in the nature of selection (35).  #@NEW_LINE#@#  The unpredictability that we observe arises from the architecture of protein systems themselves.  #@NEW_LINE#@#  Our work indicates that the physical architecture of biomolecules naturally leads to ensemble-induced epistasis.  #@NEW_LINE#@#  Accumulating mutations thus alter the effects of future mutations, making evolution unpredictable given information about the effects of mutations in the ancestral state.  #@NEW_LINE#@#  


Materials_and_Methods  #@NEW_LINE#@#  
All of our analyses are contained in Python scripts and Jupyter notebooks available on Github (https://github.com/harmslab/notebooks-epistasis-ensembles).  #@NEW_LINE#@#  Full details are given in SI Appendix.  #@NEW_LINE#@#  
For the protein lattice model simulations, we extended the lattice proteins package originally written by Jesse Bloom (https://github.com/harmslab/latticeproteins) (17) using Miyazawa and Jernigan contact energies (from table V in ref.  #@NEW_LINE#@#  36) and reduced temperature units (36).  #@NEW_LINE#@#  We randomly generated 12-site protein sequences and then evolved each sequence until the fraction folded was 0.7.  #@NEW_LINE#@#  We calculated the probability of a given evolutionary trajectory as a series of independent, sequential fixation events using a strong selection, weak mutation model (37).  #@NEW_LINE#@#  In this model, the fixation probability for going from genotype x to x+1 isxx+1=1e(wx+1wx1),where wx and wx+1 are the relative fitness rates of the x and x+1 genotypes (SI Appendix).  #@NEW_LINE#@#  
To quantify the difference between the predicted and actual trajectories, we calculated the magnitude of the difference in probability of all observed trajectories through each space (SI Appendix) (25).  #@NEW_LINE#@#  
We predicted the GN for each genotype and then used this to predict evolutionary trajectories.  #@NEW_LINE#@#  For the additive model, the predicted stability of a genotype with a set of {M} mutations wasG^N,{M}=GN,anc+i{M}GN,i,where GN,anc is the stability of the ancestor and GN,i is the effect of the ith mutation in the ancestral background.  #@NEW_LINE#@#  For the pairwise epistatic model, we added epistatic coefficients:G^N,{M}=GN,anc+i{M}GN,i+iless_thanj{M}GN,ij,where GN,ij accounts for any pairwise epistasis between the mutations i and j.  #@NEW_LINE#@#  We quantified this epistasis by introducing mutations i, j, and then, i and j together.  #@NEW_LINE#@#  We then took the difference:GN,ij=GN,ij(GN,anc+GN,i+GN,j),where GN,i and GN,j are the individual effects of mutations i and j, respectively, in the ancestral background and GN,ij is the stability of the ij double mutant.  #@NEW_LINE#@#  
To extract high-order epistasis, we used the epistasis package (https://github.com/harmslab/epistasis) (28).  #@NEW_LINE#@#  A genotype with L mutations is described by 2L hierarchical epistatic coefficients (2628, 31).  #@NEW_LINE#@#  We generated all 26 binary combinations of the substitutions that accumulated between the ancestor and most probable final sequence, calculating GN for all 64 mutants.  #@NEW_LINE#@#  Because we were doing predictions starting from the ancestral state, we used the so-called biochemical model that uses the ancestral genotype as the reference state (27).  #@NEW_LINE#@#  SI Appendix has additional details.  #@NEW_LINE#@#  

Acknowledgments  #@NEW_LINE#@#  
We thank Luke Wheeler, Tyler Starr, and Joe Thornton as well as members of the laboratory of M.J.H.  #@NEW_LINE#@#  for fruitful discussions when developing these ideas.  #@NEW_LINE#@#  This work was funded by funds from the University of Oregon (to Z.R.S.)  #@NEW_LINE#@#  and Alfred P. Sloan Fellowship FG-2015-65336 (to M.J.H.  #@NEW_LINE#@#  ).  #@NEW_LINE#@#  

Footnotes  #@NEW_LINE#@#  

This is an open access article distributed under the PNAS license.  #@NEW_LINE#@#  

