article id="http://dx.doi.org/10.1073/pnas.1703642114"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Estimating mobility using sparse data: Application to human genetic variation  #@NEW_LINE#@#  

Significance  #@NEW_LINE#@#  
Migratory activity is a critical factor in shaping processes of biological and cultural change through time.  #@NEW_LINE#@#  We introduce a method to estimate changes in underlying migratory activity that can be applied to genetic, morphological, or cultural data and is well-suited to samples that are sparsely distributed in space and through time.  #@NEW_LINE#@#  By applying this method to ancient genome data, we infer a number of changes in human mobility in Western Eurasia, including higher mobility in pre- than post-Last Glacial Maximum huntergatherers, and oscillations in Holocene mobility with peaks centering on the Neolithic transition and the beginnings of the Bronze Age and the Late Iron Age.  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
Mobility is one of the most important processes shaping spatiotemporal patterns of variation in genetic, morphological, and cultural traits.  #@NEW_LINE#@#  However, current approaches for inferring past migration episodes in the fields of archaeology and population genetics lack either temporal resolution or formal quantification of the underlying mobility, are poorly suited to spatially and temporally sparsely sampled data, and permit only limited systematic comparison between different time periods or geographic regions.  #@NEW_LINE#@#  Here we present an estimator of past mobility that addresses these issues by explicitly linking trait differentiation in space and time.  #@NEW_LINE#@#  We demonstrate the efficacy of this estimator using spatiotemporally explicit simulations and apply it to a large set of ancient genomic data from Western Eurasia.  #@NEW_LINE#@#  We identify a sequence of changes in human mobility from the Late Pleistocene to the Iron Age.  #@NEW_LINE#@#  We find that mobility among European Holocene farmers was significantly higher than among European huntergatherers both pre- and postdating the Last Glacial Maximum.  #@NEW_LINE#@#  We also infer that this Holocene rise in mobility occurred in at least three distinct stages: the first centering on the well-known population expansion at the beginning of the Neolithic, and the second and third centering on the beginning of the Bronze Age and the late Iron Age, respectively.  #@NEW_LINE#@#  These findings suggest a strong link between technological change and human mobility in Holocene Western Eurasia and demonstrate the utility of this framework for exploring changes in mobility through space and time.  #@NEW_LINE#@#  

Estimating_Past_Migration_Rates  #@NEW_LINE#@#  
Under a general model of identity-by-descent with modification and isolation by distance (IBD) (20, 21), trait (genetic, morphological, or cultural) differences between any two entities (individuals or populations) increase monotonically as a function of both the temporal and spatial distance between them.  #@NEW_LINE#@#  We therefore expect that trait differences between entities correlate with temporal as well as spatial distances.  #@NEW_LINE#@#  However, the extent to which spatial and temporal differences explain observed trait variation depends on the level of spatial population structure and therefore on the level of mobility.  #@NEW_LINE#@#  If mobility was low (i.e., strong spatial structure), then we would expect differences between entities to be more strongly correlated with space, relative to time, whereas if mobility was high we would expect time to explain a relatively larger proportion of differences between entities (because of the homogenizing effects of high mobility across space).  #@NEW_LINE#@#  
Given that both spatial and temporal distances are expected to correlate with trait differences among entities, a matrix combining both spatial and temporal distance information should give a stronger correlation than either matrix alone (extra correlation, EC).  #@NEW_LINE#@#  However, since spatial and temporal distances are measured in different units (e.g., kilometers and years), combining them requires a scaling factor (S).  #@NEW_LINE#@#  Here, we show that the scaling factor value (Smax) that maximizes the correlation between a trait difference matrix and a Euclidian distance matrix combining the spatial and temporal distance matrices provides an estimator of mobility over the period and region covered by the data (see Materials and Methods and Fig 1).  #@NEW_LINE#@#  For convenience, we use a geometric interpretation of the scaling factor Smax as an angle, , in the plane defined by the spatial and temporal distances [ = atan(Smax), illustrated in Fig 1, Inset; see Materials and Methods].  #@NEW_LINE#@#  
To test the reliability and the robustness of Smax in recovering information about past mobility, we simulated data under a spatiotemporally explicit 2D model, which includes simple population dynamics with population growth, density dependence, and mobility (modeled as a Gaussian random walk), and generated variation data under different mobility parameter values (see Materials and Methods).  #@NEW_LINE#@#  We assessed the ability of Smax to infer simulated mobility values by correlation across simulations.  #@NEW_LINE#@#  We found a strong, positive linear relationship between the simulated average migration distance (i.e., mobility) and values of Smax (Fig 2, R2 = 0.8), thus demonstrating the utility of this statistic as an estimator for relative mobility.  #@NEW_LINE#@#  However, for this result to hold, it is important that the trait differences are generated under an approximately constant mutation rate and vary neutrally within a population.  #@NEW_LINE#@#  

Migration_Rates_Among_Pleistocene_HunterGatherers_and_Early_Farmers  #@NEW_LINE#@#  
Recent advances in sequencing technologies have allowed genomic data retrieval from a large sample of past individuals (e.g., refs.  #@NEW_LINE#@#  2226).  #@NEW_LINE#@#  Although these studies have not explicitly quantified underlying mobility in the past, they have suggested several periods of large-scale population turnover in Western Eurasia.  #@NEW_LINE#@#  
Given that the Smax statistic is able to recover information on past mobility in simulated data, we applied the method to a sample (n = 329) of previously published genome-wide genotype data covering a time period from the beginning of the Upper Paleolithic to the Iron Age to explore changes in past human mobility in Western Eurasia (see Materials and Methods).  #@NEW_LINE#@#  We also constructed nonparametric confidence intervals to account for date and sampling uncertainty and estimated P values for the Smax statistic by permutation under the null hypothesis of no IBD in space and time, which allowed us to quantify the robustness of our estimates and identify time periods during which data are too sparse for the Smax statistic to be informative (see Material and Methods).  #@NEW_LINE#@#  First, we explored the extent to which mobility differed between pre- and post-Last Glacial Maximum (LGM) huntergatherers (Fig 3).  #@NEW_LINE#@#  We found the average (median) mobility rates to be higher ( = 18.1; 95% CI: 14.987.7; P = 0.08) among pre-LGM huntergatherers, temporally ranging from 37,00026,000 y ago, compared with post-LGM huntergatherers ( = 9.9; 95% CI: 9.510.9; P = 0.03), temporally ranging from 19,0005,000 y ago.  #@NEW_LINE#@#  We also estimated mobility rates for Holocene farmers, temporally ranging from 10,0001,000 y ago, and found even higher values ( = 34.8; 95% CI: 33.935.3; P less_than 0.0001) than for both huntergatherer groups (see SI Appendix, Table S2 for full results).  #@NEW_LINE#@#  
Because Holocene western Eurasia is particularly well sampled for ancient genomic DNA, we performed a sliding window analysis to explore changes in mobility over the last 14,000 y in more detail (Fig 4), using 4,000 y-wide windows to ensure sufficient temporal signal within each window.  #@NEW_LINE#@#  We inferred a reduction in mobility rate between 14,000 and 9,000 y ago, before the start of the Neolithic transition (Fig 4A).  #@NEW_LINE#@#  However, throughout most of this period, the P values are not significant (Fig 4B).  #@NEW_LINE#@#  Because of the small sample size in the windows covering this time period (Fig 4C), there is no significant correlation between genetic and temporal distances, and as a result, we do not observe any EC and so lack power to estimate mobility (see Materials and Methods and SI Appendix, Fig S3).  #@NEW_LINE#@#  We consequently treat the inferred decline in mobility in this time range with caution.  #@NEW_LINE#@#  Second, we infer a substantial increase in mobility centered on the beginning of the Neolithic, with a peak centered around 7,500 y ago (Fig 4A).  #@NEW_LINE#@#  Notably, the inferred mobility rate does not remain at this level throughout the Holocene.  #@NEW_LINE#@#  Instead, we infer a Late Neolithic drop in mobility before a second increase centered on the beginning of the Bronze Age, around 5,000 y ago, then a decline in the Late Bronze Age and Early Iron Age, before a final increase centered on the Late Iron Age (Fig 4A and SI Appendix, Table S3 for full results for each window).  #@NEW_LINE#@#  
To validate the efficacy of our method to identify changes in migration rate on the time scales found in the empirical dataset (Fig 4), we modified our simulations to represent a population experiencing two changes in migration rate, resulting in three episodes of constant migration rate.  #@NEW_LINE#@#  We observe a good correspondence between changes in Smax and the simulated migration rate (SI Appendix, Fig S4), supporting our interpretation of the empirical results in Fig 4.  #@NEW_LINE#@#  
Finally, we compare the performance of the Smax statistic to a simple IBD through time approach, where (the slope of) the linear relation between the genetic distances and geographic distances is used as an indicator of the level of past migratory activity: High levels of migration correspond to shallow IBD patterns.  #@NEW_LINE#@#  We observe a trend of decreasing spatial structure, consistent with the cumulative effects of a series of high migratory activity episodes over this period.  #@NEW_LINE#@#  However, this approach fails to recover the timing of those changes in migratory activity in specific periods (SI Appendix, Fig S5).  #@NEW_LINE#@#  Our method overcomes this lack of power to identify changes in migratory activity by explicitly considering the temporal dimension of the data.  #@NEW_LINE#@#  

Discussion  #@NEW_LINE#@#  
Through spatiotemporally explicit simulations, we have shown that the Smax statistic can be used as a reliable proxy for the underlying relative mobility of individuals within a given time period and geographic region.  #@NEW_LINE#@#  Because our statistic is based on correlations, it is well suited for analyzing data from archeological and paleontological contexts, where preservation can vary significantly across different geographical areas and temporal ranges, and samples are commonly sparsely distributed across space and time.  #@NEW_LINE#@#  Nevertheless, in the extreme case of just a small number of sites from different geographic locations or temporal periods, spurious estimates of migratory activity may arise.  #@NEW_LINE#@#  The permutation procedure introduced in this study can be used to identify when the Smax estimator is uninformative.  #@NEW_LINE#@#  We choose only to consider relative changes in the value of the Smax estimator and do not attempt to interpret its values in absolute terms.  #@NEW_LINE#@#  This is because, while our intuition is that mutation rate and population size will not affect the relationship between absolute values of the Smax estimator and the true mobility rate, we admit the possibility that other factors may.  #@NEW_LINE#@#  Selection in response to ecological and environmental factors could also reduce the utility of the Smax statistic as a proxy for mobility because local selection can create confounding spatial or temporal population structures.  #@NEW_LINE#@#  However, this is a common problem for any analysis assuming neutral evolution and can be dealt with by focusing on putatively neutrally varying traits or loci.  #@NEW_LINE#@#  
The Smax statistic offers a robust alternative to existing methods for the quantification of IBD patterns in temporally heterogeneous datasets.  #@NEW_LINE#@#  In population genetics, correlations between trait differences and geographic distances are commonly used to infer past population structure and connectivity between populations (27).  #@NEW_LINE#@#  In such approaches, temporal structures in data are usually either ignored or mathematically controlled for by using partial least squares (e.g., ref.  #@NEW_LINE#@#  28), but both of these practices have been criticized (2931), and we show that while such approaches can inform the cumulative effects of migration in terms of structure reduction, they are unable to recover temporal changes in migratory activity.  #@NEW_LINE#@#  Partial least squares analysis assumes that the effect of time on genetic differences can be decoupled from the effect of space, which is generally not the case.  #@NEW_LINE#@#  We avoid this problem by integrating space and time into a single distance measure.  #@NEW_LINE#@#  Finally, because the statistic contains information about both spatial and temporal structuring of the populations, it can be used as a potentially informative summary statistic in quantitative model-fitting frameworks such as Approximate Bayesian Computation (32).  #@NEW_LINE#@#  
Using the Smax statistic on ancient genomic data, we identified a sequence of changes in human mobility from the late Pleistocene to the Iron Age in western Eurasia.  #@NEW_LINE#@#  We find some support for reduced mobility in west Eurasian post-LGM huntergatherers compared with pre-LGM populations.  #@NEW_LINE#@#  The reasons for this result are, as yet, unclear, although possible explanations include reduced resource availability in pre-LGM Western Eurasia, requiring larger foraging ranges compared with post-LGM conditions (33, 34) and/or residual post-LGM population structure following recolonization of northern latitudes from LGM southern refugia (35).  #@NEW_LINE#@#  Using a sliding window analysis, we find some suggestion of a decline in post-LGM huntergatherer mobility leading up to the Neolithic transition.  #@NEW_LINE#@#  However, we caution against overinterpretation of this result as the estimated P values for the Smax statistic under the null hypothesis of no EC are mostly not significant.  #@NEW_LINE#@#  We find strong support for a rise in mobility during the Neolithic transition in western Eurasia, likely corresponding to a well-established demic expansion of farmers, originating in the Middle East and resulting in the spread of farming technologies throughout most of Western Eurasia (3638).  #@NEW_LINE#@#  This is followed by an inferred mobility decline toward the end of the Neolithic, possibly related to the terminal phase of the spread of farming across most of Western Eurasia, and increased sedentism (39, 40).  #@NEW_LINE#@#  We also find strong support for a rise in mobility centered on the onset of the Bronze Age.  #@NEW_LINE#@#  From previous ancient DNA studies, this period has been associated with large-scale migration of Eurasian steppe populations, particularly those related to the Yamnaya culture, into Central and Northern Europe (22, 23).  #@NEW_LINE#@#  However, the emergence of the first civilizations and the concomitant establishment of far-reaching trade networks, as well as technological innovations such as horse-based transport (41), could also contribute to this increase in mobility (42).  #@NEW_LINE#@#  Finally, our sliding window analysis indicates a mobility reduction centered on the Late Bronze Age and Early Iron Age, starting around 3,000 y ago, before a final increase centered on the Late Iron Age in Western Eurasia (Fig 4A).  #@NEW_LINE#@#  One possible explanation for this pattern is a significant increase in trade and warfare during that period (4345).  #@NEW_LINE#@#  Overall, our analysis suggests a strong link between technological change and human mobility in Holocene Western Eurasia.  #@NEW_LINE#@#  However, it should be noted that we have used wide windows (4,000 y), which necessarily reduces chronological resolution.  #@NEW_LINE#@#  
A major strength of our method is its applicability to any set of neutrally evolving heritable traits where differences between individuals can be quantified and increase monotonically with geographic distance and temporal difference.  #@NEW_LINE#@#  This means that, in principle, the Smax statistics could allow the quantification of migratory activity in temporal and environmental contexts where obtaining ancient genetic data is not feasible, by using phenotypic data such as variation in cranial morphology, which has been shown to fit the pattern of neutral evolution and closely follow the patterns observed in analyses of neutral genetic data in humans (46, 47).  #@NEW_LINE#@#  Another exciting possibility is the quantification of movement based on cultural variation data, provided that appropriate near-neutral traits are used (e.g., refs.  #@NEW_LINE#@#  4850).  #@NEW_LINE#@#  While it should not be assumed that the movement of artifacts always coincides with that of people, contrasting measures of movement based on genetics and cultural artifacts obtained under the same conceptual framework would allow quantification of demic vs. cultural diffusion processes.  #@NEW_LINE#@#  This might permit identification periods and regions where genetic, phenotypic, and cultural processes are coupled, or decoupled.  #@NEW_LINE#@#  Given its robustness and flexibility, we anticipate that the Smax estimator will be applicable to a wide range of genetic, phenotypic, and cultural traits, allowing the quantification of mobility in a wide variety of scenarios in which this type of analysis has previously been challenging.  #@NEW_LINE#@#  

Materials_and_Methods  #@NEW_LINE#@#  
The proposed migration rate estimator, Smax, is the value of a scaling factor combining spatial and temporal distance matrices into a single distance matrix that maximizes its correlation with a matrix of trait distances.  #@NEW_LINE#@#  To estimate that value, the geographical, temporal, and trait distance matrices are calculated as described below.  #@NEW_LINE#@#  
Geographic__Temporal__and_Trait_Distances  #@NEW_LINE#@#  
The geographic distance between all sample pairs was calculated in kilometers using the Haversine Eq.  #@NEW_LINE#@#  (51) to account for the curvature of the Earth as follows:Gij=2rarcsin(sin((ji)/2)2+cos(i)cos(j)sin((ij)/2)2),[1]where G is the distance in kilometers between individuals i and j; i and j are the latitude coordinates of individuals i and j, respectively; i and j are the longitude coordinates of individuals i and j, respectively; and r is the radius of the earth in kilometers.  #@NEW_LINE#@#  
Temporal distances between samples were calculated as time in years between sample pairs.  #@NEW_LINE#@#  Previously reported date ranges based on stratigraphy or direct radiocarbon dating were used for all individuals (SI Appendix, Table S1).  #@NEW_LINE#@#  In all analyses, sample dates were randomly drawn from a uniform distribution corresponding to the upper and lower bounds of a time period for a given specimen.  #@NEW_LINE#@#  
Genetic distances were calculated as pairwise proportion of alleles that are not identical by state (pairwise heterozygosity), using the function ibs.dist from the Bioconductor package SNPstats v.1.18.0 (52) in the R statistical analysis environment v3.2.2 (53).  #@NEW_LINE#@#  

The_Smax_Estimator  #@NEW_LINE#@#  
To consider the full range of scaling factors on a finite interval, we choose to represent S as the tangent of an angle  between 0° and 90°, where  = 0 corresponds to S = 0 (geographic variation alone explains the observed trait distances between entities) and  = /2 corresponds to S =  (temporal variation alone explains the observed trait distances between entities).  #@NEW_LINE#@#  Formally, the timespace product matrix (D) was calculated as follows:Dij=Gij2+(STij)2,[2]where i and j are the specimens considered, D is the timespace product matrix, G is the geographical distance matrix, T the temporal distance matrix (given by the difference in age of the samples), and S is the scaling factor [S = tan()].  #@NEW_LINE#@#  
To find the scaling factor, Smax, that maximizes the correlation between the trait distance matrix and D, the timespace product matrix, we calculated the Pearson correlation coefficient between these matrices for 200 (500 for the simulated data) scaling factor values (Fig 1).  #@NEW_LINE#@#  The scaling factor value in the timespace product matrix that produced the strongest correlation with the trait distance matrix is recorded as Smax, the mobility estimator.  #@NEW_LINE#@#  

Simulation_Tests  #@NEW_LINE#@#  
The reliability and the robustness of the Smax statistic in recovering information about past mobility was explored using a spatiotemporally explicit simulation model.  #@NEW_LINE#@#  The simulation world consists of a grid of 8,000 by 8,000 demes.  #@NEW_LINE#@#  Each simulation starts with one entity placed in a randomly chosen deme and lasts 20,000 generations.  #@NEW_LINE#@#  The model simulated exponential population growth to a carrying capacity of 10,000 entities, followed by a stochastic birthdeath process (54) mobility, and trait mutation.  #@NEW_LINE#@#  We generated spatiotemporal trait variation data under different mobility parameter values using the same Smax estimation protocols as described above for each dataset.  #@NEW_LINE#@#  A total of 10,000 independent replicates of the simulations and analyses were generated, and the utility of the Smax statistic in recovering information about mobility was assessed by correlation.  #@NEW_LINE#@#  
The migratory process was modeled as Gaussian random walks: In each generation, each entity moves independently in the x and y directions by distances picked randomly from a normal distribution with mean = 0 and SD = mig.  #@NEW_LINE#@#  This corresponds to the average distance moved in a single step (dmig) of /2 mig = 1.2533 mig.  #@NEW_LINE#@#  Thus, dmig is the parameter of interest.  #@NEW_LINE#@#  We choose 1,000 random values of dmig from a uniform distribution with a range of 1100.  #@NEW_LINE#@#  We modeled drift as a Moran-type birthdeath process (54).  #@NEW_LINE#@#  At each generation, each entity undergoes binary fission with probability P = 0.1, creating a duplicate of itself at the same location.  #@NEW_LINE#@#  The two entities subsequently move and evolve independent of each other.  #@NEW_LINE#@#  When the number of entities reaches or exceeds the carrying capacity (10,000), excess entities are deleted at random among all entities present in that generation.  #@NEW_LINE#@#  Mutation was modeled as a one-dimensional Gaussian random walk for each trait (Ntraits = 50).  #@NEW_LINE#@#  Each trait was assigned an initial value of 1,000, and new (mutated) values were picked from a random normal distribution with mean equal to the current value and SD fixed at 0.05.  #@NEW_LINE#@#  
Following a burn-in period of 10,000 generations, entities were sampled from simulations with a probability of 0.00001 at each generation.  #@NEW_LINE#@#  The x and y coordinates, time of sampling in generations, and the values for the 50 traits were recorded for all sampled entities.  #@NEW_LINE#@#  
Pairwise trait distances between all sampled entities in each of the simulated datasets were calculated using the Euclidean distance formula as follows:Mij=k=1n(dikdjk)2,[3]  #@NEW_LINE#@#  
where Mij is the distance between the two entities i and j; dik and djk are the values of the trait k for individuals i and j respectively; and n is the number of recorded traits.  #@NEW_LINE#@#  
Out of 10,000 simulations, 9,866 (98.66%) resulted in an EC greater than zero.  #@NEW_LINE#@#  To match the simulated data with the empirical data, we filtered the simulated data based on the measured EC values and removed all simulations that produced an EC value smaller than 0.001.  #@NEW_LINE#@#  This resulted in 9,155 simulations being used in the correlation analysis.  #@NEW_LINE#@#  
To assess the reliability of the Smax statistic in recovering information about mobility, R2 values were calculated for the correlation between the simulated dmig values and their corresponding Smax values.  #@NEW_LINE#@#  

Human_Mobility_in_Late_Pleistocene_and_Holocene  #@NEW_LINE#@#  
We considered genome-wide data comprising 354,199 SNPs typed in 329 West Eurasian (i.e., west of the Ural mountains) individuals (SI Appendix, Fig S2) temporally ranging from 39,0001,000 y before present (see SI Appendix, Fig S1).  #@NEW_LINE#@#  We merged the overlapping SNPs typed in archaeological samples published in refs.  #@NEW_LINE#@#  2226 and 5561 (see SI Appendix, Table S1 for list of samples and references) that met the geographic and temporal criteria described above.  #@NEW_LINE#@#  No additional bioinformatic processing of the data were carried out for this study.  #@NEW_LINE#@#  
The 329 individuals were assigned to one of following three groups based on their estimated age and subsistence strategy based on their archaeological context: pre-LGM huntergatherers n = 19 (temporally ranging from 39,000 y B.P.  #@NEW_LINE#@#  to 26,000 y B.P.  #@NEW_LINE#@#  ), post-LGM huntergatherers n = 47 (temporally ranging from 19,000 y B.P.  #@NEW_LINE#@#  to 5,000 y B.P.  #@NEW_LINE#@#  ), and Holocene farmers n = 263 (temporally ranging from 10,000 y B.P.  #@NEW_LINE#@#  to 500 y B.P.  #@NEW_LINE#@#  ).  #@NEW_LINE#@#  
Sliding window analysis was performed on all individuals in the dataset postdating 16,000 y B.P.  #@NEW_LINE#@#  The Smax statistic was estimated for 121 overlapping 4,000-y windows, each differing by 100 y.  #@NEW_LINE#@#  
To take age uncertainty into account, we report the mean scaling factor angle from 10,000 replicates with sample dates randomly resampled from their age ranges.  #@NEW_LINE#@#  We estimated 95% confidence intervals through a jackknifing procedure in which a randomly chosen sample in each window was removed from analysis, and the 0.025 and 0.095 quantiles were calculated from the resulting distribution.  #@NEW_LINE#@#  
To estimate the IBD signal through time, we fitted a linear model of genetic distances as a function of geographic distances in each time window (with sample jackknifing and age resampling as before, using the lm function from the R package base version 3.2.2) (53) and reported the slope of the line.  #@NEW_LINE#@#  

Confidence_Intervals_and_Robustness_of_Smax_Estimator  #@NEW_LINE#@#  
We tested the assumption that there is an IBD pattern by correlating the genetic (trait) distance matrices in all time bins and in all windows with the respective geographic distance matrices and the date-resampled temporal distance matrices and calculated the P values for these correlations.  #@NEW_LINE#@#  We find a positive and statistically significant IBD pattern in space in all windows (SI Appendix, Fig S3 A and B, respectively and SI Appendix, Fig S6).  #@NEW_LINE#@#  The isolation by temporal distance pattern is positive and significant for most windows, but some windows show negative correlations or are not significant.  #@NEW_LINE#@#  We find that these windows correspond to time periods where we observe low EC (SI Appendix, Fig S3C) and also low P values for the EC (Fig 4B).  #@NEW_LINE#@#  
To account for the uncertainty in sample ages, we calculated the scaling factor angle 10,000 times using dates resampled at random from a uniform distribution for each sample, as described above, and report the average of the scaling factor angle of the given distribution as a point estimate.  #@NEW_LINE#@#  
We also performed a leave-one-out analysis (10,000 replicates, combined with sample date resampling) to explore the combined effect of sampling and dating uncertainty and constructed approximate equal-tailed 95% confidence intervals for all groups and windows.  #@NEW_LINE#@#  
To assess the statistical significance of Smax estimates, we consider the ECdefined as the Pearson correlation coefficient between the trait difference matrix and the timespace product matrix when S = Smax, minus the Pearson correlation coefficient between the trait difference matrix and either the temporal or geographical distance matrix alone, whichever is higher.  #@NEW_LINE#@#  
To obtain a null-distribution of EC, we permuted trait data for individuals among the spatiotemporal sample locations 10,000 times and calculated EC for each permutation, as described above.  #@NEW_LINE#@#  Finally, we calculate the proportion of EC values from the permuted datasets that are equally high or higher than that obtained from the observed data.  #@NEW_LINE#@#  This permutation test permits assessment of how frequently the EC for the observed data are produced by chance alone or, alternatively, as the result of the method used for estimating the Smax statistic.  #@NEW_LINE#@#  The resultant P value is the probability of observing an equally high or higher EC value in permuted, supposedly signal-less data, and provides an indication of the information content of each dataset.  #@NEW_LINE#@#  

Simulated_Scenario_of_Changing_Migration_Rate  #@NEW_LINE#@#  
We modified our simulations to represent a population experiencing two changes in migration rate, resulting in three episodes of constant migration rate.  #@NEW_LINE#@#  We assumed a generation time of 25 y and chose the effective population size to be 2Ne = 10,000, standard figures in population genetic models of European populations (62).  #@NEW_LINE#@#  We next chose three levels of migration with relative magnitude on par with what was inferred from the empirical data: m1 = 0.0002, m2 = 0.01, and m3 = 0.05.  #@NEW_LINE#@#  To ensure equilibrium conditions during the start of the sampling period, we discarded the first 10,000 steps of the simulation (using migration rate m1).  #@NEW_LINE#@#  We then simulated a time period of 20,000 y, divided into three episodes with constant migration rate: m1 for 25,00015,000 y ago, m2 for 15,00010,000 y ago, and m3 for the last 5,000 y of the simulation.  #@NEW_LINE#@#  This roughly corresponds to the time spans associated with Mesolithic huntergatherers, Neolithic farmers, and post-Neolithic cultures in our empirical dataset.  #@NEW_LINE#@#  From a population genetic point of view, whole genome data as used in the empirical estimates correspond to a large number of approximately independent replicates.  #@NEW_LINE#@#  Because our model does not include recombination, we accounted for this effect by increasing the sample size to 10,000 individuals.  #@NEW_LINE#@#  SI Appendix, Fig S4 shows the migration rate estimation using the Smax statistic using a 4,000 y-wide sliding window.  #@NEW_LINE#@#  
R version 3.2.2 (53) was used for analyses throughout this manuscript.  #@NEW_LINE#@#  The correlations between temporal, geographic, and trait distance matrices were calculated using the mantel (method = pearson) function in R package Vegan version 2.3.0 (63).  #@NEW_LINE#@#  The permutation and bootstrap tests were performed using the function sample in the R package base version 3.2.2 (53).  #@NEW_LINE#@#  


Acknowledgments  #@NEW_LINE#@#  
We are very grateful to Robert Foley for valuable discussions during the formulation of the approach, to Mike Parker-Pearson for advice on Holocene migration processes, and to Tamsin OConnell for advice on stable isotopes.  #@NEW_LINE#@#  L.L.  #@NEW_LINE#@#  was supported by Natural Environment Research Council, UK Grants NE/K005243/1 and NE/K003259/1 and European Research Council Grant 339941-ADAPT.  #@NEW_LINE#@#  M.G.T.  #@NEW_LINE#@#  was supported by Wellcome Trust Senior Investigator Award Grant 100719/Z/12/Z and Leverhulme Trust Grant RP2011-R-045.  #@NEW_LINE#@#  A.M. and A.E.  #@NEW_LINE#@#  were supported by European Research Council Consolidator Grant 647787-LocalAdaptation.  #@NEW_LINE#@#  M.M.L.  #@NEW_LINE#@#  was supported by European Research Council Advanced Grant 295907, In-Africa.  #@NEW_LINE#@#  M.K.  #@NEW_LINE#@#  was funded by the Engineering and Physical Sciences Research Council through the Centre for Mathematics and Physics in the Life Sciences and Experimental Biology.  #@NEW_LINE#@#  

Footnotes  #@NEW_LINE#@#  

This is an open access article distributed under the PNAS license.  #@NEW_LINE#@#  

