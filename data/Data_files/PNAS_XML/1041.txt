article id="http://dx.doi.org/10.1073/pnas.1718449115"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Global spectral clustering in dynamic networks  #@NEW_LINE#@#  

Significance  #@NEW_LINE#@#  
Statistical theory has mostly focused on static networks observed as a single snapshot in time.  #@NEW_LINE#@#  In reality, networks are generally dynamic, and it is of substantial interest to discover the clusters within each network to visualize and model their connectivities.  #@NEW_LINE#@#  We propose the persistent communities by eigenvector smoothing algorithm for detecting time-varying community structure and apply it to a recent dataset in which gene expression is measured during a broad range of developmental periods in rhesus monkey brains.  #@NEW_LINE#@#  The analysis suggests the existence of change points as well as periods of persistent community structure; these are not well estimated by standard methods due to the small sample size of any one developmental period or region of the brain.  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
Community detection is challenging when the network structure is estimated with uncertainty.  #@NEW_LINE#@#  Dynamic networks present additional challenges but also add information across time periods.  #@NEW_LINE#@#  We propose a global community detection method, persistent communities by eigenvector smoothing (PisCES), that combines information across a series of networks, longitudinally, to strengthen the inference for each period.  #@NEW_LINE#@#  Our method is derived from evolutionary spectral clustering and degree correction methods.  #@NEW_LINE#@#  Data-driven solutions to the problem of tuning parameter selection are provided.  #@NEW_LINE#@#  In simulations we find that PisCES performs better than competing methods designed for a low signal-to-noise ratio.  #@NEW_LINE#@#  Recently obtained gene expression data from rhesus monkey brains provide samples from finely partitioned brain regions over a broad time span including pre- and postnatal periods.  #@NEW_LINE#@#  Of interest is how gene communities develop over space and time; however, once the data are divided into homogeneous spatial and temporal periods, sample sizes are very small, making inference quite challenging.  #@NEW_LINE#@#  Applying PisCES to medial prefrontal cortex in monkey rhesus brains from near conception to adulthood reveals dense communities that persist, merge, and diverge over time and others that are loosely organized and short lived, illustrating how dynamic community detection can yield interesting insights into processes such as brain development.  #@NEW_LINE#@#  

Methods  #@NEW_LINE#@#  
Spectral_Methods_for_Static_Networks  #@NEW_LINE#@#  
Spectral clustering is a popular class of methods for finding communities in a static network, and many variations have been discussed in the literature (1922).  #@NEW_LINE#@#  A prototypical method is given by ref.  #@NEW_LINE#@#  6.  #@NEW_LINE#@#  Given a symmetric n×n adjacency matrix A and a fixed number of communities K, the method computes the degree-normalized (or Laplacianized) adjacency matrix L, which is given byL=D1/2AD1/2whereD=diag(degree).  #@NEW_LINE#@#  [1]The method then returns the clusters found by K-means clustering on the eigenvectors of L corresponding to its K largest eigenvalues in absolute value.  #@NEW_LINE#@#  Methods for choosing K include refs.  #@NEW_LINE#@#  2326.  #@NEW_LINE#@#  

Eigenvector_Smoothing_for_Dynamic_Networks  #@NEW_LINE#@#  
Let A1,,AT denote a time series of symmetric adjacency matrices, and for t=1,,T, let Lt denote the Laplacianized version of At, as given by Eq.  #@NEW_LINE#@#  1.  #@NEW_LINE#@#  Let K be fixed, and let Vtn×K denote the matrix whose columns are the K leading eigenvectors of Lt. Let Ut=VtVtT, the projection matrix onto the column space of Vt.  #@NEW_LINE#@#  
In static spectral clustering, one would apply K-means clustering to V1,,VT separately.  #@NEW_LINE#@#  To share signal strength over time, a simplified form of PisCES would solve the following optimization problem, which returns a sequence of matrices U¯1,,U¯T that are smoothed versions of U1,,UT,minU¯1,,U¯Tt=1TUtU¯tF2+t=1T1U¯tU¯t+1F2subject toU¯t{VVT:Vn×K,VTV=I}t,[2]and then apply K-means clustering to the eigenvectors of each smoothed matrix U¯1,,U¯T separately.  #@NEW_LINE#@#  
The optimization problem Eq.  #@NEW_LINE#@#  2 is nonconvex and, to the best of our knowledge, no efficient methods for its global solution currently exist.  #@NEW_LINE#@#  We propose the following iteration,U¯1+1=K(U1+U¯2)[3]U¯t+1=K(U¯t1+Ut+U¯t+1),t=2,,T1[4]U¯T+1=K(U¯T1+UT),[5]where the mapping K extracts the K leading eigenvectors and is given for a matrix M byK(M)=k=1KvkvkT,where v1,,vK are the K leading eigenvectors of M. To initialize, we set U¯t0=Ut for t=1,,T.  #@NEW_LINE#@#  

PisCES  #@NEW_LINE#@#  
PisCES extends Laplacian smoothing by allowing the number of classes K to be unknown and possibly varying over time.  #@NEW_LINE#@#  
This is accomplished by replacing the operator K in Eqs.  #@NEW_LINE#@#  79 with a new operator , which requires a model order selection method  to choose the number of eigenvectors from the data:(M)=k=1(M)vkvkT.Here :n×n is a function that determines the number of eigenvectors to be returned, and v1,,v(M) are the eigenvectors of M corresponding to its (M) largest eigenvalues in absolute value.  #@NEW_LINE#@#  
To choose the model order (M), in principle one could use or adapt existing methods for eigenvector selection, such as refs.  #@NEW_LINE#@#  2326.  #@NEW_LINE#@#  Alternatively, in Model Order Selection  we describe a new method that can be adapted to the specific assumptions of the data-generating process.  #@NEW_LINE#@#  
The iterates for PisCES (that is, Eqs.  #@NEW_LINE#@#  79 with K replaced by ) are heuristic in that no convergence theorems are known.  #@NEW_LINE#@#  However, simulations suggest that they can help when K cannot be accurately estimated from any single network At due to noise.  #@NEW_LINE#@#  
To estimate the clusters, K means is applied to the eigenvectors of U¯1,,U¯T.  #@NEW_LINE#@#  

Model_Order_Selection_  #@NEW_LINE#@#  
Given a Laplacianized matrix Ln×n with eigenvalues |1||n|, (L) is given by(L)=min{K:|i||i+1|less_than,for alliK},[11]where  is the threshold for the noise eigenvalues of a null model for the data-generating process.  #@NEW_LINE#@#  
In generic network settings, a suitable null model could be to simulate Laplacianized ErdosRenyi adjacency matrices L(ER) with size and density matching L and eigenvalues |1(ER)||n(ER)| and to return the 0.95 quantile of the largest eigengap excluding 1(ER):=quantile0.95[max{|i(ER)||i+1(ER)|,i2}].  #@NEW_LINE#@#  [12]This approach may be appropriate when the observation noise is assumed to be independent across dyads (such as a stochastic block model)e.g., when the dyads are the observations.  #@NEW_LINE#@#  
A null model assuming dyadically independent observation noise may not be appropriate when networks A1,,AT are transformations of empirical correlation matrices, as in Results.  #@NEW_LINE#@#  Instead, a more appropriate choice may be to generate random samples that are matched in number to the observations that are used to form the correlation matrices underlying A1,,AT.  #@NEW_LINE#@#  Further details on such null models can be found in SI Appendix, section S5 and Figs.  #@NEW_LINE#@#  S1S3.  #@NEW_LINE#@#  


Simulations  #@NEW_LINE#@#  
Simulations suggest that PisCES works well in practice.  #@NEW_LINE#@#  Here we show three examples of simulation performance; more results can be found in SI Appendix, section S6 and Figs.  #@NEW_LINE#@#  S4S7.  #@NEW_LINE#@#  
Figs.  #@NEW_LINE#@#  1 and 2 show simulations where A1,,AT are symmetric adjacency matrices each generated by a dynamic degree-corrected block model (DCBM) (8), where[At]ijBernoulli(titjBzti,ztj(t))i,j[n],ji,[13]with [At]ij=[At]ji.  #@NEW_LINE#@#  Here zt[K]n and tn are vectors of class labels and degree parameters, and B(t)[0,1]K×K is a connectivity matrix.  #@NEW_LINE#@#  zt evolves over time byz(t+1)i={ztiwith prob.1rMultinomial(1K,,1K)otherwise,[14]where r denotes the probability that a node changes clusters, and (t) and B(t) are randomized at each stage byt=1/2+t/n[15]Blk(t)={Unif(pin(1),pin(2))l=kpoutlk,[16]where t is a random permutation of 1:n, and pin=(pin(1),pin(2)) and pout are in-cluster and between-cluster density parameters.  #@NEW_LINE#@#  
For comparison, we evaluate a variationalexpectation-maximization (VEM) likelihood method for the dynamic DCBM (8) and a spectral method [PCM (preserving cluster membership)] (17); as a baseline we contrast these with static spectral clustering (static).  #@NEW_LINE#@#  (Due to its computational complexity, results for VEM are shown for n = 100 only, as its runtimes were impractical for n500.)  #@NEW_LINE#@#  
Fig 1 shows improving performance for PisCES as the time horizon T increases (which allows greater sharing of information) and decreasing performance as the nodal classes evolve more rapidly over time.  #@NEW_LINE#@#  Fig 2 shows increasing performance for all methods as the network size n increases and decreasing performance as the number of nodal classes K increases.  #@NEW_LINE#@#  In all cases, PisCES performs comparably to or better than the other methods.  #@NEW_LINE#@#  
In Methods, we mention that PisCES suppresses the amount of smoothing at times where an outlier or a change point exists in the data.  #@NEW_LINE#@#  To demonstrate this, Fig 3 shows the results of a simulation with T=11 where the class labels evolve as a dynamic DCBM except at times t=6 and t=7, at which point they are randomized with no dependence on past time steps.  #@NEW_LINE#@#  Fig 3 shows that the estimated U¯t at t=6 closely resembles the output of static spectral clustering, while at the other time steps the output closely resembles that of PisCES applied to A1,,A5 and to A7,,A11.  #@NEW_LINE#@#  

Results  #@NEW_LINE#@#  
Background  #@NEW_LINE#@#  
The transcriptional patterns of the developing primate brain are of keen interest to neuroscientists and others interested in neurological and psychiatric disorders.  #@NEW_LINE#@#  Bakken et al.  #@NEW_LINE#@#  (18) provide a high-resolution transcriptional atlas of rhesus monkeys (Macaca mulatta) built from recorded samples of gene expression, including expression of 9,173 genes that can be mapped directly to humans.  #@NEW_LINE#@#  The samples span six prenatal ages from 40 embryonic days to 120 embryonic days (E40E120) and four postnatal ages from 0 mo to 48 mo after birth (0 M to 48 M; SI Appendix, section S7).  #@NEW_LINE#@#  These ages represent key stages of development in the prenatal phase and key milestones postnatally (newborn, juvenile, teen, and mature).  #@NEW_LINE#@#  The samples can also be divided into different regions of the brain and further into different layers (i.e., subregions) within each region.  #@NEW_LINE#@#  For example, in postnatal ages, the medial prefrontal cortex region (mPFC) can be divided into contiguous layers L6L2, with a more complex layer parcellation in prenatal ages (SI Appendix, Table S2).  #@NEW_LINE#@#  
The changes in gene expression over spatiotemporal periods have been fairly well studied, but changes in coexpression are less well understood.  #@NEW_LINE#@#  Bakken et al.  #@NEW_LINE#@#  (18) used weighted gene coexpression network analysis (WGCNA) (29) to identify gene communities in the cortex of rhesus monkeys at each age; roughly speaking, this corresponds to dividing the samples by age, constructing gene coexpression networks from each subset of samples, and then performing a clustering analysis on each network.  #@NEW_LINE#@#  Our goal is to take this investigation farther using PisCES, but in this present work we give exploratory results only to demonstrate proof of concept.  #@NEW_LINE#@#  
Due to its importance in understanding developmental brain disorders, we focus on the mPFC and use only the 423 samples corresponding to that region in our analysis (SI Appendix, Fig S8).  #@NEW_LINE#@#  For these samples, variability in the first two components of principal components analysis is explained roughly equally by their layer or by their age, suggesting that they may be grouped by either variable (Fig 4).  #@NEW_LINE#@#  To illustrate that PisCES can be used over time or location, we choose to divide the 209 prenatal samples by age category (E40E120) and divide the 214 postnatal samples by their layer within the mPFC region (L6L2).  #@NEW_LINE#@#  
For each group of samples, coexpression networks (gene networks in which edges encode coexpression level between gene pairs) are constructed by the procedure of refs.  #@NEW_LINE#@#  18 and 29.  #@NEW_LINE#@#  Specifically, adjacency matrix At for group t(E40E120, L6L2) is generated by soft thresholding the empirical correlation matrix[At]ij=|corr(gi,gj)|6,ij,[17]where gi and gj are the recorded expression levels for genes i and j in the samples belonging to group t.  #@NEW_LINE#@#  

PisCES_Results  #@NEW_LINE#@#  
PisCESusing Eq.  #@NEW_LINE#@#  S17 for is run separately on the pre- and postnatal samples.  #@NEW_LINE#@#  The detected communities vary in composition, size, and density (Dataset S1); see SI Appendix, Table S3 for descriptive summaries.  #@NEW_LINE#@#  For pre- and postnatal analyses we compare the performance of algorithms, using a measure of log-likelihood (SI Appendix, Fig S9).  #@NEW_LINE#@#  PisCES generally performs the best across ages and layers, suggesting that the dynamic progression is informative.  #@NEW_LINE#@#  
To assess the similarity of communities across periods we compute the adjusted Rand index (ARI) (27) between subsequent periods.  #@NEW_LINE#@#  We find that, for the most part, communities in adjacent ages or layers are more similar in composition than those in noncontiguous periods (SI Appendix, Table S4); for example, we find that communities in E120 are most similar to those in E90 (ARI = 0.23) and least similar to those in E40 (ARI = 0.05).  #@NEW_LINE#@#  
Many communities persist in pre- and postnatal samples as illustrated by the Sankey plots (Fig 5 and SI Appendix, Fig S10).  #@NEW_LINE#@#  To better understand the Sankey display, we focus on the transition from E40 to E50 and display thresholded weighted adjacency matrices along with the mapping between communities (Fig 6A).  #@NEW_LINE#@#  The ninth community (blue) appears to dominate Fig 5; however, closer inspection of Fig 6A suggests that this cluster may be dominated by genes that are connected with many genes outside of the cluster, indicating that this cluster is not likely to be interesting biologically.  #@NEW_LINE#@#  
To facilitate visual comparison of the adjacency matrices, only those nodes belonging to the major flows between E40 and E50 have been included in Fig 6B.  #@NEW_LINE#@#  Cluster boundaries are delineated in red (featured) or gray.  #@NEW_LINE#@#  The density of some clusters decreases markedly from E40 to E50 (clusters 23, 36, 910, 916), while others increase (clusters 57, 68, 69).  #@NEW_LINE#@#  Genes in dense clusters 7, 8, 10, 11, and 13 go to cluster 9 and lose their tight connectivity as they enter this catch-all cluster, suggesting that some genes act together, but only for brief periods.  #@NEW_LINE#@#  
For each community, we examine the composition of genes to interpret function using Enrichr (amp.pharm.mssm.edu/Enrichr/) for annotation.  #@NEW_LINE#@#  Communities are highlighted in red for which neural projection guidance (NPG) genes show significant enrichment (Fig 5 and SI Appendix, Fig S10).  #@NEW_LINE#@#  Given the hypothesis that strongly correlated genes share regulation and/or function (30), we examined the communities to determine whether any are enriched with the Simons Foundation Autism Research Initiative (SFARI) autism spectrum disorder (ASD) risk genes (classes 1, 2, 3, and S) (https://gene.sfari.org/autdb/GS_Home.do).  #@NEW_LINE#@#  Across prenatal communities we observe the strongest clustering of ASD genes in two communities, one at E80 and another at E120 (white dot in red).  #@NEW_LINE#@#  Both of these communities are enriched for NPG and synaptic transmission (ST) genes and fall in NPG- and ST-enriched paths (SI Appendix, Fig S11).  #@NEW_LINE#@#  NPG and ST genes have been strongly implicated with ASD (31, 32).  #@NEW_LINE#@#  
We further investigate the 263 NPG genes that persist in nominally significant enriched communities across at least three consecutive periods (NPG+) to identify the properties of the most highly persistent genes.  #@NEW_LINE#@#  These 64 NPG+ genes show a notable pattern of expression across ages and layers in contrast to the other NPG genes (NPG).  #@NEW_LINE#@#  The former set of genes expresses more highly in mPFC at all ages and layers, but especially during the period just before and at birth (SI Appendix, Fig S12) A thresholded-correlation network (Fig 7) shows how the NPG genes coexpress within three epochs of development: E70E90, E1200M, and 3M12M.  #@NEW_LINE#@#  Clearly the NPG+ genes are more tightly clustered at every epoch and there is a notable pattern to the development of clustered genes over time (SI Appendix, Fig S13).  #@NEW_LINE#@#  All of these results suggest that a subset of NPG genes plays a strong coordinated role in mid-to-late fetal development in the mPFC, up to and including the time of birth.  #@NEW_LINE#@#  
ST genes also show strong clustering and persistence in the prenatal analysis; however, unlike NPG genes, the tight clustering of ST genes is not apparent in the postnatal analysis of layers.  #@NEW_LINE#@#  And yet ST genes become most strongly expressed at birth and continue to be highly expressed throughout life in the mPFC (SI Appendix, Fig S14A).  #@NEW_LINE#@#  This seeming contradiction illustrates a limitation of correlation to accurately capture the relationships between genes under certain conditions.  #@NEW_LINE#@#  Examining the correlation pattern between two ST genes over two periods of time reveals the problem (SI Appendix, Fig S14B).  #@NEW_LINE#@#  At E120 the genes have considerable variability in expression and show a strong correlation, but at 0M both genes are expressing at their maximum level.  #@NEW_LINE#@#  When this happens, there is insufficient variability in expression to detect correlation between genes, and hence the correlation is near zero.  #@NEW_LINE#@#  This suggests that other measures of coexpression will be needed as we continue to investigate gene communities.  #@NEW_LINE#@#  


Discussion  #@NEW_LINE#@#  
Community detection, which involves identification of the number of clusters in a network and the membership of each node, is a challenging problem, especially in applications like gene coexpression when the information about the network is uncertain.  #@NEW_LINE#@#  This paper aims to improve community detection within networks by incorporating available information about the evolution of a network over time.  #@NEW_LINE#@#  PisCES works by smoothing the signal contained in a series of adjacency matrices, ordered by time or developmental unit, to permit analysis by spectral clustering methods designed for static networks.  #@NEW_LINE#@#  
Applying PisCES to the medial prefrontal cortex in rhesus monkey brains from near conception to adulthood reveals communities that persist over numerous developmental periods, communities that merge and diverge over time, and others that are loosely organized and ephemeral.  #@NEW_LINE#@#  PisCES provides a powerful tool to facilitate the discovery of such fine-scale dynamic structures in coexpression data.  #@NEW_LINE#@#  
Weighted adjacency matrices derived from gene-coexpression data over a number of time frames or developmental periods are ideal for PisCES.  #@NEW_LINE#@#  These estimates are usually derived from correlation matrices and are often based on a limited number of samples when the spatialtemporal partitions are extremely fine.  #@NEW_LINE#@#  But, in this situation, dynamic smoothing across partitions can increase the reliability of the resulting communities.  #@NEW_LINE#@#  
Estimates of community structure provided by PisCES for the rhesus monkeys have highlighted features that comport with known brain development, such as the coordinated expression of NPG and ST genes.  #@NEW_LINE#@#  This provides a proof of concept for the analysis paradigm.  #@NEW_LINE#@#  We posit that in-depth study of gene communities over spatial and temporal partitions of the brain will elucidate key developmental periods and communities associated with neurological disorders.  #@NEW_LINE#@#  

Acknowledgments  #@NEW_LINE#@#  
We thank Sivaraman Balakrishnan, Bernie Devlin, Maria Jalbrzikowski, and Lingxue Zhu for insightful comments.  #@NEW_LINE#@#  We also thank the reviewers whose comments led us to discover Theorems 1 and S3.1.  #@NEW_LINE#@#  This work was supported by National Institute of Mental Health Grants R37MH057881 and R01MH109900 and the Simons Foundation SFARI 124827.  #@NEW_LINE#@#  

Footnotes  #@NEW_LINE#@#  

Published under the PNAS license.  #@NEW_LINE#@#  

