article id="http://dx.doi.org/10.1073/pnas.1517109113"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Molecular circuits for dynamic noise filtering  #@NEW_LINE#@#  

Significance  #@NEW_LINE#@#  
Signaling modules in living cells function and respond in a surprisingly robust way, in spite of their very noisy environment.  #@NEW_LINE#@#  In contrast, this is not the case for most synthetic circuits in living cells, which are usually designed and tuned in silico under specific assumptions that do not hold in the real environment of the cell.  #@NEW_LINE#@#  To recover the robust behavior, synthetic circuits need a means to make inference about their dynamic environment, which in turn can be used to effectively counteract it.  #@NEW_LINE#@#  Here we show how such inference can be implemented as biochemical modules and illustrate how this can guide the design of adaptive synthetic circuits.  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
The invention of the Kalman filter is a crowning achievement of filtering theoryone that has revolutionized technology in countless ways.  #@NEW_LINE#@#  By dealing effectively with noise, the Kalman filter has enabled various applications in positioning, navigation, control, and telecommunications.  #@NEW_LINE#@#  In the emerging field of synthetic biology, noise and context dependency are among the key challenges facing the successful implementation of reliable, complex, and scalable synthetic circuits.  #@NEW_LINE#@#  Although substantial further advancement in the field may very well rely on effectively addressing these issues, a principled protocol to deal with noiseas provided by the Kalman filterremains completely missing.  #@NEW_LINE#@#  Here we develop an optimal filtering theory that is suitable for noisy biochemical networks.  #@NEW_LINE#@#  We show how the resulting filters can be implemented at the molecular level and provide various simulations related to estimation, system identification, and noise cancellation problems.  #@NEW_LINE#@#  We demonstrate our approach in vitro using DNA strand displacement cascades as well as in vivo using flow cytometry measurements of a light-inducible circuit in Escherichia coli.  #@NEW_LINE#@#  

Theoretical_Results  #@NEW_LINE#@#  
Biochemical_Signals_and_Sensors  #@NEW_LINE#@#  
Assume a synthetic circuit requires knowledge about the abundance of a biochemical signal Z(t) that it cannot access directly.  #@NEW_LINE#@#  For instance, Z(t) could be an environmental perturbation that the circuit has to adapt to or the internal state of another dynamical system that it aims to control.  #@NEW_LINE#@#  In the former case, Z(t) does not necessarily have a physical interpretation but rather serves as a phenomenological proxy that reflects the multitude of noise sources affecting a circuit.  #@NEW_LINE#@#  The synthesis rate of a protein, for instance, depends on various factors (e.g., gene dosage and ribosomal abundance) but itself may be described reasonably well by a one-dimensional quantity that fluctuates over time (22).  #@NEW_LINE#@#  For the sake of illustration, we assume Z(t) is a one-dimensional birthdeath model with parameters  and  (Fig 1A); we will be concerned with more general scenarios later in this manuscript.  #@NEW_LINE#@#  
Although Z(t) is assumed to be hidden to the circuit of interest, that circuit might have access to indirect readouts of Z(t).  #@NEW_LINE#@#  For instance, it might be able to recognize specific mRNAs which give an indication about the activity of a gene Z(t) that cannot be sensed directly by the circuit.  #@NEW_LINE#@#  In the simplest case, this indirect readout (in the following termed sensor) could relate to Z(t) through a single catalytic reaction, modeled by the stochastic birth processZcYZ+,with cY as a rate constant determining the speed of this reaction.  #@NEW_LINE#@#  Note that the symbol  serves as a wildcard that will be concretized later when the sensor is interfaced with the filter circuit.  #@NEW_LINE#@#  
Implicitly, the sensor reaction carries information about the unknown Z(t): if one observes many firings in a short amount of time, one can conclude that Z(t) was probably large, and vice versa.  #@NEW_LINE#@#  Mathematically, the number of reactions that fired in the time interval [0,t] is a random variable that can be described as a time-varying Poisson process Y(t) with rate cYZ(t).  #@NEW_LINE#@#  The differential version of this process can be viewed as a random pulse train dY(t) that has value one only at the sensor firing times and zero otherwise (Fig 1B).  #@NEW_LINE#@#  A complete sensor trajectory consists of the random reaction times Yt=(1,2,,Y(t)), as opposed to most usual readouts that reveal abundances (corrupted by additive noise, for instance).  #@NEW_LINE#@#  Note that the informativeness of the sensor increases with cY, and from this perspective, large cY are superior to small cY.  #@NEW_LINE#@#  At the same time, however, one tries to keep the energy cost at a minimum to prevent interferences with the host cell.  #@NEW_LINE#@#  The resulting tradeoff highlights the need for optimal estimators that can extract as much information as possible from the sensor, especially when cY is small.  #@NEW_LINE#@#  

Optimal_Signal_Estimation  #@NEW_LINE#@#  
The theory of optimal filtering (23) provides a mathematical framework for estimating dynamic signals Z(t) from measurements Yt.  #@NEW_LINE#@#  More specifically, it is centered around finding the conditional (i.e., filtering) distribution P(Z(t)=z|Yt).  #@NEW_LINE#@#  In this context, we denote as filter an estimator of Z(t) that is based on statistics of that distribution, such as its mean or variance.  #@NEW_LINE#@#  It can be shown that estimators of the form M(t)=E[Z(t)|Yt] minimize the mean squared error MSEZ(t)=E[(Z(t)M(t))2] and are therefore termed minimum mean squared error (MMSE) estimators (14).  #@NEW_LINE#@#  In the special case of linear dynamics and Gaussian noise, the MMSE estimator is analytically tractable through the Kalman filter.  #@NEW_LINE#@#  The KushnerStratonovich differential equation describes filters also for the more general case of nonlinear and non-Gaussian models, although their practical handling is typically challenging if not impossible.  #@NEW_LINE#@#  The MMSE estimator for the given birthdeath process from Fig 1A can be shown to satisfydM(t)=[M(t)]dt+V(t)M(t)[dY(t)cYM(t)dt],[1]with V(t)=Var[Z(t)|Yt] as the estimator variance (SI Appendix, section S.1).  #@NEW_LINE#@#  Note that Eq.  #@NEW_LINE#@#  1 can be informally rewritten as an ordinary differential equation driven by a sum of Dirac pulses k(tk), with summand k stemming from the kth reaction firing of the sensor.  #@NEW_LINE#@#  Between two consecutive firing times k and k+1, the estimator signal M(t) evolves deterministically.  #@NEW_LINE#@#  Every time a sensor reaction fires, M(t) instantaneously changes by the factor V(t)/M(t).  #@NEW_LINE#@#  This factor can be understood as an adaptation gain that determines how much weight is put on the correction term [dY(t)cYM(t)dt]: if the filter is very certain [i.e., variance V(t) small], only little correction is needed, and vice versa.  #@NEW_LINE#@#  Unfortunately, the adaptation gain is analytically intractable because V(t) generally involves the third-order moment and so forth, leading to an infinite-dimensional system of differential equations (i.e., moment closure problem).  #@NEW_LINE#@#  
However, two tractable filters can be derived under the assumption of either weakly or highly informative measurements.  #@NEW_LINE#@#  We refer to the first one as the Poisson filter, and it is based on the assumption that cY is small, for instance, when available resources are scarce.  #@NEW_LINE#@#  Because this assumption implies that V(t)=M(t) (SI Appendix, section S.1.3), the filter reduces to a single differential equationdM(t)=[(+cY)M(t)]dt+dY(t).  #@NEW_LINE#@#  [2]The second filter, called the gamma filter, is based on the fact that for large cYZ(t), the filtering distribution is approximately gamma (24) (SI Appendix, section S.1.4).  #@NEW_LINE#@#  This filter requires a second differential equation corresponding to V(t) (SI Appendix, Eq.  #@NEW_LINE#@#  20).  #@NEW_LINE#@#  
Taking a systems perspective, those filters are now understood as kinetic models driven by an external input dY(t).  #@NEW_LINE#@#  The goal is to synthesize their dynamics through simple biochemical reactions with mass-action kinetics.  #@NEW_LINE#@#  In the case of the Poisson filter, this is rather straightforward because the filter is already in the form of a valid rate equation.  #@NEW_LINE#@#  In particular, it describes the concentration of a birthdeath process with parameters  and (+cY), respectively.  #@NEW_LINE#@#  Note that despite its noisy input dY(t), the estimator M(t) should be as deterministic as possible.  #@NEW_LINE#@#  We therefore allow it to be rescaled by a constant factor n to ensure a deterministic, highcopy-number regime (SI Appendix, section S.1.5).  #@NEW_LINE#@#  Overall, the Poisson filter can be implemented through only three reactions:ZcYZ+n×MsensorØnM+cYØfilter.  #@NEW_LINE#@#  [3]For a given n, the abundance of the species M at time t is a discrete random variable which we denote by Mn(t).  #@NEW_LINE#@#  For large n, the large copy number limit will be approached, and the filter reactions will become virtually deterministic.  #@NEW_LINE#@#  Note that this will not be the case for the sensor reaction, whose rate depends on the abundance of Z, which is not scaled by n. This gives us a way to realize the solution of Eq.  #@NEW_LINE#@#  2 using chemical reactions.  #@NEW_LINE#@#  More precisely, for any t in the interval [0,T]: limnMn(t)/n=a.s.M(t).  #@NEW_LINE#@#  Therefore, for large values of n, the reactions in Eq.  #@NEW_LINE#@#  3 give us the molecular filter realization we seek because for such values, Mn(t)/nM(t).  #@NEW_LINE#@#  
In the case of the gamma filter, challenges arise because the filter equations are incompatible with biophysical rate laws.  #@NEW_LINE#@#  We addressed this problem by applying a suitable variable transform [A(t),B(t)]=f[M(t),V(t)] and implementing the transformed dynamics A(t) and B(t) and corresponding inverse transforms as standard mass-action kinetics.  #@NEW_LINE#@#  A detailed derivation and list of reactions can be found in SI Appendix, section S.1.5.  #@NEW_LINE#@#  Example trajectories of both filters for different values of cY are shown in SI Appendix, Fig S.1.  #@NEW_LINE#@#  
To quantitatively check the accuracy of the filters, we compared their empirical MSE to the MMSE obtained through numerical integration of the KushnerStratonovich equation.  #@NEW_LINE#@#  The results reflect the conditions of cY under which the two filters were derived.  #@NEW_LINE#@#  Taken together, the filters provide a reasonable approximation of the exact MMSE estimator along the entire range of cY (SI Appendix, Fig S.2).  #@NEW_LINE#@#  
Optimal filters can typically tolerate a substantial degree of model mismatch.  #@NEW_LINE#@#  This has great practical relevance because the dynamic noise model is sometimes only poorly characterized.  #@NEW_LINE#@#  In the considered example, for instance, precise knowledge of the parameters  and  might not be available.  #@NEW_LINE#@#  We performed additional simulations and found both filters to be largely robust with respect to parameter mismatch (SI Appendix, Fig S.2).  #@NEW_LINE#@#  Although the Poisson filter performs generally worse than the gamma filter for little or no mismatch, it is surprisingly robust also in case of substantial parameter variations.  #@NEW_LINE#@#  

Ensemble_Averaging  #@NEW_LINE#@#  
When a filter is scaled by n, a single sensor reaction has to produce n molecules at once.  #@NEW_LINE#@#  Although this could be achieved, for instance, using DNA hybridization cascades, challenges arise in cellular systems where the degree to which stoichiometries can be engineered is rather limited.  #@NEW_LINE#@#  Ensemble averaging offers a viable and attractive alternative to filter scaling.  #@NEW_LINE#@#  The idea here is to achieve determinism by running n independent copies M(j)(t) of the original (unscaled) filter and averaging these.  #@NEW_LINE#@#  For example, n could correspond to the number of identical plasmid replicates within a cell.  #@NEW_LINE#@#  Similarly, one could use a population of n isogenic cells to sense extracellular signals such as the abundance of a certain chemical in the media.  #@NEW_LINE#@#  Although intrinsic fluctuations will affect the individual instance M(j)(t), they will average out in the mixture process M(t)=j=1nM(j)(t)/n if n is sufficiently large.  #@NEW_LINE#@#  This has important practical implications.  #@NEW_LINE#@#  First, the resulting one-molecule sensors ZZ+M are much simpler to achieve using cellular mechanisms, and second, they provide a cheap way to exploit biological parallelism.  #@NEW_LINE#@#  This idea is related to the concept of ensemble learning (25), where a collection of noisy algorithms add up to a single accurate predictor, and we refer to these filter variants as ensemble filters.  #@NEW_LINE#@#  We show in SI Appendix, section S.2, that for large n, the ensemble Poisson filter converges to the differential equationddtM(t)=M(t)+cY[Z(t)M(t)],[4]which is reminiscent of a state observer equationa quantity frequently used in control theory.  #@NEW_LINE#@#  This filter variant appears particularly relevant for in vivo applications where it could be realized through multiple replicates of a single gene that has both a constitutive and an inducible promoter (see case studies below).  #@NEW_LINE#@#  
When comparing the ensemble Poisson filter to the Poisson filter in terms of the MSE, one finds that for any n1, the ensemble variant is guaranteed to achieve a lower MSE for any , , and cY.  #@NEW_LINE#@#  This is due to the fact that fluctuations of the sensor are repressed in the ensemble filter, whereas this fails to be true for the Poisson filter (SI Appendix, section S.2.1).  #@NEW_LINE#@#  For large n, this difference can be seen by multiplying Eq.  #@NEW_LINE#@#  4 with dt and comparing it to Eq.  #@NEW_LINE#@#  2: the two equations coincide except that the term stemming from the sensor dY(t) is replaced by its deterministic, noise-free counterpart cYZ(t)dt.  #@NEW_LINE#@#  

Extensions_to_More_General_Cases  #@NEW_LINE#@#  
The filter variants described above are suitable in cases where the sensor is attached directly to the unknown signal Z(t).  #@NEW_LINE#@#  In various practical applications, however, a circuit might require knowledge about unknown signals that are multiple steps away from the sensed species.  #@NEW_LINE#@#  For instance, we would like to conceive a filter circuit that only uses information of a certain gene product to make inference about the transcription factor abundance that controls it.  #@NEW_LINE#@#  This requires an extension of our filtering framework to general multivariate scenarios.  #@NEW_LINE#@#  As it turns out, the MMSE estimator of any biochemical species satisfiesdMi(t)=Di(t)dt+Cov[Zi(t),Zk(t)]Mk(t)[dY(t)cYMk(t)dt],[5]with Zk(t) as the species attached to the sensor, Zi(t) as any other species that depends on Zk(t) in an arbitrary way (Fig 2A), and Cov[Zi(t),Zk(t)] as the conditional covariance of those species.  #@NEW_LINE#@#  The term Di(t) refers to the unconditional dynamics of the mean of Zi(t) as dictated by the chemical master equation.  #@NEW_LINE#@#  Mathematically, this can be written as Di(t)=zzAiP(Zi(t)=z|Yt), with Ai as the infinitesimal generator of the (unconditional) stochastic process Zi(t).  #@NEW_LINE#@#  For instance, if Zi(t) is a birthdeath process such as the one from Fig 1A, then Di(t)=Mi(t).  #@NEW_LINE#@#  Note that Eq.  #@NEW_LINE#@#  5 is general, and our previously derived filters and other known estimators can be framed as special cases of it.  #@NEW_LINE#@#  For instance, if the components Zi(t) are constant parameters [i.e., Di(t)=0], then Eq.  #@NEW_LINE#@#  5 can be understood as a continuous-time variant of the recursive least squares algorithm (26).  #@NEW_LINE#@#  
Although estimator Mi(t) in Eq.  #@NEW_LINE#@#  5 may not be directly realizable, an estimator that satisfies a close approximation of it is always achievable using molecular circuits (SI Appendix, section S.3).  #@NEW_LINE#@#  This will be shown in Applications and Discussion.  #@NEW_LINE#@#  


Applications  #@NEW_LINE#@#  
In the following sections, we demonstrate practical applications of our filtering circuits using two simulation studies as well as experimental data recorded in vitro and in vivo.  #@NEW_LINE#@#  
Adaptive_System_Identification  #@NEW_LINE#@#  
We use a multivariate filter to solve a combined state and parameter estimation problem that is associated with a biochemical system identification task.  #@NEW_LINE#@#  In particular, we consider a birthdeath process Z2(t) with unknown but static birth rate Z1.  #@NEW_LINE#@#  The corresponding multivariate estimator is realizable through five elementary reactions (Fig 2B) as shown in SI Appendix, section S.3.1.  #@NEW_LINE#@#  Our simulations demonstrate that the filter is able to accurately identify both Z2(t) and Z1 (Fig 2C) after a short transient.  #@NEW_LINE#@#  Note that this filter is able to readapt to spontaneous changes in the birth rate Z1.  #@NEW_LINE#@#  This suggests an application of this filter to scenarios in which the true birth rate Z1 slowly varies over time, for instance, over the duration of a cell cycle.  #@NEW_LINE#@#  If the filter is adjusting itself quickly enough, it should be able to track the temporal dynamics of a time-varying and possibly complex system.  #@NEW_LINE#@#  In the derived filter, the speed of adaptation depends on cY and an additional parameter  (SI Appendix, section S.3.1).  #@NEW_LINE#@#  We used this filter to identify a birthdeath process, whose birth rate is controlled by a stochastic bistable switch.  #@NEW_LINE#@#  Fig 2D shows that if  and cY are reasonably large, the filter is indeed able to closely resemble the complex switch-like dynamics.  #@NEW_LINE#@#  

Cancellation_of_Extrinsic_Noise  #@NEW_LINE#@#  
In the following we show how the newly developed filters could guide the design of noise-insensitive circuits.  #@NEW_LINE#@#  Although a more detailed view on this topic is provided in SI Appendix, section S.4, we illustrate the concept by means of an example that is representative of what is typically encountered in vivo.  #@NEW_LINE#@#  In particular, we consider a microRNA circuit that is deployed to mammalian cells through transient transfection.  #@NEW_LINE#@#  The goal of the circuit is to stably express RNA X(t), but the rate at which it is transcribed is corrupted by contextual factors.  #@NEW_LINE#@#  First, we assume that each cell receives a random number of plasmid copies during deployment and that the plasmids deplete randomly as cells divide.  #@NEW_LINE#@#  We refer to the number of plasmid copies at time t as n(t).  #@NEW_LINE#@#  Furthermore, we assume transcription to be affected by a slowly varying random process C(t) that correlates with the cell cycle (Fig 3A).  #@NEW_LINE#@#  Overall, we obtain a transcription rate hT(n(t),C(t)):=n(t)C(t)=Z(t) (Fig 3B).  #@NEW_LINE#@#  
The goal is to construct an estimator M(t) of the cumulative context Z(t) and to use this estimator as a repressor of X(t) through RNA interference (RNAi) (Fig 3A).  #@NEW_LINE#@#  Intuitively, the two effects are expected to compensate for each other such that the overall effect of Z(t) on X(t) vanishes.  #@NEW_LINE#@#  In fact, this idea can be framed mathematically as demonstrated in SI Appendix, section S.4.  #@NEW_LINE#@#  
In the considered scenario, the ensemble Poisson filter is particularly suitable to serve as an estimator because it can exploit the availability of multiple gene replicates per cell to improve its accuracy.  #@NEW_LINE#@#  The gene M corresponding to this filter is present twice on the plasmid, once attached to a constitutive promoter pMc and once attached to a Z(t)-inducible promoter pMi.  #@NEW_LINE#@#  Note that in realistic scenarios, also the constitutive version of M is likely to be affected by contextual factors.  #@NEW_LINE#@#  We therefore accounted for an unintended dependency of this gene on Z(t) in our model.  #@NEW_LINE#@#  We performed stochastic simulations of the resulting circuit that accounts for both intrinsic and extrinsic (i.e., contextual) fluctuations (see SI Appendix, section S.4.4, and Fig 3 for more details).  #@NEW_LINE#@#  It turns out that if the sensor rate cY of the ensemble Poisson filter is sufficiently large, the noise canceller performs well even though it is based on strongly simplifying assumptions [i.e., Z(t) modeled as a birthdeath process], and it is affected by extrinsic and intrinsic noise itself (Fig 3 C and D).  #@NEW_LINE#@#  An additional case study showing noise cancellation in a bistable switch is provided in SI Appendix, section S.4.5.  #@NEW_LINE#@#  

In_Vitro_Implementation_of_the_Poisson_Filter  #@NEW_LINE#@#  
As a proof of principle, we forward-engineered and tested a DNA-based filtering circuit in vitro as DNA strand displacement (DSD) cascades (6, 7, 2729).  #@NEW_LINE#@#  Strand displacement is a competitive hybridization reaction where an incoming single-stranded DNA molecule binds to a complementary strand, in the process displacing an incumbent strand.  #@NEW_LINE#@#  This elementary mechanism allows one to directly synthesize arbitrary chemical reaction networks (30).  #@NEW_LINE#@#  Furthermore, because individual DSD reactions can be described by conventional bimolecular rate laws at a remarkably high precision (31), they provide a higher degree of quantitative control compared with cellular systems.  #@NEW_LINE#@#  
To enable a comparison of the molecular filter with its mathematical counterpart and the true value of Z(t), only the filter itself [i.e., the equation describing the dynamics of M(t)] was implemented in vitro.  #@NEW_LINE#@#  The noise Z(t) and respective sensor time points [i.e., the times where dY(t)=1] were simulated on a computer, and the latter were manually transferred to the test tube in which the filter was operated (Fig 4A).  #@NEW_LINE#@#  In particular, the concentration of M(t) had to be increased by a constant value M at each of those time points.  #@NEW_LINE#@#  Here we want M(t) to estimate the concentration of Z(t) (as opposed to absolute copy numbers), and thus, M=VZ1 with VZ as the reaction volume associated with the virtual signal Z(t) (Fig 4A).  #@NEW_LINE#@#  In reference to Eq.  #@NEW_LINE#@#  2 this would correspond to a scaling factor of n=VM/VZ at the level of copy numbers, with VM as the volume of the test tube.  #@NEW_LINE#@#  
The reaction network from Eq.  #@NEW_LINE#@#  2 was mapped to a DSD circuit (SI Appendix, section S.5 and Fig S.10) under the join-fork paradigm (6, 32) and quantified experimentally using calibrated fluorescence measurements (SI Appendix, section S.6.1).  #@NEW_LINE#@#  An initial perturbation experiment was performed to check the circuits sensitivity with respect to small changes in M and to compute initial estimates of kinetic parameters (SI Appendix, section S.6.1.4).  #@NEW_LINE#@#  Based on those estimates, we designed three time course experiments.  #@NEW_LINE#@#  The corresponding fluorescence trajectories show that the in vitro filter resembles the ideal mathematical model at a remarkably high precision in all three scenarios (Fig 4 CE).  #@NEW_LINE#@#  

Ensemble_Filtering_in_Escherichia_coli  #@NEW_LINE#@#  
Engineering biochemical circuits and their properties in living organisms is associated with substantial additional challenges compared with cell-free systems.  #@NEW_LINE#@#  It is therefore important to show that the desired circuit characteristics are attainable using cellular mechanisms.  #@NEW_LINE#@#  In the following, we demonstrate experimentally that a simple genetic circuit in Escherichia coli can function as an optimal filter.  #@NEW_LINE#@#  
To check whether our circuit is indeed able to estimate a noise signal Z(t) unknown to it, we must know the noise signal being estimated.  #@NEW_LINE#@#  A good way to achieve this is to generate the random signal Z(t) ourselves.  #@NEW_LINE#@#  To that end, we used an optogenetically controlled sensor to which we can apply arbitrary light sequences Z(t).  #@NEW_LINE#@#  This allowed us to compare the filter estimate M(t) to the true values of Z(t).  #@NEW_LINE#@#  In practical applications, the optogenetic sensor could be replaced by one that recognizes another signal of interest.  #@NEW_LINE#@#  The procedures we followed are described next.  #@NEW_LINE#@#  
We used an optogenetic circuit encoded in plasmid pJT119b (33), which expresses a fluorescent protein (GFP) at a basal rate through a weak constitutive promoter (34).  #@NEW_LINE#@#  This rate can be enhanced through a second promoter that is inducible by green light (Fig 5A).  #@NEW_LINE#@#  Due to this particular promoter configuration and the fact that plasmids are present in multiple copies per cell [n5070 (35)], this circuit closely resembles an ensemble Poisson filter that optimally estimates a light signal Z(t) generated according to noise dynamics with a particular set of parameters , .  #@NEW_LINE#@#  Indeed, based on Eq.  #@NEW_LINE#@#  4, there always exist a  and  for which the optogenetic circuit functions as an optimal filter as long as the degradation rate of M is larger than cY.  #@NEW_LINE#@#  To figure out these inverse optimal parameters for our specific optogenetic circuit, we performed calibration experiments using a designed light profile Z1(t) to infer the mRNA transcription dynamics along with the parameters , , and  that account for reporter maturation and degradation.  #@NEW_LINE#@#  From the inferred transcription dynamics, we can get the parameters , , and cY according to Eq.  #@NEW_LINE#@#  4 (see also Fig 5 A and SI Appendix, section S.7.5 and Fig S.16).  #@NEW_LINE#@#  The inferred filter circuit parameters allow us to assess the performance that the filter would achieve in terms of its MSE (SI Appendix, Fig S.16).  #@NEW_LINE#@#  
Finally, we tested the function of our circuit as an estimator of Z(t).  #@NEW_LINE#@#  We generated a random trajectory Z2(t) and applied it as a light input to our optogenetic circuit (SI Appendix, section S.7.7).  #@NEW_LINE#@#  We found that the corresponding experimental fluorescence measurements are in very good agreement with the response predicted by the inferred filter model (Fig 5B), indicating that the corresponding transcriptional output M(t) is indeed able to estimate Z(t) with high fidelity (see SI Appendix, sections S.7.5S.7.7, for more details).  #@NEW_LINE#@#  
Circuits like the one above could serve as modules for estimating dynamic transcription factor abundances from transcribed RNAs.  #@NEW_LINE#@#  The estimator could be optimized to specific Z(t) dynamics (characterized by , ) by tuning the strengths of the promoters: the constitutive expression rate should be designed to be close to , whereas the induced transcription rate should be close to cY:=(k), where k is the degradation rate constant of M which should satisfy k. As shown earlier in this article, the robustness of the filter with respect to mismatch in  and  increases with the sensor rate cY.  #@NEW_LINE#@#  


Discussion  #@NEW_LINE#@#  
Our results illustrate that a seemingly complex filtering operation may be realizable through very simple biochemical mechanisms.  #@NEW_LINE#@#  This simplicity allowed us to showcase our filtering approach in vitro using DNA strand displacement cascades but also in vivo using a light-inducible gene expression circuit in E. coli.  #@NEW_LINE#@#  
A key strength of model-based filtering techniques is that the assumed model dynamics of Z(t) are steadily corrected through a feedback control loop.  #@NEW_LINE#@#  This way, a filter can exploit all information about Z(t) that is available a priori (e.g., its autocorrelation or mean abundance) but, at the same time, can tolerate a substantial degree of model mismatch (SI Appendix, Fig S.2 and Figs.  #@NEW_LINE#@#  2D and 3D).  #@NEW_LINE#@#  The latter property appears particularly relevant for synthetic biology where the true dynamics of a signal Z(t) is often only poorly characterized.  #@NEW_LINE#@#  
We found that the proposed ensemble filter variants are favorable over normal ones when replicates of identical circuits are easy to accomplish (e.g., through multiple plasmids).  #@NEW_LINE#@#  By exploiting this parallelism, they lead to a damping of the sensor noise that is inversely proportional to the ensemble size n, and as a consequence, ensemble filters achieve a reduced MSE for all n1 compared with their original counterparts.  #@NEW_LINE#@#  
Most importantly, however, the ensemble concept entails a general recipe for building optimal estimators of arbitrary biochemical signals, even if they are nonlinear and multiple steps away from the sensor.  #@NEW_LINE#@#  In particular, they can be realized from n replications of the signal of interest Zi(t), extended by a sensor reaction and an additional (controlled) degradation (SI Appendix, section S.3).  #@NEW_LINE#@#  The individual replicates serve as stochastic simulations of Zi(t) to emulate its unconditional mean dynamics [i.e., Di(t)] as an n-sample Monte Carlo average.  #@NEW_LINE#@#  As a striking implication, the moment closure problem is bypassed, facilitating applications also to nonlinear Zi(t).  #@NEW_LINE#@#  Another desirable side effect of replicating Zi(t) is that parameter and model mismatch between the assumed and true dynamics is reduced to a minimum.  #@NEW_LINE#@#  
Our simulation studies suggest several potential applications of optimal filters to biomolecular estimation, system identification, and the design of context-independent circuits.  #@NEW_LINE#@#  In contrast to trial-and-error approaches, the circuits are derived in a principled fashion under an MMSE criterion.  #@NEW_LINE#@#  
We believe that the ability to perform statistical computations in situ will be crucial for devising robust synthetic networks.  #@NEW_LINE#@#  Those will allow circuits to sense, estimate, and adapt to their environment, facilitating context-aware designs.  #@NEW_LINE#@#  We envision many potential applications, ranging from adaptive therapeutics to self-reporting cells that estimate and display inaccessible parameters and states.  #@NEW_LINE#@#  

Materials_and_Methods  #@NEW_LINE#@#  
Detailed information about mathematical derivations, simulations, and experimental procedures can be found in SI Appendix.  #@NEW_LINE#@#  In SI Appendix, section S.1, we provide discussions around the optimal filtering framework for biochemical networks.  #@NEW_LINE#@#  The ensemble and multivariate filters are described in SI Appendix, sections S.2 and S.3, respectively.  #@NEW_LINE#@#  SI Appendix, section S.4, introduces a mathematical framework for noise cancellation and contains details about the corresponding simulations.  #@NEW_LINE#@#  Rational design and experimental methods related to the DNA-based filtering circuit are provided in SI Appendix, sections S.5 and S.6.  #@NEW_LINE#@#  Experimental methods related to the bacterial circuit are described in SI Appendix, section S.7.  #@NEW_LINE#@#  

Acknowledgments  #@NEW_LINE#@#  
The authors are grateful to Yuan Chen and Sundipta Rao for providing technical assistance to the first author while he was performing the experiments.  #@NEW_LINE#@#  This project was financed with a grant from the Swiss SystemsX.ch initiative, evaluated by the Swiss National Science Foundation.  #@NEW_LINE#@#  G.S.  #@NEW_LINE#@#  was supported by National Science Foundation Grant CCF-1317653.  #@NEW_LINE#@#  

Footnotes  #@NEW_LINE#@#  


