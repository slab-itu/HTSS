article id="http://dx.doi.org/10.1073/pnas.1710248114"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Meta-mass shift chemical profiling of metabolomes from coral reefs  #@NEW_LINE#@#  

Significance  #@NEW_LINE#@#  
Coral reef taxa produce a diverse array of molecules, some of which are important pharmaceuticals.  #@NEW_LINE#@#  To better understand how molecular diversity is generated on coral reefs, tandem mass spectrometry datasets of coral metabolomes were analyzed using a novel approach called meta-mass shift chemical (MeMSChem) profiling.  #@NEW_LINE#@#  MeMSChem profiling uses the mass differences between molecules in molecular networks to determine how molecules are related.  #@NEW_LINE#@#  Interestingly, the same molecules gain and lose chemical groups in different ways depending on the taxa it came from, offering a partial explanation for high molecular diversity on coral reefs.  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
Untargeted metabolomics of environmental samples routinely detects thousands of small molecules, the vast majority of which cannot be identified.  #@NEW_LINE#@#  Meta-mass shift chemical (MeMSChem) profiling was developed to identify mass differences between related molecules using molecular networks.  #@NEW_LINE#@#  This approach illuminates metabolome-wide relationships between molecules and the putative chemical groups that differentiate them (e.g., H2, CH2, COCH2).  #@NEW_LINE#@#  MeMSChem profiling was used to analyze a publicly available metabolomic dataset of coral, algal, and fungal mat holobionts (i.e., the host and its associated microbes and viruses) sampled from some of Earths most remote and pristine coral reefs.  #@NEW_LINE#@#  Each type of holobiont had distinct mass shift profiles, even when the analysis was restricted to molecules found in all samples.  #@NEW_LINE#@#  This result suggests that holobionts modify the same molecules in different ways and offers insights into the generation of molecular diversity.  #@NEW_LINE#@#  Three genera of stony corals had distinct patterns of molecular relatedness despite their high degree of taxonomic relatedness.  #@NEW_LINE#@#  MeMSChem profiles also partially differentiated between individuals, suggesting that every coral reef holobiont is a potential source of novel chemical diversity.  #@NEW_LINE#@#  

Data processing and generation based on a simplified molecular network and two redundant mass shifts.  #@NEW_LINE#@#  (A) GNPS used MS/MS fragmentation spectra to elucidate molecular similarities and network similar molecules (i.e., related molecules).  #@NEW_LINE#@#  (B) Redundant mass shifts between related molecules were identified and annotated to known chemical groups when possible.  #@NEW_LINE#@#  Two annotated mass shifts are shown here, m/z 2.016 in blue with dashed lines and m/z 27.996 in orange with solid lines.  #@NEW_LINE#@#  (C) Molecular features that differed by a redundant mass shift were quantified based on MS. (DF) Data were generated for (D) the number of times each redundant mass shift was observed across all networks, (E) the summed abundances of all molecules exhibiting each redundant mass shift, and (F) the sum of the differences in abundances between the more massive and less massive molecules for all pairs of molecules connected by a mass shift.  #@NEW_LINE#@#  
Results  #@NEW_LINE#@#  
Identifying_Redundant_Mass_Shifts_in_Metabolomes_of_Coral_Reef_Holobionts  #@NEW_LINE#@#  
The dataset used as the basis for creating MeMSChem profiles was previously published in ref.  #@NEW_LINE#@#  12 and can be found on the Mass spectrometry Interactive Virtual Environment (MassIVE) at https://massive.ucsd.edu/ProteoSAFe/static/massive.jsp with accession no.  #@NEW_LINE#@#  MSV000078598.  #@NEW_LINE#@#  This dataset was derived from an LC-MS/MS analysis of three genera of scleractinian coral (Montipora spp., Pocillopora spp., and Porites spp.  #@NEW_LINE#@#  ), two coralline algae [crustose coralline algae (CCA) and Halimeda sp.  #@NEW_LINE#@#  ], two noncalcifying algae (macroalgae and turf algae), and a fungal mat.  #@NEW_LINE#@#  
The online platform GNPS [gnps.ucsd.edu/ProteoSAFe/static/gnps-splash.jsp (5); Fig S1] was used to cluster identical MS/MS spectra into nodes and identify the degree to which each node was structurally similar (i.e., related) to other nodes (henceforth referred to as molecular features) based on a cosine score of spectral similarity.  #@NEW_LINE#@#  All pairs of molecular features receiving a cosine score above a threshold of 0.6 were considered to be related and connected in the network (SI Materials and Methods for more details regarding the cosine score threshold).  #@NEW_LINE#@#  Each mass shift between network connections was then mined for multiple (i.e., redundant) occurrences (Fig 1B).  #@NEW_LINE#@#  When the mass shifts of five or more molecular pairs differed by less_thanm/z 0.001, the mass shift was counted.  #@NEW_LINE#@#  All molecular features comprising the pairs with this mass shift were assigned to a bin (Fig 1 CE; see SI Materials and Methods for more details).  #@NEW_LINE#@#  
MeMSChem profiling identified 62 mass shifts that passed the filter of five or more mass shifts within m/z 0.001 (Table S1).  #@NEW_LINE#@#  Among these mass shifts, 10 were annotated to known adducts and artifacts and were removed before further analyses (Tables S1 and S2).  #@NEW_LINE#@#  The remaining mass shifts were annotated to known chemical groups involving hydrogen, carbon, and oxygen where possible, leading to the annotation of 13 of the 62 mass shifts identified (Table 1 and Table S1).  #@NEW_LINE#@#  This represents a conservative list of annotations, and the additional mass shifts identified here may be annotatable in future investigations.  #@NEW_LINE#@#  
Mass shifts of 0 were abundant in the networks and may represent isomers.  #@NEW_LINE#@#  These mass shifts were removed due to the likelihood that two isomers were merged into a single molecular feature or that the same molecular feature was split into two molecules during networking, due to the high degree of spectral similarity or difference in the number of observable fragments, respectively.  #@NEW_LINE#@#  An approach using retention time differences or chiral separation columns should be employed to separate isomers in future applications of MeMSChem profiling.  #@NEW_LINE#@#  

Quantifying_Mass_Shifts_in_Holobionts  #@NEW_LINE#@#  
MS/MS-based molecular features associated with redundant mass shifts were quantified from the MS scan of the parent molecule using Optimus software (https://github.com/MolecularCartography/Optimus; Fig 1C).  #@NEW_LINE#@#  A molecular feature filter was applied to remove features that were not detected in all samples.  #@NEW_LINE#@#  Consequently, only the features present in all samples were quantified.  #@NEW_LINE#@#  This filter allowed us to determine whether holobionts exhibited different mass shifts associated with the same molecules (cf.  #@NEW_LINE#@#  different mass shifts associated with molecules that are only found in that holobiont; Fig 1 E and F).  #@NEW_LINE#@#  
Three forms of metabolome-wide data were generated for each sample (Fig 1 AC).  #@NEW_LINE#@#  First, all instances where a redundant mass shift was observed in the network were tabulated for each sample.  #@NEW_LINE#@#  These counts data provided a metric of the commonness and rarity of each mass shift in each sample (Fig 1D).  #@NEW_LINE#@#  Second, the abundance of every molecular feature was summed by mass shift regardless of whether that feature was the higher or lower mass feature in a network pair.  #@NEW_LINE#@#  These summed abundances data provided a metric for the overall occurrence of each mass shift throughout each sample (Fig 1E; see SI Materials and Methods for equations).  #@NEW_LINE#@#  Third, for each network pair, the difference in abundance between the more and less massive feature was calculated, and then these values were summed by mass shift for each sample (Fig 1F; see SI Materials and Methods for equations).  #@NEW_LINE#@#  These differences in abundances data reflected whether, metabolome-wide, molecules were more likely to gain or lose a given mass, potentially reflecting active interconversion or branching of largely shared biosynthetic pathways.  #@NEW_LINE#@#  All resultant data are provided in Dataset S1.  #@NEW_LINE#@#  Among the redundant mass shifts, 7 of the 10 most common mass shifts were putatively annotated to known chemical groups, constituting nearly 50% of the network pairs isolated from the networks.  #@NEW_LINE#@#  These mass shifts included m/z 2.016, 14.016, 28.032, 56.064, 26.016, 18.010, and 12.000, which were putatively annotated as H2, CH2, C2H4, C4H8, C2H2, H2O, and C, respectively.  #@NEW_LINE#@#  

Examining_Known_Mass_Shifts_Associated_with_Library-Identified_Molecular_Features  #@NEW_LINE#@#  
Instances in which known mass shifts were associated with identified molecules provided conformational evidence that mass shifts were correctly annotated.  #@NEW_LINE#@#  Four examples are highlighted in Fig 2B, as follows.  #@NEW_LINE#@#  (i) A feature identified as phenanthro-furanone with a mass shift of m/z 18.014 (H2O; Fig 2B, example 1 and Fig S2).  #@NEW_LINE#@#  (ii) A subnetwork with three forms of lyso-platelet activating factor (lyso-PAF) and related compounds (Fig 2B, example 2 and Fig S3).  #@NEW_LINE#@#  The identification of one molecular feature, lyso-PAF-C16, in these samples was previously confirmed using a reference standard by ref.  #@NEW_LINE#@#  12.  #@NEW_LINE#@#  This subnetwork is particularly informative, because the three identified compounds were networked to one another, showing that the mass shifts truly correspond to a desaturation and elongation of a fatty acid chain, m/z 2.018 (H2) and m/z 28.032 (C2H4).  #@NEW_LINE#@#  (iii) A subnetwork of ceramide-related compounds (Fig 2B, example 3 and Fig S4) with mass shifts of m/z 2.015 (H2), m/z 14.015 (CH2), and m/z 165.057 (C6H10O5; glycosylation).  #@NEW_LINE#@#  A coral-associated ceramide was recently identified (16) with one additional desaturation relative to the ceramide identified here, and this newly identified ceramide has an extremely similar mass (m/z 536.504) to the unknown feature (m/z 536.508) networked to the ceramide here.  #@NEW_LINE#@#  The newly identified ceramide also differs in mass from the identified ceramide by m/z 2.015, consistent with one fewer saturation.  #@NEW_LINE#@#  (iv) A subnetwork of three unidentified molecules with mass shifts of m/z 28.032 (C2H4), m/z 28.033 (C2H4), and m/z 56.065 (C4H8) (Fig 2B, example 4 and Fig S5).  #@NEW_LINE#@#  

Differences_in_Mass_Shift_Profiles_Between_Types_of_Holobionts  #@NEW_LINE#@#  
To determine how well MeMSChem profiling resolved each holobiont type, Random Forests classification (17) was used to generate an out-of-bag error (henceforth referred to as a model error), which reflects the extent to which the model correctly categorized every sample (i.e., whether Halimeda sp.  #@NEW_LINE#@#  samples were correctly placed into the models Halimeda group).  #@NEW_LINE#@#  Random Forests offers exceptional classification performance and is robust to nonnormally distributed data and correlated predictors (18), both of which were present in this dataset (Dataset S1).  #@NEW_LINE#@#  
The usefulness of recategorizing molecules by their mass shifts was first evaluated based on the number of times that each mass shift was observed (counts data described above).  #@NEW_LINE#@#  The model error of the Random Forests model classifying holobiont types using the counts data was 0.44, which indicates that 44% of the time samples were assigned to the incorrect holobiont type.  #@NEW_LINE#@#  The resolution gained from the observed counts data (i.e., actual data) was compared with that from 1,000 permutations of the data in which pairs were randomly binned and counted while keeping the original proportions consistent (Dataset S2).  #@NEW_LINE#@#  The observed counts data outperformed 95% of the randomly generated datasets, suggesting that the counts of redundant mass shifts aided in differentiating between holobiont types despite the relatively high model error (Fig 3A).  #@NEW_LINE#@#  
Molecular abundance data were then incorporated into the analysis and compared against the holobiont resolution gained from the counts data.  #@NEW_LINE#@#  When the summed abundances of each mass shift among molecules present in all holobionts were considered, the model error from the abundance data was 0.36 (Fig 3B).  #@NEW_LINE#@#  Therefore, incorporating feature abundance data improved the accuracy of the model by 8% when resolving between holobiont types.  #@NEW_LINE#@#  The value of summing feature abundances by mass shift was also tested by comparing its accuracy with the models of 1,000 permutations of the data in which network pairs were randomly binned and summed while keeping the original proportions consistent (as was done for the counts data above).  #@NEW_LINE#@#  Among only the molecular features present in all holobionts, summing of feature abundances by mass shift resolved holobiont types better than 90% of the datasets generated from random summing of feature abundances (Fig 3B).  #@NEW_LINE#@#  Thus, binning abundance data by redundant mass shifts categorizes molecules in a nonrandom manner.  #@NEW_LINE#@#  Molecular abundances binned by mass shifts also reflected differences among holobiont types better than when holobionts were compared with data that lack any feature abundance information (i.e., counts of the number of mass shifts).  #@NEW_LINE#@#  
To determine whether mass shifts may reflect active sites of molecular interconversions, as would be expected if a molecular modification had occurred, the summed abundances were compared with the differences in abundances between molecular pairs by mass shift.  #@NEW_LINE#@#  This is akin to one molecule being the reactant and the other the product.  #@NEW_LINE#@#  The model error of the differences in abundances data was 0.34, demonstrating that organizing the data by the differences in abundances slightly outperformed the summed abundances data (model error, 34 and 36%, respectively; Fig 3C).  #@NEW_LINE#@#  Compared with 1,000 random permutations of the actual data, the differences in abundances data outperformed 86% of the random models.  #@NEW_LINE#@#  
Classification was further improved by incorporating the full molecular dataset, and thus the molecules that were present in all holobionts and the molecules that were only found in one or a few holobionts.  #@NEW_LINE#@#  When these molecules were included, the model error was 0.02.  #@NEW_LINE#@#  This reflects a 32% decrease in the model error relative to when only molecules found in all holobionts were considered and was nearly perfect in assigning samples to their correct holobiont type.  #@NEW_LINE#@#  The real data outperformed 92% of the randomly generated datasets (Fig 3D and summarized in Fig 3E).  #@NEW_LINE#@#  These results suggest that the highest level of holobiont resolution was achieved when (i) molecular features were binned by the redundant mass shifts they exhibited, (ii) molecular abundances were included as the difference in abundance between molecules in a network pair, and (iii) molecules/pairs that were only found in certain holobionts were included in addition to those molecules present in all holobionts.  #@NEW_LINE#@#  

Mass_Shifts_That_Best_Distinguish_Each_Holobiont_Type  #@NEW_LINE#@#  
Among the molecular features present in all holobionts, coral genera were best differentiated from one another by mass shifts corresponding to two carbons that were either saturated (m/z 28.032, C2H4 or 2*CH2) or unsaturated (m/z 26.016 C2H2) (P less_than 0.01 for both; Fig 4A).  #@NEW_LINE#@#  The three coral genera exhibited distinct patterns between these two mass shifts: Molecular features of Montipora exhibited the addition of C2H4 and loss of C2H2, while Pocillopora exhibited the opposite pattern.  #@NEW_LINE#@#  Porites-associated molecules did not gain or lose either mass shift.  #@NEW_LINE#@#  Putative CH2 and CH2OOH mass shifts best differentiated the noncoral holobionts (P less_than 0.01 for both; Fig 4B).  #@NEW_LINE#@#  Halimeda features predominantly gained CH2, as did turf algae, the fungal mat, and all of the corals, though to a lesser degree than Halimeda.  #@NEW_LINE#@#  Additions of CH2OOH were unique to Halimeda.  #@NEW_LINE#@#  Corals were best differentiated from noncorals based on larger losses of CO and H2, the latter suggesting a dehydrogenated state perhaps due to higher concentrations of unsaturated lipids.  #@NEW_LINE#@#  


SI_Materials_and_Methods  #@NEW_LINE#@#  
LC-MS_MS_Data_Collection  #@NEW_LINE#@#  
As described in Quinn et al.  #@NEW_LINE#@#  (12), samples of coral, algae, and a fungal mat were extracted in 70% methanol and analyzed with a Thermo Fisher Scientific UltiMate 3000 Dionex UHPLC coupled to a Bruker Daltonics maXis qTOF mass spectrometer.  #@NEW_LINE#@#  An internal standard of glycocholic acid was used for normalization across samples.  #@NEW_LINE#@#  Lock mass internal calibration was achieved using a wick within the source that was saturated with hexakis phosphazene ions (1H,1H,3H-tetrafluoropropoxy, m/z 922.0098; SynQuest Laboratories) to allow for constant infusion of the calibrant into the instrument.  #@NEW_LINE#@#  An injection volume of 30 µL was used and samples were separated on a Kinetex 2.6-m C18 (30 × 2.10 mm) UHPLC column.  #@NEW_LINE#@#  A linear water/acetonitrile gradient of +0.1% formic acid was used for the mobile phase at a flow rate of 0.5 mLmin1.  #@NEW_LINE#@#  Acquisition was carried out for MS spectra in the mass range of m/z 50 to 2,000, and the 10 most intense ions per scan were fragmented using collision-induced dissociation at 35 eV for +1 ions and 25 eV for +2 ions.  #@NEW_LINE#@#  The instrument was operated in positive-ion mode and data-dependent acquisition.  #@NEW_LINE#@#  Ions were ignored for MS/MS after being selected in three consecutive scans but were refragmented when their intensity increased to greater than two and a half times that of the previous fragmentation scan in which it was detected.  #@NEW_LINE#@#  

Molecular_Networking  #@NEW_LINE#@#  
Raw MS data were recalibrated using the lock masses of an internal standard constantly infused in the ESI source, normalized to an internal glycocholic acid standard, and converted to mzXML files.  #@NEW_LINE#@#  The files reported in ref.  #@NEW_LINE#@#  12 were submitted for molecular network analysis using the online workflow at GNPS (5) (Fig S1).  #@NEW_LINE#@#  These files can be found on the Mass spectrometry Interactive Virtual Environment (MassIVE) at https://massive.ucsd.edu/ProteoSAFe/static/massive.jsp with accession no.  #@NEW_LINE#@#  MSV000078598.  #@NEW_LINE#@#  In GNPS, the similarity of spectral fragmentation patterns (i.e., similarity of two molecular features) was compared in a pairwise fashion across all spectra using the cosine score as a reporter of relatedness.  #@NEW_LINE#@#  Network parameters are chosen by the user in the online interface before network generation, and detailed documentation is available on GNPS to guide the user through this process.  #@NEW_LINE#@#  The following GNPS parameters were used here: Data were filtered by removing all MS/MS peaks within m/z 17 of the precursor m/z.  #@NEW_LINE#@#  MS/MS spectra were window-filtered by choosing only the top six peaks in an m/z ±50 window throughout the spectrum.  #@NEW_LINE#@#  The data were then clustered with MSCluster (24) with a parent mass tolerance of m/z 0.02 and an MS/MS fragment ion tolerance of m/z 0.02 to create consensus spectra (referred to as nodes in GNPS and molecular features here).  #@NEW_LINE#@#  Molecular features that contained fewer than two spectra were discarded.  #@NEW_LINE#@#  
Two features were connected in a network when their spectral similarity had a cosine score above 0.6 (henceforth referred to as network pairs), when both features had at least four matching spectral peaks, and when each of the features was among each others top 10 most similar features.  #@NEW_LINE#@#  The scoring algorithm is based on matching MS/MS fragments between two spectra, allowing an equal mass delta between MS/MS fragments as there is between the precursors.  #@NEW_LINE#@#  This process primarily identifies analogs that differ via one modification, or through multiple modifications at one specific side of the molecule.  #@NEW_LINE#@#  Compounds differing by two or more modifications at distinct sides might be connected in the network through a single modified analog.  #@NEW_LINE#@#  
With these settings applied (0.6 cosine score), 11,623 nodes (consensus spectra or features) were generated in GNPS, 4,597 of which were networked to at least one other molecular feature (39.6%).  #@NEW_LINE#@#  When the default GNPS cosine score of 0.7 was applied [i.e., stricter limits on whether two features were networked (5)], 11,619 nodes were generated and 4,525 of those nodes networked, 38.9% of the total, or 0.7% fewer nodes than with the 0.6 cosine score.  #@NEW_LINE#@#  While the increased number of network pairs was small, networking with the 0.6 cosine score was used to develop MeMSChem profiling to include more features and allow molecular features with slightly more disparate spectra, but that could still differ by a redundant mass shift, to be considered.  #@NEW_LINE#@#  
The spectra in the network were then searched against the GNPS spectral libraries using the default settings.  #@NEW_LINE#@#  To focus only on the most high-quality library hits, only spectrum library matches with precursor mass errors less_than20 ppm were considered for further analysis (Fig 2).  #@NEW_LINE#@#  A total of 0.74% of features were annotated to library IDs.  #@NEW_LINE#@#  This low degree of identification is common in other nontargeted metabolomic datasets (2527), confirming that there is much information still to be gained from preexisting LC-MS/MS datasets.  #@NEW_LINE#@#  

Identifying_Aggregations_of_Mass_Shifts_in_Network_Pairs  #@NEW_LINE#@#  
Connections between two features in any network were used to identify aggregations of mass shifts (i.e., repetitive or redundant mass differences between network pairs).  #@NEW_LINE#@#  When a feature was networked to more than one other feature it was considered to exhibit multiple potential mass shifts.  #@NEW_LINE#@#  All network pairs were downloaded from GNPS as a comma separated values (CSV) file list that included the GNPS ID of each feature in every pair as well as the exact mass shift between the two features in every pair (henceforth referred to as network pair mass shift).  #@NEW_LINE#@#  Features associated with contaminants were removed from the network pair dataset before identifying redundant mass shifts (Table S2).  #@NEW_LINE#@#  Contaminants were identified in two ways: (i) when a molecular feature was matched to a library ID known to be a contaminant, and (ii) when a mass shift known to arise from a contaminant was found, even if the molecules were not identified.  #@NEW_LINE#@#  Included in removals were a number of molecular features that were double-charged, which yielded half-mass-unit shifts (e.g., m/z 3.5XX).  #@NEW_LINE#@#  Mass shift m/z 3.008 was merged with m/z 2.016, as the former likely resulted from molecules with the heavy isotope of hydrogen.  #@NEW_LINE#@#  All network pairs containing at least one contaminant molecule or separated by a known contaminant mass shift (e.g., sodium formate clusters) were removed before further analysis, which led to the removal of 384 molecular features.  #@NEW_LINE#@#  
To identify redundancies, the network pairs were searched for aggregations around precise mass differences between related molecules.  #@NEW_LINE#@#  Doing this first required determining the optimal mass resolution for identifying aggregations of network pair mass shifts.  #@NEW_LINE#@#  This was done by determining how well different filtering criteria separated the similar masses of CO and C2H4 (m/z 27.995 and m/z 28.031, respectively; Fig S6).  #@NEW_LINE#@#  First, network pairs were rank-ordered by mass shift (i.e., smallest to largest mass shift between two spectra), and then a sliding window was passed sequentially across the network pairs, one network pair at a time (Fig S1D).  #@NEW_LINE#@#  A window was flagged as a potential aggregation when the range of mass shifts (largest mass shift  smallest mass shift within a window) was equal to or below a threshold value.  #@NEW_LINE#@#  Multiple mass shift thresholds were tested including m/z 0.04, 0.02, 0.01, and 0.001 using 5 versus 10 network pairs within a window (Fig S6).  #@NEW_LINE#@#  Any network pairs that did not fall within a flagged window were discarded to isolate only the network pairs exhibiting aggregations/redundancies.  #@NEW_LINE#@#  Windows with a width of m/z 0.001 that contained five network pairs best separated the known mass shifts of CO and C2H4, and thus these criteria were applied to the entire dataset (Fig S6).  #@NEW_LINE#@#  
Because the sliding window increased sequentially across every network pair but included five network pairs, a single network pair could fall within multiple flagged windows.  #@NEW_LINE#@#  To account for this redundancy and precisely identify the center of aggregation around specific mass shifts, the most abundant mass shifts remaining after filtering were identified (visualized in a histogram in Fig S1E).  #@NEW_LINE#@#  Network pairs m/z ±0.001 of the peaks in mass shifts in network pairs were included in the final list of redundant mass shifts and used to bin/annotate network pairs by the mass shift they exhibited.  #@NEW_LINE#@#  Also considered was whether the absolute variance changed over the range of parent masses, given that the relative variance decreases as the parent mass increases.  #@NEW_LINE#@#  Little evidence was found that absolute variance was related to parent mass (Fig S7), though the change in relative variance across parent masses could be considered in a more advanced binning approach.  #@NEW_LINE#@#  While these parameters were employed here, more or less stringent criteria can be applied (e.g., fewer network pairs per window), or this approach could be used to find mass shifts of interest a priori, depending on the research goal.  #@NEW_LINE#@#  

Tabulating_Redundant_Mass_Shifts_Found_in_Each_Sample  #@NEW_LINE#@#  
The GNPS networks were created using features found in all samples, though not all features were present in all samples.  #@NEW_LINE#@#  As a result, mass shifts had to be identified on a per-sample basis.  #@NEW_LINE#@#  To generate these data, features found in all redundant mass shift network pairs had to be isolated from all features found in the networks and then searched for in each sample.  #@NEW_LINE#@#  To generate the lists of features to isolate, network pairs were split into two lists of featuresone of the more massive feature (gaining dataset) and the other of the less massive feature (losing dataset) for each network pair.  #@NEW_LINE#@#  A unique network pair ID, GNPS feature ID, and mass shift of the network pair were maintained in the gaining and losing feature lists.  #@NEW_LINE#@#  When features were networked to more than one other feature, they were included redundantly in the dataset such that all their network pairs were represented.  #@NEW_LINE#@#  
The list of all molecular features identified by MSCluster, the samples they were found in, and all associated information were downloaded from GNPS.  #@NEW_LINE#@#  This overall feature list was then reduced to only the features found in the gaining and losing feature lists, which were then used to tabulate the presence or absence of each feature in each sample in a binary bucket table (1, present; 0, absent).  #@NEW_LINE#@#  The gaining and losing counts bucket tables were then combined into a single binary bucket table that tabulated whether both features in a network pair were found in each sample.  #@NEW_LINE#@#  This step was necessary because both features in a network pair were not always present in every sample.  #@NEW_LINE#@#  In this combined dataset, the network pair mass shift was appended in place of the molecule ID numbers to annotate each network pair by the mass of the mass shift it exhibits.  #@NEW_LINE#@#  Network pair mass shifts were then binned for each sample by tabulating the binary values (i.e., 1 or 0) of the presence or absence of a network pair, yielding the counts of mass shifts by sample (Dataset S1, Counts tab).  #@NEW_LINE#@#  
The counts data were used to identify holobiont-specific mass shift patterns based on how common or rare mass shifts were among holobiont types (Fig 3A).  #@NEW_LINE#@#  For these analyses, the counts data were not normalized for two reasons: (i) The dataset was predominated by zeros, and (ii) the network pairs in the redundant mass shift datasets represent a small subset of all network pairs found in the overall networks generated by GNPS, and thus to normalize to, for example, the total number of network pairs in a sample would normalize to a value that does not reflect the truncated dataset isolated during MeMSChem profiling.  #@NEW_LINE#@#  On the other hand, the network pairs in the overall networks include many network pairs that do not reflect redundant mass shifts (hence the need to identify them here), and thus the total number of network connections does not represent a useful normalizing value either.  #@NEW_LINE#@#  
Notably, the counts data yielded relatively few counts per mass shift per sample (mean less_than1 per redundant mass shift).  #@NEW_LINE#@#  This apparent scarcity of mass shifts was amplified by the assignment of very similar features (i.e., potentially the same molecule) to different features in GNPS.  #@NEW_LINE#@#  When this happened, it reduced the likelihood that both features in a network pair were found in any given sample, thus reducing the number of mass shifts (i.e., counts data) overall.  #@NEW_LINE#@#  This issue was ameliorated by incorporating another feature-finding tool, Optimus, which independently identified features using the list of features generated by GNPS using MS scans (i.e., parent molecules).  #@NEW_LINE#@#  Features were combined when Optimus identified multiple GNPS features as a single feature and vice versa, consolidating and corroborating the molecular features represented in the dataset.  #@NEW_LINE#@#  

Quantifying_Feature_Abundances  #@NEW_LINE#@#  
The Optimus workflow was used to quantify molecular features exhibiting redundant mass shifts based on MS data (https://github.com/MolecularCartography/Optimus).  #@NEW_LINE#@#  Among its many functionalities, Optimus uses m/z and retention time feature lists to search mass spectra data, returning feature abundances based on MS (i.e., parent molecule).  #@NEW_LINE#@#  This search was used to narrow down the list of all detected MS-based features to MS/MS-based feature identifications and networks generated with GNPS.  #@NEW_LINE#@#  Optimus employs a feature occurrence rate filter, which reduces the number of missed features in the dataset, thereby aiding in statistical comparisons.  #@NEW_LINE#@#  To quantify features involved in redundant mass shifts, all features in the gaining and losing datasets were input into Optimus along with their GNPS IDs, which allowed Optimus-quantified features to be mapped back to the GNPS features and mass shift network pairs.  #@NEW_LINE#@#  Three feature abundance datasets were generated using Optimus: (i) the abundances of only the features involved in redundant mass shifts that were present in all files/holobionts, (ii) the abundances of only the features involved in redundant mass shifts that were present in each holobiont type (i.e., each group was analyzed in separate batches and then combined), and (iii) the abundances of all molecules (i.e., molecules involved in redundant mass shifts and molecules not involved).  #@NEW_LINE#@#  The data in (iii) were used to normalize the abundance data collected in (i) and (ii) by dividing the abundance of each molecule by the sum of the abundance of all molecules in the sample, as follows:  #@NEW_LINE#@#  
The data in (i) represented only the molecules present in all holobionts to assess whether different holobiont types exhibit unique mass shift patterns among a pool of molecules that are present/shared across all holobionts.  #@NEW_LINE#@#  The data in (ii) allow for mass shifts among features found in all holobionts and features that are only found in one or a few holobionts.  #@NEW_LINE#@#  Among only the molecules found in all holobionts (i), MeMSChem profiling isolated 512 molecular features involved in redundant mass shifts.  #@NEW_LINE#@#  Among all molecules in the entire dataset (ii), MeMSChem profiling isolated 728 molecular features involved in redundant mass shifts.  #@NEW_LINE#@#  
The feature abundances quantified by Optimus were mapped back to their respective GNPS features.  #@NEW_LINE#@#  Abundance of features identified in blanks were not removed, due to the fact that Optimus identifies the abundance of all features in all samples (i.e., the number of features found in blanks can be artificially elevated).  #@NEW_LINE#@#  Three forms of MeMSChem mass shift data were generated, as described in Results: (i) the number of times each mass shift was observed in each sample (counts data); (ii) the summed abundances of all molecules exhibiting each mass shift in a sample (summed abundances data); and (iii) the difference in abundances of each network pair (abundance of the more massive molecule  abundance of the less massive molecule) for each mass shift, summed by mass shift (differences in abundances data).  #@NEW_LINE#@#  All data are presented in Dataset S1 and the calculations were carried out as shown below:  #@NEW_LINE#@#  
The differences in abundances data provided a conservative estimate of molecular abundance changes, because taking the difference between feature abundances can lead to small values when both features have similar abundances and because summing negative and positive values draws the summed value toward zero.  #@NEW_LINE#@#  Therefore, the detection of directional feature abundances (positive or negative) serves as a robust indicator of systemic processes.  #@NEW_LINE#@#  

Data_Analysis_Using_Random_Forests  #@NEW_LINE#@#  
MeMSChem data (counts, summed abundances, differences in abundances) were analyzed using the ensemble machine learning algorithm Random Forests (17) with the R packages randomForest (28) and rfPermute (29).  #@NEW_LINE#@#  A Random Forests consists of an ensemble of decision trees for classification.  #@NEW_LINE#@#  Each tree in the ensemble is grown using a different bootstrap sample of the original data.  #@NEW_LINE#@#  In addition, when growing each tree, a small random subset of the candidate variables available for splitting at each node of the tree is selected (in the present analysis, four variables were selected).  #@NEW_LINE#@#  For highly correlated data, the set of randomly selected variables tends to decorrelate the trees and produces more diverse trees.  #@NEW_LINE#@#  For the final prediction, the class majority vote from all of the trees is used.  #@NEW_LINE#@#  Replicate samples of the seven holobiont types were used as classifiers with MeMSChem data as predictors in an rfPermute Random Forests model.  #@NEW_LINE#@#  The number of samples per classifier used in each tree was equilibrated due to unequal sample sizes between holobiont types and run for 10,000 trees.  #@NEW_LINE#@#  The equilibration was equal to half the sample size of the most sample-depauperate holobiont type.  #@NEW_LINE#@#  
The first two dimensions of the proximity matrix from Random Forests models that were run for each data type are projected in Fig 3.  #@NEW_LINE#@#  The proximity matrix is the measure of the closeness for each pair of observations in the data.  #@NEW_LINE#@#  After the Random Forests is grown, all of the data (both training and out-of-bag) are put down each tree.  #@NEW_LINE#@#  If two observations end up in the same terminal node, then their proximity is increased by one.  #@NEW_LINE#@#  At the end, the proximity is normalized by dividing by the number of trees.  #@NEW_LINE#@#  The out-of-bag error of the Random Forests model (OOB) reflects the extent to which the model placed samples back into their correct classes (i.e., holobiont types) and was referred to here with the general term model error.  #@NEW_LINE#@#  OOB was used as a model response metric in two ways.  #@NEW_LINE#@#  First, OOB was used to gain biologically relevant information across different types of mass shift data: counts, summed abundances, and differences in abundances.  #@NEW_LINE#@#  For example, differences among holobiont types based on the counts data may be less than that in the mass shift abundance data, which would be reflected in high and low OOB values, respectively.  #@NEW_LINE#@#  Second, the Random Forests class error and confusion matrix, reflecting the models ability to classify each holobiont type and the classifiers into which samples were placed, were used to assess how similar or distinct each holobiont type was from every other.  #@NEW_LINE#@#  

Random_Forests_Permutation_Tests  #@NEW_LINE#@#  
Permutation tests were used to determine how well the MeMSChem data differentiated the seven holobiont types.  #@NEW_LINE#@#  In these tests, the model error was used to measure model accuracy based on correctly classifying holobionts.  #@NEW_LINE#@#  To test how well the samples were classified when binned by counts, summed abundances, or differences in abundances, the Random Forests model error of the actual data was compared with the model error of 1,000 permutations of the data in which pairs were randomly binned while keeping the original proportions consistent (Dataset S2).  #@NEW_LINE#@#  The ability of the actual data to differentiate the seven holobiont types was then determined based upon the quantile into which it fell in the distribution of model errors in the randomly generated datasets.  #@NEW_LINE#@#  

Identifying_the_Mass_Shifts_That_Best_Differentiate_Holobiont_Types  #@NEW_LINE#@#  
The extent to which each redundant mass shift aids the Random Forests model in correctly assigning samples by holobiont type was evaluated across all holobionts based on the mean decrease accuracy score and feature importance score (for each holobiont type).  #@NEW_LINE#@#  Implementation of the rfPermute package in R (29) generated statistical P values for each mean decrease accuracy/feature importance score by randomly permuting the response variable and comparing the observed importance scores with the null distribution from the permutations.  #@NEW_LINE#@#  These comparisons were run based on various groupings of holobiont types to determine which mass shifts best differentiated, for example, all corals vs. all noncorals, coral genera from each other, and noncoral holobionts from each other.  #@NEW_LINE#@#  

Data_Accessibility__Processing_Sources__and_Scripts  #@NEW_LINE#@#  
All LC-MS/MS data can be found on the Mass spectrometry Interactive Virtual Environment (MassIVE) at https://massive.ucsd.edu/ProteoSAFe/static/massive.jsp with accession no.  #@NEW_LINE#@#  MSV000078598.  #@NEW_LINE#@#  Molecular networking was performed using the online GNPS platform [gnps.ucsd.edu/ProteoSAFe/static/gnps-splash.jsp (5)].  #@NEW_LINE#@#  The results of the network analysis with a cosine score of 0.6 can be found at https://gnps.ucsd.edu/ProteoSAFe/status.jsp?task=faaf7ea1ff8c4942afcd819b621d871e, while the analysis at a cosine score of 0.7 can be found at gnps.ucsd.edu//ProteoSAFe/status.jsp?task=06f164e107404b239ea2f04f710f8c40.  #@NEW_LINE#@#  MS features were quantified using Optimus (https://github.com/MolecularCartography/Optimus) in KNIME 3.2.0 (https://www.knime.org).  #@NEW_LINE#@#  Identifying redundant mass shifts was carried out in Microsoft Excel.  #@NEW_LINE#@#  The R code used for the rfPermute data analyses can be found in Dataset S2.  #@NEW_LINE#@#  


Discussion  #@NEW_LINE#@#  
MeMSChem profiling provides an approach to identify mass shifts between related molecules and annotate them to known chemical groups in complex metabolomes.  #@NEW_LINE#@#  Seven coral reef holobiont types were well-resolved by MeMSChem profiling.  #@NEW_LINE#@#  Even among molecular features detected in all holobionts, mass shift profiles differed among holobiont types, suggesting that each type of holobiont is modifying the same molecules in different ways.  #@NEW_LINE#@#  The chemical differences between holobionts was much more apparent when all molecules were considered (i.e., molecules only produced by certain holobionts were also incorporated), suggesting that disparate mass shift patterns between holobionts play a role in generating molecular diversity in this ecosystem.  #@NEW_LINE#@#  Shifts in the abundance of molecules exhibiting each mass shift better resolved holobiont types than the number of times each mass shift was detected.  #@NEW_LINE#@#  Together, these findings suggest that holobionts differ more in their patterns of molecular abundance changes (akin to gene expression) than in the diversity of mass shifts they can carry out (akin to genomic diversity).  #@NEW_LINE#@#  
Mass_Shifts_Associated_with_Holobionts_Reflect_Differences_in_Molecular_Diversity  #@NEW_LINE#@#  
By focusing on the differences in mass shift profiles between related molecules, MeMSChem profiling expands metabolomic analysis beyond molecular matches in reference libraries to systemic insights into holobiont biochemistry.  #@NEW_LINE#@#  If annotated mass shifts reflect single types or classes of molecular modifications catalyzed by enzymes, then disparate mass shift patterns among holobionts may arise for multiple reasons.  #@NEW_LINE#@#  Holobionts for which the hosts have large genomic differences, such as stony corals and turf algae, may merely possess different biochemical pathways.  #@NEW_LINE#@#  Among closely related holobiont types such as the three stony coral genera, the distinct patterns of molecular relatedness may arise from differential expression of shared genes.  #@NEW_LINE#@#  However, the largest disparity among coral holobionts was found by including the mass shifts of molecules that are unique to each holobiont.  #@NEW_LINE#@#  This suggests that the mass shifts of holobiont-specific molecules largely generate each coral holobionts unique biochemical profile despite the high degree of taxonomic relatedness among these corals.  #@NEW_LINE#@#  
The mass shifts that differed among holobiont types included differences putatively assigned to single- and double-bonded carbon and oxygen, likely among phospholipids and their derivatives based upon the molecules identified in this dataset previously (12) and in the current analyses.  #@NEW_LINE#@#  These data show the expected lower saturation state of corals relative to algae (19, 20) based on the mass shift of m/z 2.016 putatively assigned to H2.  #@NEW_LINE#@#  Greater fatty acid saturation flexibility can mitigate the damage of elevated temperatures that lead to bleaching in corals (21), suggesting that corals benefit from a higher degree of saturation flexibility and homeoviscous adaptation potential relative to the noncorals studied here.  #@NEW_LINE#@#  While desaturations in coral molecules generate double bonds between carbons, the shift toward gaining H2O in coral samples suggests these double bonds may be replaced by hydroxyl groups, either directly or through shifts in the relative abundances of molecules.  #@NEW_LINE#@#  Hydration of phospholipids can lead to conformational changes that alter membrane surface potential and signaling activity (22), suggesting that the higher abundance of hydroxyl groups in corals reflects systemic changes in cellcell interactions and cellular signaling pathways.  #@NEW_LINE#@#  

Applications_of_MeMSChem_Profiling  #@NEW_LINE#@#  
MeMSChem profiling offers a way to analyze existing LC-MS/MS datasets and provides an approach for identifying system-wide changes in small molecules across metabolomes.  #@NEW_LINE#@#  Here we analyzed a dataset collected from one of the most remote places in the world.  #@NEW_LINE#@#  Other researchers may have LC-MS/MS datasets that, like this dataset, cannot be resampled or recreated.  #@NEW_LINE#@#  Therefore, offering a way to gain information in silico is an attractive proposition for many working with untargeted metabolomic data.  #@NEW_LINE#@#  
While MeMSChem profiling was applied here to uncover similarities and differences among types of holobionts, it opens doors to answering many more questions.  #@NEW_LINE#@#  Rather than comparing known groups, MeMSChem profiling may be used to uncover clusters in seemingly homogeneous populations (e.g., individuals of a coral species in a common environment, human patients suffering from the same disease, cohorts of offspring growing in a shared location).  #@NEW_LINE#@#  Known mass shifts can also be searched for and quantified, which may be particularly useful when looking for a ubiquitous process such as antioxidant activity.  #@NEW_LINE#@#  
If molecules of interest are identified, the mass shifts around them may be used to detect putative sites of known modifications or previously unidentified biochemistries.  #@NEW_LINE#@#  Annotated and unknown mass shifts will require further verification with targeted analyses, such as spiking samples with authentic standards, networking, and examining the mass shifts associated with these standards.  #@NEW_LINE#@#  Once putative modifications are identified, genetics and molecular biology approaches can be used to confirm or identify the responsible enzyme(s).  #@NEW_LINE#@#  Such an approach may be particularly useful for tracking molecular changes in time-series samples, a primary need for clinicians (23).  #@NEW_LINE#@#  Future applications of MeMSChem profiling may also employ a more precise binning approach, taking into account the smaller relative variance at higher masses, changes in MS accuracy across parent masses, and precursor differences.  #@NEW_LINE#@#  Through this process, the continued application of MeMSChem profiling and the data it generates will produce a wealth of previously uncaptured information from data-rich untargeted metabolomic datasets.  #@NEW_LINE#@#  


Conclusions  #@NEW_LINE#@#  
Untargeted metabolomics continues to grow as a tool to examine the complex physiologies of life on Earth.  #@NEW_LINE#@#  We applied an approach that analyzes untargeted metabolomic data based on the chemical relationships between molecules.  #@NEW_LINE#@#  An analysis of seven coral reef holobionts demonstrated that the relationships between molecules are diverse and distinct between holobiont types.  #@NEW_LINE#@#  That different types of holobionts had unique MeMSChem profiles despite high genomic similarity suggests that each possesses physiological capabilities that are not easily identified through traditional genomic approaches.  #@NEW_LINE#@#  The distinct molecular repertoires identified in each holobiont, coupled with the wide diversity of holobiont types on coral reefs, offer insights into why this ecosystem is an abundant source of chemical diversity.  #@NEW_LINE#@#  

Materials_and_Methods  #@NEW_LINE#@#  
LC-MS_MS_Data_Collection_and_Molecular_Networking  #@NEW_LINE#@#  
Samples of seven types of holobionts (hosts and associated viral and microbial communities) including corals, algae, and a fungal mat were extracted in 70% methanol and analyzed with LC-MS/MS [as described in Quinn et al.  #@NEW_LINE#@#  (12); see SI Materials and Methods for data acquisition details].  #@NEW_LINE#@#  Files were submitted for molecular network analysis using the online workflow in GNPS (5) (Fig S1), which compares spectral fragmentation patterns and networks-related molecules (Fig S1).  #@NEW_LINE#@#  Molecular spectra were also compared against reference libraries of known molecules in GNPS.  #@NEW_LINE#@#  Details of the networking parameters can be found in SI Materials and Methods.  #@NEW_LINE#@#  

Identifying_Aggregations_of_Mass_Shifts_in_Network_Pairs  #@NEW_LINE#@#  
Across all pairs, the difference in mass between two networked molecular features (referred to as network pair mass shifts) was searched for aggregations around precise masses.  #@NEW_LINE#@#  Criteria for identifying aggregations (i.e., redundancies) were established using the similar masses of CO and C2H4 (m/z 27.995 and m/z 28.031, respectively; Fig S6; see SI Materials and Methods for details).  #@NEW_LINE#@#  The network pairs involved in aggregations were binned by mass shift and counted per sample (Counts dataset in Dataset S1).  #@NEW_LINE#@#  All molecular features involved in redundant mass shifts were then quantified using the Optimus workflow (https://github.com/MolecularCartography/Optimus).  #@NEW_LINE#@#  Optimus was used to quantify features involved in redundant mass shifts that were present in all files/holobionts, features involved in redundant mass shifts that were present in each holobiont type, and all molecular features, including those that were not involved in redundant mass shifts (for normalization of the two former datasets).  #@NEW_LINE#@#  Molecular abundance data were then used to quantify the molecules exhibiting each mass shift and to quantify the prevailing direction of each mass shift (gaining or losing) in each sample (Results and SI Materials and Methods for more details).  #@NEW_LINE#@#  

Data_Analysis_Using_Random_Forests  #@NEW_LINE#@#  
MeMSChem data were analyzed using the ensemble machine learning algorithm Random Forests (17).  #@NEW_LINE#@#  The seven holobiont types were used as classifiers, and MeMSChem data were used as predictors.  #@NEW_LINE#@#  The out-of-bag error (referred to as a model error) indicated how well each holobiont type was resolved by the Random Forests model.  #@NEW_LINE#@#  Permutation tests were used to determine how well the MeMSChem data differentiated the seven holobiont types.  #@NEW_LINE#@#  These tests were carried out by comparing the model error of the actual data with a distribution of model errors generated from 1,000 randomizations of the data (SI Materials and Methods for more details).  #@NEW_LINE#@#  The relative importance of each mass shift in differentiating between holobiont types was determined using the Random Forests mean decrease accuracy score and feature importance score (for each holobiont type).  #@NEW_LINE#@#  


Acknowledgments  #@NEW_LINE#@#  
This work was supported by an NSF Partnerships for International Research and Education Grant (1243541; to F.L.R.)  #@NEW_LINE#@#  and the Gordon and Betty Moore Foundation (GBMF-3781; to F.L.R.).  #@NEW_LINE#@#  This work was also supported by the NIH through Grant P41 GM103484 and an NIH grant on the reuse of metabolomic data (R03 CA211211).  #@NEW_LINE#@#  The European Unions Horizon 2020 Research and Innovation Programme further supported this work under Grant Agreement 634402 (to T.A.  #@NEW_LINE#@#  and I.P.).  #@NEW_LINE#@#  We thank the Deutsche Forschungsgemeinschaft for supporting this work with a postdoctoral research fellowship to D.P.  #@NEW_LINE#@#  (Grant PE 2600/1-1).  #@NEW_LINE#@#  

Footnotes  #@NEW_LINE#@#  

This is an open access article distributed under the PNAS license.  #@NEW_LINE#@#  

