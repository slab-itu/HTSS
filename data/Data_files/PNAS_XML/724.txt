article id="http://dx.doi.org/10.1073/pnas.1704553114"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Modeling gene regulation from paired expression and chromatin accessibility data  #@NEW_LINE#@#  

Significance  #@NEW_LINE#@#  
Chromatin plays a critical role in the regulation of gene expression.  #@NEW_LINE#@#  Interactions among chromatin regulators, sequence-specific transcription factors, and cis-regulatory sequence elements are the main driving forces shaping context-specific chromatin structure and gene expression.  #@NEW_LINE#@#  However, because of the large number of such interactions, direct data on them are often missing in most cellular contexts.  #@NEW_LINE#@#  The purpose of the present work is to show that, by modeling matched expression and accessibility data across diverse cellular contexts, it is possible to recover a significant portion of the information in the missing data on binding locations and chromatin states and to achieve accurate inference of gene regulatory relations.  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
The rapid increase of genome-wide datasets on gene expression, chromatin states, and transcription factor (TF) binding locations offers an exciting opportunity to interpret the information encoded in genomes and epigenomes.  #@NEW_LINE#@#  This task can be challenging as it requires joint modeling of context-specific activation of cis-regulatory elements (REs) and the effects on transcription of associated regulatory factors.  #@NEW_LINE#@#  To meet this challenge, we propose a statistical approach based on paired expression and chromatin accessibility (PECA) data across diverse cellular contexts.  #@NEW_LINE#@#  In our approach, we model (i) the localization to REs of chromatin regulators (CRs) based on their interaction with sequence-specific TFs, (ii) the activation of REs due to CRs that are localized to them, and (iii) the effect of TFs bound to activated REs on the transcription of target genes (TGs).  #@NEW_LINE#@#  The transcriptional regulatory network inferred by PECA provides a detailed view of how trans- and cis-regulatory elements work together to affect gene expression in a context-specific manner.  #@NEW_LINE#@#  We illustrate the feasibility of this approach by analyzing paired expression and accessibility data from the mouse Encyclopedia of DNA Elements (ENCODE) and explore various applications of the resulting model.  #@NEW_LINE#@#  

Genome-wide data for gene-regulatory inference.  #@NEW_LINE#@#  Each row represents a particular cellular context under which multiple types of genome-wide data may be available.  #@NEW_LINE#@#  In this paper we illustrate our method by analyzing data from 25 contexts studied in the mouse ENCODE project covering a variety of mouse cell types and developmental stages.  #@NEW_LINE#@#  Expression data (from RNA-seq, red boxes) and chromatin accessibility data (from DNase-seq or ATAC-seq, blue boxes) are available for each context, but most of the location data (from ChIP-seq data, green boxes) for transcriptional regulators are missing.  #@NEW_LINE#@#  We expect that the number of contexts (i.e., number of rows) with expression and accessibility data will increase rapidly in the future, but corresponding location data will be sparse; i.e., gray boxes indicating missing data will remain numerous as the number of rows in the table grows.  #@NEW_LINE#@#  
Approach  #@NEW_LINE#@#  
We assume that a good genome annotation is available that contains the coordinates of all transcriptional units (genes) and most regulatory elements in the genome.  #@NEW_LINE#@#  In this paper, a RE is defined as a short region in the chromosome, typically a few hundred base pairs in size, on which sequence-specific TFs and other related proteins may assemble to exert control on the transcription of nearby genes.  #@NEW_LINE#@#  During the past decade, large-scale projects such as ENCODE have mapped more than 100,000 REs in the genomes of humans and mice.  #@NEW_LINE#@#  Although this set of REs (Methods, Definition of cis-Regulatory Elements) is still incomplete, especially for cellular contexts far from those analyzed in ENCODE, we do not further study the annotation of REs in this work.  #@NEW_LINE#@#  Instead, our goal is to infer, from the observed expression and accessibility data in any cellular context, how each known RE may interact with relevant transcriptional regulators to affect the expression of its target genes.  #@NEW_LINE#@#  
Fig 1 summarizes the types of data to be analyzed or incorporated in our model of gene regulation.  #@NEW_LINE#@#  Context-dependent data, such as those on gene expression, chromatin accessibility, and TF-binding location, can show significant variation across cellular contexts, for example, across different cell types or across different treatments on the same cell type.  #@NEW_LINE#@#  There are hundreds of assays measuring different types of context-dependent data.  #@NEW_LINE#@#  In this paper we focus on gene expression and chromatin accessibility.  #@NEW_LINE#@#  These two types of data are already available for many contexts and respectively provide strong information on the result and the mechanism of regulation.  #@NEW_LINE#@#  For example, Fig S1 lists the 25 cellular contexts for which matched expression and accessibility data are available from the mouse ENCODE project, when matching is done at the sample level, and Fig S2 lists the 56 cellular contexts for which matched expression and accessibility data are available from the mouse ENCODE project, when matching is done at the cell type level.  #@NEW_LINE#@#  Most of the results below are based on the model trained on the sample-matched data.  #@NEW_LINE#@#  
Our analytical approach for learning from these data is to model the distribution of the expression of target genes (TGs) conditional on the accessibility of regulatory elements and the expression of TFs and chromatin regulators (CRs).  #@NEW_LINE#@#  Note that by a target gene we mean a gene that is not a TF or a CR.  #@NEW_LINE#@#  Our model, depicted in Fig 2, has three components designed to model, respectively, (i) control of target gene expression, (ii) activity status of the regulatory element, and (iii) recruitment of the chromatin regulator to the regulatory element.  #@NEW_LINE#@#  Definitions of the variables in Fig 2 are given in Table 1.  #@NEW_LINE#@#  
Expression_of_a_TG  #@NEW_LINE#@#  
We assume that the rate of transcription of a TG in a cellular context is affected by TFs bound to regulatory elements that are active in that cellular context.  #@NEW_LINE#@#  For each RE we construct a variable (parenthesized term in Eq.  #@NEW_LINE#@#  3 of Fig 2) that represents the combined effect of TFs that are expressed in that context and have significant motif matches on that RE.  #@NEW_LINE#@#  TG expression is modeled by a regression with these variables as potential predictors.  #@NEW_LINE#@#  However, only active REs associated with a TG will be included in the regression model for that TG (Fig 2, Eq.  #@NEW_LINE#@#  3).  #@NEW_LINE#@#  The association of RE to TG was done before model building, based on the distance between them and the degree of correlation between the accessibility of the RE with promoter accessibility and expression of the TG (Methods).  #@NEW_LINE#@#  

Activity_Status_of_RE  #@NEW_LINE#@#  
The activity status of a RE (say the ith RE) is represented by a context-dependent binary variable Zi, with Zi = 1 indicating that the ith RE is in an active state.  #@NEW_LINE#@#  Testing whether a RE is active in a cellular context, say by editing the RE in a cell line, is time consuming experimentally.  #@NEW_LINE#@#  As an alternative, genome-wide inference of active REs is usually done based on ChIP-seq signals for selected chromatin regulators (e.g., P300), histone modification marks (e.g., H3K4me3, H3K27ac) (10), and local methylation signal (11).  #@NEW_LINE#@#  Thus, the knowledge of which CRs have been recruited to a RE is informative on the activity status of that RE.  #@NEW_LINE#@#  To incorporate this into our model, we denote the recruitment status of a CR to a RE by a binary variable C, i.e., Ci,j = 1 indicates that the jth CR has been recruited to the ith RE.  #@NEW_LINE#@#  These variables are used together with the expression of CRs and the accessibility of the RE to define predictive variables in our model for the activity status of the RE (Fig 2, Eq.  #@NEW_LINE#@#  2).  #@NEW_LINE#@#  

Recruitment_of_the_CR_to_the_RE  #@NEW_LINE#@#  
Generally CRs do not have sequence specificity.  #@NEW_LINE#@#  We assume a CR is likely to be recruited to a RE if the RE is open and is bound by TFs that have protein interaction propensity with the CR.  #@NEW_LINE#@#  For each pair of CR and RE, we consider any TF that (i) is a protein interaction partner with the CR and (ii) has significant motif match on the RE and use it to construct a predictor variable for the modeling of the recruitment status of the CR on the RE.  #@NEW_LINE#@#  This predictor variable is defined as the geometric mean of the openness of the RE, the binding potential of the TF to the RE, the expression of the TF, and the expression specificity score of the TF.  #@NEW_LINE#@#  The specificity score (denoted as TFS), defined as geometric mean of maximum TF expression and max/(min + 0.5) where max and min are, respectively, maximum and minimum expression over a panel of cellular contexts, measures the tissue specificity of the expression of the TF.  #@NEW_LINE#@#  Including it in the definition of the predictor variable has the desirable effect of down-weighting any TF whose expression is nonvarying across cellular contexts.  #@NEW_LINE#@#  The resulting model for CR recruitment is given in Eq.  #@NEW_LINE#@#  1 of Fig 2.  #@NEW_LINE#@#  
To infer the unknown parameters ,,, and latent variables (C, Z) based on the observed expression data (TG, TF, CR) and accessibility data (O), we consider the conditional density of TG given TF, CR, and O:P(TG|TF,CR,O)=C,ZP(C|TF,O)P(Z|CR,C,O)P(TG|TF,Z)=C,Z(ijP(Ci,j|TF,Oi))(iP(Zi|CR,Ci,Oi))×(lP(TGl|TF,Z)).The term P(Ci,j|TF,Oi) represents the conditional density of the recruitment status of the jth CRs on the ith RE, as specified in Eq.  #@NEW_LINE#@#  1 of Fig 2.  #@NEW_LINE#@#  Similarly the terms P(Zi|CR,Ci,Oi) and P(TGl|TF,Z) are specified by Eqs.  #@NEW_LINE#@#  2 and 3 of Fig 2 (Methods for details).  #@NEW_LINE#@#  Note that these terms involve different components of the parameter vector:  appears in the first term,  appears in the second term, and (, ) appears in the third term.  #@NEW_LINE#@#  This conditional experiment (TG|TF, CR, O) provides a valid basis for the inference of the unknown parameters ,,, and latent variables (C, Z).  #@NEW_LINE#@#  To induce sparsity, we use Laplacian priors for the parameters  and .  #@NEW_LINE#@#  We use an iterated conditional modes algorithm for this inference.  #@NEW_LINE#@#  The resulting model and inference methodology is called paired expression and chromatin accessibility (PECA) modeling (Methods for details of PECA).  #@NEW_LINE#@#  
Note that in the above analysis, the response variables TG include only the expression for non-TFs and non-CRs.  #@NEW_LINE#@#  Thus, this initial analysis provides inference for only those parameters that correspond to non-TF REs.  #@NEW_LINE#@#  TF-associated REs, namely those REs whose closest associated target gene is a TF or a CR, were excluded in the initial analysis.  #@NEW_LINE#@#  The inference of parameters specific to these TF-associated REs is accomplished by a second-stage analysis (Methods for details).  #@NEW_LINE#@#  Briefly, fixing the values i learned from the initial analysis, we infer the , , and  and those is corresponding to TF-associated REs based the model in Fig 2, with the response variables TG replaced by TF and CR in Eq.  #@NEW_LINE#@#  3 and with any parameter and hidden variables already learned from the initial analysis regarded as known.  #@NEW_LINE#@#  
To test feasibility of this approach, we constructed a training set consisting 25 sample-matched pairs of expression and accessibility data from the mouse ENCODE project.  #@NEW_LINE#@#  Based on these data, we learn the parameters of the model using the above procedure.  #@NEW_LINE#@#  Evaluation and applications of the resulting model are discussed in Results below.  #@NEW_LINE#@#  
As seen in Table 1 and Fig 2, a large amount of noncontext-dependent data have been incorporated into our model.  #@NEW_LINE#@#  These include the locations of REs in the genome, protein interactions between CRs and TFs, and motif-matching strengths of TFs on REs.  #@NEW_LINE#@#  Although most of these data are also derived from high-throughput experiments (Methods, Data Collection), they reflect propensities of interactions and have interpretations largely independent of cellular context.  #@NEW_LINE#@#  For example, if a TF and CR pair has been shown to interact in yeast two-hybrid experiments, then they are likely to have interacting domains that would allow them to interact if both are expressed.  #@NEW_LINE#@#  Likewise, if a RE contains sites matching strongly to the motif of a TF, then we would expect TF binding if the TF is expressed and the RE is accessible.  #@NEW_LINE#@#  The incorporation of these noncontext-dependent data into our model has allowed us to greatly reduce the complexity of the model.  #@NEW_LINE#@#  The caveat is that knowledge of such proteinprotein interactions and proteinDNA interactions is currently incomplete and this may cause modeling bias.  #@NEW_LINE#@#  The validation results reported below show that despite this, our method is already useful for many types of inferences and predictions.  #@NEW_LINE#@#  We expect that the bias associated with the use of noncontext-dependent data will be further minimized as these data become more complete in the future.  #@NEW_LINE#@#  


Results  #@NEW_LINE#@#  
Inference_of_the_Recruitment_Status_of_Chromatin_Regulators  #@NEW_LINE#@#  
To assess whether the models can be used to infer CR recruitment status, we first consider a cell line (MEL) within the training set for which ChIP-seq data for the CR Ep300 are available.  #@NEW_LINE#@#  The ChIP-seq data are used to define ground truths for the recruitment status Ci,js of Ep300 to the REs.  #@NEW_LINE#@#  Using Eq.  #@NEW_LINE#@#  1 of Fig 2 with parameters learned from training data, we can infer Ep300 recruitment status conditional on the expression of TFs and CRs in the MEL context (Methods).  #@NEW_LINE#@#  Fig 3A shows the receiver operating characteristic (ROC) curve for our predictions, where each point on the curve corresponds to a different cutoff value for P(Ci,j = 1|TF, O).  #@NEW_LINE#@#  As a comparison, we also show the ROC curve for the default prediction based on thresholding the accessibility of the RE.  #@NEW_LINE#@#  The curve shows that prediction based on our model is significantly better than that based on accessibility alone.  #@NEW_LINE#@#  Superiority of the PECA approach is also demonstrated in comparisons with several other methods based on various ways of using information on CRTF interactions data, TF-motif occurrences, etc.  #@NEW_LINE#@#  (Fig S3).  #@NEW_LINE#@#  
Next we ask whether our model has predictive power in a cellular context not covered by the training set.  #@NEW_LINE#@#  ChIP-seq datasets for nine CRs are available in mouse embryonic stem cells (mESCs), which are not part of the training set.  #@NEW_LINE#@#  We evaluate our predictions of the recruitment status of these nine CRs in mESCs by comparing them to ChIP-seqbased ground truths.  #@NEW_LINE#@#  Fig 3B shows the ROC curves of the prediction on these nine CRs.  #@NEW_LINE#@#  It is seen that very good performances [8093% area under the curve (AUC)] have been achieved for a diverse set of CRs, in a cellular context not covered by the training sets (Fig S4).  #@NEW_LINE#@#  The strong performance in out-sample prediction suggests that the PECA approach is capable of learning regulatory relations useful in understanding new cellular contexts.  #@NEW_LINE#@#  

Prediction_of_the_Activation_Status_of_Regulatory_Elements  #@NEW_LINE#@#  
A key aspect of the PECA model is the introduction of the latent variable zi to indicate whether the ith RE is active in a cellular context.  #@NEW_LINE#@#  Once the model has been trained, prediction on the activation status of a RE in a new cellular context can be made based on P(zi = 1|Oi, TF, CR), where Oi, TF, and CR are measured in the cellular context of interest.  #@NEW_LINE#@#  To validate this aspect of the model, we evaluate the predictions in several cellular contexts where annotation of active REs is available.  #@NEW_LINE#@#  Traditionally, the genome-wide mapping of active REs in a given cellular context is accomplished by examining multiple types of location data for CR binding or for chromatin modification.  #@NEW_LINE#@#  For example, ENCODE tissue-specific enhancers are defined by five types of ChIP-seq data: RNA polymerase II (polII), CCCTC-binding factor (CTCF), histone H3 lysine 4 trimethylation (H3K4me3), histone H3 lysine 4 monomethylation (H3K4me1), and H3 lysine 27 acetylation (H3K27ac) in each tissue (12).  #@NEW_LINE#@#  We examine a set of 34,844 REs that (i) are associated with 419 core TFs and (ii) overlap with an ENCODE active enhancer in at least one of the following seven cellular contexts: neuron (cerebellum, e14.5-brain, and olfactory bulb), liver (e14.5-liver, liver), intestine, kidney, lung, spleen, and thymus.  #@NEW_LINE#@#  The set of core TFs was studied in ref.  #@NEW_LINE#@#  13, and details of enhancer mapping by ENCODE on various tissues are given in ref.  #@NEW_LINE#@#  12.  #@NEW_LINE#@#  We choose to focus on these seven contexts because paired expression and chromatin accessibility data are available for them.  #@NEW_LINE#@#  Based on ENCODE annotation, we define a 34,888 by seven matrix of ground truth values for the indicator z of activation status, with each entry of the matrix corresponding to a different combination of RE and cellular context.  #@NEW_LINE#@#  For each cell in this matrix, we predict the value of z based on whether P(zi = 1|Oi, TF, CR) is larger than 1/2 or not.  #@NEW_LINE#@#  The comparison of our prediction to ENCODE annotation is given in Fig 4A.  #@NEW_LINE#@#  Of the 243,908 entries of the matrix, 59,005 should be active (z = 1) according to ENCODE annotation.  #@NEW_LINE#@#  PECA predicted 52,793 active entries, of which 28,711 are consistent with ENCODE annotation.  #@NEW_LINE#@#  This gives a sensitivity of 0.4866 and a precision of 0.5438.  #@NEW_LINE#@#  As a comparison, if we use accessibility as the basis for prediction (i.e., a RE is regarded as active if its openness level is more than twofold that of background), the sensitivity is 0.5370 and precision is 0.4300.  #@NEW_LINE#@#  Thus, PECA provides a large gain in precision at a slight cost of sensitivity.  #@NEW_LINE#@#  Fig 4B shows the full precision- recall curves.  #@NEW_LINE#@#  It is seen that PECA-based predictions achieve a considerably higher AUC than accessibility-based predictions.  #@NEW_LINE#@#  PECA-based prediction of active status of REs on each of the individual tissues are shown in Fig 4 C and D.  #@NEW_LINE#@#  
Based on consistency of each of the individual CRs binding status with the REs activity, our model also identifies the CRs most predictive for active enhancer.  #@NEW_LINE#@#  We list the top 10 CRs in predicting enhancer activity in Fig 4E.  #@NEW_LINE#@#  The top CRs are largely associated with histone acetylation, which is consistent with the fact that active enhancer is enriched in histone acetylation H3K27ac.  #@NEW_LINE#@#  We find the p300-CBP coactivator family (Ep300 and Crebbp) can predict enhancers; these two CRs contain a protein or histone acetyltransferase (PAT/HAT) domain and a bromodomain that binds acetylated lysines and is reported to play a major key role in the active enhancer (14).  #@NEW_LINE#@#  Histone deacetylase 1 and 2 (Hdac1 and Hdac2) (15) and BAF complex member Smarca4, which contain a bromodomain (16), also have good performance in predicting active enhancers.  #@NEW_LINE#@#  
In the above analysis we used tissue-specific active enhancer lists from ENCODE to define ground truths.  #@NEW_LINE#@#  Because those lists may be incomplete or may contain false positives, it is of interest to compare PECA-predicted active enhancers and ENCODE-predicted active enhancers to a set of enhancers from an independent source.  #@NEW_LINE#@#  Kasper et al.  #@NEW_LINE#@#  (17) defined active enhancers in mouse MEF by comparing CBP ChIP-seq data in wild type and CBP/p300 double-knockout data.  #@NEW_LINE#@#  Because there are no paired expression and accessibility data for MEF in mouse ENCODE, we analyzed the most similar cellular context (NIH 3T3) with paired data available and obtained PECA-predicted and ENCODE-predicted active enhancers in that context.  #@NEW_LINE#@#  We found that 1,455 of 8,947 (16.26%) PECA-predicted enhancers and 1,159 of 9,421 (12.30%) ENCODE-predicted enhancers are consistent with the active enhancer set in Kasper et al.  #@NEW_LINE#@#  (17) (Fig 4F).  #@NEW_LINE#@#  This result suggests that, in this cellular context, PECA analysis may identify active enhancers with an accuracy matching or exceeding that of ENCODE annotations.  #@NEW_LINE#@#  

Prediction_of_Gene_Expression  #@NEW_LINE#@#  
In our approach, we use a variable xi (defined as the parenthesized term in Eq.  #@NEW_LINE#@#  3 of Fig 2) to represent the integrated effect of TFs bound on the ith RE and model the expression of the target gene by a linear regression with predictors (zixi).  #@NEW_LINE#@#  To illustrate the importance of the activation status indicator zi, consider for example the regulation of Bhlhe40 by the circadian rhythm-associated TF, Clock.  #@NEW_LINE#@#  Although this regulatory relation is well known (18), Bhlhe40 and Clock expressions are not strongly correlated (R2 = 0.4247 in log scale, Fig 5A).  #@NEW_LINE#@#  In contrast, Bhlhe40 expression is strongly correlated (R2 = 0.8236 in log scale, Fig 5B) with the product of Clock expression and the activation status of the RE (chr6:108,658,100108,660,100), which is predicted to regulate Bhlhe40.  #@NEW_LINE#@#  
To assess this component of our model systematically, we generated paired expression and accessibility data in a new cellular context quite different from those in the training sets.  #@NEW_LINE#@#  Mouse ESC was induced to differentiate by treatment with retinoic acid (RA).  #@NEW_LINE#@#  After 6 d, samples are collected for RNA-seq and ATAC-seq (Methods).  #@NEW_LINE#@#  Based on the PECA model learned from training data, we predicted the expression of all genes based on the accessibility data and the TF and CR expression data in this context.  #@NEW_LINE#@#  As comparisons, we also performed (i) accessibility-based predictions, where the predictor variables are the degree of openness (Oi) of the REs associated with the target gene, and (ii) TF-bindingbased predictions, where the predictor variables are the integrated TF effect variable (xi) for the REs associated with the target gene (Fig 5 CE).  #@NEW_LINE#@#  The results show that PECA-based prediction is significantly more accurate (R2=0.47) than accessibility-based prediction (R2=0.35) or TF-bindingbased prediction (R2=0.34).  #@NEW_LINE#@#  

Extraction_of_Regulatory_Relations  #@NEW_LINE#@#  
Our model provides a means to extract regulatory relations among REs, CRs, TFs, and TGs.  #@NEW_LINE#@#  Given a TG, the TFs and active REs that correspond to the nonzero  and  are inferred to be regulators of this TG.  #@NEW_LINE#@#  To control the false discovery rate, we select highly active REs by requiring the posterior probability for z = 1 to be 0.9 or higher in at least one cellular context and use only these REs to extract the regulatory relations.  #@NEW_LINE#@#  Pooling all these regulatory relations together, we assemble a gene regulatory network consisting of four types of nodes (RE, CR, TF, and TG) and three types of edges (CR recruitment to RE, TF binding to RE, and RE regulation of TG).  #@NEW_LINE#@#  This network (Dataset S1) contains 18,463 TGs, 168,883 REs, 357 TFs, and 83 CRs.  #@NEW_LINE#@#  
This network contains a large number of TFTG relations (i.e., TF and TG connected through a RE) not detectable from expression data alone.  #@NEW_LINE#@#  To illustrate this, we examine 1,465 TFTG relations in our network that are supported by prior experimental data (19) and compute the Pearson correlation coefficient (PCC) between the TF and TG in our training set (Fig 6A).  #@NEW_LINE#@#  We found that for most of these pairs (68.26%), the TF and TG do not have highly correlated expressions (PCC less_than 0.3).  #@NEW_LINE#@#  This confirms the value of having RE accessibility in the model even if we are interested only in TFTG relations.  #@NEW_LINE#@#  
We identify cooperating TFTF pairs based on whether they share common targets and whether they are proteinprotein interaction partners (Methods).  #@NEW_LINE#@#  If two cooperating TFs regulate the same target gene but one binds to the promoter and the other to an enhancer, then this suggests a candidate proteinprotein interaction that may mediate DNA looping to facilitate enhancerpromoter cooperation.  #@NEW_LINE#@#  In this way, we detected 53 such TFTF pairs at a false discovery rate of 0.05.  #@NEW_LINE#@#  Indeed, some TFTF pairs detected this way, such as Jdp2-Atf2, E2f4-Brca1, Jun-Fos, Jund-Fos, Jun-Jdp2, and Yy1-Jund, have been reported to show chromatin looping structure (20).  #@NEW_LINE#@#  We checked our chromatin looping predictions against Hi-C data in mESC and cortex (12) (Methods for details of Hi-C validation) and found that they are highly consistent (TFTF pairs validated both in Hi-C and in the literature are shown in Fig 6B, and all of the 53 TFTF pairs results are in Dataset S2).  #@NEW_LINE#@#  For example, 108 of 190 loopings of Jdp2-Atf2 are validated.  #@NEW_LINE#@#  
We also examined CRCR cooperation.  #@NEW_LINE#@#  We depict the CRCR cooperation among six CR complexes including the BAF complex, TIP60 complex, NuRD complex, NuRF complex, PRC1, and PRC2 in Fig 6C.  #@NEW_LINE#@#  Results show that TIP60, NuRD, and PRC1 complexes tend to cooperate within complexes whereas the BAF complex, NuRF complex, and PRC2 complex tend to cooperate between complexes.  #@NEW_LINE#@#  Much of the CRCR cooperation is regulating target genes by binding to the same element.  #@NEW_LINE#@#  But we find that BAF complex member Actb and NuRD complex member Chd4 cooperate and tend to regulate the TG by using different elements that may result in chromatin looping.  #@NEW_LINE#@#  All of the CRCR pairs from different complexes that tend to regulate the TG by different REs are shown in Fig 6D.  #@NEW_LINE#@#  Actb and Chd4 regulate 3,877 TGs by different elements and 3,545 (91.44%) of them are validated by Hi-C data.  #@NEW_LINE#@#  This suggests that CRs from different complexes may lead to chromatin looping as well.  #@NEW_LINE#@#  

Inference_of_Context-Specific_Regulatory_Network  #@NEW_LINE#@#  
For any cellular context, a regulatory network may be inferred by selecting the REs predicted to be active in the cellular context of interest and connecting the CRs, specifically expressed TFs [fragment per kilobase million (FPKM)  greater than  10, TFS  greater than  10], and expressed TGs (FPKM  greater than  10) through regulatory relations involving these REs.  #@NEW_LINE#@#  The examination of this network may reveal details of the regulatory mechanism.  #@NEW_LINE#@#  For example, in the network specific to brain samples in our training set (Dataset S3), the target gene Snapc5 is regulated by two enhancers.  #@NEW_LINE#@#  One enhancer is regulated by TF Hbp1, and the other one is regulated by CR Ep300.  #@NEW_LINE#@#  Ep300 and Hbp1 are reported to have proteinprotein interaction and may mediate contact of the two enhancers, which is consistent with evidence from ChIA-PET data (20).  #@NEW_LINE#@#  
We can also infer the regulatory network in a new cellular context different from those used in training the model.  #@NEW_LINE#@#  To assess the utility of this approach, we apply the model learned from the training set to expression and accessibility data from the mESC differentiation sample (6 d after RA treatment).  #@NEW_LINE#@#  We infer the context-specific regulatory network by selecting active REs and specifically expressed TFs and expressed TGs in this context.  #@NEW_LINE#@#  For each of the 34 highly expressed TFs (FPKM  20) with a sufficient number (20) of downstream genes, we perform Gene Ontology (GO) enrichment analysis on these genes to gain insight on the role of the TF in this context (Dataset S4).  #@NEW_LINE#@#  Fig 7A presents the results for some of the TFs.  #@NEW_LINE#@#  It is seen that the targets of Ewsr1, Bhlhe22, Cux1, Hoxa5, Id4, and Jund are enriched for various neuronal associated functions, which is consistent with the fact that RA induces neuron differentiation.  #@NEW_LINE#@#  Fig 7B gives details for Ewsr1.  #@NEW_LINE#@#  The results suggest enrichment in axon genesis and neuron projection morphogenesis, which is consistent with the previous report that differentially expressed genes after Ewsr1/Fli1 knockdown are enriched in cell morphogenesis involved in differentiation and neuron projection morphogenesis (21).  #@NEW_LINE#@#  It is also interesting that cardiovascular development-related GO terms are highly enriched among the downstream genes of Sox4 and Mnt.  #@NEW_LINE#@#  The results for all TFs are given in Dataset S4.  #@NEW_LINE#@#  

Interpretation_of_Genetic_Variants_Relevant_to_Traits_and_Diseases  #@NEW_LINE#@#  
The regulatory model inferred from accessibility and expression data in diverse contexts may provide new tools for interpretation of genetic variants.  #@NEW_LINE#@#  We use this approach to examine QTL mapping results based on two mouse strains: A/J and C57BL/6J.  #@NEW_LINE#@#  There are a total of 17 long QTL regions ( greater than 0.5 Mb) mapped using these two strains (Bhr1, Bhr2, Bhr3, Char4, Hpi1, Hpi2, Aod1a, Vacq1, Nilac10, Dbm1, Dbm2, Ssrq1, Ssrq2, Ssrq8, Obrq13, Obrq14, and Obrq15).  #@NEW_LINE#@#  We focus on a subset of 7 QTL regions that have clearly relevant tissue contexts (Table 2).  #@NEW_LINE#@#  The sizes of these regions range from 3 Mb to 48 Mb.  #@NEW_LINE#@#  
We consider strain-specific SNPs (i.e., single-nucleotide variants with different alleles in A/J and C57BL/6J).  #@NEW_LINE#@#  Among the thousands of strain-specific SNPs located in the QTL regions, the majority of them ( greater than 99%) are in noncoding regions.  #@NEW_LINE#@#  To further prioritize these noncoding SNPs, we consider only the subset located on relevant motif-binding site on REs that are (i) active in the phenotype-related tissue context and (ii) regulating one or more expressed TGs (FPKM  greater than  5).  #@NEW_LINE#@#  Here a relevant motif means a motif associated with a TF that is inferred (by PECA analysis) to be using this RE in the phenotype-related tissue context.  #@NEW_LINE#@#  Table 2 presents the results of this analysis.  #@NEW_LINE#@#  It is seen that dozens of candidate causal loci are detected in each QTL region.  #@NEW_LINE#@#  
Some QTL regions, such as Hpi1, Hpi2, Vacq1, and Nilac10, have very few or even no deleterious SNPs [i.e., SNPs predicted to affect protein function by SIFT (22)].  #@NEW_LINE#@#  So on these QTL regions, SNPs from a noncoding region may play important roles.  #@NEW_LINE#@#  We examine two examples.  #@NEW_LINE#@#  


Discussion_and_Conclusions  #@NEW_LINE#@#  
In this paper, we propose a method, named PECA, to infer gene regulatory networks by jointly modeling paired gene expression and chromatin accessibility data.  #@NEW_LINE#@#  Building on the recent advances in identifying candidate REs (enhancers) in the genome, PECA tries to answer a number of questions on the regulatory roles of these elements.  #@NEW_LINE#@#  How is the REs activity spatiotemporally regulated by CRs?  #@NEW_LINE#@#  How do colocalized TFs and CRs on a RE regulate target genes and achieve context-specific gene expression?  #@NEW_LINE#@#  Answers to these questions are key to understanding the functions of the annotated REs and will enable effective interpretation of sequence variants that may be relevant to physiological traits and disease risks.  #@NEW_LINE#@#  We choose to focus on paired accessibility and expression data as such data are easy to measure and will be obtained in the near future for the majority of definable cell types in different tissues and developmental stages, as well as for many abnormal cell types arising from diseases.  #@NEW_LINE#@#  The utility and reliability of the model will increase rapidly as these data become available for more cellular states.  #@NEW_LINE#@#  

Methods  #@NEW_LINE#@#  
Data_Collection  #@NEW_LINE#@#  
We collected 25 bio-samplematched and 56 cell-typematched RNA-seq and DNase-seq data from the mouse ENCODE project.  #@NEW_LINE#@#  We used these data to train our PECA model (Figs.  #@NEW_LINE#@#  S1 and S2 and Dataset S5).  #@NEW_LINE#@#  Both human and mouse proteinprotein interaction data are from the BIOGRID database (https://thebiogrid.org).  #@NEW_LINE#@#  We collected 557 TFs motif data from JASPAR, TRANSFAC, UniPROBE, and Taipale.  #@NEW_LINE#@#  We also collected 120 CRs from GO annotation, which consist of 5 ATP-dependent chromatin-remodeling complexes (BAF complex, PBAF complex, NuRD complex, NuRF complex, and Tip60 complex), 2 chromatin-modifying complexes (polycomb complex and trithorax complex), and 3 chromatin-modifying enzyme families [K-demethylase family enzymes (Kdm), K-acetyltransferase family enzymes (Kat), and K-methyltransferase family enzymes (Kmt)] (Dataset S6).  #@NEW_LINE#@#  

Definition_of_cis-Regulatory_Elements  #@NEW_LINE#@#  
The promoter is defined as the 2-kb region upstream of the TGs transcription start site (TSS).  #@NEW_LINE#@#  Enhancers are obtained from the mouse ENCODE defined via five ChIP-seq datasets in 19 tissues and length is set to be 1 kb centered on the predictions in ref.  #@NEW_LINE#@#  12.  #@NEW_LINE#@#  This gives 931,427 enhancers in total.  #@NEW_LINE#@#  The annotated enhancers add up to 11% of the mouse genome and include more than 70% of conserved noncoding sequences (12).  #@NEW_LINE#@#  Overlapping enhancers regulating the same target gene are merged into one enhancer.  #@NEW_LINE#@#  The resulting 419,299 enhancers are used in our model training.  #@NEW_LINE#@#  

Statistical_Model_to_Define_Openness  #@NEW_LINE#@#  
We propose a score to quantify the openness (i.e., accessibility) for the cis-REs and make it comparable across different conditions.  #@NEW_LINE#@#  Given a certain region of length L, we treat this region as foreground and denote by X the count of reads in the region.  #@NEW_LINE#@#  To remove the sequencing depth effect, we choose a background region with length L0 and denote by Y the count of reads in this background window.  #@NEW_LINE#@#  The openness score is formally defined as the fold change of read numbers per base pair and can be simply calculated asO=(X+)/L(Y+)/L0,  #@NEW_LINE#@#  
where  is a pseudocount (the default value of  is 5 in our implementation).  #@NEW_LINE#@#  

EnhancerTarget_Prediction_via_Crossing_Tissue_Correlation  #@NEW_LINE#@#  
We obtain and pool enhancerTG associations from three sources: ENCODE annotations, inferred from ChIA-PET data, and inferred from accessibility correlations.  #@NEW_LINE#@#  Enhancertarget associations are available for 19 tissues from ENCODE.  #@NEW_LINE#@#  Associations based on ChIA-PET data are available for mESC, NPCs, and NSC (27).  #@NEW_LINE#@#  Additionally, enhancertarget associations are also inferred from accessibility and expression data by the method described below.  #@NEW_LINE#@#  
Given an enhancer, we first list all of the potential TGs within a certain distance (default is 1 million bp upstream or downstream from the TSS).  #@NEW_LINE#@#  Then, for each potential target gene in this list, we compute a conditional fold change of expression (CFC-e) to quantify the correlation across tissues between the expression of the gene and the accessibility of the RE, as follows.  #@NEW_LINE#@#  Given the REs openness X = [x1,xn], apply Jenks method (28) to divide the samples (denoted by G) into two groups Gh and Gl with high and low openness, respectively, and define CFC-e as the ratio of the mean expression in Gh to that of a comparison group Gm of the same size selected from G. Specifically, if the expression values of the target gene in the n tissues are Y = [y1,yn], thenCFC=1|Gh|kGhyk1|Gm|kGmyk,  #@NEW_LINE#@#  
where GmG, |Gm|=|Gh|, yi greater than yj,jGm, iG\Gm.  #@NEW_LINE#@#  We note that the REs target is specific for samples in Gh and this allows us to achieve tissue-specific enhancer target prediction.  #@NEW_LINE#@#  Jenks method is a way to threshold a set of values into two classes, where we minimize each classs average deviation from the class mean, while maximizing each classs deviation from the means of the other class.  #@NEW_LINE#@#  In our implementation, a small constant 0.05 is added to the denominator to avoid division by very small values.  #@NEW_LINE#@#  Similarly, using promoter openness, we also compute a conditional fold change of openness (CFC-o) to represent the correlation between enhancer accessibility and promoter accessibility.  #@NEW_LINE#@#  We pick out the RE and TG association by requiring both CFC-e and CFC-o to be larger than 2.  #@NEW_LINE#@#  In addition to the local correlation quantitated by CFC-e and CFC-o, we also adopt the PCC to assess the global correlation across conditions between RE and TG.  #@NEW_LINE#@#  Similarly we propose a PCC of openness (PCC-o) to represent the correlation between the REs accessibility and the genes promoter accessibility.  #@NEW_LINE#@#  We also compute a PCC of expression (PCC-e) to quantify the correlation across tissues between the expression of the gene and the accessibility of the RE.  #@NEW_LINE#@#  We pick out the RE and TG association by requiring both PCC-e and PCC-o to be larger than 0.5.  #@NEW_LINE#@#  
Finally we take the union of four sources of RE and gene associations: ENCODE annotations, inferred from ChIA-PET data, inferred from local accessibility correlations by CFC, and inferred from global accessibility correlations by PCC.  #@NEW_LINE#@#  We get 39,006 enhancerTG associations from ChIA-PET data, 395,031 from ENCODE, and 3,332,931 from our correlation-based method.  #@NEW_LINE#@#  This method improves the coverage about 10-fold.  #@NEW_LINE#@#  

TF_Localization_by_Motif_Scan  #@NEW_LINE#@#  
We collected 557 TF position weight matrix (PWM) matrices for the known motifs from widely used databases, including JASPAR, TRANSFAC, UniPROBE, and Taipale.  #@NEW_LINE#@#  We identified these TF binding sites by a whole-genome motif scan, using Homer with a P-value cutoff of 1.0e-4.  #@NEW_LINE#@#  

PECA_Model  #@NEW_LINE#@#  
We formally introduce the notations for variables in PECAs statistical model as follows:  #@NEW_LINE#@#  
Bi,k=mlog(Pvaluem).  #@NEW_LINE#@#  

TFTF_Cooperation_Network  #@NEW_LINE#@#  
Given two TFs, we count the number of coregulating TGs.  #@NEW_LINE#@#  By coregulating TG we mean one TF binds to the promoter and one binds to the enhancer of the TG.  #@NEW_LINE#@#  Then, we randomly generate 1,000 TFTG networks that have the same degree distribution as the original TFTG network.  #@NEW_LINE#@#  We count the number of coregulated TGs of the two TFs in the 1,000 random networks.  #@NEW_LINE#@#  Comparing the number of coregulated TGs with background distribution generated from the random networks, we get the significantly cooperating TFTF pairs by thresholding the P value at 0.05.  #@NEW_LINE#@#  We then overlap this network with the proteinprotein interaction (PPI) network and get the TFTF cooperation network.  #@NEW_LINE#@#  

Validation_of_Chromatin_Looping_by_Hi-C  #@NEW_LINE#@#  
We use the Hi-C data on mESC and cortex that have resolution 40 kb (dividing each chromosome into bins of size 40 kb).  #@NEW_LINE#@#  Only the regions associated with expressed genes (FPKM  greater than  10 on mESC and cortex) are considered in Hi-C validation.  #@NEW_LINE#@#  Given a chromosome and two regions (two bins) on this chromosome, a Hi-C score is denoted as I(A,B), where A and B are the bin indexes of the two regions.  #@NEW_LINE#@#  We define the interaction between A and B in Hi-C data if I(A,B) greater than max(I(A1,B),I(A+1,B),I(A,B1),I(A,B+1)).  #@NEW_LINE#@#  
Given an interacting TFTF pair may result in regionregion chromatin looping, we perform a permutation test to find whether they are significantly validated by Hi-C data or not.  #@NEW_LINE#@#  We randomly select a regionregion pair from the whole genome 1,000 times (same distance distribution with the original regionregion pairs) and then count the number of validated pairs in each permutation to generate the background distribution.  #@NEW_LINE#@#  Comparing the count of validated pairs with the background distribution, we calculate the P value of the Hi-C data validation.  #@NEW_LINE#@#  

Experimental_Design_of_Retinoic_Acid-Induced_mESC_Differentiation  #@NEW_LINE#@#  

Software_and_Data  #@NEW_LINE#@#  
PECA software and training data are available at web.stanford.edu/zduren/PECA/.  #@NEW_LINE#@#  Gene expression data and chromatin accessibility data of RA induction have been deposited in the GEO database under accession no.  #@NEW_LINE#@#  GSE98479.  #@NEW_LINE#@#  


ATAC-seq_PCR_Primer  #@NEW_LINE#@#  
Nextera Universal PCR primer:  #@NEW_LINE#@#  
Index 1:  #@NEW_LINE#@#  
Index 2:  #@NEW_LINE#@#  
Index 3:  #@NEW_LINE#@#  
Index 4:  #@NEW_LINE#@#  
Index 5:  #@NEW_LINE#@#  
Index 6:  #@NEW_LINE#@#  
Index 7:  #@NEW_LINE#@#  
Index 8:  #@NEW_LINE#@#  
Index 9:  #@NEW_LINE#@#  
Index 10:  #@NEW_LINE#@#  
Index 11:  #@NEW_LINE#@#  
Index 12:  #@NEW_LINE#@#  

NEBNext_Multiplex_Oligo_for_Illumina  #@NEW_LINE#@#  
NEBNext Universal PCR primer:  #@NEW_LINE#@#  
Index 1:  #@NEW_LINE#@#  
Index 2:  #@NEW_LINE#@#  
Index 3:  #@NEW_LINE#@#  
Index 4:  #@NEW_LINE#@#  
Index 5:  #@NEW_LINE#@#  
Index 6:  #@NEW_LINE#@#  
Index 7:  #@NEW_LINE#@#  
Index 8:  #@NEW_LINE#@#  
Index 9:  #@NEW_LINE#@#  
Index 10:  #@NEW_LINE#@#  
Index 11:  #@NEW_LINE#@#  
Index 12:  #@NEW_LINE#@#  

Acknowledgments  #@NEW_LINE#@#  
This study was supported by the Strategic Priority Research Program of the Chinese Academy of Sciences (XDB13000000), NIH Grants R01HG007834 and P50HG007735, and National Natural Science Foundation of China Grants 11422108, 61671444, 61621003, and 61573207.  #@NEW_LINE#@#  

Footnotes  #@NEW_LINE#@#  




