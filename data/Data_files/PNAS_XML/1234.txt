article id="http://dx.doi.org/10.1073/pnas.1716215115"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Green function of correlated genes in a minimal mechanical model of protein evolution  #@NEW_LINE#@#  

Significance  #@NEW_LINE#@#  
Many protein functions involve large-scale motion of their amino acids, while alignment of their sequences shows long-range correlations.  #@NEW_LINE#@#  This has motivated search for physical links between genetic and phenotypic collective behaviors.  #@NEW_LINE#@#  The major challenge is the complex nature of protein: nonrandom heteropolymers made of 20 species of amino acids that fold into a strongly coupled network.  #@NEW_LINE#@#  In light of this complexity, simplified models are useful.  #@NEW_LINE#@#  Our model describes protein in terms of the Green function, which directly links the gene to force propagation and collective dynamics in the protein.  #@NEW_LINE#@#  This allows for derivation of basic determinants of evolution, such as fitness landscape and epistasis, which are often hard to calculate.  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
The function of proteins arises from cooperative interactions and rearrangements of their amino acids, which exhibit large-scale dynamical modes.  #@NEW_LINE#@#  Long-range correlations have also been revealed in protein sequences, and this has motivated the search for physical links between the observed genetic and dynamic cooperativity.  #@NEW_LINE#@#  We outline here a simplified theory of protein, which relates sequence correlations to physical interactions and to the emergence of mechanical function.  #@NEW_LINE#@#  Our protein is modeled as a strongly coupled amino acid network with interactions and motions that are captured by the mechanical propagator, the Green function.  #@NEW_LINE#@#  The propagator describes how the gene determines the connectivity of the amino acids and thereby, the transmission of forces.  #@NEW_LINE#@#  Mutations introduce localized perturbations to the propagator that scatter the force field.  #@NEW_LINE#@#  The emergence of function is manifested by a topological transition when a band of such perturbations divides the protein into subdomains.  #@NEW_LINE#@#  We find that epistasisthe interaction among mutations in the geneis related to the nonlinearity of the Green function, which can be interpreted as a sum over multiple scattering paths.  #@NEW_LINE#@#  We apply this mechanical framework to simulations of protein evolution and observe long-range epistasis, which facilitates collective functional modes.  #@NEW_LINE#@#  

Protein as an evolving machine and propagation of mechanical forces.  #@NEW_LINE#@#  (A) Formation of a softer shear band (red) separating the protein into two rigid subdomains (light blue).  #@NEW_LINE#@#  When a ligand binds, the biochemical function involves a low-energy hinge-like or shear motion (arrows).  #@NEW_LINE#@#  (B) Shear band and large-scale motion in a real protein: the arrows show the displacement of all amino acids in human glucokinase when it binds glucose (Protein Data Bank ID codes 1v4s and 1v4t).  #@NEW_LINE#@#  The coloring shows a high-shear region (red) separating two low-shear domains that move as rigid bodies (shear calculated as in refs.  #@NEW_LINE#@#  21 and 36).  #@NEW_LINE#@#  (C) The mechanical model.  #@NEW_LINE#@#  The protein is made of two species of amino acids, polar (P; red) and hydrophobic (H; blue), with a sequence that is encoded in a gene.  #@NEW_LINE#@#  Each amino acid forms weak or strong bonds with its 12 near neighbors (Right) according to the interaction rule in the table (Left).  #@NEW_LINE#@#  (D) The protein is made of 10×20=200 amino acids with positions that are randomized from a regular triangular lattice.  #@NEW_LINE#@#  Strong bonds are shown as gray lines.  #@NEW_LINE#@#  Evolution begins from a random configuration (Left) and evolves by mutating one amino acid at each step, switching between H and P. The fitness is the mechanical response to a localized force probe (pinch) (2).  #@NEW_LINE#@#  After 103 mutations (Center; intermediate stage), the evolution reaches a solution (Right).  #@NEW_LINE#@#  The green arrows show the mechanical response: a hinge-like, low-energy motion with a shear band starting at the probe and traversing the protein, qualitatively similar to B. L, left; R, right.  #@NEW_LINE#@#  
Force propagation, mutations, and epistasis.  #@NEW_LINE#@#  (A) The Green function G measures the propagation of the mechanical signal, depicted as a diffraction wave, across the protein (blue) from the force source f (pinch) to the response site v. (B) A mutation Hi deflects the propagation of force.  #@NEW_LINE#@#  The effect of the mutation on the propagator G can be described as a series of multiple scattering paths (6).  #@NEW_LINE#@#  (C) The epistasis between two mutations, Hi and Hj, is equivalent to a series of multiple scattering paths (9).  #@NEW_LINE#@#  
Model__Protein_as_an_Evolving_Machine  #@NEW_LINE#@#  
The_Amino_Acid_Network_and_Its_Green_Function  #@NEW_LINE#@#  
We use a coarse-grained description in terms of an elastic network (2327, 39) with connectivity and interactions that are encoded in a gene (Fig 1 C and D).  #@NEW_LINE#@#  Similar vector elasticity models were considered in refs.  #@NEW_LINE#@#  35 and 36 (app.  #@NEW_LINE#@#  B3 therein).  #@NEW_LINE#@#  The protein is a chain of na=200 amino acids: ai (i=1,,na) folded into a 10×20 2D hexagonal lattice (d=2).  #@NEW_LINE#@#  We follow the HP model (73, 74) with its two species of amino acids, hydrophobic (ai=H) and polar (ai=P).  #@NEW_LINE#@#  The amino acid chain is encoded in a gene c, a sequence of 200 binary codons, where ci=1 encodes an H amino acid and ci=0 encodes a P amino acid.  #@NEW_LINE#@#  
We consider a constant fold, and therefore, any particular codon ci in the gene encodes an amino acid ai at a certain constant position ri in the protein.  #@NEW_LINE#@#  The positions ri are randomized to make the network amorphous.  #@NEW_LINE#@#  These nd=dna=400 dfs are stored in a vector r. Except the ones at the boundaries, every amino acid is connected by harmonic springs to z=12 nearest and next nearest neighbors.  #@NEW_LINE#@#  There are two flavors of bonds according to the chemical interaction, which is defined as an AND gate: a strong HH bond and weak HP and PP bonds.  #@NEW_LINE#@#  The strength of the bonds determines the mechanical response of the network to a displacement field u, when the amino acids are displaced as riri+ui.  #@NEW_LINE#@#  The response is captured by Hookes law that gives the force field f induced by a displacement field, f=H(c)u.  #@NEW_LINE#@#  The analogue of the spring constant is the Hamiltonian H(c), a nd×nd matrix, which records the connectivity of the network and the strength of the bonds.  #@NEW_LINE#@#  H(c) is a nonlinear function of the gene c, reflecting the amino acid interaction rules of Fig 1C (Eq.  #@NEW_LINE#@#  11, Materials and Methods).  #@NEW_LINE#@#  
Evolution searches for a protein that will respond by a prescribed large-scale motion to a given localized force f (pinch).  #@NEW_LINE#@#  In induced fit, for example, specific binding of a substrate should induce global deformation of an enzyme.  #@NEW_LINE#@#  The response u is determined by the Green function G (76):u=G(c)f.[1]G is the mechanical propagator that measures the transmission of signals from the force source f across the protein (Fig 2A).  #@NEW_LINE#@#  Eq.  #@NEW_LINE#@#  1 constitutes an explicit genotype-to-phenotype map from the genotype c to the mechanical phenotype u: cu(c)=G(c)f. This reflects the dual nature of the Green function G: in the phenotype space, it is the linear mechanical propagator that turns a force into motion, u=Gf, whereas it is also the nonlinear function that maps the gene into a propagator, cG(c).  #@NEW_LINE#@#  
When the protein is moved as a rigid body, the lengths of the bonds do not change, and the elastic energy cost vanishes.  #@NEW_LINE#@#  A 2D protein has n0=3 such zero modes (Galilean symmetries), two translations, and one rotation, and H is, therefore, always singular.  #@NEW_LINE#@#  Hence, Hookes law and [1] imply that G is the pseudoinverse of the Hamiltonian, G(c)=H(c)+ (78, 79), which amounts to inversion of H in the nonsingular subspace of the ndn0=397 nonzero modes (Materials and Methods).  #@NEW_LINE#@#  A related quantity is the resolvent, G()=(H)1, with poles at the energy levels of H, =k.  #@NEW_LINE#@#  
The fitness function rewards strong mechanical response to a localized probe (pinch in Fig 1D): a force dipole at two neighboring amino acids p and q on the left side of the protein (L in Fig 1D), fq=fp.  #@NEW_LINE#@#  The prescribed motion is specified by a displacement vector v, with a dipolar response, vq=vp, on the right side of the protein (R in Fig 1D).  #@NEW_LINE#@#  The protein is fitter if the pinch f produces a large deformation in the direction specified by v. To this end, we evolve the amino acid network to increase a fitness function F, which is the projection of the displacement u=Gf on the prescribed response v:F(c)=vu=vG(c)f.[2]Eq.  #@NEW_LINE#@#  2 defines the fitness landscape F(c).  #@NEW_LINE#@#  Here, we examine particular examples for a localized pinch f and prescribed response v, which drive the emergence of a hinge-like mode.  #@NEW_LINE#@#  This approach is general and can as well treat more complex patterns of force and motion.  #@NEW_LINE#@#  

Evolution_Searches_in_the_Mechanical_Fitness_Landscape  #@NEW_LINE#@#  
Our simulations search for a prescribed response v induced by a force f applied at a specific site on the left side (pinch).  #@NEW_LINE#@#  The prescribed dipolar response may occur at any of the sites on the right side.  #@NEW_LINE#@#  This gives rise to a wider shear band that allows the protein to perform general mechanical tasks (unlike specific allostery tasks of communicating between specified sites on L and R).  #@NEW_LINE#@#  We define the fitness as the maximum of F [2] over all potential locations of the channels output (typically 810 sites) (Materials and Methods).  #@NEW_LINE#@#  The protein is evolved via a point mutation process where, at each step, we flip a randomly selected codon between zero and one.  #@NEW_LINE#@#  This corresponds to exchanging H and P at a random position in the protein, thereby changing the bond pattern and the elastic response by softening or stiffening the amino acid network.  #@NEW_LINE#@#  
Evolution starts from a random protein configuration encoded in a random gene.  #@NEW_LINE#@#  Typically, we take a small fraction of amino acid of type P (about 5%) randomly positioned within a majority of H (Fig 1D, Left).  #@NEW_LINE#@#  The high fraction of strong bonds renders the protein stiff and therefore, of low initial fitness F0.  #@NEW_LINE#@#  At each step, we calculate the change in the Green function G (by a method explained below) and use it to evaluate from [2] the fitness change F:F=vGf.  #@NEW_LINE#@#  [3]The fitness change F determines the fate of the mutation: we accept the mutation if F0; otherwise, the mutation is rejected.  #@NEW_LINE#@#  Since fitness is measured by the criterion of strong mechanical response, it induces softening of the amino acid network.  #@NEW_LINE#@#  
The typical evolution trajectory lasts about 103 steps.  #@NEW_LINE#@#  Most are neutral mutations (F0) and deleterious ones (Fless_than0); the latter are rejected.  #@NEW_LINE#@#  About a dozen or so beneficial mutations (F0) drive the protein toward the solution (Fig 3A).  #@NEW_LINE#@#  The increase in the fitness reflects the gradual formation of the channel, while the jump in the shear signals the emergence of the soft mode.  #@NEW_LINE#@#  The first few beneficial mutations tend to form weakly bonded P-enriched regions near the pinch site on the left side and close to the right boundary of the protein.  #@NEW_LINE#@#  The following ones join these regions into a floppy channel (a shear band), which traverses the protein from left to right.  #@NEW_LINE#@#  We stop the simulation when the fitness reaches a large positive value Fm5.  #@NEW_LINE#@#  The corresponding gene c* encodes the functional protein.  #@NEW_LINE#@#  The ad hoc value Fm5 signals slowing down of the fitness curve toward saturation at FFm, as the channel has formed and now only continues to slightly widen.  #@NEW_LINE#@#  In this regime, even a tiny pinch will easily excite a large-scale motion with a distinct high-shear band (Fig 1D, Right).  #@NEW_LINE#@#  


Results  #@NEW_LINE#@#  
Mechanical_Function_Emerges_at_a_Topological_Transition  #@NEW_LINE#@#  
The hallmark of evolution reaching a solution gene c* is the emergence of a new zero-energy mode, u*, in addition to the three Galilean symmetry modes.  #@NEW_LINE#@#  Near the solution, the energy of this mode * almost closes the spectral gap, *0, and G() has a pole at 0.  #@NEW_LINE#@#  As a result, the emergent mode dominates the Green function, Gu*u*/*.  #@NEW_LINE#@#  The response to a pinch will be mostly through this soft mode, and the fitness [2] will diverge asF(c*)F*=vu*u*f*.  #@NEW_LINE#@#  [4]On average, we find that the fitness increases exponentially with the number of beneficial mutations (Fig 3A).  #@NEW_LINE#@#  However, beneficial mutations are rare and are separated by long stretches of neutral mutations.  #@NEW_LINE#@#  This is evident from the fitness landscape (Fig 3B), which shows that, in most sites, the effect of mutations is practically neutral.  #@NEW_LINE#@#  The vanishing of the spectral gap, *0, manifests as a topological change in the system: the amino acid network is now divided into two domains that can move independently of each other at low energetic cost.  #@NEW_LINE#@#  The soft mode appears at a dynamical phase transition, where the average shear in the protein jumps abruptly as the channel is formed and the protein can easily deform in response to the force probe (Fig 3D).  #@NEW_LINE#@#  
As the shear band is taking shape, the correlation among codons builds up.  #@NEW_LINE#@#  To see this, we align genes from the 106 simulations in analogy to sequence alignment of real protein families (4961), albeit without the phylogenetic correlation that hampers the analysis of real sequences.  #@NEW_LINE#@#  At each time step, we calculate the two-codon correlation Qij between all pairs of codons ci and cj:Qijcicjcicj,[5]where brackets denote ensemble averages.  #@NEW_LINE#@#  We find that most of the correlation is concentrated in the forming channel (Fig 3C), where it is 10-fold larger than in the whole protein.  #@NEW_LINE#@#  In the channel, there is significant long-range correlation shown in the spatial profile of the correlation g(r) (Fig 3C, Inset).  #@NEW_LINE#@#  Analogous regions of coevolving residues appear in real protein families (5355, 5860) as well as in coarse-grained models of protein allostery (35, 36, 43, 44) and allosteric networks (46, 47).  #@NEW_LINE#@#  

Point_Mutations_Are_Localized_Mechanical_Perturbations  #@NEW_LINE#@#  
A mutation may vary the strength of no more than z=12 bonds around the mutated amino acid (Fig 2B).  #@NEW_LINE#@#  The corresponding perturbation of the Hamiltonian H is, therefore, localized, akin to a defect in a crystal (80, 81).  #@NEW_LINE#@#  The mechanics of mutations can be further explored by examining the perturbed Green function, G=G+G, which obeys the Dyson equation (77, 82) (Materials and Methods):G=GGHG.  #@NEW_LINE#@#  [6]The latter can be iterated into an infinite seriesG=GG=GHG+GHGHG.This series has a straightforward physical interpretation as a sum over multiple scatterings: as a result of the mutation, the elastic force field is no longer balanced by the imposed force f, leaving a residual force field f=Hu=HGf.  #@NEW_LINE#@#  The first scattering term in the series balances f by the deformation u=Gf=GHGf.  #@NEW_LINE#@#  Similarly, the second scattering term accounts for further deformation induced by u and so forth.  #@NEW_LINE#@#  In practice, we calculate the mutated Green function using the Woodbury formula [12], which exploits the localized nature of the perturbation to accelerate the computation by a factor of 104 (Materials and Methods).  #@NEW_LINE#@#  

Epistasis_Links_Protein_Mechanics_to_Genetic_Correlations  #@NEW_LINE#@#  
Our model provides a calculable definition of epistasis, the nonlinearity of the fitness effect of interacting mutations (Fig 2C).  #@NEW_LINE#@#  We take a functional protein obtained from the evolution algorithm and mutate an amino acid at a site i.  #@NEW_LINE#@#  This mutation induces a change in the Green function Gi (calculated by [12]) and hence, in the fitness function Fi [3].  #@NEW_LINE#@#  One can similarly perform another independent mutation at a site j, producing a second deviation, Gj and Fj.  #@NEW_LINE#@#  Finally, starting again from the original solution, one mutates both i and j simultaneously, with a combined effect Gi,j and Fi,j.  #@NEW_LINE#@#  The epistasis eij measures the departure of the double mutation from additivity of two single mutations:eijFi,jFiFj.  #@NEW_LINE#@#  [7]To evaluate the average epistatic interaction among amino acids, we perform the double-mutation calculation for all 106 solutions and take the ensemble average Eij=eij.  #@NEW_LINE#@#  Landscapes of Eij show significant epistasis in the channel (Fig 4).  #@NEW_LINE#@#  Amino acids outside the high-shear region show only small epistasis, since mutations in the rigid domains hardly change the elastic response.  #@NEW_LINE#@#  The epistasis landscapes (Fig 4 AC) are mostly positive, since the mutations in the channel interact antagonistically (83): after a strongly deleterious mutation, a second mutation has a smaller effect.  #@NEW_LINE#@#  
Definition [7] is a direct link between epistasis and protein mechanics: the nonlinearity (curvature) of the Green function measures the deviation of the mechanical response from additivity of the combined effect of isolated mutations at i and j, Gi,jGi,jGiGj.  #@NEW_LINE#@#  The epistasis eij is simply the inner product value of this nonlinearity with the pinch and the response:eij=vGi,jf.  #@NEW_LINE#@#  [8]Relation [8] shows how epistasis originates from mechanical forces among mutated amino acids.  #@NEW_LINE#@#  
In the gene, epistatic interactions are manifested in codon correlations (56, 57) shown in Fig 4D, which depicts two-codon correlations Qij from the alignment of 106 functional genes c* [5].  #@NEW_LINE#@#  We find a tight correspondence between the mean epistasis Eij=eij and the codon correlations Qij.  #@NEW_LINE#@#  Both patterns exhibit strong correlations in the channel region with a period equal to channels length: 10 amino acids.  #@NEW_LINE#@#  The similarity in the patterns of Qij and Eij indicates that a major contribution to the long-range correlations observed among aligned protein sequences stems from the mechanical interactions propagating through the amino acid network.  #@NEW_LINE#@#  

Epistasis_as_a_Sum_over_Scattering_Paths  #@NEW_LINE#@#  
One can classify epistasis according to the interaction range.  #@NEW_LINE#@#  Neighboring amino acids exhibit contact epistasis (4951), because two adjacent perturbations, Hi and Hj, interact nonlinearly via the AND gate of the interaction table (Fig 1C), Hi,jHi,jHiHj0 (where Hi,j is the perturbation by both mutations).  #@NEW_LINE#@#  The leading term in the Dyson series [6] of Gi,j is a single scattering from an effective perturbation with an energy Hi,j, which yields the epistasiseij=vGHi,jGf+.Long-range epistasis among nonadjacent, noninteracting perturbations (Hi,j=0) is observed along the channel (Fig 4).  #@NEW_LINE#@#  In this case, [6] expresses the nonlinearity Gi,j as a sum over multiple scattering paths, which include both i and j (Fig 2C):eij=vGHiGHjG+GHjGHiGf.  #@NEW_LINE#@#  [9]The perturbation expansion directly links long-range epistasis to shear deformation: near the transition, the Green function is dominated by the soft mode, Gu*u*/*, with fitness F given by [4].  #@NEW_LINE#@#  From [6] and [8], we find a simple expression for the mechanical epistasis as a function of the shear:eijFhi1+hi+hj1+hjhi+hj1+hi+hj.  #@NEW_LINE#@#  [10]The factor hiu*Hiu*/* in [10] is the ratio of the change in the shear energy due to mutation at i (the expectation value of Hi) and the energy * of the soft mode, and it is similar for hj.  #@NEW_LINE#@#  Thus, hi and hj are significant only in and around the shear band, where the bonds varied by the perturbations are deformed by the soft mode.  #@NEW_LINE#@#  When both sites are outside the channel, hi,hj1, the epistasis [10] is small, eij2hihjF.  #@NEW_LINE#@#  It remains negligible even if one of the mutations, i, is in the channel, hj1hi, and eijhjF.  #@NEW_LINE#@#  Epistasis can only be long ranged along the channel when both mutations are significant, hi,hj1, and eijF1hi1hj1+(hi+hj)1F[11/min(hi,hj)].  #@NEW_LINE#@#  We conclude that epistasis is maximal when both sites are at the start or end of the channel as illustrated in Fig 4.  #@NEW_LINE#@#  The nonlinearity of the fitness function gives rise to antagonistic epistasis.  #@NEW_LINE#@#  

Geometry_of_Fitness_Landscape_and_Gene-to-Function_Map  #@NEW_LINE#@#  
With our mechanical evolution algorithm, we can swiftly explore the fitness landscape to examine its geometry.  #@NEW_LINE#@#  The genotype space is a 200D hypercube with vertices that are all possible genes c. The phenotypes reside in a 400D space of all possible mechanical responses u.  #@NEW_LINE#@#  The Green function provides the genotype-to-phenotype map [1].  #@NEW_LINE#@#  A functional protein is encoded by a gene c* with fitness that exceeds a large threshold, F(c*)Fm5, and the functional phenotype is dominated by the emergent zero-energy mode, u(c*)u* (Fig 3A).  #@NEW_LINE#@#  We also characterize the phenotype by the shear field s* (Materials and Methods).  #@NEW_LINE#@#  
The singular value decomposition (SVD) of the 106 solutions returns a set of eigenvectors with ordered eigenvalues that show their significance in capturing the data (Materials and Methods).  #@NEW_LINE#@#  The SVD spectra reveal strong correspondence between the genotype c* and the phenotype, u and s* (Fig 5).  #@NEW_LINE#@#  In all three datasets, the largest eigenvalues are discrete and stand out from the bulk continuous spectrum.  #@NEW_LINE#@#  These are the collective dfs, which show loci in the gene and positions in the flow (i.e., displacement) and shear fields that tend to vary together.  #@NEW_LINE#@#  
We examine the correspondence among three sets of eigenvectors: {Uk} of the flow, {Ck} of the gene, and {Sk} of the shear.  #@NEW_LINE#@#  The first eigenvector of the flow, U1, is the hinge motion caused by the pinch, with two eddies rotating in opposite directions (Fig 5A).  #@NEW_LINE#@#  The next two modes, shear (U2) and breathing (U3), also occur in real proteins, such as glucokinase (Fig 1B).  #@NEW_LINE#@#  The first eigenvectors of the shear S1 and of the gene sequence C1 show that the high-shear region is mirrored as a P-rich region, where a mechanical signal may cause local rearrangement of the amino acids by deforming weak bonds.  #@NEW_LINE#@#  In the rest of the protein, the H-rich regions move as rigid bodies with insignificant shear.  #@NEW_LINE#@#  The higher gene eigenvectors, Ck (k1), capture patterns of correlated genetic variations.  #@NEW_LINE#@#  The striking similarity between the sequence correlation patterns Ck and the shear eigenvectors Sk shows a tight genotype-to-phenotype map, as is further shown in the likeness of the correlation matrices of the amino acid and shear flow (Fig 5C).  #@NEW_LINE#@#  
In the phenotype space, we represent the displacement field u in the SVD basis, {Uk} (Fig 5B).  #@NEW_LINE#@#  Since 90% of the data are explained by the first 15 Uk, we can compress the displacement field without much loss into the first 15 coordinates.  #@NEW_LINE#@#  This implies that the set of solutions is a 15D discoid, which is flat in most directions.  #@NEW_LINE#@#  In contrast, representation of the genes c* in the SVD frame of reference (with the {Ck} basis) reveals that, in genotype space, the solution set is an incompressible 200D spheroid (Fig 5B).  #@NEW_LINE#@#  The dramatic dimensional reduction in mapping genotypes to phenotypes stems from the different constraints that shape them (36, 8489).  #@NEW_LINE#@#  


Discussion  #@NEW_LINE#@#  
Theories of protein need to combine the many-body physics of the amino acid matter with the evolution of genetic information, which together, give rise to protein function.  #@NEW_LINE#@#  We introduced a simplified theory of protein, where the mapping between genotype and phenotype takes an explicit form in terms of mechanical propagators (Green functions), which can be efficiently calculated.  #@NEW_LINE#@#  As a functional phenotype, we take cooperative motion and force transmission through the protein [2].  #@NEW_LINE#@#  This allows us to map genetic mutations to mechanical perturbations, which scatter the force field and deflect its propagation [3 and 6] (Fig 2).  #@NEW_LINE#@#  The evolutionary process amounts to solving the inverse scattering problem: given prescribed functional modes, one looks for network configurations that yield this low end of the dynamical spectrum.  #@NEW_LINE#@#  Epistasis, the interaction among loci in the gene, corresponds to a sum over all multiple scattering trajectories or equivalently, the nonlinearity of the Green function [7 and 8].  #@NEW_LINE#@#  We find that long-range epistasis signals the emergence of a collective functional mode in the protein.  #@NEW_LINE#@#  The results of this theory (in particular, the expressions for epistasis) follow from the basic geometry of the amino acid network and the localized mutations and are, therefore, applicable to general tasks and fitness functions with multiple inputs and responses.  #@NEW_LINE#@#  

Materials_and_Methods  #@NEW_LINE#@#  
The_Mechanical_Model_of_Protein  #@NEW_LINE#@#  
We model the protein as an elastic network made of harmonic springs (23, 24, 39, 90).  #@NEW_LINE#@#  The connectivity of the network is described by a hexagonal lattice with vertices that are amino acids and edges that correspond to bonds.  #@NEW_LINE#@#  There are na=10×20=200 amino acids indexed by Roman letters and nb bonds indexed by Greek letters.  #@NEW_LINE#@#  We use the HP model (73) with two amino acid species, hydrophobic (ai=H) and polar (ai=P).  #@NEW_LINE#@#  The amino acid chain is encoded in a gene c, where ci=1 encodes H and ci=0 encodes P, i=1,,na.  #@NEW_LINE#@#  The degree zi of each amino acid is the number of amino acids to which it is connected by bonds.  #@NEW_LINE#@#  In our model, most amino acids have the maximal degree, which is z=12, while amino acids at the boundary have fewer neighbors, zless_than12 (Fig 1C).  #@NEW_LINE#@#  The connectivity of the graph is recorded by the adjacency matrix A, where Aij=1 if there is a bond from j to i and Aij=0 otherwise.  #@NEW_LINE#@#  The gradient operator  relates the spaces of bonds and vertices (and is, therefore, of size nb×na): if vertices i and j are connected by a bond , then i=+1 and j=1.  #@NEW_LINE#@#  As in the continuum case, the Laplace operator  is the product =.  #@NEW_LINE#@#  The nondiagonal elements ij are 1 if i and j are connected and 0 otherwise.  #@NEW_LINE#@#  The diagonal part of  is the degree ii=zi.  #@NEW_LINE#@#  Hence, we can write the Laplacian as =ZA, where Z is the diagonal matrix of the degrees zi.  #@NEW_LINE#@#  
We embed the graph in Euclidean space Ed (d=2) by assigning positions riEd to each amino acid.  #@NEW_LINE#@#  We concatenate all positions in a vector r of length nadnd.  #@NEW_LINE#@#  Finally, to each bond, we assign a spring with constant k, which we keep in a diagonal nb×nb matrix K. The strength of the spring is determined by the AND rule of the HP models interaction table (Fig 1C), k=kw+(kskw)cicj, where ci and cj are the codons of the amino acid connected by bond .  #@NEW_LINE#@#  This implies that a strong HH bond has k=ks, whereas the weak bonds HP and PH have k=kw.  #@NEW_LINE#@#  We usually take ks=1 and kw=0.01.  #@NEW_LINE#@#  This determines a spring network.  #@NEW_LINE#@#  We also assume that the initial configuration is such that all springs are at their equilibrium length, disregarding the possibility of internal stresses (39), so that the initial elastic energy is E0=0.  #@NEW_LINE#@#  
We define the embedded gradient operator D (of size nb×nd), which is obtained by taking the graph gradient  and multiplying each nonzero element (±1) by the corresponding direction vector nij=rirj/rirj.  #@NEW_LINE#@#  Thus, D is a tensor (D=inij), which we store as a matrix ( is the bond connecting vertices i and j).  #@NEW_LINE#@#  In each row vector of D, which we denote as mD,:, there are only 2d nonzero elements.  #@NEW_LINE#@#  To calculate the elastic response of the network, we deform it by applying a force field f, which leads to the displacement of each vertex by ui to a new position ri+ui (39).  #@NEW_LINE#@#  For small displacements, the linear response of the network is given by Hookes law, f=Hu.  #@NEW_LINE#@#  The elastic energy is E=uHu/2, and the Hamiltonian, H=DKD, is the Hessian of the elastic energy E, Hij=2E/(uiuj).  #@NEW_LINE#@#  By rescaling, DK1/2D, which amounts to scaling all distances by 1/k, we obtain H=DD.  #@NEW_LINE#@#  It follows that the Hamiltonian is a function of the gene H(c), which has the structure of the Laplacian  multiplied by the tensor product of the direction vectors.  #@NEW_LINE#@#  Each d×d block Hij (i=j) is a function of the codons ci and cj:Hij(ci,cj)=ijnijnij=Aijkw+kskwcicjnijnij.  #@NEW_LINE#@#  [11]The diagonal blocks complete the row and column sums to zero, Hii=jiHij.  #@NEW_LINE#@#  

The_Inverse_Problem__Green_Function_and_Its_Spectrum  #@NEW_LINE#@#  
The Green function G is defined by the inverse relation to Hookes law, u=Gf [1].  #@NEW_LINE#@#  If H were invertible (nonsingular),G would have been just G=H1.  #@NEW_LINE#@#  However, H is always singular owing to the zero-energy (Galilean) modes of translation and rotation.  #@NEW_LINE#@#  Therefore, one needs to define G as the MoorePenrose pseudoinverse (78, 79), G=H+, on the complement of the space of Galilean transformations.  #@NEW_LINE#@#  The pseudoinverse can be understood in terms of the spectrum of H. There are at least n0=d(d+1)/2 zero modes: d translation modes and d(d1)/2 rotation modes.  #@NEW_LINE#@#  These modes are irrelevant and will be projected out of the calculation (note that these modes do not come from missing connectivity of the graph  itself but from its embedding in Ed).  #@NEW_LINE#@#  H is singular but is still diagonalizable (since it has a basis of dimension nd), and it can be written as the spectral decomposition, H=k=1ndkukuk, where {k} is the set of eigenvalues and {uk} are the corresponding eigenvectors (note that k denotes the index of the eigenvalue, while i and j denote amino acid positions).  #@NEW_LINE#@#  For a nonsingular matrix, one may calculate the inverse simply as H1=k=1ndk1ukuk.  #@NEW_LINE#@#  Since H is singular, we leave out the zero modes and get the pseudoinverse H+, G=H+=k=n0+1ndk1ukuk.  #@NEW_LINE#@#  It is easy to verify that, if u is orthogonal to the zero modes, then u=GHu.  #@NEW_LINE#@#  The pseudoinverse obeys the four requirements (78): (i) HGH=H, (ii) GHG=G, (iii) (HG)=HG, and (iv) (GH)=GH.  #@NEW_LINE#@#  In practice, as the projection commutes with the mutations, the pseudoinverse has most virtues of a proper inverse.  #@NEW_LINE#@#  The reader might prefer to link G and H through the heat kernel, K(t)=kektukuk.  #@NEW_LINE#@#  Then, G=0dtK(t) and H=ddtK|t=0.  #@NEW_LINE#@#  

Pinching_the_Network  #@NEW_LINE#@#  
A pinch is given as a localized force applied at the boundary of the protein.  #@NEW_LINE#@#  We usually apply the force on a pair of neighboring boundary vertices, p and q.  #@NEW_LINE#@#  It seems reasonable to apply a force dipole (i.e., two opposing forces fq=fp), since a net force will move the center of mass.  #@NEW_LINE#@#  This pinch is, therefore, specified by the force vector f (of size nd), with the only 2d nonzero entries being fq=fp.  #@NEW_LINE#@#  Hence, it has the same structure as a bond vector m of a pseudobond connecting p and q A normal pinch f has a force dipole directed along the rprq line (the npq direction).  #@NEW_LINE#@#  Such a pinch is expected to induce a hinge motion.  #@NEW_LINE#@#  A shear pinch will be in a perpendicular direction npq and is expected to induce a shear motion.  #@NEW_LINE#@#  
Evolution tunes the spring network to exhibit a low-energy mode, in which the protein is divided into two subdomains moving like rigid bodies.  #@NEW_LINE#@#  This large-scale mode can be detected by examining the relative motion of two neighboring vertices, p and q, at another location at the boundary (usually at the opposite side).  #@NEW_LINE#@#  Such a desired response at the other side of the protein is specified by a response vector v, and the only nonzero entries correspond to the directions of the response at p and q.  #@NEW_LINE#@#  Again, we usually consider a dipole response vq=vp.  #@NEW_LINE#@#  

Evolution_and_Mutation  #@NEW_LINE#@#  
The quality of the response (i.e., the biological fitness) is specified by how well the response follows the prescribed one v. In the context of our model, we chose the (scalar) observable F as F=vu=vpup+vquq=vGf [2].  #@NEW_LINE#@#  In an evolution simulation, one would exchange amino acids between H and P, while demanding that the fitness change F is positive or nonnegative.  #@NEW_LINE#@#  By this, we mean F0 is thanks to a beneficial mutation, whereas F=0 corresponds to a neutral one.  #@NEW_LINE#@#  Deleterious mutations Fless_than0 are generally rejected.  #@NEW_LINE#@#  A version that accepts mildly deleterious mutations (a finite temperature Metropolis algorithm) gave similar results.  #@NEW_LINE#@#  We may impose a stricter minimum condition FF with a small positive , say 1%.  #@NEW_LINE#@#  An alternative, stricter criterion would be the demand that each of the terms in F, vpup and vquq, increases separately.  #@NEW_LINE#@#  The evolution is stopped when FFm5, which signals the formation of a shear band.  #@NEW_LINE#@#  When simulations ensue beyond Fm5, the band slightly widens, and the fitness slows down and converges at a maximal value, typically Fmax8.  #@NEW_LINE#@#  

Evolving_the_Green_Function_Using_the_Dyson_and_Woodbury_Formulas  #@NEW_LINE#@#  
The Dyson formula follows from the identity HHH=G+G+, which is multiplied by G on the left and G on the right to yield [6].  #@NEW_LINE#@#  The formula remains valid for the pseudoinverses in the nonsingular subspace.  #@NEW_LINE#@#  One can calculate the change in fitness by evaluating the effect of a mutation on the Green function, G=G+G, and then examining the change, F=vGf [3].  #@NEW_LINE#@#  Using [6] to calculate the mutated Green function G is an impractical method, as it amounts to inverting at each step a large nd×nd matrix.  #@NEW_LINE#@#  However, the mutation of an amino acid at i has a localized effect.  #@NEW_LINE#@#  It may change only up to z=12 bonds among the bonds (i) with the neighboring amino acids.  #@NEW_LINE#@#  Thanks to the localized nature of the mutation, the corresponding defect Hamiltonian Hi is, therefore, of a small rank, rz=12, equal to the number of switched bonds (the average r is about 9.3).  #@NEW_LINE#@#  Hi can be decomposed into a product Hi=MBM.  #@NEW_LINE#@#  The diagonal r×r matrix B records whether a bond (i) is switched from weak to strong (B=kskw=+0.99) or vice versa (B=0.99), and M is a nd×r matrix with r columns that are the bond vectors m for the switched bonds (i).  #@NEW_LINE#@#  This allows one to calculate changes in the Green function more efficiently using the Woodbury formula (91, 92):G=GMB1+MGM+MG.  #@NEW_LINE#@#  [12]  #@NEW_LINE#@#  
The two expressions for the mutation impact G, [6 and 12], are equivalent, and one may get the scattering series of [6] by a series expansion of the pseudoinverse in [12].  #@NEW_LINE#@#  The practical advantage of [12] is that the only (pseudo-)inversion that it requires is of a low-rank tensor (the term in parentheses).  #@NEW_LINE#@#  This accelerates our simulations by a factor of (na/r)3104.  #@NEW_LINE#@#  

Pathologies_and_Broken_Networks  #@NEW_LINE#@#  
A network broken into disjoint components exhibits floppy modes owing to the low energies of the relative motion of the components with respect to each other.  #@NEW_LINE#@#  The evolutionary search might end up in such nonfunctional unintended modes.  #@NEW_LINE#@#  The common pathologies that we observed are (i) isolated nodes at the boundary that become weakly connected via HP mutations, (ii) sideways channels that terminate outside the target region (which typically includes around 810 sites), and (iii) channels that start and end at the target region without connecting to the binding site.  #@NEW_LINE#@#  All of these are some easy to understand floppy modes, which can vibrate independent of the location of the pinch and cause the response to diverge (Fm) without producing a functional mode.  #@NEW_LINE#@#  We avoid such pathologies by applying the pinch force to the protein network symmetrically: pinch the binding site on face left, look at responses on face right, and vice versa.  #@NEW_LINE#@#  Thereby, we not only look for the transmission of the pinch from the left to right but also, from right to left.  #@NEW_LINE#@#  The basic algorithm is modified to accept a mutation only if it does not weaken the two-way responses and enables hinge motion of the protein.  #@NEW_LINE#@#  This prevents the vibrations from being localized at isolated sites or unwanted channels.  #@NEW_LINE#@#  

Dimension_and_SVD  #@NEW_LINE#@#  
To examine the geometry of the fitness landscape and the genotype-to-phenotype map, we looked at the correlation among numerous solutions, typically Nsol106.  #@NEW_LINE#@#  Each solution is characterized by three vectors: (i) the gene of the functional protein, c* (a vector of length na=200 codons); (ii) the flow field (displacement), u(c*)=G(c*)f (a vector of length nd=400 of x and y velocity components); and (iii) the shear field s* (a vector of length na=200).  #@NEW_LINE#@#  We compute the shear as the symmetrized derivative of the displacement field using the method in ref.  #@NEW_LINE#@#  21.  #@NEW_LINE#@#  The value of the s* field is the sum of squares of the traceless part of the strain tensor (Frobenius norm).  #@NEW_LINE#@#  These three types of vectors are stored along the rows of three matrices WC, WU, and WS.  #@NEW_LINE#@#  We calculate the eigenvectors of these matrices, Ck, Uk, and Sk, via SVD (as in ref.  #@NEW_LINE#@#  36).  #@NEW_LINE#@#  The corresponding SVD eigenvalues are the square roots of the eigenvalues of the covariance matrix WW, while the eigenvectors are the same.  #@NEW_LINE#@#  In typical spectra, most eigenvalues reside in a continuum bulk region that resembles the spectra of random matrices.  #@NEW_LINE#@#  A few larger outliers, typically around a dozen or so, carry the nonrandom correlation information.  #@NEW_LINE#@#  

The_Protein_Backbone  #@NEW_LINE#@#  
A question may arise as to what extent the proteins backbone might affect the results described so far.  #@NEW_LINE#@#  Proteins are polypeptides, linear heteropolymers of amino acids, linked by covalent peptide bonds, which form the protein backbone.  #@NEW_LINE#@#  The peptide bonds are much stronger than the noncovalent interactions among the amino acids and do not change when the protein mutates.  #@NEW_LINE#@#  We, therefore, augmented our model with a backbone: a linear path of conserved strong bonds that passes once through all amino acids.  #@NEW_LINE#@#  We focused on two extreme cases: a serpentine backbone either parallel to the shear band or perpendicular to it (Fig 6).  #@NEW_LINE#@#  
The presence of the backbone does not interfere with the emergence of a low-energy mode of the protein with a flow pattern (i.e., displacement field) that is similar to the backboneless case with two eddies moving in a hinge-like fashion.  #@NEW_LINE#@#  In the parallel configuration, the backbone constrains the channel formation to progress along the fold (Fig 6A).  #@NEW_LINE#@#  The resulting channel is narrower than in the model without backbone (Figs.  #@NEW_LINE#@#  1D and 5).  #@NEW_LINE#@#  In the perpendicular configuration, the evolutionary progression of the channel is much less oriented (Fig 6C).  #@NEW_LINE#@#  While the flow patterns are similar, closer inspection shows noticeable differences, as can be seen in the flow eigenvectors Uk (Fig 6 B and D).  #@NEW_LINE#@#  The shear eigenvectors Sk represent the derivative of the flow and therefore, highlight more distinctly these differences.  #@NEW_LINE#@#  
As for the correspondence between gene eigenvectors Ck and shear eigenvectors Sk, the backbone affects the shape of the channel in concert with the sequence correlations around it.  #@NEW_LINE#@#  Transmission of mechanical signals seems to be easier along the orientation of the fold (parallel configuration) (Fig 6A).  #@NEW_LINE#@#  Transmission across the fold (perpendicular configuration) necessitates significant deformation of the backbone and leads to dispersion of the signal at the output (Fig 6C).  #@NEW_LINE#@#  We propose that the shear band will be roughly oriented with the direction of the fold, but this requires further analysis of structural data.  #@NEW_LINE#@#  Overall, we conclude from our examination that the backbone adds certain features to patterns of the field and sequence correlation without changing the basic results of our model.  #@NEW_LINE#@#  The presence of the backbone might constrain the evolutionary search, but this has no significant effect on the fast convergence of the search and on the long-range correlations among solutions.  #@NEW_LINE#@#  


Acknowledgments  #@NEW_LINE#@#  
We thank Jacques Rougemont for calculations of shear in glucokinase (Fig 1B) and for helpful discussions.  #@NEW_LINE#@#  We thank Stanislas Leibler, Michael R. Mitchell, Elisha Moses, Giovanni Zocchi, and Olivier Rivoire for helpful discussions and encouragement.  #@NEW_LINE#@#  We also thank Alex Petroff, Steve Granick, Le Yan, and Matthieu Wyart for valuable comments on the manuscript.  #@NEW_LINE#@#  J.-P.E.  #@NEW_LINE#@#  is supported by European Research Council Advanced Grant Bridges, and T.T.  #@NEW_LINE#@#  is supported by Institute for Basic Science Grant IBS-R020 and the Simons Center for Systems Biology of the Institute for Advanced Study, Princeton.  #@NEW_LINE#@#  

Footnotes  #@NEW_LINE#@#  

This open access article is distributed under Creative Commons Attribution-NonCommercial-NoDerivatives License 4.0 (CC BY-NC-ND).  #@NEW_LINE#@#  

