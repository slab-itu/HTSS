article id="http://dx.doi.org/10.1073/pnas.1714376115"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Accurate and sensitive quantification of protein-DNA binding affinity  #@NEW_LINE#@#  

Significance  #@NEW_LINE#@#  
One-tenth of human genes produce proteins called transcription factors (TFs) that bind to our genome and read the local DNA sequence.  #@NEW_LINE#@#  They work together to regulate the degree to which each gene is expressed.  #@NEW_LINE#@#  The affinity with which DNA is bound by a particular TF can vary more than a thousand-fold with different DNA sequences.  #@NEW_LINE#@#  This study presents the first computational method able to quantify the sequence-affinity relationship almost perfectly over the full affinity range.  #@NEW_LINE#@#  It achieves this by analyzing data from experiments that use massively parallel DNA sequencing to comprehensively probe proteinDNA interactions.  #@NEW_LINE#@#  Strikingly, it can accurately predict the effect in vivo of DNA mutations on gene expression levels in fly embryos even for very-low-affinity binding sites.  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
Transcription factors (TFs) control gene expression by binding to genomic DNA in a sequence-specific manner.  #@NEW_LINE#@#  Mutations in TF binding sites are increasingly found to be associated with human disease, yet we currently lack robust methods to predict these sites.  #@NEW_LINE#@#  Here, we developed a versatile maximum likelihood framework named No Read Left Behind (NRLB) that infers a biophysical model of protein-DNA recognition across the full affinity range from a library of in vitro selected DNA binding sites.  #@NEW_LINE#@#  NRLB predicts human Max homodimer binding in near-perfect agreement with existing low-throughput measurements.  #@NEW_LINE#@#  It can capture the specificity of the p53 tetramer and distinguish multiple binding modes within a single sample.  #@NEW_LINE#@#  Additionally, we confirm that newly identified low-affinity enhancer binding sites are functional in vivo, and that their contribution to gene expression matches their predicted affinity.  #@NEW_LINE#@#  Our results establish a powerful paradigm for identifying protein binding sites and interpreting gene regulatory sequences in eukaryotic genomes.  #@NEW_LINE#@#  

Results  #@NEW_LINE#@#  
Description_of_the_NRLB_Method  #@NEW_LINE#@#  
NRLB uses every DNA sequence observed after a single round of SELEX enrichment to characterize the relative affinities of all binding sites, from the optimal site all of the way down to those sites that are bound nonspecifically.  #@NEW_LINE#@#  At the core of our method is an equilibrium thermodynamics model of proteinDNA interaction (Fig 1A) used previously to analyze protein binding microarray data (11, 1921).  #@NEW_LINE#@#  Assuming that TF binding is affected by a DNA sequence over K base pairs, this model maps each of the 4K possible bound sequences S to a relative binding free energy G(S)=G(S)G(S0), where S0 is a fixed reference sequence usually chosen to be the highest-affinity sequence.  #@NEW_LINE#@#  The corresponding relative binding affinity is given by Ka,rel=exp(G(S)/RT), with R denoting the ideal gas constant and T the absolute temperature.  #@NEW_LINE#@#  A linear relationship is assumed between the binding free energy and the various sequence features, , that distinguish sequence S from the reference sequence (usually taken to be the optimal sequence):G(S)RT=X(S).Here,  represents the effect of each feature, , on the binding free energy, as indicated by X(S), which equals 1 if S contains the feature and 0 if it does not.  #@NEW_LINE#@#  The set of features always includes all possible mononucleotide substitutions (mononucleotide model).  #@NEW_LINE#@#  However, dependencies among pairs of adjacent nucleotides can optionally also be taken into account (dinucleotide model).  #@NEW_LINE#@#  The dinucleotide model has the potential to improve prediction, partly because it better captures the effect of variation in DNA shape on binding (22).  #@NEW_LINE#@#  
The proteinDNA interaction model is embedded in a statistical model of the SELEX method.  #@NEW_LINE#@#  Each DNA ligand in the initial library of a SELEX experiment consists of a variable region of L base pairs surrounded by constant flanks, resulting in 4L possible ligands.  #@NEW_LINE#@#  The input data consist of the complete set of reads sequenced from a random library of DNA ligands at round zero (R0) and after one cycle (R1) of affinity-based selection (Fig 1B).  #@NEW_LINE#@#  Significantly, the observed distribution of sequences in the initial R0 library f0(S) is not entirely random; presumably, the processes associated with library generation (probe synthesis, double-stranding, and PCR amplification) introduce sequence-specific biases.  #@NEW_LINE#@#  We explicitly capture these biases using an oligomer feature-based, log-linear multinomial model (Methods).  #@NEW_LINE#@#  This is significantly more accurate (SI Appendix, Fig S1) than the approach we used previously (13).  #@NEW_LINE#@#  
Binding by the TF complex at various offsets and/or orientations within a probe can contribute to its selection.  #@NEW_LINE#@#  In the absence of saturation, the frequency f1(S) of sequence S in the R1 library is proportional both to its frequency f0(S) in R0 and to the relative affinity with which it is bound:f1(S)f0(S)v[meGm(Sv)/RT+eGns/RT].Here, Sv denotes the bound subsequence of length K for view v on the probe sequence of length L (Fig 1A).  #@NEW_LINE#@#  Explicitly accounting for nonspecific binding (Gns/RT) is essential to achieve accurate prediction of relative affinities.  #@NEW_LINE#@#  Moreover, since the same TF complex may bind DNA in different configurations, the model can be optionally extended to a weighted sum over multiple binding modes m in parallel (Methods).  #@NEW_LINE#@#  Finally, a multinomial distribution relates f1(S) to the observed (and unobserved) R1 counts of all 4L unique sequences S. In this formalism, every unique sequence S can be considered its own category.  #@NEW_LINE#@#  
The coefficients of the protein-DNA recognition model ( and ns) are estimated using a likelihood maximization procedure.  #@NEW_LINE#@#  Despite the conceptual simplicity of our approach, it was necessary to develop tailored dynamic programming techniques and dedicated nonlinear optimization methods to make it feasible to fit the model in an efficient and robust manner.  #@NEW_LINE#@#  A detailed description is provided in SI Appendix, Supplemental Methods.  #@NEW_LINE#@#  

Cross-Platform_Validation_Shows_That_NRLB_Accurately_Models_Binding_Specificity_over_the_Full_Affinity_Range  #@NEW_LINE#@#  
The widely studied human basic helixloophelix (bHLH) protein MAX is one of the few TFs whose binding specificity has been simultaneously characterized for many DNA ligands by the gold-standard microfluidics-based MITOMI assay (9).  #@NEW_LINE#@#  It has also been characterized by the bead-based HT-SELEX (23, 24), EMSA-based SELEX-seq [Zhou et al.  #@NEW_LINE#@#  (22) and this study (Methods)], and microfluidics-based SMiLE-seq (14) platforms.  #@NEW_LINE#@#  To assess the biophysical accuracy of NRLB predictions, we constructed models on these datasets and compared their predictions for 255 different DNA probes with the observed G/RT values obtained from the MITOMI assay.  #@NEW_LINE#@#  Strikingly, when fit to R1 SMiLE-seq data, an NRLB model with dinucleotide features and a nonspecific binding term (46 independent parameters) achieves near-perfect agreement with MITOMI measurements spanning a 160-fold (G/RT = 5) range of binding affinity (R2 = 0.93; Fig 2 A and C).  #@NEW_LINE#@#  This level of agreement is significantly better (Fig 2C; P = 4.7 × 1011, Fishers r-to-z transformation) than for a model with mononucleotide features (13 parameters; R2 = 0.79; Fig 2B) fit to the same data.  #@NEW_LINE#@#  Importantly, including nonspecific binding is essential to achieve good agreement (SI Appendix, Fig S2A), because the R1 library is still dominated by low-affinity probes.  #@NEW_LINE#@#  Models for the same MAX homodimer constructed from the alternative SELEX-seq and HT-SELEX platforms display a slightly lower level of agreement with the MITOMI standard (Fig 2C and SI Appendix, Fig S2 BE).  #@NEW_LINE#@#  SELEX data can be significantly subsampled before performance degrades, although, as expected, a larger number of reads is required to fit dinucleotide than mononucleotide-only models (SI Appendix, Fig S3).  #@NEW_LINE#@#  

Capturing_Specificity_over_the_Full_Binding_Site_of_Full-Length_p53_Tetramers  #@NEW_LINE#@#  
Because NRLB fits G/RT coefficients directly to SELEX reads, there is no limit on the size of the footprint over which binding specificity can be modeled.  #@NEW_LINE#@#  This allows analyses of complexes such as tetramers of tumor suppressor protein p53.  #@NEW_LINE#@#  A previous study (25) highlighted the role of the C-terminal domain (CTD) of p53 in altering its binding preferences in vivo, although it remained unclear if the CTD impacted the binding preferences of p53s DNA binding domain (DBD).  #@NEW_LINE#@#  To further elucidate the CTDs role in binding, we used SELEX-seq and NRLB to analyze both full-length wild-type (WT) p53 and a version (30) from which the CTD has been deleted (26).  #@NEW_LINE#@#  As expected, WT p53 displayed very poor enrichment after a single round of affinity-based selection: Only 420 of the 16.4 million R1 reads match the binding consensus RRRCATGYYYRRRCATGYYY (R = [A,G], Y = [C,T]) (27).  #@NEW_LINE#@#  Despite the high degree of nonspecific binding, a dinucleotide-based, multiple-binding mode NRLB model (discussed below) uncovered WTs specific binding preferences over a 24-bp footprint (Fig 2D).  #@NEW_LINE#@#  A direct comparison between the WT and 30 models (SI Appendix, Fig S4A) shows that their coefficients are highly correlated (R2 = 0.84; SI Appendix, Fig S4B), confirming that the CTD does not alter the DBDs specific binding preferences.  #@NEW_LINE#@#  In addition, sampling of binding sequences (Methods) indicate that the ratio between nonspecific and optimal binding affinity is nearly two orders of magnitude larger for WT than 30, supporting previous conclusions that the CTD enhances nonspecific binding.  #@NEW_LINE#@#  

Analysis_of_Exd-Hox_Heterodimer_Data_Uncovers_Flanking_Specificity  #@NEW_LINE#@#  
In a previous study, we performed SELEX-seq to probe the binding specificity of D. melanogaster Extradenticle (Exd)-Hox heterodimers (13).  #@NEW_LINE#@#  Using oligomer enrichment analysis after multiple selection rounds, we uncovered a latent specificity in Hox proteins when they bind in the presence of the cofactor Exd (13).  #@NEW_LINE#@#  Here, we applied NRLB to the R1 data from the same study and found models that recover this phenomenon (Fig 3A), including all of the information previously captured using oligomer tables (Fig 3B and SI Appendix, Figs.  #@NEW_LINE#@#  S5 and S7).  #@NEW_LINE#@#  Unlike oligomer enrichment approaches, feature-based model fits select a single binding frame among various equivalent (shifted and/or reverse-complemented) representations of the binding site; this has the advantage of yielding a model that is consistently structurally interpretable with reference to the proteinDNA interface (Fig 3C).  #@NEW_LINE#@#  In a biological finding, our Exd-Hox models indicate that the sequence specificity extends well outside the previously reported 12-bp footprint (13).  #@NEW_LINE#@#  We validated this explicitly by performing competitive EMSAs with sequences containing identical 12-bp cores but with different flanks (SI Appendix, Fig S6).  #@NEW_LINE#@#  Together, these results show that NRLB models are more sensitive and informative than oligomer enrichment tables.  #@NEW_LINE#@#  

Identification_of_Alternative_Binding_Modes_in_a_Single_SELEX_Library  #@NEW_LINE#@#  
When we used NRLB to reanalyze R1 SELEX-seq libraries (13) where Hox proteins were assayed in the absence of Exd, it yielded the expected monomer motifs (SI Appendix, Fig S8, Monomer Data).  #@NEW_LINE#@#  However, a fit to the R1 heterodimer library for Exd-Proboscipedia (Pb) yielded a motif indicative of monomeric rather than heterodimeric binding (Fig 4A).  #@NEW_LINE#@#  Indeed, a multiple binding mode fit to the same Exd-Pb data recovers both the Pb monomer motif and the expected Exd-Pb heterodimer motif (Fig 4A); this yielded a small yet significant increase (P less_than 1 × 1016, Fischers r-to-z transformation) in the agreement between observed and expected oligomer counts and, at the same time, greatly improved the interpretation of the data (SI Appendix, Fig S9).  #@NEW_LINE#@#  Comprehensive multimode analysis of all of the Hox-only and Exd-Hox data yields models with at least two binding modes for each R1 library (SI Appendix, Fig S8, Heterodimer Data).  #@NEW_LINE#@#  For some Exd-Hox datasets, NRLB also discovers a motif indicative of Exd monomer binding (SI Appendix, Fig S8, Bottom).  #@NEW_LINE#@#  NRLB can also be used to analyze in detail how a TF may dimerize with alternative partners.  #@NEW_LINE#@#  For example, the basic leucine zipper (bZIP) proteins ATF4 and C/EBP can bind either as homodimers or heterodimers (28).  #@NEW_LINE#@#  We performed SELEX-seq with a mixture of these proteins and generated new R1 libraries.  #@NEW_LINE#@#  Simultaneously fitting multiple binding modes to these data recovered the heterodimer and both homodimer motifs (Fig 4B).  #@NEW_LINE#@#  Moreover, the homodimer models quantitatively agree with NRLB fits to R1 SELEX-seq libraries, where ATF4 and C/EBP were assayed separately (R2 = 0.735 and R2 = 0.476, respectively; SI Appendix, Fig S10).  #@NEW_LINE#@#  Together, these results show that NRLB can identify reliable motifs for multiple binding modes in mixtures of two distinct but interacting TFs.  #@NEW_LINE#@#  It remains to be seen whether NRLB can be applied to even more complex mixtures.  #@NEW_LINE#@#  

NRLB_Enables_Improved_Quantification_of_Suboptimal_Binding  #@NEW_LINE#@#  
It is not yet clear whether the quantitative biophysical models derived from in vitro data are useful for improving predictions of in vivo binding.  #@NEW_LINE#@#  Recent studies (29, 30) have considered the ability of models to make binary predictions regarding the presence or absence of peaks in ENCODE ChIP-seq data (5) from the underlying DNA sequence (29).  #@NEW_LINE#@#  By this metric, the deep learning algorithm DeepBind (30) was recently shown to outperform both MEME (31) and the method of Jolma et al.  #@NEW_LINE#@#  (12) when trained on HT-SELEX data for a set of several dozen human TFs (23).  #@NEW_LINE#@#  We compared NRLB with DeepBind using the same measure of performance (details about the training of NRLB on HT-SELEX data are provided in Methods and SI Appendix, Fig S11).  #@NEW_LINE#@#  Comparison of the area under the curve (AUC) for various TFs shows that NRLB does as well as DeepBind [Fig 2E and SI Appendix, Figs.  #@NEW_LINE#@#  S12 (overview) and S14 (details)].  #@NEW_LINE#@#  However, the binary ChIP-seq peak classification metric may not accurately distinguish between weak and nonspecific binding.  #@NEW_LINE#@#  To quantitatively assess model performance in this regime, we compared G predictions made using models trained on human Max HT-SELEX data with the MITOMI gold standard.  #@NEW_LINE#@#  Surprisingly, by this metric the DeepBind model showed dramatically poorer agreement with MITOMI (R2 = 0.07; Fig 2C and SI Appendix, Fig S2F) than did the NRLB model (R2 = 0.71; Fig 2C and SI Appendix, Fig S2D).  #@NEW_LINE#@#  
To more comprehensively assess the quantitative performance of DeepBind and NRLB over the full affinity range, we developed in vitro performance metrics to compare the ability of both HT-SELEX trained models to explain R1 probe frequencies from a more deeply sequenced technical replicate of the same dataset (24); details are provided in Methods.  #@NEW_LINE#@#  Unlike DeepBind, NRLB explicitly accounts for R0 biases; as such, we ignored the contribution of NRLBs bias model f0(S) in our predictions to ensure a fair comparison.  #@NEW_LINE#@#  Even under these constraints, NRLB again significantly outperformed DeepBind when attempting to predict read enrichment between R0 and R1 [Fig 2F and SI Appendix, Figs.  #@NEW_LINE#@#  S13A (overview) and S15 (details)] or the observed probe frequency in R1 [SI Appendix, Figs.  #@NEW_LINE#@#  S13B (overview) and S15 (details)].  #@NEW_LINE#@#  The full NRLB model (which accounts for R0 bias) predicts the observed R1 probe frequencies almost perfectly [SI Appendix, Figs.  #@NEW_LINE#@#  S13C (overview) and S15 (details)].  #@NEW_LINE#@#  

Identification_of_Validated_D_melanogaster_Hox_Binding_Sites  #@NEW_LINE#@#  
To further test the biological relevance of our NRLB models, we asked how well they detect Exd-Hox binding sites that were previously validated using in vivo reporter assays in D. melanogaster.  #@NEW_LINE#@#  We started with the well-characterized 37-bp fkh enhancer element, fkh250, which contains a low-affinity Exd-Hox binding site (AGATTAATCG) preferred by Exd-Scr (32).  #@NEW_LINE#@#  Mutating two base pairs in this element [fkh250con, AGATTTATGG (mutations underlined)] creates an Exd-Hox consensus site that is also bound by Exd-Antp, Exd-UbxIa, and Exd-AbdA heterodimers (32).  #@NEW_LINE#@#  NRLB captures these Hox preferences when scoring both fkh250 and fkh250con (Fig 5A).  #@NEW_LINE#@#  Moreover, the relative affinities predicted for Exd-Scr binding to these two sites are similar, consistent with previous Kd measurements (33).  #@NEW_LINE#@#  
Next, we attempted to identify two functionally validated Exd-UbxIa binding sites in the Distalless minimal element (DME): a noncanonical site previously hypothesized to have a 3-bp spacer between the two ATs [AAATTAAATCAT (spacer underlined) (34)] and a second site with a conventional 2-bp spacer located 16 bp upstream [GAATTTATG (spacer underlined) (35)].  #@NEW_LINE#@#  The NRLB model for Exd-Ubx consists of only a single binding mode with a 2-bp spacer.  #@NEW_LINE#@#  Nevertheless, scanning the DME with this model identified both of these sites, along with two previously uncharacterized sites (Fig 5B).  #@NEW_LINE#@#  We conclude from this that the Exd-UbxIa heterodimer is likely to bind both sites in the same configuration [AAATTAAATCAT (spacer underlined)], and that it is hard to draw correct conclusions about structural mechanism based only a handful of distinct binding sites.  #@NEW_LINE#@#  
We extended this analysis to assess how well the Exd-Hox NRLB models (SI Appendix, Fig S8) identify a total of 96 experimentally validated monomer and heterodimer binding sites for seven Hox factors in 21 enhancer elements reported in the literature (36) (Dataset S3).  #@NEW_LINE#@#  To account for unobserved variation in local free protein concentration from enhancer to enhancer, we assumed that the highest scoring sequence in any particular enhancer is bound at the same (nonsaturating) level.  #@NEW_LINE#@#  A site was classified as bound whenever its affinity was greater than a certain fraction of the highest-affinity site in the same enhancer; this fraction, in turn, was treated as a variable threshold.  #@NEW_LINE#@#  According to a precision-recall curve constructed by treating the regions immediately surrounding binding sites as positive and the remaining regions in the elements as negative (Methods, Fig 5C, and SI Appendix, Fig S16), NRLB substantially outperforms matches to the Hox consensus site TTWATK distilled from bacterial-one-hybrid assays (37) and the general Exd-Hox consensus TGAYNNAY derived from our previous work (13).  #@NEW_LINE#@#  Importantly, and as shown for a specific example below, although we treat any binding site predicted by NRLB that was not confirmed in the literature as a false-positive result, these sites might be functional; therefore, the performance shown in Fig 5C is a lower bound.  #@NEW_LINE#@#  

Detection_and_Validation_of_Ultra-Low-Affinity_Binding_Sites  #@NEW_LINE#@#  
Recent studies have demonstrated that low-affinity binding sites play important roles in vivo in regulating gene expression (1, 2).  #@NEW_LINE#@#  We hypothesized that other low-affinity sites that cannot be identified using existing approaches and have not been experimentally validated may also contribute to regulation.  #@NEW_LINE#@#  We therefore reexamined two shavenbaby (svb) enhancers, E3N and 7H, where low-affinity Exd-Ubx binding sites are required to drive robust and specific gene expression in D. melanogaster embryos (1).  #@NEW_LINE#@#  Significantly, these sites could not be identified using oligomer-enrichment-based affinity tables (1, 13).  #@NEW_LINE#@#  Using the NRLB model trained on R1 data for Exd-UbxIVa (SI Appendix, Fig S8), we identified the three previously validated sites in E3N and four additional sites (Fig 6A); in 7H, we identified two previously validated sites and several additional sites (SI Appendix, Fig S17A).  #@NEW_LINE#@#  To verify the newly identified sites, we first used in vitro binding assays to compare the ability of the nonconsensus E3N WT site 2 sequence to bind Exd-UbxIVa with sites that NRLB predicts to be high affinity or to have an affinity in the nonspecific range.  #@NEW_LINE#@#  As predicted, we found that Exd-UbxIVa binds to both the high-affinity and WT sequences but fails to bind the nonspecific sequence (Fig 6B).  #@NEW_LINE#@#  
Finally, we tested the contribution of several predicted low-affinity sites in E3N and 7H to enhancer activity by sequentially mutating them and measuring reporter gene expression in vivo (Methods, Fig 6C, SI Appendix, Fig S17B, and Dataset S5).  #@NEW_LINE#@#  These assays confirm that the newly discovered low-affinity binding sites in both the E3N and 7H elements contribute to expression (Fig 6D and SI Appendix, Fig S17C; P = 0.001 and P = 0.045, respectively, MannWhitney U test).  #@NEW_LINE#@#  The 7H enhancer shows evidence of saturation (SI Appendix, Fig S17C), consistent with previous results (1).  #@NEW_LINE#@#  Despite the demonstrated ultra-low affinity of the individual binding sites in the E3N enhancer, we found a strong quantitative relationship (R2 = 0.86, P less_than 2.2 × 1016) between expression level as quantified from the 2D embryonic reporter expression pattern and the cumulative binding affinity of the enhancer as predicted by the NRLB model for Exd-Ubx (Fig 6D).  #@NEW_LINE#@#  Unlike for E3N, transcriptional activation by the 7H enhancer saturates at high levels of Exd-Ubx binding (1); similarly good predictions from a DNA sequence could be made for 7H using a simple two-parameter model that accounts for this saturation (SI Appendix, Fig S18).  #@NEW_LINE#@#  
Assuming clusters of binding sites to contribute additively to enhancer activity was previously successful in predicting how enhancer activity is modified by mutations (38).  #@NEW_LINE#@#  Significantly, our computational model was able to predict functional ultra-low-affinity binding from a DNA sequence alone and provide an affinity estimate that correlates well with in vivo expression level.  #@NEW_LINE#@#  


Discussion  #@NEW_LINE#@#  
We designed NRLB to maximize the amount of information that can be derived from a set of millions of DNA ligands sequenced after a single round of in vitro selection.  #@NEW_LINE#@#  NRLB estimates model parameters through a maximum likelihood estimation (MLE) approach that considers all possible binding sites within each ligand.  #@NEW_LINE#@#  This allows sensitive and accurate quantification of DNA binding specificity over the full range (several orders of magnitude) of binding free energy, from optimal to nonspecific, without any prior information.  #@NEW_LINE#@#  Our MLE framework embeds a biophysically interpretable model of proteinDNA interaction within a statistical model of the complete set of sequencing reads sampled in each experiment.  #@NEW_LINE#@#  The resulting software tool allows us to perform near-optimal quantification of in vitro proteinDNA interaction specificity for all eight Drosophila Hox proteins and Exd-Hox complexes, as well as dozens of human TFs in the context of this paper, and should facilitate the creation of a comprehensive resource.  #@NEW_LINE#@#  
Our general methodology can be used to build a sequence-to-affinity model for any TF for which SELEX data are currently available (1114, 23).  #@NEW_LINE#@#  Once learned, these models can transform an organisms genome into a high-resolution (1-bp) affinity landscape to efficiently find biologically relevant binding sites in regulatory DNA.  #@NEW_LINE#@#  NRLB predictions are sufficiently accurate that further validation of these sites using tedious in vitro binding assays of TF-DNA affinity, such as traditional EMSAs, may no longer be required.  #@NEW_LINE#@#  It is now possible to imagine accurate quantitative characterization of DNA binding over the full affinity range for all TFs from any organism whenever high-quality SELEX data are available.  #@NEW_LINE#@#  The fact that we can deal with very large footprint sizes should also make it possible to systematically analyze cooperativity for complexes of two or more TFs for which SELEX libraries are available (14, 39).  #@NEW_LINE#@#  The multiple binding mode functionality in the current implementation should, in principle, allow NRLB to capture both alternative complexes that can form within the same mixture of TFs and alternative configurations (e.g., relative orientation, internal spacers) with which a given multi-TF complex may bind.  #@NEW_LINE#@#  
TF-DNA binding models are typically assessed in terms of their ability to predict in vivo ChIP-seq peaks.  #@NEW_LINE#@#  We believe this is not a sufficiently rigorous test, because peak prediction is a qualitative task and does not account for binding in the low-affinity range.  #@NEW_LINE#@#  Specifically, NRLB performed similarly to DeepBind on the qualitative task of predicting ChIP-seq binding peaks; by contrast, the NRLB model for the human Max protein dramatically outperformed the corresponding DeepBind model for the quantitative task of predicting MITOMI-derived quantitative measures of affinity.  #@NEW_LINE#@#  Thus, the ChIP-seq peak classification performance of a model cannot be used to assess how well it quantifies binding affinity.  #@NEW_LINE#@#  The unprecedented performance of NRLB in predicting functional low-affinity sites in vivo suggests that NRLB will allow the identification of the presence, gain, or loss of binding sites in regulatory DNA with unprecedented sensitivity and accuracy, marking a significant step forward in the identification of noncoding polymorphisms relevant to human disease (40, 41) and evolution (42).  #@NEW_LINE#@#  

Methods  #@NEW_LINE#@#  
Protein_Expression_and_Purification  #@NEW_LINE#@#  
cDNA clones for human C/EBP and ATF4 were obtained from the Dharmacon mammalian clone collection.  #@NEW_LINE#@#  The full-length protein-coding regions were cloned into pet expression vectors containing a C-terminal His-tag.  #@NEW_LINE#@#  Proteins were expressed in competent cells supplying additional rare tRNAs (RosettaTM DE3; Novagen) and purified using TALON Metal Affinity Resins (Clontech).  #@NEW_LINE#@#  For p53, WT (amino acids 1393) and the C-terminal truncated (30, amino acids 1363) p53 proteins were expressed and purified as previously described (25).  #@NEW_LINE#@#  

SELEX-Seq_and_Library_Preparation  #@NEW_LINE#@#  
EMSAs for the human bZIP proteins and extraction of bound DNA were performed as described previously (13, 21).  #@NEW_LINE#@#  Purified bound DNA was amplified using a 15-cycle PCR protocol using Phusion polymerase (New England Biolabs) and overhang primers adding the Illumina adapter sites.  #@NEW_LINE#@#  During each round, a unique Illumina identifier was added in a five-cycle PCR assay, for 20 cycles of PCR in total.  #@NEW_LINE#@#  The indexed libraries were gel-purified as described previously (13, 21).  #@NEW_LINE#@#  R0 and R1 indexed experiments were pooled and sequenced using the v2 high-output 75 cycles kit on an Illumina NEXTSeq Series desktop sequencer.  #@NEW_LINE#@#  R1 SELEX-seq for MAX protein was performed as described previously (22) and sequenced with Illuminas HiSeq system at the New York Genome Center.  #@NEW_LINE#@#  

Hox_Protein_Purification_and_EMSA_Assays  #@NEW_LINE#@#  
EMSAs were performed as described previously (13).  #@NEW_LINE#@#  Proteins were purified as His-tagged fusions from BL21 cells.  #@NEW_LINE#@#  The UbxIVa isoform was used, and the HM isoform of Hth was copurified in complex with His-tagged Exd protein.  #@NEW_LINE#@#  Probe sequences used in the assay can be found in Dataset S2.  #@NEW_LINE#@#  Images were taken using a Typhoon scanner and processed using ImageJ (NIH).  #@NEW_LINE#@#  

Fly_Strains_and_Crosses  #@NEW_LINE#@#  
D. melanogaster strains were maintained under standard laboratory conditions.  #@NEW_LINE#@#  All enhancer constructs were cloned into the placZattB expression construct with an hsp70 promoter.  #@NEW_LINE#@#  Transgenic enhancer constructs were created by Rainbow Transgenic Flies, Inc. and were integrated at the attP2 landing site.  #@NEW_LINE#@#  

Embryo_Manipulations  #@NEW_LINE#@#  
Embryos were raised at 25 °C and were fixed and stained according to standard protocols.  #@NEW_LINE#@#  LacZ protein was detected using an anti-Gal antibody (1:1,000; Promega).  #@NEW_LINE#@#  Detection of primary antibodies was done using secondary antibodies labeled with Alexa Fluor dyes (1:500; Invitrogen).  #@NEW_LINE#@#  

Microscopy  #@NEW_LINE#@#  
Each series of experiments to measure protein levels was performed entirely in parallel.  #@NEW_LINE#@#  Embryo collections, fixations, staining, and image acquisitions were performed side by side in identical conditions.  #@NEW_LINE#@#  Confocal exposures were identical for each series and were set to not exceed the 255 maximum level.  #@NEW_LINE#@#  Series of images were acquired over a 1-d time frame to minimize any signal loss or aberration.  #@NEW_LINE#@#  Confocal images were obtained on a Leica DM5500 Q Microscope with an ACS APO 20×/0.60 IMM CORR lens and Leica Microsystems LAS AP software.  #@NEW_LINE#@#  Sum projections of confocal stacks were assembled, embryos were scaled to match sizes, background was subtracted using a 50-pixel rolling-ball radius, and plot profiles of fluorescence intensity were analyzed using ImageJ software (https://imagej.nih.gov/ij/).  #@NEW_LINE#@#  

NRLB_Model_of_R0_Bias  #@NEW_LINE#@#  
To parameterize the biases in the initial (R0) library with probe sequences with an L-bp-long variable region, we maximize the following likelihood function:L=Sf0(S)y0(S).  #@NEW_LINE#@#  
Here, the product runs over all 4L possible probes S, while y0(S) denotes the observed count in R0.  #@NEW_LINE#@#  The predicted frequency of probe S in R0 is given by f0(S)=w0(S)/Z0, where w0(S)=exp(X(S)) is the Boltzmann weight and Z0=Sw0(S) is the partition function.  #@NEW_LINE#@#  Our assumption is that the R0 biases are due to an accumulation of processes (oligomer synthesis, Klenow double-stranding, and PCR amplification) that are each translationally invariant within the probe but depend on local sequence context.  #@NEW_LINE#@#  Assuming independence between the successive positions along the probe in each process leads naturally to the log-linear (i.e., multiplicative) form of the R0 bias model above; this form is also mathematically convenient, as it enables dynamic programming.  #@NEW_LINE#@#  The set of model features  encompasses all oligomers of length k (or k-mers).  #@NEW_LINE#@#  X(S) represents the number of times k-mer  occurs in sequence S, taking into account k  1 flanking bases up- and downstream of the variable region on the forward strand.  #@NEW_LINE#@#  Z0 is computed using dynamic programming techniques.  #@NEW_LINE#@#  We fit the model parameters  by maximizing the multinomial likelihood L() using the limited memory BroydenFletcherGoldfarbShanno (L-BFGS) algorithm (44).  #@NEW_LINE#@#  The optimal k is selected using cross-validation.  #@NEW_LINE#@#  Further information is provided in SI Appendix, Supplemental Methods.  #@NEW_LINE#@#  

NRLB_Model_of_R1_Probe_Selection  #@NEW_LINE#@#  
To infer the protein-DNA recognition model based on the trends seen in the selected (R1) library, we maximize the following likelihood function:L=Sf1(S)y1(S).  #@NEW_LINE#@#  
Again, the product runs over all 4L possible probes S, while y1(S) denotes the observed count in R1 (or a later round, if necessary).  #@NEW_LINE#@#  The predicted frequency of probe S in R1 is given by f1(S)=w1(S)/Z1, where w1(S)=f0(S)(mv[eG(Sv)/RT]+ens); here, the additional sum is over binding modes m and Z1=Sw1(S), the partition function.  #@NEW_LINE#@#  The views v now include both the forward and reverse orientation and can extend into the up- and downstream regions flanking the variable region.  #@NEW_LINE#@#  While the combined length of the variable region and relevant flanking regions is unlimited in principle, our current code uses an efficient binary representation of a DNA sequence that limits it to 32 bp.  #@NEW_LINE#@#  As with NRLBs R0 bias model, the partition function Z0 is evaluated using dynamic programming techniques.  #@NEW_LINE#@#  We fit the model parameters by maximizing the multinomial likelihood L() using L-BFGS (44).  #@NEW_LINE#@#  Due to the redundant parameterization of the model, the likelihood is invariant to changes in the parameters in certain directions (the null space).  #@NEW_LINE#@#  Different model fits can be compared by projecting out components in this null space.  #@NEW_LINE#@#  Further information is provided in SI Appendix, Supplemental Methods.  #@NEW_LINE#@#  

NRLB_Model_Construction  #@NEW_LINE#@#  
Various settings were used to construct the NRLB models used in this study; a detailed summary can be found in Dataset S1.  #@NEW_LINE#@#  All individual NRLB model fits are unseeded and start from all parameters set equal to zero.  #@NEW_LINE#@#  Further optimization is achieved by shifting the free energy parameters of converged models at all positions by ±1 bp and refitting.  #@NEW_LINE#@#  Optionally, dinucleotide parameters, initially set to zero, are introduced for the best mononucleotide model fit.  #@NEW_LINE#@#  When multiple binding modes are used, only a single mode is learned initially and additional modes are added sequentially.  #@NEW_LINE#@#  Model footprints were increased until the additional parameters were uninformative.  #@NEW_LINE#@#  In general, models with the highest likelihood were chosen.  #@NEW_LINE#@#  

NRLB_Model_Construction_for_HT-SELEX_Data  #@NEW_LINE#@#  
NRLB models were built for 30 of the 35 HT-SELEX datasets used in the DeepBind study (30) (European Nucleotide Archive identifiers ERP001824 and ERP001826).  #@NEW_LINE#@#  Of the five that were excluded, three did not have R0 data (BHLHE41, CTCF, and PRDM1), while two others used variable regions longer than 32 bp (ELK4 and HNF4A), the limit imposed by our current implementation of NRLB.  #@NEW_LINE#@#  R0 bias models were built for each unique probe design; we used 2-mer models as these had robust cross-validation performance for most TFs (R0 library size for HT-SELEX is vastly smaller than SELEX-seq libraries).  #@NEW_LINE#@#  We built selection models with mononucleotide features and nonspecific binding.  #@NEW_LINE#@#  For all TFs, models were constructed for footprint sizes from 8 to 15 bp and a maximum overlap with the constant flanks of 05 bp (a total of 48 hyperparameter combinations).  #@NEW_LINE#@#  Longer footprints were tested if there appeared to be additional specificity outside the 15-mer (EBF1: 816 bp, NFE2: 817 bp, PAX5: 819 bp, and ZNF143: 820 bp).  #@NEW_LINE#@#  In probes with a 30-bp variable region, the overlap with the flanking regions was restricted to 1 bp.  #@NEW_LINE#@#  Reverse complement symmetry was enforced only for factors from the following TF families: bHLH (45), bZIP (28), and AP-2 (46) (Dataset S3).  #@NEW_LINE#@#  Sequence bias frequently produced suboptimal models (compare SI Appendix, Fig S11A), and it was therefore necessary to employ multiple binding modes; all modes shared the same footprint length and symmetry status.  #@NEW_LINE#@#  In some cases, contaminants and/or poor enrichment forced the use of later round data (compare SI Appendix, Fig S11B); in these cases, later rounds were treated in the same way as R1 data.  #@NEW_LINE#@#  Unlike other factors, Max was fit using criteria designed to align its model with that derived from SELEX-seq data (Dataset S1).  #@NEW_LINE#@#  

Selection_of_HT-SELEX_Models  #@NEW_LINE#@#  
As noted by others (30), HT-SELEX datasets (23) can be subject to contamination and sequence bias (compare SI Appendix, Fig S11).  #@NEW_LINE#@#  Consequently, simply using likelihood as the criterion for selecting the best R1 single-mode model from among all footprint and flank hyperparameter combinations discussed above often yields motifs that are incorrect.  #@NEW_LINE#@#  To automate the selection of an appropriate model for each TF in a way that does not consider classification performance on ChIP-seq data, we settled on the following procedure.  #@NEW_LINE#@#  First, we defined a viable model as one that satisfied these criteria: (i) The highest-affinity sequence matches the relevant consensus sequence found in literature up to a 1-bp mismatch (compare SI Appendix, Fig S11B and Dataset S3); (ii) the model contains at least three consecutive positions of considerable specificity ([Gmax  Gmin]/RT  3 for mononucleotide features) (compare SI Appendix, Fig S11C); and (iii) if multiple binding modes were fit simultaneously, only the primary mode (the one with the highest relative affinity) is used.  #@NEW_LINE#@#  Next, starting with R1 data for a given TF, single-mode models for each footprint size and flank hyperparameter combination that were deemed viable were ranked by likelihood.  #@NEW_LINE#@#  If no viable models were found, the number of binding modes was incremented by one and the process was repeated.  #@NEW_LINE#@#  If no viable models were found using three binding modes, the enrichment round was incremented by one and the number of binding modes was reset to one.  #@NEW_LINE#@#  The first viable motif thus selected for each TF was used in all subsequent analyses.  #@NEW_LINE#@#  

Visualization_of_Dinucleotide_Models  #@NEW_LINE#@#  
Models with dinucleotide features were summarized in terms of the model-predicted relative affinity of all sequences a single point mutation away from the highest-affinity sequence and visualized as an energy logo (19), which was created using the LogoGenerator tool from the REDUCE Suite (reducesuite.bussemakerlab.org).  #@NEW_LINE#@#  The highest-affinity sequence was determined using a tailor-made dynamic programming algorithm.  #@NEW_LINE#@#  

Observed_and_Predicted_Sequencing_Rate_Comparisons  #@NEW_LINE#@#  
These comparisons assume that the observed SELEX read counts follow a Poisson distribution whose rate parameter  (normalized for library size) is determined by the model in question.  #@NEW_LINE#@#  As such, for a given probe, the predicted sequencing rate and variance are both .  #@NEW_LINE#@#  In practice, there are many more possible SELEX probes than reads, resulting in most reads never being observed (or only once), making it impossible to compute the observed sequencing rate and variance for each probe.  #@NEW_LINE#@#  To practically compare the observed sequencing rate, we aggregate probes by their model predicted sequencing rates .  #@NEW_LINE#@#  Computing the observed sequencing rate then requires knowledge of the number of probes and their total sequenced count within each bin.  #@NEW_LINE#@#  Depending on the dataset and model, slight variations in the computation of the observed sequencing rate are required.  #@NEW_LINE#@#  Once computed, comparing observed and predicted sequencing rates is trivial.  #@NEW_LINE#@#  

Prediction_of_R1_Oligomer_Counts  #@NEW_LINE#@#  
The R/Bioconductor package SELEX version 1.6.0 (bioconductor.org/packages/SELEX) was used to determine the observed R1 count for all 10mers.  #@NEW_LINE#@#  For each 10mer occurring at least 100 times, a predicted count was computed by summing the predicted frequency of all probes containing it at any offset and then multiplying by the total number of reads in R1.  #@NEW_LINE#@#  Observed and predicted count values were compared using a linear fit.  #@NEW_LINE#@#  

Scoring_Genomic_Sequences_with_NRLB  #@NEW_LINE#@#  
For an NRLB model with footprint K and a target sequence of length L, relative affinity scores were computed at all 2(L  K + 1) views in the forward and reverse directions.  #@NEW_LINE#@#  If included, the nonspecific binding term inferred on SELEX-seq data was rescaled by explicitly considering the effective length of the DNA ligands in each technology, without adjustable parameters.  #@NEW_LINE#@#  Total affinity for the target sequence is the sum of all affinity contributions.  #@NEW_LINE#@#  G/RT for the target sequence is the logarithm of this sum.  #@NEW_LINE#@#  

Scoring_Sequences_with_DeepBind  #@NEW_LINE#@#  
DNA sequences were scored using the v0.11 scoring tool available at tools.genes.toronto.edu/deepbind/download.html and the interactive database located at tools.genes.toronto.edu/deepbind/.  #@NEW_LINE#@#  The raw score was used in further analyses, as this value corresponds to G/RT.  #@NEW_LINE#@#  To construct the histograms required for the analysis in SI Appendix, Figs.  #@NEW_LINE#@#  S13 and S15, we modified the C code of the DeepBind scoring tool to implement the WangLandau algorithm (47).  #@NEW_LINE#@#  

Comparison_with_MITOMI_Binding_Free_Energy  #@NEW_LINE#@#  
MITOMI ligand sequences were scored using NRLB and DeepBind models to obtain predicted G/RT values as described above, which were then compared with MITOMI observed G/RT values using a linear fit.  #@NEW_LINE#@#  Scores were shifted such that the target sequence with the highest score was set to G/RT = 0.  #@NEW_LINE#@#  

ChIP-Seq_Peak_Classification  #@NEW_LINE#@#  
NRLB and DeepBind models for 30 TFs in the HT-SELEX dataset (Dataset S3) were compared using AUC metrics.  #@NEW_LINE#@#  For NRLB, only the primary binding mode was used to score sequences, even if multiple binding modes had been used during the fit to HT-SELEX data.  #@NEW_LINE#@#  Positive and negative sets were constructed in three different ways: (i) The DeepBind method used the same 500 positive and 500 shuffled negative sequences derived from ENCODE ChIP-seq datasets as (30) for each TF, (ii) the ENCODE Top 500 method used the same ENCODE ChIP-seq datasets as Alipanahi et al.  #@NEW_LINE#@#  (30) but restricted the analysis to the 500 highest peaks, and (iii) the ENCODE Bottom 500 method used the 500 lowest peaks among those with a significant quality value (qValue).  #@NEW_LINE#@#  For the last two methods, positive sequences were defined as a 101-bp window centered around the midpoint of each peak; following Bell et al.  #@NEW_LINE#@#  (48), for each positive sequence, two corresponding negative sequences were defined as a 101-bp window centered exactly one peaks width upstream or downstream of the peak midpoint.  #@NEW_LINE#@#  Since this yields 500 positive and 1,000 negative sequences, we use area under the precision-recall curve to quantify classification performance.  #@NEW_LINE#@#  

Quantitative_Validation_of_HT-SELEX_Models  #@NEW_LINE#@#  
Quantitative comparisons for 27 of the 30 NRLB and DeepBind models used in the ChIP-seq classification task were run on R1 HT-SELEX data from the more deeply sequenced technical replicate (24) of the original dataset (23) (European Nucleotide Archive identifier PRJEB14744).  #@NEW_LINE#@#  The three models that were excluded did not have R1 data in this newly sequenced replicate (E2F1, ELF1, and SP1).  #@NEW_LINE#@#  For the comparisons, it was unknown how much of the flanking regions the DeepBind model was trained on; to account for this, all probe scores were computed, including 10-bp flanking regions.  #@NEW_LINE#@#  In the analyses below, either the raw DeepBind probe scores or the log of the total probe binding affinity as predicted by the reduced NRLB binding model (no R0 bias) was used.  #@NEW_LINE#@#  

Identification_of_Validated_Hox_Binding_Sites  #@NEW_LINE#@#  
We curated 96 functionally validated Hox and Exd-Hox binding sites in 21 different enhancer elements in D. melanogaster based on available reporter data from 31 studies (36) (Dataset S4).  #@NEW_LINE#@#  The genomic context of a binding site was determined based on the most minimal enhancer element used in the reporter assay, and genomic coordinates were standardized to release 5 (dm3) of the D. melanogaster genome using DNA sequence information reported in the studies.  #@NEW_LINE#@#  Partial matches to the entire validated binding site sequence were used to identify binding site offsets within the enhancer elements.  #@NEW_LINE#@#  To account for variation in the position of the 12-bp core binding region within NRLB models, and for experimental error in identifying the true location of the binding site within the enhancer, any model-predicted site overlapping a region extending K  1 nucleotides up- and downstream of an experimentally validated binding site was considered a match, where K denotes the footprint of the model.  #@NEW_LINE#@#  Any model-predicted site outside of this extended region was considered a false-positive result.  #@NEW_LINE#@#  
Enhancer elements were scored using mononucleotide and dinucleotide NRLB models as described above.  #@NEW_LINE#@#  By default, the appropriate Hox monomer model (SI Appendix, Fig S8) was used unless the study stated that both Exd and Hox regulated the target; if so, the appropriate Exd-Hox heterodimer model among the multiple binding modes in the model was used (SI Appendix, Fig S8 and Dataset S4).  #@NEW_LINE#@#  To account for variations in local protein concentration, all affinities within an enhancer element were normalized to the highest-affinity sequence in the particular enhancer (resulting in the normalized affinities varying between 0 and 1 for all sites in all enhancers).  #@NEW_LINE#@#  Potential binding windows in the element were considered functionally important if their normalized affinity was at or above a threshold T. Precision and recall were computed for all enhancer elements for all values of T between 0 and 1.  #@NEW_LINE#@#  A similar analysis was performed to assess the performance of sequence gazing methods.  #@NEW_LINE#@#  The consensus TTWATK was used for Hox sites, and TGAYNNAY was used for Exd-Hox sites; the former was derived by us from bacterial one-hybrid results (37), and the latter was adopted from the method of Slattery et al.  #@NEW_LINE#@#  (13).  #@NEW_LINE#@#  Sites were deemed functional if they matched the consensus.  #@NEW_LINE#@#  In the absence of a thresholding parameter, only a single precision and recall pair was computed.  #@NEW_LINE#@#  

Reporter_Assay_Analysis  #@NEW_LINE#@#  
The significance of potential low-affinity sites was established using MannWhitney U tests on the recorded intensities (Dataset S5).  #@NEW_LINE#@#  The cumulative affinity of the various E3N and 7H sequences used in the reporter assays was computed by summing relative affinity over all views on the E3N and 7H genomic regions as scored by the single 18-bp heterodimer mode from a multiple binding mode fit for Exd-UbxIVa (SI Appendix, Fig S8).  #@NEW_LINE#@#  The logarithm base 10 of the E3N reporter intensity values was fit to the rescaled total affinities using linear regression.  #@NEW_LINE#@#  The E3N and 7H reporter intensity values were also fit to a logistic model of expression saturation using nonlinear least squares; parameter values were checked for significance using an F-test.  #@NEW_LINE#@#  

Data_and_Software_Availability  #@NEW_LINE#@#  


Acknowledgments  #@NEW_LINE#@#  
We thank members of the H.J.B., R.S.M., and R. Rohs labs for valuable discussions.  #@NEW_LINE#@#  This work was supported by NIH Grants R01HG003008 (to H.J.B.  #@NEW_LINE#@#  ), R35GM118336 (to R.S.M.  #@NEW_LINE#@#  ), and CA87497 and CA196234 (to C.P.  #@NEW_LINE#@#  ); NIH Training Grant T32GM08279707 (to C.R.  #@NEW_LINE#@#  ); and a Howard Hughes Medical Institute International Student Research Fellowship (to J.F.K.).  #@NEW_LINE#@#  Columbia Universitys Shared Research Computing Facility is supported by NIH Grant G20RR030893 and Empire State Developments Division of Science, Technology and Innovation (NYSTAR) Contract C090171.  #@NEW_LINE#@#  

Footnotes  #@NEW_LINE#@#  

This open access article is distributed under Creative Commons Attribution-NonCommercial-NoDerivatives License 4.0 (CC BY-NC-ND).  #@NEW_LINE#@#  

