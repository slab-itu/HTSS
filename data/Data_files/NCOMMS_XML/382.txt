article id="http://dx.doi.org/10.1038/NCOMMS11712"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Numerical approach for unstructured quantum key distribution  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
'Quantum key distribution (QKD) allows for communication with security guaranteed by quantum theory.  #@NEW_LINE#@#  The main theoretical problem in QKD is to calculate the secret key rate for a given protocol.  #@NEW_LINE#@#  Analytical formulas are known for protocols with symmetries, since symmetry simplifies the analysis.  #@NEW_LINE#@#  However, experimental imperfections break symmetries, hence the effect of imperfections on key rates is difficult to estimate.  #@NEW_LINE#@#  Furthermore, it is an interesting question whether (intentionally) asymmetric protocols could outperform symmetric ones.  #@NEW_LINE#@#  Here we develop a robust numerical approach for calculating the key rate for arbitrary discrete-variable QKD protocols.  #@NEW_LINE#@#  Ultimately this will allow researchers to study unstructured protocols, that is, those that lack symmetry.  #@NEW_LINE#@#  Our approach relies on transforming the key rate calculation to the dual optimization problem, which markedly reduces the number of parameters and hence the calculation time.  #@NEW_LINE#@#  We illustrate our method by investigating some unstructured protocols for which the key rate was previously unknown.'  #@NEW_LINE#@#  

Introduction  #@NEW_LINE#@#  
'Quantum key distribution (QKD) will play an important role in quantum-safe cryptography, that is, cryptography that addresses the emerging threat of quantum computers1.  #@NEW_LINE#@#  Since its original proposal2,3, QKD has developed significantly over the past three decades4,5, both in theory and implementation.  #@NEW_LINE#@#  Indeed, QKD is now a commercial technology, with the prospect of global QKD networks on the horizon6,7.  #@NEW_LINE#@#  ', 'The main theoretical problem in QKD is to calculate how much secret key can be distributed by a given protocol.  #@NEW_LINE#@#  A crucial practical issue is that the QKD protocols that are easiest to implement with existing optical technology do not necessarily coincide with the protocols that are easiest to analyse theoretically4.  #@NEW_LINE#@#  Currently, calculating the secret key output of a protocol is typically extremely technical, and hence only performed by skilled experts.  #@NEW_LINE#@#  Furthermore, each new protocol idea requires a new calculation, tailored to that protocol.  #@NEW_LINE#@#  Ultimately, the technical nature of these calculations combined with the lack of universal tools limits the pace at which new QKD protocols can be discovered and analysed.  #@NEW_LINE#@#  Here we address this problem by developing a robust, user-friendly framework for calculating the secret key output, with the hope of bringing such calculations to the masses.  #@NEW_LINE#@#  ', 'The secret key output is typically quantified by the key rate, which refers to the number of bits of secret key established divided by the number of distributed quantum systems.  #@NEW_LINE#@#  Operationally, this corresponds to the question of how much privacy amplification Alice and Bob must apply to transform their raw key into the final secure key.  #@NEW_LINE#@#  Analytical simplifications of the key rate calculation can be made for some special protocols that have a high degree of symmetry8.  #@NEW_LINE#@#  Examples of such symmetric protocols, where the signal states have a group-theoretic structure, include the BB84 (ref.  #@NEW_LINE#@#  3) and six-state protocols9.  #@NEW_LINE#@#  Indeed the key rate is known for these protocols.  #@NEW_LINE#@#  However, in practice, lack of symmetry is the rule rather than the exception.  #@NEW_LINE#@#  That is, even if experimentalists try to implement a symmetric protocol, experimental imperfections tend to break symmetries10.  #@NEW_LINE#@#  Furthermore, it is sometimes desirable due to optical hardware issues to implement asymmetric protocols, for example, as in ref.  #@NEW_LINE#@#  11.  #@NEW_LINE#@#  ', 'We refer to general QKD protocols involving signal states or measurement choices that lack symmetry as unstructured protocols.  #@NEW_LINE#@#  Some recent work has made progress in bounding the key rate for special kinds of unstructured protocols, such as four-state protocols in refs 12, 13 and qubit protocols in ref.  #@NEW_LINE#@#  14.  #@NEW_LINE#@#  Still, there is no general method for computing tight bounds on the key rate for arbitrary unstructured protocols.  #@NEW_LINE#@#  Yet, these are the protocols that are most relevant to experimental implementations.  #@NEW_LINE#@#  ', 'This motivates our present work, in which we develop an efficient, numerical approach to calculating key rates.  #@NEW_LINE#@#  Our ultimate aim is to develop a computer program, where Alice and Bob input a description of their protocol (for example, their signal states, measurement devices, sifting procedure and key map) and their experimental observations, and the computer outputs the key rate for their protocol.  #@NEW_LINE#@#  This program would allow for any protocol, including those that lack structure.  #@NEW_LINE#@#  ', 'At the technical level, the key rate problem is an optimization problem, since one must minimize the well-known entropic formula for the key rate15, over all states AB that satisfy Alices and Bobs experimental data.  #@NEW_LINE#@#  The main challenge here is that this optimization problem is unreliable and inefficient.  #@NEW_LINE#@#  In this work, we give a novel insight that transforming to the dual problem (for example, see ref.  #@NEW_LINE#@#  16) resolves these issues, hence paving the way for automated key rate calculations.  #@NEW_LINE#@#  ', 'Specifically, the unreliable (or unphysical) aspect of the primal problem is that it is a minimization, hence the output will in general be an upper bound on the key rate.  #@NEW_LINE#@#  But one is typically more interested in reliable lower bounds, that is, physically achievable key rates.  #@NEW_LINE#@#  Transforming to the dual problem allows one to formulate the problem as a maximization, and hence approach the key rate from below.  #@NEW_LINE#@#  Therefore, every number outputted from our computer program represents an achievable asymptotic key rate, even if the computer did not reach the global maximum.  #@NEW_LINE#@#  ', 'The inefficient aspect of the primal problem is that the number of parameters grows as  for a state AB with  and .  #@NEW_LINE#@#  For example, if dA=dB=10, the number of parameters that one would have to optimize over is 10,000.  #@NEW_LINE#@#  In contrast, in the dual problem, the number of parameters is equal to the number of experimental constraints that Alice and Bob choose to impose.  #@NEW_LINE#@#  For example, in the generalization of the BB84 protocol to arbitrary dimensions17,18, Alice and Bob typically consider two constraints, their error rates in the two mutually-unbiased bases (MUBs).  #@NEW_LINE#@#  So, for this protocol, we have reduced the number of parameters to something that is constant in dimension.  #@NEW_LINE#@#  We, therefore, believe that our approach (of solving the dual problem) is ideally suited to efficiently calculate key rates in high dimensions.  #@NEW_LINE#@#  ', 'We have written a MATLAB program to implement our key rate calculations.  #@NEW_LINE#@#  To illustrate the validity of our program, we show (Fig 1) that it exactly reproduces the known theoretical dependence of the key rate on error rate, for both the BB84 and six-state protocols.  #@NEW_LINE#@#  ', 'Figure 1: Key rate for two well-known QKD protocols.Here we compare our numerics (from Theorem 1) with the theoretical curves.  #@NEW_LINE#@#  The results of our numerical optimization for the BB84 and six-state protocols are respectively shown as red and blue dots.  #@NEW_LINE#@#  The known theoretical curves for these protocols are also shown as black dashed lines.  #@NEW_LINE#@#  The dots should be viewed as reliable lower bounds on the key rate, but in this case they happen to be perfectly tight, coinciding with the theoretical curves.Full size image', 'But ultimately the strength of our approach is its ability to handle unstructured protocols.  #@NEW_LINE#@#  We demonstrate this by investigating some unstructured protocols for which the key rates were not previously known.  #@NEW_LINE#@#  For example, we study a general class of protocols where Alice and Bob measure n MUBs, with 2nd+1, in dimension d. Also, we investigate the B92 protocol19, which involves two signal states whose inner product is arbitrary.  #@NEW_LINE#@#  Our key rates are higher than known analytical lower bounds20,21 for B92.  #@NEW_LINE#@#  Finally, we argue that our approach typically gives markedly higher key rates than those obtained from an analytical approach based on the entropic uncertainty relation22,23.  #@NEW_LINE#@#  ', 'We focus on asymptotic key rates in this work.  #@NEW_LINE#@#  Nevertheless, the optimization problem that we solve is also at the heart of finite-key analysis, for example, see refs 24, 25.  #@NEW_LINE#@#  We, therefore, hope to extend our approach to the finite-key scenario in future efforts.  #@NEW_LINE#@#  We remark that finite-size effects generally reduce the key rate below its asymptotic value.  #@NEW_LINE#@#  ', 'In what follows, we first present our main result: a reformulation of the key rate optimization problem in such a way that it is easily computable.  #@NEW_LINE#@#  We then outline our general framework for treating a broad range of protocols.  #@NEW_LINE#@#  Finally, we illustrate our approach with various examples.'  #@NEW_LINE#@#  

Results  #@NEW_LINE#@#  
'Setup of the problem', 'Consider a general entanglement-based QKD protocol involving finite-dimensional quantum systems A and B that are respectively received by Alice and Bob.  #@NEW_LINE#@#  Note that prepare-and-measure QKD protocols can be recast as entanglement-based protocols, as discussed below.  #@NEW_LINE#@#  For simplicity of presentation, we consider protocols where Alices raw key is derived from a measurement on her system, possibly after some post-selection corresponding to a public announcement with a binary outcome, pass or fail.  #@NEW_LINE#@#  However, our approach can easily be extended to more general protocols.  #@NEW_LINE#@#  ', 'Let ZA (ZB) denote the measurement that Alice (Bob) performs on system A (B) to derive the raw key.  #@NEW_LINE#@#  Suppose they use one-way direct reconciliation for the classical post-processing and that their error correction is optimal (that is, leaks out the minimum number of bits), then the asymptotic key rate is given by the DevetakWinter formula15:', '', 'In equation (1), H(X|Y):=H(XY)H(Y) is the conditional von Neumann entropy, with , and', '', '', 'Here ABE is the tripartite density operator shared by Alice, Bob and Eve (and it may be the state after some post-selection procedure, see our general framework below).  #@NEW_LINE#@#  Also,  and  are the sets of positive operator valued measure (POVM) elements associated with Alices and Bobs key-generating measurements.  #@NEW_LINE#@#  In what follows we refer to  as the key-map POVM.  #@NEW_LINE#@#  ', 'In the previous paragraph and in what follows, we assume that the state shared by Alice, Bob and Eve has an i.i.d.  #@NEW_LINE#@#  (independent, identically distributed) structure, and hence it makes sense to discuss the state ABE associated with a single round of quantum communication.  #@NEW_LINE#@#  To avoid confusion, we emphasize that our approach is unstructured in the sense of lacking structure for a given round of quantum communication, but we do impose the i.i.d.  #@NEW_LINE#@#  structure that relates one round to other rounds.  #@NEW_LINE#@#  This i.i.d.  #@NEW_LINE#@#  structure corresponds to Eve doing a so-called collective attack.  #@NEW_LINE#@#  However, the security of our derived asymptotic key rate also holds against the most general attacks (coherent attacks) if one imposes that the protocol involves a random permutation of the rounds (a symmetrization step) such that the de Finetti theorem26,27 or the post-selection technique28 applies.  #@NEW_LINE#@#  ', 'Typically, Alices and Bobs shared density operator AB is unknown to them.  #@NEW_LINE#@#  A standard part of QKD protocols is for Alice and Bob to gather data through local measurements, and in a procedure known as parameter estimation, they use this data to constrain the form of AB.  #@NEW_LINE#@#  The measurements used for this purpose can, in general, be described by bounded Hermitian operators i, with the set of such operators denoted by .  #@NEW_LINE#@#  ', 'From their data, Alice and Bob determine the average value of each of these measurements:', '', 'and this gives a set of experimental constraints:', '', 'We denote the set of density operators that are consistent with these constraints as:', '', 'where  denotes the set of positive semidefinite operators on , and an additional constraint  is assumed to be added to the set C to enforce normalization.  #@NEW_LINE#@#  ', 'Because Alice and Bob typically do not perform full tomography on the state,  includes many density operators, and hence the term H(ZA|E) in equation (1) is unknown.  #@NEW_LINE#@#  To evaluate the key rate, Alice and Bob must consider the most pessimistic of scenarios where H(ZA|E) takes on its smallest possible value that is consistent with their data.  #@NEW_LINE#@#  This is a constrained optimization problem, given by', '', 'where Eves system E can be assumed to purify AB since it gives Eve the most information.  #@NEW_LINE#@#  Here the number of parameters in the optimization is (dAdB)2, corresponding to the number of parameters in a positive semidefinite operator on .  #@NEW_LINE#@#  We refer to equation (7) as the primal problem.  #@NEW_LINE#@#  ', 'Main result', 'Our main result is a reformulation of the optimization problem in equation (7).  #@NEW_LINE#@#  ', 'Theorem 1: The solution of the minimization problem in equation (7) is lower bounded by the following maximization problem:', '', 'where', '', 'and', '', 'In equation (9), the optimization is over all vectors ={i}, where the i are arbitrary real numbers and the cardinality of  is equal to that of .  #@NEW_LINE#@#  Also,  denotes the supremum norm of M, which is the maximum eigenvalue of M when M is positive semidefinite, as in equation (9).  #@NEW_LINE#@#  ', 'The proof of Theorem 1 is given in the Methods section.  #@NEW_LINE#@#  It relies on the duality of convex optimization problems, as well as some entropic identities that allow us to simplify the dual problem.  #@NEW_LINE#@#  Note that the term H(ZA|ZB) in equation (8) is pulled outside of the optimization since Alice and Bob can compute it directly from their data.  #@NEW_LINE#@#  ', 'The cardinalities of the sets  and  are the same.  #@NEW_LINE#@#  This means that the number of parameters i that one must optimize over, to solve equation (9), is equal to the number of experimental constraints that Alice and Bob have.  #@NEW_LINE#@#  (More precisely this is the number of independent constraints, since one can eliminate constraints that carry redundant information.)  #@NEW_LINE#@#  This has the potential to be significantly less than the number of parameters in the primal problem.  #@NEW_LINE#@#  Indeed, we demonstrate below that equation (9) can be easily solved using MATLAB on a personal computer for a variety of interesting QKD protocols.  #@NEW_LINE#@#  ', 'Formulating constraints', 'For a given protocol, how does one decide which constraints to include in the set C?  #@NEW_LINE#@#  Consider the following remarks.  #@NEW_LINE#@#  First, adding in more constraints will never decrease the key rate obtained from our optimization.  #@NEW_LINE#@#  This follows since adding a new constraint gives an additional i to maximize over, while setting this new i to zero recovers the old problem.  #@NEW_LINE#@#  Second, coarse-graining constraints, that is, merging two constraints i=i and j=j into a single constraint i+j=i+j, will never increase the key rate obtained from our optimization.  #@NEW_LINE#@#  This follows since merging two constraints means that two is are merged into a single i, thus restricting the optimization.  #@NEW_LINE#@#  Hence, to obtain the highest key rates, one should input all of ones refined knowledge that is available into our optimization.  #@NEW_LINE#@#  On the other hand, coarse graining reduces the number of constraints and thus may help to simplify the optimization problem, possibly at the cost of a reduced key rate.  #@NEW_LINE#@#  ', 'Ones refined knowledge is captured as follows.  #@NEW_LINE#@#  In a general entanglement-based protocol, Alice measures a POVM (whose elements may be non-commuting, for example, if she randomly measures one of two MUBs), which we denote as A={A,i}.  #@NEW_LINE#@#  Likewise Bobs corresponding POVM is B={B,i}.  #@NEW_LINE#@#  Hence, through public discussion, Alice and Bob obtain knowledge of expectation values of the form', '', 'These constraints form the set C in equation (5).  #@NEW_LINE#@#  We remark that it is common in the QKD field to express correlations in terms of average error rates rather than in terms of the joint probability distribution in equation (11).  #@NEW_LINE#@#  This is an example of the coarse graining that we mentioned above.  #@NEW_LINE#@#  For simplicity of presentation, we will do this sort of coarse graining for some protocols that we investigate below, although equation (11) represents our general framework for constructing C.', 'Framework for prepare and measure', 'While our approach is stated in the entanglement-based scenario, let us note how it applies to prepare-and-measure protocols.  #@NEW_LINE#@#  Consider a prepare-and-measure protocol involving a set of N signal states {|j}, which Alice sends with probabilities {pj}.  #@NEW_LINE#@#  It is well-known that prepare-and-measure protocols can be recast as entanglement-based protocols using the source-replacement scheme (see, for example, refs 4, 8, 29).  #@NEW_LINE#@#  Namely, one forms the entangled state:', '', 'One imagines that Alice keeps system A, while system A is sent over an insecure quantum channel  to Bob, resulting in', '', 'The numerical optimization approach described above can then be applied to the state AB in equation (13).  #@NEW_LINE#@#  However, in addition to the constraints obtained from Alices and Bobs measurement results, we must add in further constraints to account for the special form of AB.  #@NEW_LINE#@#  In particular, note that the partial trace over B gives', '', 'The form of A, which is closely related to Gram matrix, depends on the inner products between the signal states, which (we assume) Alice knows.  #@NEW_LINE#@#  Suppose {i} is a set of tomographically complete observables on system A, then one can add in the calculated expectation values {i} of these observables into the set of constraints.  #@NEW_LINE#@#  That is, add', '', 'to the set C in equation (5).  #@NEW_LINE#@#  This will capture Alices knowledge of her reduced density operator.  #@NEW_LINE#@#  ', 'Framework for decoy states', 'In decoy-state QKD30, which aims to combat photon-number splitting attacks, Alice prepares coherent states of various intensities and then randomizes their phases before sending them to Bob.  #@NEW_LINE#@#  Our framework can handle decoy states simply by allowing for additional signal states to be added to the set {|j} in equation (12).  #@NEW_LINE#@#  For example, to treat decoy protocols with partial phase randomization31, one can consider signal states that are bipartite (on the signal mode S and the reference mode R) of the form', '', 'where j is the amplitude of the coherent state associated with the jth intensity setting, k is the kth phase used in phase randomization, and l is the phase Alice uses to encode her information (for example, for generating key).  #@NEW_LINE#@#  Decoy protocols with complete phase randomization are also treatable in our framework, namely, by adding in a signal state for each photon-number basis state (up to a cutoff), and treating multi-photon signals as orthogonal states (so-called tagged states) since Eve can perfectly distinguish them.  #@NEW_LINE#@#  ', 'Framework for MDI QKD', 'A special kind of prepare-and-measure protocol is measurement-device-independent (MDI) QKD32.  #@NEW_LINE#@#  In MDI QKD, Alice prepares states {|j} with probabilities {pj} and sends them to Charlie, and Bob does the same procedure as Alice (Fig 2).  #@NEW_LINE#@#  Charlie typically does a Bell-basis measurement, however the security proof does not assume this particular form of measurement.  #@NEW_LINE#@#  Charlie announces the outcome of his measurement, which we denote by the classical register M. Our framework for treating MDI QKD considers the tripartite state ABM, where A and B, respectively, are Alices and Bobs systems in the source-replacement scheme, playing the same role as system A in equation (12) (see Supplementary Note 1 for elaboration).  #@NEW_LINE#@#  For our numerics, we impose the constraint that the marginal AB=AB is fixed (since Eve cannot access A and B), with A and B given by the form in equation (14).  #@NEW_LINE#@#  We enforce this constraint using the same approach as used in equation (15) to fix A for prepare-and-measure protocols.  #@NEW_LINE#@#  The only other constraints we impose are the usual correlation constraints, that is, a description of the joint probability distribution for the standard bases on A, B and M, of the form', 'Figure 2: Key rate for MDI QKD with the BB84 signal states.The inset shows the basic idea of MDI QKD: Alice and Bob each prepare a signal state and send it to an untrusted node, which performs an (untrusted) Bell-basis measurement and announces the outcome.  #@NEW_LINE#@#  Our numerics (circular dots) essentially reproduce the known theoretical dependence of the key rate on the error rate (dashed curve), which is the same expression as that given in (20).  #@NEW_LINE#@#  See Supplementary Note 1 for elaboration.Full size image', '', 'Framework for post-selection and announcements', 'In general, a QKD protocol may involve post-selection.  #@NEW_LINE#@#  As an example, if Alice sends photons to Bob over a lossy channel, then they may post-select on rounds in which Bob detects a photon.  #@NEW_LINE#@#  As noted above, for simplicity we consider protocols where the post-selection involves a binary announcement, and Alice and Bob keep (discard) rounds when pass (fail) is announced.  #@NEW_LINE#@#  Let  be the completely positive linear map corresponding to the post-selection.  #@NEW_LINE#@#  The action of  is given by a single Kraus operator G, corresponding to the pass announcement.  #@NEW_LINE#@#  ', 'The key rate formula (1) should be applied to the post-selected state:', '', 'where  is the probability for passing the post-selection filter.  #@NEW_LINE#@#  We remark that since  is given by a single Kraus operator, it maps pure states to pure states, and hence taking Eves system to purify the post-selected state  is equivalent to taking it to purify AB.  #@NEW_LINE#@#  Hence applying the key rate formula to  does not give Eve access to any more than she already has, and hence does not introduce any looseness into our bound.  #@NEW_LINE#@#  Future extension of our work to more general maps  will need to carefully account for how Eves system is affected by , so as not to lose key rate from this proof technique.  #@NEW_LINE#@#  ', 'The only issue is that Alices and Bobs experimental constraints C in equation (5) are still in terms of state AB.  #@NEW_LINE#@#  To solve for the key rate, one must transform these constraints into constraints on .  #@NEW_LINE#@#  For the special case where  has an inverse  that is also completely positive, one can simply insert the identity channel  into the expression .  #@NEW_LINE#@#  Using cyclic permutation under the trace, we transform equation (5) into a set of constraints on ,', '', 'where the  are Hermitian operators, with  being the adjoint of , and .  #@NEW_LINE#@#  Note that ppass is determined experimentally and hence the  are known to Alice and Bob.  #@NEW_LINE#@#  More generally, we provide a method for obtaining  for arbitrary , as described in Supplementary Note 2.  #@NEW_LINE#@#  ', 'We remark that public announcements can be treated with a simple extension of our post-selection framework.  #@NEW_LINE#@#  While our framework directly applies to announcements with only two outcomes corresponding to pass or fail (as discussed above), more general announcements can be treated by adding classical registers that store the announcement outcomes.  #@NEW_LINE#@#  Our treatment of MDI QKD is an example of this approach (Fig 2 and Supplementary Note 1).  #@NEW_LINE#@#  Additional examples that could be treated in this way are protocols with two-way classical communication33 such as advantage distillation.  #@NEW_LINE#@#  ', 'Outline of examples', 'We now illustrate our numerical approach for lower bounding the key rate by considering some well-known protocols.  #@NEW_LINE#@#  First, we consider the BB84 and six-state protocols (Fig 1), MDI QKD with BB84 states (Fig 2), and the generalized BB84 protocol involving two MUBs in any dimension (Fig 3).  #@NEW_LINE#@#  In each case, the dependence of the key rate on error rate is known, and we show that our numerical approach exactly reproduces these theoretical dependences.  #@NEW_LINE#@#  After considering these structured protocols, we move on to using our numerical optimization for its intended purpose: studying unstructured protocols.  #@NEW_LINE#@#  The fact that our bound is tight for the structured protocols mentioned above gives reason to suspect that we will get strong bounds in the unstructured case.  #@NEW_LINE#@#  We investigate below a protocol involving n MUBs, a protocol involving bases with arbitrary angle between them, and the B92 protocol.  #@NEW_LINE#@#  ', 'Figure 3: Higher dimensional analog of BB84, using two MUBs.This plot shows the theoretical key rate as solid curves, and the result of our numerical optimization as circular dots, for dA=dB=d, with d=6 (blue), d=8 (red), and d=10 (black).  #@NEW_LINE#@#  Again, the dots should be viewed as reliable lower bounds, but in this case they are perfectly tight.Full size image', 'BB84 example', 'Consider an entanglement-based version of the BB84 protocol3, where Alice and Bob each receive a qubit and measure either in the Z={|0, |1} or X={|+, |} basis, where .  #@NEW_LINE#@#  For all protocols that we discuss, we assume perfect sifting efficiency, which can be accomplished asymptotically via asymmetric basis choice34.  #@NEW_LINE#@#  Let us suppose that Alice and Bob each use their Z basis to generate key.  #@NEW_LINE#@#  For simplicity, suppose they observe that their error rates in the Z and X bases are identical and equal to Q, then it is known (see, for example, ref.  #@NEW_LINE#@#  4) that the key rate is given by', '', 'where  is the binary entropy.  #@NEW_LINE#@#  ', 'To reproduce this result using our numerics, we write the optimization problem as follows:', '', '', '', '', 'where the error operators are defined as', '', '', 'Equations (21)(24), highlight the fact that, as far as the optimization in equation (9) is concerned, a QKD protocol is defined by the POVM elements used for generating the key and the experimental constraints used for parameter estimation (and also the post-selection map , but this is trivial for the ideal BB84 protocol).  #@NEW_LINE#@#  Once these things are specified, the protocol is defined and the key rate is determined.  #@NEW_LINE#@#  Numerically solving the problem defined in equations (21)(24) for several values of Q leads to the red dots in Fig 1, which agree perfectly with the theory curve.  #@NEW_LINE#@#  ', 'Six state example', 'Now consider an entanglement-based version of the six-state protocol, where Alice and Bob each measure one of three MUBs (X, Y or Z) on their qubit.  #@NEW_LINE#@#  Suppose that Alice and Bob observe that their error rates in all three bases are identical, EX=EY=EZ=Q, where', '', 'with .  #@NEW_LINE#@#  (Our definition of EY reflects the fact that the standard Bell state is correlated in Z and X but anti-correlated in Y.)  #@NEW_LINE#@#  To reproduce the known key rate9,21, we write the optimization problem as:', '', '', '', '', 'where EXY :=(EX+EY)/2 quantifies the average error for X and Y.  #@NEW_LINE#@#  Note that the constraint EXY=Q is obtained by coarse graining the individual error rates.  #@NEW_LINE#@#  In theory, one can get a stronger bound on the key rate by splitting up this constraint into EX=Q and EY=Q.  #@NEW_LINE#@#  However, our numerics show that this does not improve the key rate, and the constraints in equation (29)(31) are enough to reproduce the theory curve.  #@NEW_LINE#@#  Indeed, numerically solving the problem in equation (28)(31) leads to the blue dots in Fig 1, which agree with the theory curve.  #@NEW_LINE#@#  ', 'Two MUBs in higher dimensions example', 'A distinct advantage of our approach of solving equation (9) instead of the primal problem equation (7) is that we can easily perform the optimization in higher dimensions, where the number of parameters in equation (7) would be quite large.  #@NEW_LINE#@#  To illustrate this, we consider a generalization of BB84 to arbitrary dimension, where Alice and Bob measure generalized versions of the X and Z bases.  #@NEW_LINE#@#  This protocol has been implemented, for example, in ref.  #@NEW_LINE#@#  18 using orbital angular momentum.  #@NEW_LINE#@#  Taking Z as the standard basis {|j}, Alices X basis can be taken as the Fourier transform {F|j}, where', '', 'is the Fourier matrix, with =e2i/d, and for simplicity we choose Alices and Bobs dimension to be equal: dA=dB=d.  #@NEW_LINE#@#  Bobs X basis is set to {F*|j}, where F* denotes the conjugate of F in the standard basis.  #@NEW_LINE#@#  ', 'Suppose that Alice and Bob observe that their error rates in Z and X are identical.  #@NEW_LINE#@#  The theoretical key rates8,17 for the cases d=6, 8, 10 are shown as dashed curves in Fig 3, while our numerics are shown as circular dots.  #@NEW_LINE#@#  Clearly there is perfect agreement with the theory.  #@NEW_LINE#@#  ', 'For our numerics we employ the same constraints as used for BB84 in equation (21)(24), but generalized to higher d. We again emphasize that the calculation of  here is very efficient and can easily handle higher dimension.  #@NEW_LINE#@#  This is because the number of parameters one is optimizing over is independent of dimensionequal to the number of constraints, which in this case is 3.  #@NEW_LINE#@#  This is in sharp contrast to the primal problem in equation (7), where the number of parameters is d4, which would be 10,000 for d=10.  #@NEW_LINE#@#  ', 'n MUBs example', 'A simple generalization of the above protocols is to consider a set of n MUBs in dimension d. For example, in prime power dimensions there exist explicit constructions for sets of n MUBs with 2 less_than n less_than d+1 (ref.  #@NEW_LINE#@#  35).  #@NEW_LINE#@#  Consisder a protocol where we fix the set of n MUBs, and in each round, Alice and Bob each measure their d dimensional system in one basis chosen from this set.  #@NEW_LINE#@#  For general n the symmetry group is not known for this protocol8, so one can consider it an unstructured protocol.  #@NEW_LINE#@#  Indeed, only for the special cases n=2 and n=d+1 do we have analytical formulas for the key rate8.  #@NEW_LINE#@#  Nevertheless it is straightforward to apply our numerics to this protocol for any n. Our results are shown in Fig 4 for d=5.  #@NEW_LINE#@#  To obtain these curves we only need three constraints, which are analogous to equation (29)(31), but generalized such that EXY is replaced by the average error rate in all n1 bases, excluding the basis used for key generation (the Z basis).  #@NEW_LINE#@#  ', 'Figure 4: Protocol where Alice and Bob each use n MUBs.The key rate is plotted for various n{2, 3, 4, 5, 6} and for dA=dB=5.  #@NEW_LINE#@#  This is an unstructured protocol, since for intermediate values of n the symmetry group and hence the key rate is unknown.  #@NEW_LINE#@#  However, our numerics provides the dependence of key rate on error rate for any n, as shown.  #@NEW_LINE#@#  The inset shows the error tolerancethe smallest error rate that makes the key rate vanishas a function of n. Note that the largest jump in the error tolerance occurs from n=2 to n=3.Full size image', 'Interestingly, Fig 4 shows that just adding one basis, going from n=2 to n=3, gives a large jump in the key rate, whereas there are diminishing returns as one adds more bases.  #@NEW_LINE#@#  This can be seen in the inset of Fig 4, which plots the error tolerance (that is, the value of Q for which the key rate goes to zero) as a function of n. We have seen similar behaviour for other d besides d=5.  #@NEW_LINE#@#  After completion of this work, an analytical formula for n=3 was discovered36, and we have verified that it agrees perfectly with our numerics.  #@NEW_LINE#@#  ', 'In Supplementary Note 3, we analytically prove the following.  #@NEW_LINE#@#  ', 'Proposition 2: Our numerical results are perfectly tight for the protocols discussed in Figs 1, 3 and 4.  #@NEW_LINE#@#  That is, for these protocols, our optimization exactly reproduces the primal optimization (equation (7)).  #@NEW_LINE#@#  ', 'Note that this observation implies that key rate for protocols involving n MUBs (as in Fig 4) is now known; namely it is given by our numerical optimization.  #@NEW_LINE#@#  ', 'Arbitrary angle between bases example', 'While MUBs are a special case, our approach can handle arbitrary angles between the different measurements or signal states.  #@NEW_LINE#@#  For example, we consider a simple qubit protocol37 where Alice and Bob each measure either the Z or W basis, where W is rotated by an angle  away from the ideal X basis.  #@NEW_LINE#@#  This protocol provides the opportunity to compare our numerical approach to an analytical approach based on the entropic uncertainty principle, introduced in refs 22, 23.  #@NEW_LINE#@#  This is the state-of-the-art method for lower bounding the key rate.  #@NEW_LINE#@#  So for comparison, Fig 5 plots the bound obtained from the entropic uncertainty principle for bases Z and W.', 'Figure 5: Protocol where Alice and Bob each measure Z or W.Here Z is the standard basis and the W basis is rotated by an angle  away from the X basis.  #@NEW_LINE#@#  The key rate versus  is shown with the error rate set to Q=0.01.  #@NEW_LINE#@#  Our numerics give a hierarchy of four lower bounds on the key rate, corresponding to adding in additional constraints from (33)(37).  #@NEW_LINE#@#  All of our bounds are tighter than the bound obtained from the entropic uncertainty principle.  #@NEW_LINE#@#  The plot indicates that the uncertainty principle gives a dramatically pessimistic key rate, much lower than the true key rate of the protocol.Full size image', 'We apply our numerical approach with the constraints:', '', '', '', '', '', 'where Z and W are the Pauli operators associated with the Z and W bases.  #@NEW_LINE#@#  Figure 5 plots a hierarchy of lower bounds obtained from gradually adding in more of the constraints in equation (33)(37).  #@NEW_LINE#@#  As the plot shows, we already beat the entropic uncertainty principle with only the first two constraints.  #@NEW_LINE#@#  Furthermore, adding in all these constraints gives a markedly higher bound, showing the uncertainty principle gives highly pessimistic key rates for this protocol.  #@NEW_LINE#@#  From an experimental perspective, Fig 5 is reassuring, in that small variations in  away from the ideal BB84 protocol (=0) have essentially no effect on the key rate.  #@NEW_LINE#@#  Figure 5 also highlights the fact that our approach allows us to systematically study the effect on the key rate of Alice and Bob using more or less of their data.  #@NEW_LINE#@#  In this example, we see that it is useful to keep data that one will usually discard in the sifting step of the protocol.  #@NEW_LINE#@#  ', 'B92 example', 'Next we consider the B92 protocol19, which is a simple, practical and unstructured protocol.  #@NEW_LINE#@#  It nicely illustrates our framework because it is inherently a prepare-and-measure protocol and it involves post-selection.  #@NEW_LINE#@#  In the protocol, Alice sends one of two non-orthogonal states {|0, |1} to Bob.  #@NEW_LINE#@#  Since the Bloch-sphere angle  between the two states is arbitrary, with 0|1=cos(/2), the protocol is unstructured.  #@NEW_LINE#@#  Bob randomly (with equal probability) measures either in basis  or basis , where .  #@NEW_LINE#@#  If Bob gets outcome  or , then he publicly announces pass, and he assigns a bit value of 1 or 0, respectively, to his key.  #@NEW_LINE#@#  Otherwise, Bob announces fail and they discard the round.  #@NEW_LINE#@#  ', 'A detailed description of the constraints we employed for B92 can be found in Supplementary Note 4.  #@NEW_LINE#@#  Our numerical results are shown in Fig 6.  #@NEW_LINE#@#  Figure 6 shows that the optimal angle for maximizing key rate depends on the depolarizing noise p, although small deviations ±5° from the optimal angle do not affect the key rate much.  #@NEW_LINE#@#  ', 'Figure 6: The B92 protocol.The key rate (in bits per photon sent by Ailce) is plotted versus the Bloch-sphere angle between the two signal states.  #@NEW_LINE#@#  Curves are shown for various values of the depolarizing probability p.Full size image', 'Our results give higher key rates for B92 than refs 20 and 21, which respectively predicted positive key rates for p less_than 0.034 and p less_than 0.048, while we predict it for p less_than 0.053.  #@NEW_LINE#@#  On the other hand, ref.  #@NEW_LINE#@#  38 directly solved the primal problem equation (7) for B92 by brute-force numerics, and achieves positive key rate for p less_than 0.065.  #@NEW_LINE#@#  We have verified that the gap between our results and those of ref.  #@NEW_LINE#@#  38 is due to the looseness of our usage of the Golden-Thompson inequality (equation (60) in the Methods section).  #@NEW_LINE#@#  However, ref.  #@NEW_LINE#@#  38 only showed a plot for p0.046, noting that the numerical optimization for the primal problem did not converge for smaller p values.  #@NEW_LINE#@#  This highlights a benefit of going to the dual problem, in that we have no trouble with obtaining the full dependence on p.'  #@NEW_LINE#@#  

Discussion  #@NEW_LINE#@#  
'In conclusion, we address one of the main outstanding problems in QKD theory: how to calculate key rates for arbitrary protocols.  #@NEW_LINE#@#  Our main result is a numerical method for lower-bounding key rates that is both efficient and reliable.  #@NEW_LINE#@#  It is reliable in the sense that, by reformulating the problem as a maximization, every solution that ones computer outputs is an achievable key rate.  #@NEW_LINE#@#  It is efficient in the sense that we have reduced the number of parameters in the optimization problem from  down to the number of experimental constraints, which in some cases is independent of dimension.  #@NEW_LINE#@#  ', 'The motivation for our work is twofold.  #@NEW_LINE#@#  First, experimental imperfections tend to break symmetries, so theoretical techniques that exploit symmetries do not apply.  #@NEW_LINE#@#  Hence, there is no general method currently available for calculating the effect of imperfections on the key rate.  #@NEW_LINE#@#  Second, it is interesting to ask whether protocols that are intentionally designed to lack symmetry might outperform the well-known symmetric protocols.  #@NEW_LINE#@#  Such a question cannot be posed without a method for calculating key rates for unstructured protocols.  #@NEW_LINE#@#  Just to give an example where the key rate is currently unknown, we plan to apply our approach to protocols where a small, discrete set of coherent states are the signal states and information is encoded in the phase39.  #@NEW_LINE#@#  ', 'We envision that our method could be a standard tool for QKD researchers.  #@NEW_LINE#@#  In future work we hope to extend our approach to the finite-key scenario.  #@NEW_LINE#@#  Indeed, the optimization problem we solve is closely related to one appearing in finite-key analysis24.'  #@NEW_LINE#@#  

Methods  #@NEW_LINE#@#  
'Outline', 'Here we prove our main result, Theorem 1.  #@NEW_LINE#@#  Our proof relies on several technical tools.  #@NEW_LINE#@#  First is the notion of the duality of optimization, that is, transforming the primal problem to its dual problem.  #@NEW_LINE#@#  Second, we employ several entropic identities to simplify the dual problem.  #@NEW_LINE#@#  Third, we use a recent, important result from ref.  #@NEW_LINE#@#  40 that solves a relative entropy optimization problem.  #@NEW_LINE#@#  ', 'For readability, we prove Theorem 1 here for the special case where the key map POVM ZA= is a projective measurement, that is, where the  are projectors (of arbitrary rank).  #@NEW_LINE#@#  We postpone the proof for arbitrary POVMs to Supplementary Note 5.  #@NEW_LINE#@#  ', 'The primal problem', 'First we rewrite equation (7) as:', '', 'noting that the second term in equation (38), H(ZA|ZB), will be determined experimentally and hence can be pulled out of the optimization.  #@NEW_LINE#@#  We remark that, simply for illustration purposes we used Fanos inequality to upper-bound H(ZA|ZB) in our figures; however, in practice H(ZA|ZB) would be directly calculated from the data.  #@NEW_LINE#@#  ', 'Since we only need to optimize the first term, we redefine the primal problem as', '', 'and note that we can take E to be a purifying system of AB, since that gives Eve the most information.  #@NEW_LINE#@#  Next we use a result for tripartite pure states  from refs 41, 42 that relates the conditional entropy to the relative entropy:', '', 'where the relative entropy is defined by', '', 'We remark that the joint convexity of the relative entropy implies that the right-hand side of equation (40) is a convex function of AB.  #@NEW_LINE#@#  (See ref.  #@NEW_LINE#@#  43 for an alternative proof of convexity.)  #@NEW_LINE#@#  Because of this, and the fact that the constraints in equation (5) are linear functions of AB, equation (39) is a convex optimization problem16.  #@NEW_LINE#@#  ', 'It is interesting to point out the connection to coherence44.  #@NEW_LINE#@#  For some set of orthogonal projectors  that decompose the identity, , the coherence (sometimes called relative entropy of coherence) of state  is defined as44:', '', 'Rewriting the primal problem in terms of coherence gives', '', 'Hence, we make the connection that calculating the secret key rate is related to optimizing the coherence.  #@NEW_LINE#@#  ', 'This observation is important since the coherence is a continuous function of  (Supplementary Note 6).  #@NEW_LINE#@#  This allows us to argue in Supplementary Note 6 that our optimization problem satisfies the strong duality criterion16, which means that the solution of the dual problem is precisely equal to that of primal problem.  #@NEW_LINE#@#  ', 'The dual problem', 'Now we transform to the dual problem.  #@NEW_LINE#@#  Due to a pesky factor of ln(2), it is useful to rescale the primal problem as follows:', '', 'where, henceforth, we generally use the notation , for any quantity M. The dual problem16 of equation (44) is given by the following unconstrained optimization:', '', 'where  is the set of positive semidefinite operators:', '', 'Here the Lagrangian is given by', '', 'where the ={i} are Lagrange multipliers.  #@NEW_LINE#@#  Strong duality implies that', '', 'In what follows, we go through several steps to simplify the dual problem.  #@NEW_LINE#@#  It helps to first state the following lemma from refs 42, 45.  #@NEW_LINE#@#  ', 'Lemma 3: For any  and , the coherence can be rewritten as', '', 'where  is the set of density operators.  #@NEW_LINE#@#  ', 'Hence, we have', '', 'where we define the quantum channel  whose action on an operator O is given by', '', 'Next, we interchange the two minimizations in (45)', '', 'where', '', '40 solved a relative entropy optimization problem, a special case of which is our problem:', '', 'From ref.  #@NEW_LINE#@#  40, the unique solution of equation (54) is', '', 'Inserting equation (55) into equation (53) gives the optimal value:', '', 'In summary, the dual problem becomes', '', 'with', '', 'A lower bound', 'We can obtain a simple lower bound on () as follows.  #@NEW_LINE#@#  The GoldenThompson inequality states that', '', 'Applying this inequality gives:', '', '', '', 'where  was defined in equation (10).  #@NEW_LINE#@#  Next, note that', '', 'Hence, we arrive at our final result', '', 'where the right-hand side is denoted as  in Theorem 1.  #@NEW_LINE#@#  ', 'Data availability', 'The authors declare that the data supporting the findings in this study are available within the article.'  #@NEW_LINE#@#  


