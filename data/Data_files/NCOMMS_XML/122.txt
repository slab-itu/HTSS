article id="http://dx.doi.org/10.1038/ncomms9924"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Migration and horizontal gene transfer divide microbial genomes into multiple niches  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
'Horizontal gene transfer is central to microbial evolution, because it enables genetic regions to spread horizontally through diverse communities.  #@NEW_LINE#@#  However, how gene transfer exerts such a strong effect is not understood.  #@NEW_LINE#@#  Here we develop an eco-evolutionary model and show how genetic transfer, even when rare, can transform the evolution and ecology of microbes.  #@NEW_LINE#@#  We recapitulate existing models, which suggest that asexual reproduction will overpower horizontal transfer and greatly limit its effects.  #@NEW_LINE#@#  We then show that allowing immigration completely changes these predictions.  #@NEW_LINE#@#  With migration, the rates and impacts of horizontal transfer are greatly increased, and transfer is most frequent for loci under positive natural selection.  #@NEW_LINE#@#  Our analysis explains how ecologically important loci can sweep through competing strains and species.  #@NEW_LINE#@#  In this way, microbial genomes can evolve to become ecologically diverse where different genomic regions encode for partially overlapping, but distinct, ecologies.  #@NEW_LINE#@#  Under these conditions ecological species do not exist, because genes, not species, inhabit niches.'  #@NEW_LINE#@#  

Introduction  #@NEW_LINE#@#  
'Microbes survive and reproduce in an extremely wide range of environments, from hydrothermal vents1 through marine snow2 and soil3, to host associations such as the human microbiome4.  #@NEW_LINE#@#  Within and between such environments, microbial genomes differ widely both in terms of allelic diversity and gene content5,6,7.  #@NEW_LINE#@#  At the heart of this genetic diversity is the ability of microbes to gain both homologous and non-homologous DNA via horizontal gene transfer.  #@NEW_LINE#@#  These transfers appear to occur in almost all prokaryotic lineages and have significant impacts on both bacterial and archaeal genomes8.  #@NEW_LINE#@#  ', 'Horizontal transfer is considered central to the ability of cells to adapt to new ecological conditions including clinical or environmental settings that contain antibiotics9,10.  #@NEW_LINE#@#  Recent empirical work suggests that these transfers can spread a single beneficial allele horizontally through a microbial communitywhere the allele can either represent a single gene or a small group of geneswith the result that an otherwise diverse microbial community becomes genetically identical in a certain genomic region9,11,12,13,14,15.  #@NEW_LINE#@#  However, the rates at which gene transfers occur are thought to be extremely low, with asexual reproduction a much faster process.  #@NEW_LINE#@#  Competition between strains and species within a patch, therefore, will mean that a beneficial allele can spread much more quickly via whole-genome vertical transmission than horizontal transmission, which should prevent horizontal sweeps16,17,18,19.  #@NEW_LINE#@#  One way that genes can transfer horizontally is if they hop between ecologically distinct populations that do not compete20,21,22.  #@NEW_LINE#@#  However, the prevalence of competition within microbial communities23,24 suggests that vertical sweeps should remain a barrier to horizontal sweeps.  #@NEW_LINE#@#  And yet, the experimental evidence for horizontal sweeps comes from communities of phylogenetically related strains9,11,12,13,25 where ecological competition is likely to be significant.  #@NEW_LINE#@#  ', 'A major question then is how horizontal transfer can so strongly impact microbial communities and cause the observed horizontal sweeps.  #@NEW_LINE#@#  Answering this question is necessary to understand microbes and how they evolve, both in nature and in the clinic.  #@NEW_LINE#@#  In a recent study, Takeuchi et al.26 provide an explanation for horizontal sweeps via negative frequency-dependent selection acting on other loci in the genome.  #@NEW_LINE#@#  Frequency-dependent selection can prevent full genome-wide selective sweeps and allow time for genetic transfer.  #@NEW_LINE#@#  Here we show that horizontal sweeps can occur without the need for negative frequency-dependent selection.  #@NEW_LINE#@#  We develop a series of models of a microbial community in which all cells compete for the same resource.  #@NEW_LINE#@#  We use these models to study both the rate of horizontal gene transfer and the impact that this transfer has on the genomics of the focal community.  #@NEW_LINE#@#  Our work reveals a missing ingredient that can explain horizontal sweeps: migration.  #@NEW_LINE#@#  When including immigration in our models, we find that the highest rates of horizontal transfer will occur for ecologically important traits that are under positive natural selection.  #@NEW_LINE#@#  The result is a genome where selected regions become partially decoupled from the ecology of the remaining loci such that different parts of the genome map to different niches.'  #@NEW_LINE#@#  

Results  #@NEW_LINE#@#  
'Overview', 'We are interested in understanding how a beneficial trait can spread horizontally through a microbial community.  #@NEW_LINE#@#  We build on a previously modelled scenario18,27 that considers a community of diverse strains that compete, and that will have the opportunity for genetic transfer28,29.  #@NEW_LINE#@#  Although we use the word community throughout, our model can also capture a set of strains from a single species, commonly referred to as a population.  #@NEW_LINE#@#  We follow the fate of a novel beneficial allele that is able to transfer horizontally between the genotypes in our community.  #@NEW_LINE#@#  Existing theory suggests that very little gene transfer should occur, because once a beneficial trait is picked up horizontally the carrier will rapidly outcompete the other strains in the patch before it has a chance to transfer the trait to other genomes16,17,18,27.  #@NEW_LINE#@#  However, previous models neglect the possibility that fixation of a trait can be delayed or prevented by migration of new cells into the community.  #@NEW_LINE#@#  We therefore begin by recapitulating previous predictions that competition suppresses gene transfer and we then show how making a single change, allowing immigration, can explain how horizontal genetic sweeps occur.  #@NEW_LINE#@#  ', 'Without migration adaptation by horizontal transfer is rare', 'We consider a community that lives in a focal patch, which can either be literally a single isolated patch or a set of similar patches that are themselves well connected by migration.  #@NEW_LINE#@#  At first we consider that this patch is largely isolated from the external environment, such that there is negligible migration between the community of the patch and the world at large.  #@NEW_LINE#@#  This scenario could correspond, for example, to communities living in hosts where there is limited superinfection with new strains and species over time30.  #@NEW_LINE#@#  We focus on those strains in the patch that are ecologically interchangeable in the sense that they compete for a common limiting resource.  #@NEW_LINE#@#  Under these conditions, horizontal transfer has been predicted to be almost powerless compared with vertical selective sweeps16,17,18,27.  #@NEW_LINE#@#  ', 'Our model follows the fate of a rare beneficial allele that first appears in a small subset of the community.  #@NEW_LINE#@#  Although non-carriers have fitness w=1, carriers of the adaptive allele have increased fitness w=1+s, where s is the local benefit of the trait (b) minus the cost of carrying it ().  #@NEW_LINE#@#  We assume that the benefit of the trait in the focal patch is always larger than its cost, so that s  greater than  0.  #@NEW_LINE#@#  Any cell in the community lacking the gene has a chance of picking it up horizontally and it is the overall rate of this process in the community that we are interested in.  #@NEW_LINE#@#  Not all loci can transfer their phenotypes horizontally31,32,33 and we focus here on those loci where horizontal transfer is possible.  #@NEW_LINE#@#  In addition, genetic transfer is typically relevant only for phenotypes that lie outside the range of physiological responses or short-term evolution by de-novo mutation34,35.  #@NEW_LINE#@#  Examples of such phenotypestransferable and otherwise hard to achieveinclude toxin resistance genes36, virulence factors37 and heat shock proteins38.  #@NEW_LINE#@#  ', 'We want then to capture the horizontal spread of an allele in a community of microbes.  #@NEW_LINE#@#  Although there is relatively little theoretical work on genetic transfer and its impact, there is a long theoretical tradition of modelling the horizontal spread of infectious diseases, along with associated empirical tests39,40.  #@NEW_LINE#@#  These models, often known as compartment models, have proved to be a powerful way to capture the key processes underlying the horizontal spread of a focal trait.  #@NEW_LINE#@#  We therefore begin here with a simple compartment model (Fig 1a) that allows us to identify the conditions that maximize horizontal genetic transfer, before extending and developing our predictions using other modelling approaches.  #@NEW_LINE#@#  ', 'Figure 1: Migration greatly increases the potential for horizontal genetic transfer of a beneficial allele.  #@NEW_LINE#@#  (a) The compartment model.  #@NEW_LINE#@#  Sub-communities C (blue) and 1C (yellow) represent the fractions of allele carriers and non-carriers in the community, respectively.  #@NEW_LINE#@#  In the absence of migration, positive selection (s) causes a replacement of non-carriers by carriers and gene transfer (r) converts non-carriers into carriers.  #@NEW_LINE#@#  In the presence of migration, non-carriers continuously arrive at the patch in addition to the processes of positive selection and gene transfer.  #@NEW_LINE#@#  (b) No migration: the beneficial allele is rapidly fixed so that the horizontal gene flux becomes zero and the total amount of horizontal transfers since the beginning of the sweep, the cumulative gene flux (cml gene flux), stays constant.  #@NEW_LINE#@#  (c) With migration: the immigration supplies the system with non-carriers, resulting in ongoing gene transfer at a constant rate.  #@NEW_LINE#@#  Other parameters are N=108, s=0.025, r=106, m=0 (b) and m=0.02 (c).Full size image', 'We study a focal community of constant size N that contains two sub-communities, adaptive gene carriers and non-carriers.  #@NEW_LINE#@#  Applying a deterministic continuum approach, the relative community size in each sub-community and the flux between them can be described by the ordinary differential equation (ODE)', '', 'where C(t) is the fraction of carriers in the community at time t, 1C(t) is the fraction of non-carriers and r is the rate of gene transfer from carriers to non-carriers (Fig 1a).  #@NEW_LINE#@#  The growth of compartment C due to selection is given through the term s/(1+sC(t)).  #@NEW_LINE#@#  The term rC(t)(1C(t)) captures the transition of cells from being a non-carrier to carrier through horizontal gene transfer.  #@NEW_LINE#@#  The proportion of trait carriers has two steady states (C*) when s or r are non-zero, given by', '', 'with C*=0 being an unstable and C*=1 being a stable equilibrium (see Supplementary Methods).  #@NEW_LINE#@#  Therefore, for any non-zero initial number of carriers (C(0)  greater than  0) the fraction C(t) will increase until fixation of the focal beneficial allele (C*=1) at steady state.  #@NEW_LINE#@#  A key model parameter for our further analysis is the probability that a carrier cell transfers the focal allele to a non-carrier in any generation, r. Gene transfer rates in natural communities remain largely unknown.  #@NEW_LINE#@#  Previous theoretical work used a relatively low and conservative estimate for transfer rate of 106 per gene per generation33, which corresponds to our transition rate (rC(t)(1C(t))).  #@NEW_LINE#@#  However, recent studies suggest that the rates of horizontal transfer can be much higher than such estimates41,42.  #@NEW_LINE#@#  We therefore consider a range of rates, 106  r  104, which goes either side of 106 per gene per generation (using r=106 guarantees that the transition rate rC(t)(1C(t)) is  less_than 106).  #@NEW_LINE#@#  Genetic transfer can occur both by homologous and non-homologous recombination.  #@NEW_LINE#@#  Although we phrase our results here in terms of the former, our conclusions should apply to both mechanisms.  #@NEW_LINE#@#  ', 'What then defines the rate of horizontal gene transfer in the whole patch?  #@NEW_LINE#@#  We can calculate this rate by multiplying the transition rate from carriers to non-carriers, rC(t)(1C(t)), by the community size N to obtain the community-level rate of gene transfer, which we term horizontal gene flux (rC(t)(1C(t))N).  #@NEW_LINE#@#  This horizontal gene flux spreads the beneficial gene without removing cells, whereas the vertical gene flux, given through sC(t)(1C(t)), spreads the gene by removing non-carrier cells.  #@NEW_LINE#@#  ', 'As the selective sweep for the focal trait proceeds, the horizontal gene flux initially increases up to a maximum at a 1:1 ratio of donors and recipients (C(t)=1C(t)=0.5) before decreasing back down to zero at allele fixation (Fig 1b).  #@NEW_LINE#@#  The overall impact of this process can be quantified from the integral of the gene flux, which gives the expected number of horizontal gene transfer events over time (cumulative gene flux, see Methods).  #@NEW_LINE#@#  How is this cumulative gene transfer affected by the strength of positive selection?  #@NEW_LINE#@#  Plotting cumulative gene transfer against selection pressure shows that strong selection regimes minimize the effects of horizontal transfer, because the time window during which this transfer can occur is short (Fig 2b, inset).  #@NEW_LINE#@#  Our model then recapitulates previous conclusions that, given a small rate of genetic transfer, only weakly selected traits can undergo significant horizontal transfer by slowly sweeping through a community18.  #@NEW_LINE#@#  However, weakly selected traits are, by definition, relatively unimportant for the ecology and evolution of their carriers.  #@NEW_LINE#@#  In contrast, many successful horizontally transferred traits, such as antibiotic resistance genes, appear to be both functionally important and under significant positive natural selection29,43,44 and these are the traits that we are interested in here.  #@NEW_LINE#@#  ', 'Figure 2: Migration allows horizontal transfer even with significant positive natural selection for a transferred trait.  #@NEW_LINE#@#  (a) Gene transfer events accumulate over time when immigration is possible, with increased gene transfer rates increasing the horizontal gene flux.  #@NEW_LINE#@#  (Selection pressure s=0.025).  #@NEW_LINE#@#  (b) Cumulative horizontal gene flux measured at t=105 across different selection pressures (left-hand side plot) and for different rates of migration (right-hand side inset).  #@NEW_LINE#@#  With migration (left-hand plot, m=0.02), the cumulative gene flux peaks for intermediate selection pressure (s=0.04 with 2.5 × 106 transfer events) and remains significant even for stronger positive selection (s=0.1 with 1.7 × 106 transfer events).  #@NEW_LINE#@#  Without migration (inset plot, r=106), gene transfer remains extremely infrequent and peaks at the lowest selection pressure with only around 4,000 transfer events.  #@NEW_LINE#@#  In all plots, we calculate cumulative gene flux for N=108 and C(0)=1,000/N.Full size image', 'With migration adaptive traits transfer horizontally', 'Previous models of genetic transfer have not considered a key feature of microbial life, migration, which has the potential for important effects on population dynamics45,46.  #@NEW_LINE#@#  We next introduce migration into our model and we study its effect on our predictions.  #@NEW_LINE#@#  We now assume that our focal patch is separated, but not completely isolated, from its external environment so that there will be a limited but ongoing exchange of cells.  #@NEW_LINE#@#  For example, this focal patch could be a nutrient particle in ocean water, a mammalian host or tree hole.  #@NEW_LINE#@#  As discussed for our no-migration model, the patch can also represent a set of connected patches that all select for the same horizontally transferred trait, that is, a set of particles, hosts or tree holes.  #@NEW_LINE#@#  The key is that we now allow there to be immigration from other regions that do not select for the focal trait.  #@NEW_LINE#@#  Accordingly, we assume that all immigrating cells that arrive from outside the focal patch (or patches) lack the trait (but we relax this assumption below).  #@NEW_LINE#@#  For example, the focal allele might provide resistance to a toxin that is specific to the focal patch.  #@NEW_LINE#@#  Some immigrating cells will be unable to establish themselves in the focal community due to a mismatch with general ecological characters, such as nutrient conditions, temperature and alike.  #@NEW_LINE#@#  Other migrants might not be compatible with the selected locus and are unable to adapt.  #@NEW_LINE#@#  However, both of these effects will lead to fast extinction of these migrants and we can account for both by varying the migration rate, where an increase in the frequency of non-viable strains corresponds to a reduced migration rate.  #@NEW_LINE#@#  Extending our model to include migration gives', '', 'where m is the migration rate, given as the fraction of cells that is replaced through migrators landing and replacing them per unit time, and mC(t) is the replacement of trait carriers only (Fig 1a).  #@NEW_LINE#@#  If the basic rate of genetic transfer is very small (r  0), the steady-state proportions of cells carrying the focal trait (C*) are given approximately by', '', 'with C*=0 defining an unstable equilibrium and C*=(sm)/((m+1)s) a stable equilibrium (see Supplementary Methods).  #@NEW_LINE#@#  Therefore, given an initial non-zero number of carriers, the system will reach the second equilibrium (C*=(sm)/((m+1)s)).  #@NEW_LINE#@#  A key implication of this expression is that with non-zero migration (m  0) the selected trait will now reach a steady state before it has been fixed in the community (C*  less_than  1), because migration continuously brings new genotypes into the system.  #@NEW_LINE#@#  These migrators mean that opportunities for genetic transfer remain after the initial selective sweep has occurred.  #@NEW_LINE#@#  Migration stops the selective sweep before it can complete as a classic selective sweep47 and instead there is a second longer-lasting incomplete sweep.  #@NEW_LINE#@#  Indeed, horizontal transfer now occurs as long as the community persists, which greatly increases its potential effects (Figs 1c and 2a).  #@NEW_LINE#@#  Migration rates are commonly considered to be high in natural microbial communities, as cells can be so easily dispersed, but exact rates are difficult to assess.  #@NEW_LINE#@#  In these first models, we use a relatively high rate of m=0.02, which corresponds to 2% of cells being replaced by incoming cells in each generation.  #@NEW_LINE#@#  However, we show in the next section that our conclusions are robust for a range of possible migration rates, just so long as migration does not overpower natural selection (m less_than s).  #@NEW_LINE#@#  ', 'With migration in the model, the relationship between the strength of natural selection and the cumulative gene transfer is fundamentally changed.  #@NEW_LINE#@#  Now, horizontal transfer peaks for traits under intermediate selection pressure (Fig 2), whereas without migration it peaks at minimum selection strength (Fig 2b, inset).  #@NEW_LINE#@#  This means that migration greatly increases the potential for horizontal sweeps of ecologically important traits that are associated with significant positive selection pressures, for example, a trait that provides a fitness advantage of  greater than 10% (Fig 2).  #@NEW_LINE#@#  The sweep occurs in spite of the fact that vertical flux remains the dominant mode of transmission in the community; even modest rates of natural selection (s greater than 103) are much greater than the expected rates of gene transfer (106 less_than r less_than 104).  #@NEW_LINE#@#  ', 'We have assumed so far that incoming migrators lack the adaptive trait.  #@NEW_LINE#@#  However, there are clearly cases where new cells may be pre-adapted and carry the focal trait.  #@NEW_LINE#@#  When will this occur and how does it change our predictions about horizontal gene flux?  #@NEW_LINE#@#  To investigate this, we consider an extended model that explicitly captures the external environment as an additional compartment where the focal trait is disfavoured by natural selection (Supplementary Fig 1).  #@NEW_LINE#@#  Cells from the focal patch can leave and enter the surrounding environment and, equally, cells can return from the surrounding environment into the focal patch.  #@NEW_LINE#@#  As before, our focal patch can also represent a set of connected patches that all select for the same focal trait, which are surrounded by the wider external environment that does not favour the trait.  #@NEW_LINE#@#  ', 'Our extended model makes the same predictions as our original model with migration whenever the external environment is large relative to the focal patch (Supplementary Figs 2 and 3).  #@NEW_LINE#@#  This is intuitive: a large external environment means that the focal gene is likely to be lost outside the focal patch before a cell returns, such that few or no immigrants will possess the focal trait.  #@NEW_LINE#@#  By contrast, when the external environment is itself a small patch, the focal patch and the external environment converge to act as a single patch in which the focal gene reaches fixation with limited horizontal gene transfer (as seen in the no-migration model above, Supplementary Figs 2 and 3).  #@NEW_LINE#@#  Another way to view the size of the external environment is as a proxy for the rarity of the focal niche: a large external environment that selects against the focal allele means that the focal niche is relatively rare.  #@NEW_LINE#@#  For the rest of the study, we focus on this case where a focal niche is rare relative to the environment from which immigrants arrive, such as a niche that selects for resistance to a specific antibiotic48.  #@NEW_LINE#@#  Under these conditions, the great majority of immigrants will be non-adapted.  #@NEW_LINE#@#  ', 'Horizontal transfer divides the genome into distinct niches', 'We have shown that migration from outside of a focal patch greatly increases the potential for gene transfer in microbial communities.  #@NEW_LINE#@#  However, is this increased transfer important for the ecology and evolution of microbes?  #@NEW_LINE#@#  Specifically, we are interested in whether the rate of horizontal transfer is sufficient to generate a horizontal selective sweep whereby a particular allele moves horizontally through a diverse community of microbes.  #@NEW_LINE#@#  To address this question, we next investigate how gene transfer with migration affects genomic diversity, at both the horizontally transferred and the non-transferred regions of the microbial genomes.  #@NEW_LINE#@#  Although compartment models allow us to follow the dynamics of horizontal transfer and identify the population processes driving a horizontal sweep, these models are not well suited to follow genomic effects.  #@NEW_LINE#@#  We therefore next develop a coalescence model to capture the genetic effects of genetic transfer, selection and migration probabilistically.  #@NEW_LINE#@#  ', 'Our new model assesses the impact of genetic transfer in terms of how much it can decouple evolution at the genetic locus of the beneficial allele (focal locus) from the rest of the genome (background genome).  #@NEW_LINE#@#  We determine this effect by comparing the diversity at the focal locus (Df) to the diversity at the background genome (Dbg), in the diversity ratio DR=Dbg/Df (for details, see Methods).  #@NEW_LINE#@#  Without migration, the DR changes little over time and remains close to one (Fig 3ac).  #@NEW_LINE#@#  Consistent with the predictions of our first model, we see very little effect of horizontal transfer when there is no migration.  #@NEW_LINE#@#  Genetic transfer is largely powerless to evolve the focal locus independently of the background genome and the two remain locked together in a vertical selective sweep that purges diversity in both genetic regions.  #@NEW_LINE#@#  ', 'Figure 3: Migration enables horizontal genetic sweeps.We plot the diversity ratio (DR) as a function of the strength of natural selection (s) for r=106 (a), r=105 (b) and r=104 (c) as calculated from the coalescence model both with and without migration.  #@NEW_LINE#@#  With migration, the DR, which gives the strength of the selective sweep, peaks at intermediate selection pressure (s  0.04), whereas (d) the fraction of cells carrying the same adaptive gene increases monotonically with selection pressure, where for the different transfer rates the curve of the final carrier fraction is approximately identical, reaching about 80% for all three transfer rates.  #@NEW_LINE#@#  Parameters are t=5 × 106, N=108 and C(0)=1,000/N, and either m=0 or m=0.02.  #@NEW_LINE#@#  (e) The effect of migration rate (m) on the diversity ratio (DR) and (f) the effect of migration rate on the fraction of the community that carry the trait, for all three transfer rates (s=0.05, t=5 × 106, N=108 and C(0)=1,000/N).  #@NEW_LINE#@#  (g) The individual-based model shows the effect of ecologically different migrants for an increasing number of ecological niches (n=1, 10 and 20, and z=0.2).  #@NEW_LINE#@#  (h) We also plot (for n=20) the DR against selection pressure for two different levels of ecological specialization: cells competing twice as much in their own niche than in other niches (blue line) and cells that compete entirely in their own niche (green line).  #@NEW_LINE#@#  Other parameters are N=106, tend=105, r=104, C(0)=1,000/N.  #@NEW_LINE#@#  Results are averaged over 50 simulations and the s.d.  #@NEW_LINE#@#  is given by the transparent areas.Full size image', 'We next consider the case where there is immigration into the focal patch.  #@NEW_LINE#@#  Now, the behaviour of the model is very different.  #@NEW_LINE#@#  We find a wide range of parameter values for which the combination of positive natural selection, migration and horizontal transfer largely purge diversity at the focal locus, while leaving significant variability in the background genomes (high DR, Fig 3ac,e).  #@NEW_LINE#@#  The result is that the majority of cells carry the same adaptive allele (high fraction of carriers, Fig 3d,f), while their background genomes remain diverse.  #@NEW_LINE#@#  The relative proportion of adaptive gene carriers increases monotonically with a stronger selection pressure (Fig 3d) and with a decreasing migration rate (Fig 3f).  #@NEW_LINE#@#  The DR is maximal when migration rate and positive selection are in a balanced regime.  #@NEW_LINE#@#  That is, some immigration is needed for an effective horizontal sweep to occur but, as seen in results from classical population genetics49, if migration is too strong (m greater than s) then it will overpower selection and prevent adaptive evolution (Fig 3e,f).  #@NEW_LINE#@#  As a result, the horizontal gene sweep is most effective at intermediate positive selection pressures (Fig 3ac).  #@NEW_LINE#@#  ', 'This result has major implications for the evolution of microbial communities in the face of horizontal transfer.  #@NEW_LINE#@#  Positive natural selection is no longer a barrier to the horizontal spread of a trait.  #@NEW_LINE#@#  Instead, the impacts of genetic transfer are greatest for ecologically important traits that are under positive natural selection.  #@NEW_LINE#@#  In this way, a horizontally transferred trait with its own specific ecology is able to move through a diverse set of strain backgrounds.  #@NEW_LINE#@#  As we discuss below, a key implication of this uncoupling is that genomes can become ecologically diverse in the sense that the ecology of the focal locus and the rest of the genome are overlapping but distinct.  #@NEW_LINE#@#  ', 'Ecological division of the patch promotes horizontal sweeps', 'We have so far focussed on an ecologically cohesive community, because the potential for diverse genotypes to compete ecologically is clear23,24,50 and also because previous work suggests that competitive exclusion in a community is the worst-case scenario for gene-specific horizontal sweeps16,17,18,27.  #@NEW_LINE#@#  For this reason the above results should be conservative in their estimates of how migration promotes horizontal sweeps.  #@NEW_LINE#@#  However, we can use an individual-based model to relax competition within the community and study the consequences for gene sweeps and genomic diversity.  #@NEW_LINE#@#  ', 'We introduce ecological differences between genotypes by introducing n different background niches in our focal patch, which could represent specialization on different resources.  #@NEW_LINE#@#  Each incoming cell then belongs to one background niche but also partly competes within the other niches.  #@NEW_LINE#@#  We denote the extent to which a cell competes within its assigned niche as z, whose value lies between 0 and 1, where z=1 corresponds to a cell competing purely in its own niche and z=1/n corresponds to a cell competing equally in all niches (see Methods).  #@NEW_LINE#@#  Our simulations show that the genetic effect of horizontal gene transfer increases with an increasing number of distinct niches (n) in the community (Fig 3g) and gene transfer is also increased by a stronger separation of the cells into separate niches (increasing z, Fig 3h).  #@NEW_LINE#@#  This result is intuitive: the ecological subdivision reduces competition between cells in the different niches and thus reduces the loss of diversity in the background genome during the selective sweep.  #@NEW_LINE#@#  This effect of ecological subdivision agrees with the study of Majewski and Cohan20 who found that gene transfer has greater impact if communities were subdivided into a number of completely non-competing lineages (or ecotypes21).  #@NEW_LINE#@#  Another way to view the effect of niches in our model is in terms of negative frequency-dependent selection that prevents any one genotype from completely dominating the focal community14, which was the subject of a recent study by Takeuchi et al.26', 'In summary, our results suggest that an influx of diverse and non-adapted migrator genotypes can greatly increase the effect of genetic transfer on microbial communities.  #@NEW_LINE#@#  It does so in at least two ways.  #@NEW_LINE#@#  First, migration adds new gene recipients that, even after the beneficial trait is established, enable continued gene flux.  #@NEW_LINE#@#  Second, migration may introduce new genomes that increase ecological subdivision (n  greater than  1).  #@NEW_LINE#@#  Both of these processes constrain the impact of vertical selective sweeps, but within ecologically cohesive communities (low n) it is the addition of new gene recipients that is critical for horizontal sweeps.  #@NEW_LINE#@#  The result is that most species and strains can evolve to be identical at the locus under positive selection, while the rest of the genomes are highly diverse.'  #@NEW_LINE#@#  

Discussion  #@NEW_LINE#@#  
'Our models explain how horizontal sweeps of small stretches of DNA can occur in ecologically cohesive communities of microbes.  #@NEW_LINE#@#  The strains and species that compete within such communities are ideal candidates for horizontal transfer, because they live in close proximity and they can induce lysis in one another releasing DNA for uptake51,52.  #@NEW_LINE#@#  However, previous work suggests that transfer of a beneficial gene within competing communities should be limited by selective sweeps that propagate the allele vertically to fixation before significant horizontal transfer can occur16,17,18,27(Fig 4a).  #@NEW_LINE#@#  Here we have shown that this prediction does not hold when one includes the possibility of immigration.  #@NEW_LINE#@#  Migration is a significant process in microbial ecology45,46 and allowing migration in our model results in large amounts of horizontal transfer that has the power to transform the genomics of the community.  #@NEW_LINE#@#  ', 'Figure 4: Horizontal transfer creates multiple ecologies within one microbial genome.  #@NEW_LINE#@#  (a) The ecotype model70.  #@NEW_LINE#@#  A selected trait (blue dot) causes a selective sweep of the genome in which it first appears (red cell), wiping out other genomes if selection strength (s) for the trait is much larger than its gene transfer rate (r).  #@NEW_LINE#@#  (b) Divided-genome model.  #@NEW_LINE#@#  Immigration of new genotypes causes a horizontal genetic sweep because incoming genotypes can pick up the selected trait.  #@NEW_LINE#@#  The trait is now found in diverse genomic backgrounds, which can have ecologies that are distinct from both the focal locus and from each other.  #@NEW_LINE#@#  (c) Genomic regions can display high or low diversity depending on the ecological basis of sampling.  #@NEW_LINE#@#  The two circles containing the cells represent patches with loci-specific sweeps.  #@NEW_LINE#@#  Sampling from a single patch that selects for a horizontally transferred locus (blue dots) will capture cells that are diverse in their background genome phylogeny but homogeneous at the transferred locus (horizontal gene sampling, left-hand phylogeny).  #@NEW_LINE#@#  In contrast, sampling from a single background genome (green cells) will capture cells that are diverse in their horizontally transferred loci (background genome sampling, right-hand phylogeny).Full size image', 'Our models then provide an evolutionary explanation for the increasing number of sequencing studies showing that otherwise diverse microbial communities possess regions of the genome that contain very little diversity9,11,12,13,53.  #@NEW_LINE#@#  Further evidence of the processes we describe comes from the recent observation that mobile genetic elements can be enriched in their own niches, largely independently of their bacterial host25,28,29.  #@NEW_LINE#@#  Horizontal transfer then has the potential to make diverse and competitive strains coherent in an ecologically important phenotype, including key traits such as resistances to toxins9.  #@NEW_LINE#@#  Although our models explain how horizontal sweeps can occur, they also predict that the timescale required for a sweep is likely to be on the order of months to years (for example, 104 to 106 generations for a 30-min generation time), based on current estimates of genetic transfer rates33,41,42.  #@NEW_LINE#@#  A key prediction then is that horizontal sweeps are relatively slow compared with the canonical vertical sweep often seen in the laboratory54,55.  #@NEW_LINE#@#  Nevertheless, the timescales of horizontal sweeps remain extremely short compared with phylogenetic timescales, and fit with data showing that genetically coherent microbial communities persist for years in the face of migration56 and vertical sweeps57.  #@NEW_LINE#@#  Recent work also suggests that the basic rates of gene transfer can sometimes be much higher than typically assumed41,58, which in our model will significantly reduce the timescales required for horizontal sweeps.  #@NEW_LINE#@#  This prediction contrasts with the horizontal gene sweep scenario described by Takeuchi et al.26, in which gene transfer rates need to remain low ( less_than 106), for single-gene sweeps to occur.  #@NEW_LINE#@#  ', 'We have emphasized here how horizontal gene transfer can remove diversity at one locus relative to the rest of the genome in a microbial community.  #@NEW_LINE#@#  How is this result reconciled with the notion of horizontal transfer as a way to generate diversity, in particular in the form of the much-discussed accessory genome13,14,53,59?  #@NEW_LINE#@#  Our analyses explain how genetic transfer can be seen to generate diversity in some studies, while removing diversity in others.  #@NEW_LINE#@#  This effect can be illustrated by considering two contrasting examples.  #@NEW_LINE#@#  First, if an experimenter samples in a specific patch that, as in our model, selects strongly for a particular horizontally transferred trait, then the data may show evidence of the horizontal sweep that removed variability at the focal locus relative to the rest of the genome (horizontal gene sampling, Fig 4c)11,12,53.  #@NEW_LINE#@#  In contrast, if an experimenter samples one species such as Escherichia coli across different locations, then its background genome is likely to cross many niches for different horizontally acquired loci.  #@NEW_LINE#@#  In this case, horizontal transfer will be a process that mostly generates diversity relative to the core genome (background genome sampling, Fig 4c)60,61.  #@NEW_LINE#@#  Arguably then, what is considered the accessory region of a genome will depend on the ecological basis for sampling15.  #@NEW_LINE#@#  ', 'Our work speaks to the fundamental question of how microbial genotypes map to ecology14,62,63.  #@NEW_LINE#@#  A key result from our model is that the highest rates of transfer occur for loci that are under significant positive natural selection: loci that are important for the ecology of a cell.  #@NEW_LINE#@#  Horizontal transfer, therefore, can enable a particular locus to accumulate in a local environment to which it is evolutionarily adapted, without the rest of the genome evolving in the same way.  #@NEW_LINE#@#  An interesting corollary is that a single cell carrying such loci will become ecologically diverse, in the sense that its genome can evolve to become a community of genetic regions with multiple partially overlapping, but distinct, ecologies.  #@NEW_LINE#@#  This idea of distinct gene ecologies64 has recently been discussed in light of the microbial species question25,29,64,65,66.  #@NEW_LINE#@#  Our model explains how distinct gene ecologies are possible, as well as identifying the conditions required for them to occur (Fig 4c).  #@NEW_LINE#@#  We show that, with sufficient migration, an ecologically important trait can readily decouple itself from any one genetic background via horizontal transfer.  #@NEW_LINE#@#  When this occurs, a microbial niche is defined at the sub-genomic scale so that ecological species concepts will no longer map to the whole organism but rather to a subset of any one genome.'  #@NEW_LINE#@#  

Methods  #@NEW_LINE#@#  
'Continuous model', 'We model the dynamics of a selective sweep with opportunity for genetic transfer and migration using an ODE.  #@NEW_LINE#@#  This equation describes the community in our selective patch where there are two sub-communities: carriers and non-carriers of the selected trait.  #@NEW_LINE#@#  The community is assumed to have a constant number of cells (N) with varying fractions of beneficial gene carriers (C) and non-carriers (1C).  #@NEW_LINE#@#  For simplicity, we assume the community to be well-mixed and we do not consider stochastic effects (we relax this later).  #@NEW_LINE#@#  The dynamics and steady-state levels of carriers in the community are described by equations (1, 2, 3) in the main text.  #@NEW_LINE#@#  To capture the gene flux through horizontal transfer in a given community, we define a composite parameter that is the rate of transfer of the selected trait in the whole community:', '', 'This horizontal gene flux is maximized at equal number of donors and recipients (C=0.5).  #@NEW_LINE#@#  At steady state of the system, the gene flux is given by:', '', 'Figure 1b,c show plots of C, 1C and the horizontal gene flux over time with and without migration.  #@NEW_LINE#@#  Gene transfer events accumulate over time and ultimately cause sweeps of single loci or small groups of loci.  #@NEW_LINE#@#  As the horizontal gene flux gives the rate of gene transfer events, the integral of this flux over a time interval gives the expected number of transfer events in this time.  #@NEW_LINE#@#  To obtain the numerical solutions of the cumulative gene flux plotted in Figs 1 and 2, we employ the rectangle rule in MATLAB.  #@NEW_LINE#@#  Table 1 provides a summary of the parameters present in this model and a more detailed description and analysis of the model are given in the Supplementary Methods.  #@NEW_LINE#@#  ', 'Table 1 Parameters used in the compartment model.Full size table', 'Coalescence model', 'We use a coalescence approach to model the genomes in our focal patch under influence of the selective sweep in combination with horizontal transfer and migration.  #@NEW_LINE#@#  We first simulate the fraction of selected gene carriers (C) in the time interval t0, tend using the ODE of our continuous model.  #@NEW_LINE#@#  With the simulated values of C(t) we then compute the coalescence process of two homologous loci, to determine the expected diversity in their genome site.  #@NEW_LINE#@#  For the diversity in the background genome, we consider two random background loci at time t=tend and for the diversity in the focal locus we consider two focal loci at t=tend.  #@NEW_LINE#@#  We then go backward in time until t=0, while updating the probabilities of the two loci being in a given state.  #@NEW_LINE#@#  The loci can take the following states:', 'State 11: Both loci are in two distinct individuals that are both carriers.  #@NEW_LINE#@#  ', 'State 00: Both loci are in two distinct individuals that are both non-carriers.  #@NEW_LINE#@#  ', 'State 01: Both loci are in two distinct individuals where one is a carrier and the other one a non-carrier.  #@NEW_LINE#@#  ', 'State 1: The two loci are coalesced in one individual that is a carrier.  #@NEW_LINE#@#  ', 'State 0: The two loci are coalesced in one individual that is a non-carrier.  #@NEW_LINE#@#  ', 'State m: At least one of the loci is in a migrating individual outside the patch.  #@NEW_LINE#@#  ', 'We simulate the change of all six probabilities backward in time, until t=0, by solving a set of coupled ODEs given in the Supplementary Methods.  #@NEW_LINE#@#  We obtain the diversity in the focal locus Df and the diversity of the background genome Dbg.  #@NEW_LINE#@#  We measure the power of the horizontal gene sweep using the ratio of the diversity in the background genome over the diversity in the focal locus and we call this the DR given by:', '', 'Individual-based model', 'We develop an individual-based model of our selective patch to confirm the predictions of our coalescence model and to be able to change the ecological details of the patch.  #@NEW_LINE#@#  The simulated patch contains a fixed number of cells (N), where each individual cell is described by a set of three numbers representing the focal locus (transferrable), the genotype of the remaining background genome (non-transferrable) and the niche/resource association of the genotype.  #@NEW_LINE#@#  The background genotype can take any positive integer, which matches the focal locus for cells at the beginning of the simulation and for migrating cells.  #@NEW_LINE#@#  The focal locus can take the adapted state 1 or alternatively any other positive integer for non-adapted cells.  #@NEW_LINE#@#  We simulate the ecological competition of the cells in n different niches in the patch similar to the symsim model by Friedman et al.67.  #@NEW_LINE#@#  Each cell obtains resources from an assigned niche and from the remaining niches as well.  #@NEW_LINE#@#  Thus, for a given cell i there is a vector of length n giving the cells ecological fit to each niche.  #@NEW_LINE#@#  A cells fit to its assigned niche is denoted by z  0,1, where z=1 means that a cell only competes in its assigned niche and z=1/n means that a cell competes in all niches equally.  #@NEW_LINE#@#  We then define the competitive weight  of a cell i in niche j is as the product of its fitness fi (f=1+s for carriers and f=1 for non-carrier cells) times its association with niche j, so that ij=fii,1.  #@NEW_LINE#@#  Each of the n niches holds a resource share of N/n in each generation, so that a cell obtains resources from niche j proportionally to its relative competitive weight in this niche according to:', '', 'where Rij is the amount or resources obtained by cell i from niche j and j is the summed competitive weight in niche j given by:', '', 'The total amount of resources obtained by cell i per generation is then given by:', '', 'The resources of a cell determine the reproduction of a cell and we can use Ri as the mean number of offspring of a cell.  #@NEW_LINE#@#  We update the cell numbers stochastically using a Poisson distribution following a discrete time WrightFisher process68.  #@NEW_LINE#@#  Then, cells that lack the selected trait have a chance of acquiring the trait with a probability C(t)r. We implement the simulations using MATLAB and measure the horizontal gene flux and the diversities in different parts of the genome.  #@NEW_LINE#@#  The diversity is calculated as:', '', 'where n is the number of different locus variants present in the community and pi is their respective proportion.  #@NEW_LINE#@#  This calculation is analogous to the effective number of species in a community (of order 2 (ref.  #@NEW_LINE#@#  69)).  #@NEW_LINE#@#  We measure the genetic effect of the horizontal sweep as in the coalescence model using the DR given by:', '', 'where Dbg is the diversity in the background genome and Df is the diversity in the focal locus.  #@NEW_LINE#@#  More details of this simulation are given in the Supplementary Methods.  #@NEW_LINE#@#  We show that the results of our individual-based model and coalescence model match quantitatively, despite being fundamentally different models (Supplementary Fig 4).  #@NEW_LINE#@#  ', 'Code availability', 'The MATLAB code of our individual-based model is available online via http://zoo-kfoster.zoo.ox.ac.uk.'  #@NEW_LINE#@#  


