article id="http://dx.doi.org/10.1371/journal.pone.0148386"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Agent Based Modeling of Human Gut Microbiome Interactions and Perturbations  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
Background  #@NEW_LINE#@#  
Intestinal microbiota plays an important role in the human health.  #@NEW_LINE#@#  It is involved in the digestion and protects the host against external pathogens.  #@NEW_LINE#@#  Examination of the intestinal microbiome interactions is required for understanding of the community influence on host health.  #@NEW_LINE#@#  Studies of the microbiome can provide insight on methods of improving health, including specific clinical procedures for individual microbial community composition modification and microbiota correction by colonizing with new bacterial species or dietary changes.  #@NEW_LINE#@#  

Methodology_Principal_Findings  #@NEW_LINE#@#  
In this work we report an agent-based model of interactions between two bacterial species and between species and the gut.  #@NEW_LINE#@#  The model is based on reactions describing bacterial fermentation of polysaccharides to acetate and propionate and fermentation of acetate to butyrate.  #@NEW_LINE#@#  Antibiotic treatment was chosen as disturbance factor and used to investigate stability of the system.  #@NEW_LINE#@#  System recovery after antibiotic treatment was analyzed as dependence on quantity of feedback interactions inside the community, therapy duration and amount of antibiotics.  #@NEW_LINE#@#  Bacterial species are known to mutate and acquire resistance to the antibiotics.  #@NEW_LINE#@#  The ability to mutate was considered to be a stochastic process, under this suggestion ratio of sensitive to resistant bacteria was calculated during antibiotic therapy and recovery.  #@NEW_LINE#@#  

Conclusion_Significance  #@NEW_LINE#@#  
The model confirms a hypothesis of feedbacks mechanisms necessity for providing functionality and stability of the system after disturbance.  #@NEW_LINE#@#  High fraction of bacterial community was shown to mutate during antibiotic treatment, though sensitive strains could become dominating after recovery.  #@NEW_LINE#@#  The recovery of sensitive strains is explained by fitness cost of the resistance.  #@NEW_LINE#@#  The model demonstrates not only quantitative dynamics of bacterial species, but also gives an ability to observe the emergent spatial structure and its alteration, depending on various feedback mechanisms.  #@NEW_LINE#@#  Visual version of the model shows that spatial structure is a key factor, which helps bacteria to survive and to adapt to changed environmental conditions.  #@NEW_LINE#@#  


Citation: Shashkova T, Popenko A, Tyakht A, Peskov K, Kosinsky Y, Bogolubsky L, et al.  #@NEW_LINE#@#  (2016) Agent Based Modeling of Human Gut Microbiome Interactions and Perturbations.  #@NEW_LINE#@#  PLoS ONE 11(2):  #@NEW_LINE#@#  
           e0148386.  #@NEW_LINE#@#  

        https://doi.org/10.1371/journal.pone.0148386  #@NEW_LINE#@#  
Editor: Brenda A. Wilson, University of Illinois at Urbana-Champaign, UNITED STATES  #@NEW_LINE#@#  
Received: August 18, 2015; Accepted: January 18, 2016; Published:  February 19, 2016  #@NEW_LINE#@#  
Copyright:  Â© 2016 Shashkova et al.  #@NEW_LINE#@#  This is an open access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.  #@NEW_LINE#@#  
Data Availability: All relevant data are within the paper and its Supporting Information files.  #@NEW_LINE#@#  
Funding: Russian ministry of education and sciencegrant number 14.604.21.0119supported the data collection and Rusiina scientific foundationgrant 15-14-00066supported the model development.  #@NEW_LINE#@#  The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.  #@NEW_LINE#@#  
Competing interests:  "M&S Decisions" LLC and Yandex LLC provided support in the form of salaries for authors KP, YK, LB,AR, but did not have any additional role in the study design, data collection and analysis, decision to publish, or preparation of the manuscript.  #@NEW_LINE#@#  The specific roles of these authors are articulated in the 'author contributions' section.  #@NEW_LINE#@#  The authors have declared that no competing interests exist.  #@NEW_LINE#@#  "M&S Decisions" LLC and Yandex LLC have declared that no competing interests exist along with any other relevant declarations relating to employment, consultancy, patents, products in development, marketed products, etc.  #@NEW_LINE#@#  This does not alter the authors' adherence to PLOS ONE policies on sharing data and materials.  #@NEW_LINE#@#  
Introduction  #@NEW_LINE#@#  
The gut microbiota is a complex system of various microorganisms, e.g.  #@NEW_LINE#@#  bacteria, archaea, viruses, which interact to each other and the host.  #@NEW_LINE#@#  About 100 trillion microbial cells inhabit our gut, altogether they encode numerous unique enzymes needed for digestion (eupepsy) [1].  #@NEW_LINE#@#  The majority of microbes in a gut are innocuous or beneficial for the host [2].  #@NEW_LINE#@#  Intestinal microbiota protects the host against enteropathogenic microorganism colonization, produces additional nutrients and promotes normal functionality of immune system [3].  #@NEW_LINE#@#  Imbalance of gut microbiota is associated with many diseases, such as obesity [4], malnutrition [5], inflammatory bowel diseases (including Chron's disease, Ulcerative colitis) [6] and colon cancer [7].  #@NEW_LINE#@#  
There are many studies focused on the investigation of the composition and function of the gut microbiota [89].  #@NEW_LINE#@#  Most of them suggest some interactions between some of the microbiota members [1011] and their impact on the host [12].  #@NEW_LINE#@#  Bacteria communication with the host through secreted metabolites via variety mechanisms, which include interactions with epithelial-cell and receptor-mediated signaling [13].  #@NEW_LINE#@#  As you can see, studies propose a lot of hypothesis about interactions, however it will take long before all types of interactions will be deciphered.  #@NEW_LINE#@#  
Various types of microorganisms do not exist independently in the microbial community, but rather form a complex ecological interaction network [1415].  #@NEW_LINE#@#  Interactions between species from ecological network can be positive (+), negative (-) or neutral (0) for the community members [16].  #@NEW_LINE#@#  Pairwise relationship are divided into following groups: mutualism (+,+), commensalism (0,+), parasitiam (+,-) and amenalism (0,-) [17].  #@NEW_LINE#@#  For example in mutualism, bacteria from different taxonomic groups can interact with each other to create biofilm, which protects them against antibiotics [18].  #@NEW_LINE#@#  Another example is cross-feeding [19], when two species reciprocate metabolites.  #@NEW_LINE#@#  Recently it was shown that certain assembly rules are present and partners and excluders of certain species exhibit distinct metabolic interaction levels [20].  #@NEW_LINE#@#  Detection and study of such interaction types in microbial ecosystems is a subject of current scientific interest [2122].  #@NEW_LINE#@#  
Computer modeling is frequently used for testing scientific hypothesis on interactions between agents [2324].  #@NEW_LINE#@#  It provides a basis for formal testing, evaluation and comparison of what is currently known about the experimental system.  #@NEW_LINE#@#  Such models can help to predict the outcome of the overall changes and the effect of disturbances.  #@NEW_LINE#@#  Studies in the real world are limited by features of the devices, to date we can not observe spatial distributions in vivo, whereas computer models allow to test any hypothesis based on known facts.  #@NEW_LINE#@#  Theoretical computer models are used to hypothesize and test major principles and to visualize the processes, which are impossible to observe.  #@NEW_LINE#@#  
Some of the most popular models for complex systems are differential equations based and agent-based models.  #@NEW_LINE#@#  Differential equations based models are defined by ordinary differential equations (ODE) and often used in theoretical modeling focused on studying interactions between bacteria [2526].  #@NEW_LINE#@#  Agent-based modeling approach (ABM) describes dynamic systems consisting of objects that interact with each other according to specified algorithm [2728].  #@NEW_LINE#@#  The advantage of ABM is that it takes into account each agent separately and models could be made without much knowledge of the system, rules of the behaviour for agents could be introduced with a high degree of confidence in intrinsic structure of the system [28].  #@NEW_LINE#@#  ABM allows a real-time simulation of the system behavior caused by internal mechanisms, such as feedback regulation.  #@NEW_LINE#@#  Thus, agent-based model is a promising tool to study complexity of systems and test hypothesis on importance of agent properties.  #@NEW_LINE#@#  Dynamic modeling was originally used in sociology science, recently it was shown to describe the complexity of biological systems [29], and applied in studies of microbial community consisting of several species [3032].  #@NEW_LINE#@#  
We have constructed a simplified model of intestinal microbiota using an ABM approach.  #@NEW_LINE#@#  The model describes host-bacterial interactions and agents are presented by: two bacterial species, metabolites and a gut.  #@NEW_LINE#@#  A bacterial interaction scheme in presented model was based on short-chained fatty acids (SCFAs) metabolism as key controlling process.  #@NEW_LINE#@#  Levels of SCFAs in the gut are implicitly associated with obesity and overweigh [33].  #@NEW_LINE#@#  The hypothesis about role of SCFA concentration still needs in-depth studies and computer model gives an additional opportunity to investigate this questions.  #@NEW_LINE#@#  The main source of SCFAs is carbohydrate, and mammalian genomes do not encode most of the enzymes required for the degradation of structural polysaccharides presented in the plant tissues [34].  #@NEW_LINE#@#  Instead, there is a complex interdependent system of interactions between the host and the symbiotic intestinal microorganisms, this system allows to produce energy from rich sources such as polysaccharides.  #@NEW_LINE#@#  It is known that carbohydrate content of the diet has a strong effect on microbiota composition and activity of microbial communities [35].  #@NEW_LINE#@#  Many bacterial species are involved in SCFAs metabolism, we used a scheme belong to Bacteroidetes and Firmicutes, which are the dominant bacterial species in adult human intestine [36] and also Firmicutes/Bacteroidetes ratio is indicator of the development of obesity and overweight [37].  #@NEW_LINE#@#  
First step was to produce a stable system.  #@NEW_LINE#@#  Real biological self-regulating systems include feedbacks as necessary mechanisms for stability and flexibility [3839].  #@NEW_LINE#@#  We have constructed the system without feed-backs and after showing its instability started to add known feed backs to observe resilience.  #@NEW_LINE#@#  Understanding the role and the functions of feedbacks is one of the central questions in systems biology research at any level as even basic feedback patterns can produce non-linear effects [40].  #@NEW_LINE#@#  We have been interested in minimal number of interactions, which can create a stable system.  #@NEW_LINE#@#  We included different variants of feedbacks in our model.  #@NEW_LINE#@#  The most common example of feedback mechanism is a toxin-antitoxin system.  #@NEW_LINE#@#  Bacteria produce toxins (bacteriocins) to suppress competitive species, while the toxin producer itself produces antitoxins [4142].  #@NEW_LINE#@#  Loss or expression inhibition of the gene encoding antitoxin leads to death of the producing bacteria.  #@NEW_LINE#@#  Maintenance of bacterial species balance without the toxin-antitoxin systems can be reached by other bacteria, which use the toxic substance as nutrient.  #@NEW_LINE#@#  Gut controls the number of strains through production of toxins against some bacteria and nutrients for the other ones as response to metabolites concentrations [43] Our model shows that discussed feedback mechanisms increase the stability of the system and lead to steady state at certain parameters.  #@NEW_LINE#@#  
While it was possible to construct a stable system based on feedbacks, it was even more challenging to to study how this system woul respond to perturbation.  #@NEW_LINE#@#  It is known that such self-regulating systems are resilient to external influence, which can be random, periodic or programmed (like pregnancy [44] or hibernation [45]).  #@NEW_LINE#@#  In biological systems perturbation facilitates selection, and the fittest species survive.  #@NEW_LINE#@#  Antibiotics treatment is the most frequent cause of gut microbial community change [46] and hypothetically one of the major factors, that can lead to diseases like dysbacteriosis, allergy and inflammatory bowel disease [4749].  #@NEW_LINE#@#  The main cause of diseases is thought to be alterations of human-microbial co-metabolism, when the microbial composition is altered [5051].  #@NEW_LINE#@#  
Next issue we studied was recovery after antibiotics treatment.  #@NEW_LINE#@#  Microbiota composition may dramatically change after antibiotic treatment course and pass into another steady state or return to the previous [48].  #@NEW_LINE#@#  Each bacterial strain has its own recovery dynamics, as they differently response to perturbation.  #@NEW_LINE#@#  Some strains may become extinct, and the new steady state may be more appropriate for pathogenic strains, like C. difficile [52].  #@NEW_LINE#@#  A better understanding of the mechanisms will allow to avoid potentially adverse effects of the antibiotic treatment for the microbiota and the host as well.  #@NEW_LINE#@#  The time recovery dynamics is also dependent on type of antibiotic treatment [53].  #@NEW_LINE#@#  We observed different recovery time of the system after antibiotic treatment course and studied its dependence on interaction between species, number of feedbacks and periods of antibiotic gavage.  #@NEW_LINE#@#  
The problems of antibiotic treatment also includes the emergence of resistant bacterial strains [54].  #@NEW_LINE#@#  The presence of antibiotic-resistant strains complicates further antibiotic treatments [55] and makes them ineffective.  #@NEW_LINE#@#  Bacteria possess a number of mechanisms of defending against antimicrobial drugs.  #@NEW_LINE#@#  Bacteria adapt to new environment during antibiotic treatment and mutate, thus obtaining resistance.  #@NEW_LINE#@#  Mutations in bacteria are presented by both single nucleotide polymorphism (SNP) and horizontal gene transfer (HGT).  #@NEW_LINE#@#  SNP and HGT rates and ratios are species specific and in general it is unknown which mechanism dominates [56].  #@NEW_LINE#@#  In this study we didn't take into account how exactly bacteria became resistant and set mutation rate as probability function of drug concentration.  #@NEW_LINE#@#  We also introduced fitness-cost for resistance acquisition.  #@NEW_LINE#@#  Depending on mutation probability different outputs were obtained: domination of sensitive or resistant strains, oscillations or steady ratios.  #@NEW_LINE#@#  Presence and absence of resistant strains after antibiotic treatment in particular are defined by social interactions between sensitive and resistance strains [57].  #@NEW_LINE#@#  Our model demonstrates how segregation of strains can influence on rates of sensitive and resistant bacteria.  #@NEW_LINE#@#  
Finally we discuss some valuable implications of the model to the real world data and argue that such model are good opportunity to study the mechanisms of processes.  #@NEW_LINE#@#  We believe that presented thorough description of the model construction would be valuable for research community.  #@NEW_LINE#@#  

Results_and_Discussion  #@NEW_LINE#@#  
Model_structure_and_parameters  #@NEW_LINE#@#  
Development of the dynamic model for agent based modeling (ABM) has two stages.  #@NEW_LINE#@#  The first stage is a network definition.  #@NEW_LINE#@#  This step includes choosing objects and specifying interactions between them.  #@NEW_LINE#@#  The second stage is describing model dynamics.  #@NEW_LINE#@#  
In the current study bacteria and metabolites were chosen as objects.  #@NEW_LINE#@#  In the network (Fig 1) hubs correspond to chosen biological objects and edges illustrate relationship between them.  #@NEW_LINE#@#  Model of the community consists of two bacterial species, which compete with each other for nutrients and space.  #@NEW_LINE#@#  Topology selection of co-metabolism is a key factor determining interactions in the network, influencing the bacterial behavior in the model [58].  #@NEW_LINE#@#  Basic scheme of polysaccharides metabolism was chosen (Fig 1).  #@NEW_LINE#@#  The scheme reflects nutrition intake of Firmicutes (corresponds to type 1) and Bacteroidetes (corresponds to type 2), which are the dominant species in adult human microbiota.  #@NEW_LINE#@#  The analogous scheme was used in research of model microbiota consisting of these two phyla10.  #@NEW_LINE#@#  In the same study kinetic equations corresponding the scheme were provided, which made possible to calculate reaction velocity and Michaelis constants (Table 1).  #@NEW_LINE#@#  Parameters of the model were selected to correspond to current physiological and biochemical concepts, however it is possible that some of them may contradict to real world object.  #@NEW_LINE#@#  We argue that this shall not influence the validity of the model and its applicability to modeling of processes in the gut, as we manage to demonstrate several effects observed according to real world data: such as bistability and biofilm formation.  #@NEW_LINE#@#  
Interactions described in the scheme were used to develop a dynamic model of microbial community.  #@NEW_LINE#@#  In the model the following main classes were created: bacteria (type 1, type 2), nutritional metabolites (polysaccharides, acetate, propionate, butyrate), toxins and an immobilized object gut (object container).  #@NEW_LINE#@#  Each member of any class is the "agent" and has its own behavior pattern.  #@NEW_LINE#@#  Agents of class Bacteria, are active and have an ability to choose next action.  #@NEW_LINE#@#  Agents of class Metabolite are passive, move along the gut and, in the end, are excreted or absorbed by gut wall.  #@NEW_LINE#@#  The gut interacts with active agents by excreting metabolites (toxins and polysaccharides) thus controlling their abundance and directly influences the metabolites flux.  #@NEW_LINE#@#  
Life cycle and development of bacteria in the gut is affected by many parameters of the environment, including microbiota composition.  #@NEW_LINE#@#  In the model bacterium behavior depends on substances conversion reaction rate constants, the rate of nutrients uptake by intestine, the rate of metabolites flux, and the amount of given objects (metabolites and bacteria).  #@NEW_LINE#@#  Also, bacteria are characterized by a set of parameters, which define their movement and survival (Table 1).  #@NEW_LINE#@#  
A scheme describing behavior of the bacteria was developed.  #@NEW_LINE#@#  Bacteria searches for food, moves, converts substrate into appropriate metabolites, divides and dies.  #@NEW_LINE#@#  Action of the bacterium at the next moment is determined by its current state, local environment and random processes.  #@NEW_LINE#@#  Each action requires certain amount of time (Fig 2, shown as ticks), and all actions are performed sequentially.  #@NEW_LINE#@#  

Basic_behavior_of_the_model  #@NEW_LINE#@#  
The system containing bacteria, metabolites and gut was created.  #@NEW_LINE#@#  The constructed model shows development of the system in the course of time.  #@NEW_LINE#@#  At initial moment starting conditions (number and coordinates) are set for all object types (bacteria, metabolites).  #@NEW_LINE#@#  Every bacterium begins the cycle from one of the states in lifecycle, i.e.  #@NEW_LINE#@#  they can be producing metabolites, searching nutrients, dividing or dying.  #@NEW_LINE#@#  
The initial parameters are described in Table 1, parameters are chosen to fit biologically meaningful ranges and nutrition scheme (Fig 1).  #@NEW_LINE#@#  
In the basic version of the model combination of initial parameters and behavior rules did not lead to finding the "steady state" of the system.  #@NEW_LINE#@#  System was set to run multiple times with various intial conditions.  #@NEW_LINE#@#  Here by "steady state" we mean a state of the system, characterized by maintaining constant and not zero average number of bacterial agents of each type over the prolonged course of time.  #@NEW_LINE#@#  The initial set up of the model does not have regulating mechanisms, so it can not support balance in the system.  #@NEW_LINE#@#  Therefore this step became a validation of correctness of the model.  #@NEW_LINE#@#  
It is well known that feedbacks are required mechanisms for self-regulating systems.  #@NEW_LINE#@#  The feedbacks provide the systems sensitivity to signals (noise filtering), optimal performance (use of resources), stability/multistability and resistance to environmental changes.  #@NEW_LINE#@#  Driven by the presence/absence of feedbacks and their types, positive or negative, different types of interactions emerge in the system: mutualism, commensalism, competition, amensalism and parasitism [5960].  #@NEW_LINE#@#  The basic model contains links leading to competition (use of only one substratepolysaccharides) and exploitation (type 2 bacteria consume the waste products of the bacteria type 1acetate).  #@NEW_LINE#@#  
Following modification of the initial system have been considered (bellow we define feedback as FB):  #@NEW_LINE#@#  
Further systems containing single feedbacks from the above list were constructed.  #@NEW_LINE#@#  The general behavior of the system is determined not only by the presence of specific communication mechanisms, but also by sensitivity and by the time it takes system to respond.  #@NEW_LINE#@#  We observe following dependencies:  #@NEW_LINE#@#  
The model parameters were selected for the model in the following way:  #@NEW_LINE#@#  
Each feedback type is defined by set of parameters: reaction constant or threshold of sensitivity (Methods).  #@NEW_LINE#@#  The program was run 3 times for each feedback type for each hypothetical value, in total 210 times.  #@NEW_LINE#@#  Using above described criterion parameters for each additional mechanism were chosen.  #@NEW_LINE#@#  We have also taken into account the average number of bacteria and period and amplitude of oscillation.  #@NEW_LINE#@#  These three parameters do not influence general trends in the system behavior however alter the calculation time.  #@NEW_LINE#@#  Chosen parameters presented in S1 Table.  #@NEW_LINE#@#  
The results of the experiments with feedbacks were compared with those of basic model and classified according to their impact on the system (Table 2).  #@NEW_LINE#@#  In the basic model bacteria of type 2 are dominant, because they have more energy sources (acetate and polysaccharides), and as a consequence, a higher division rate.  #@NEW_LINE#@#  In order to stabilize the system the feedbacks should promote growth of bacteria type 1 and restrict that of the type 2.  #@NEW_LINE#@#  Onwards only those variants of feedbacks were considered which stabilized the system.  #@NEW_LINE#@#  Additionally systems containing all possible combinations of 2 and 3 stabilizing feedbacks were studied.  #@NEW_LINE#@#  
During the system behavior research, for each combination the model was run 588 times (14*14*43): three replicates for each set of initial quantities of bacteria (from 200 to 3000 with increment of 200).  #@NEW_LINE#@#  The overall number of tests was 16464, which took around 24 hours of computation on a 6 node cluster.  #@NEW_LINE#@#  The system with a single feedback can have only one stable state.  #@NEW_LINE#@#  When the system has multiple feedbacks, their combination may lead to the existence of two stable states (S2 Table).  #@NEW_LINE#@#  For example, we observe one stable state of the system taking into account FB1 only (Fig 4A), while the combination of FB1 and FB7 results in two stable states (Fig 4B).  #@NEW_LINE#@#  In order to understand this bistability dependence of the steady state on initial bacterial quantity was analyzed, but no relationship was found (S1 Fig).  #@NEW_LINE#@#  
Interestingly, visualized version of the model showed that feedbacks also affect the spatial distribution of bacteria.  #@NEW_LINE#@#  For example, addition of mutualistic bacterial interactions leads to a strong mixing of the two species (Fig 4C).  #@NEW_LINE#@#  In case of bacteria feeding from the gutthe separation of bacterial layers is observed (Fig 4D and 4E).  #@NEW_LINE#@#  To estimate the ratio of bacterial mixing rate we used segregation index (see Methods).  #@NEW_LINE#@#  It was calculated for each case in different parts of the gut (mucin layer, gut lumen).  #@NEW_LINE#@#  The presence of two stable states of the system is also associated with the degree of intermixing of bacteria within the virtual intestine.  #@NEW_LINE#@#  We discovered that two steady states are observed if there are several FB mechanisms in the model with different effects on the spatial distribution of bacteria.  #@NEW_LINE#@#  Two spatial configurations in the model are separation of the bacterial layers and intermixing, the most pronounced bistability (i.e.  #@NEW_LINE#@#  separation of the two stable states) is observed in the combination of toxin-antitoxin system (FB1) and intestinal production of polysaccharides (FB7), consumed by only bacterial type 1.  #@NEW_LINE#@#  FB1 supports intermixing and FB7 supports segregation.  #@NEW_LINE#@#  If intermixing dominates (Fig 4D), then the average number of bacteria is higher than in case of separation (Fig 4E).  #@NEW_LINE#@#  The state of intermixing promotes active metabolic exchange and the number of bacteria increases, while separation leads to overall decline in metabolism and therefore the number of bacteria falls.  #@NEW_LINE#@#  
In general, the force of FB mechanisms determines distance between peaks of stable states.  #@NEW_LINE#@#  The program was run several times with same initial parameters (numbers of bacteria and feedback parameters) and different results were acquired.  #@NEW_LINE#@#  The basic spatial distribution of bacteria at initial time is random and we suggest that the final system state depends on initial spatial distribution of bacteria.  #@NEW_LINE#@#  

Perturbation__antibiotic_treatment  #@NEW_LINE#@#  
Antibiotics are one of the most powerful agents of perturbations in gut microbial ecology to date [61].  #@NEW_LINE#@#  An effect of the antibiotic therapy on the model was examined.  #@NEW_LINE#@#  Several variants of antibiotic treatment were analyzed: 1 or 3 times a day gavage, for period 3, 5, 10 and 30 days.  #@NEW_LINE#@#  
Antibiotic treatment course in our model is defined by following parameters: antibiotic dose (k_ant_intake [mmol/hours]), frequency (per day) and period (AntibiticPeriod [days]) of intake.  #@NEW_LINE#@#  The model output is almost the same for different values of antibiotic dose, which is quite expected.  #@NEW_LINE#@#  The most part of antibiotics is moving along the gut lumen while the large part of bacteria end to occupy place near gut wall during treatment.  #@NEW_LINE#@#  Thus, small change (from 2% to 1.8% of predicted value) of antibiotic dose do not lead to significant change of bacterial abundance during treatment (S2 Fig).  #@NEW_LINE#@#  Comparison of antibiotic intake frequency, when antibiotic dose is the same for single gavage, (1 and 3 times a day) shows that this parameter influences on average number of bacteria.  #@NEW_LINE#@#  If the antibiotic dose is the same for course, frequency of intake influences the amplitude and period of oscillation of average number of bacteria during antibiotics treatment.  #@NEW_LINE#@#  The 1 time a day course was used for the further study.  #@NEW_LINE#@#  
It is known that bacteria can be sensitive or resistant to the antibiotics.  #@NEW_LINE#@#  We added new parameter for bacterial sensitivity in the model.  #@NEW_LINE#@#  The bacterial sensitivity was defined by a certain threshold, which equals to a quantity of the drug lethal for the bacterium.  #@NEW_LINE#@#  According to the model, antibiotic molecules get into a bacterium by diffusion and after its death of antibiotics dissolve into the gut.  #@NEW_LINE#@#  Thus, there are four cases:  #@NEW_LINE#@#  
We examined system behavior and stability in first three cases while the fourth obviously will not show any influence of antibiotic treatment.  #@NEW_LINE#@#  
Here and further stability is defined as an ability of the system to keep the functional properties after an impact of an external perturbation.  #@NEW_LINE#@#  
As follows from the previous point, relationship between components regulates not only density of the community, but also forms its spatial structure.  #@NEW_LINE#@#  Interestingly, model shows spatial factor influence on stability: in a dense population structure sensitive species could be hidden from drug access by resistant (case 2 and 3: bacterial type have different sensitivity to antibiotics), this situation is only possible when bacteria have tight feedback connection.  #@NEW_LINE#@#  Antibiotics mostly affect the bacteria in an intestinal lumen and only a small dose of "drug" reaches bacterial layer near gut epithelium.  #@NEW_LINE#@#  There are no differences in system behavior between cases 2 and 3 when bacterial spatial organization is intermixed.  #@NEW_LINE#@#  If bacteria are separated into layers, in case 3 this spatial structure didn't change, but in case 2 bacteria of type 2 suffer from antibiotics and are forced to live mixed up with bacterial type 1.  #@NEW_LINE#@#  
The most interesting situations are when both bacterial species are sensitive to the antibiotics, then the differences in a "steady state" recovery processes are observed.  #@NEW_LINE#@#  Also new steady states can be established after recovery.  #@NEW_LINE#@#  These processes are dependent on different mechanisms of interactions and different sensitivity to the antibiotic.  #@NEW_LINE#@#  We clearly observed two cases:  #@NEW_LINE#@#  

System_recovery  #@NEW_LINE#@#  
Model was run 3 times for each schema of bacterial interactions.  #@NEW_LINE#@#  The recovery time was defined as difference between the end of antibiotic course and the time, then number of bacteria equals 80% of these before treatment.  #@NEW_LINE#@#  After that, recovery time was averaged over all runs with the same number of feedbacks (Fig 6A).  #@NEW_LINE#@#  To estimate the resilience of the system with different parameters we calculated the time it takes system to reach a critical number of 100 for any of two bacterial species.  #@NEW_LINE#@#  In this case continuous gavage was used once a day with the same dose for all parameters.  #@NEW_LINE#@#  After number of any bacterial type reaches 100 it is improbable that the system will rebound, therefore the longer it takes to reach the critical threshold the more resilient is the system.  #@NEW_LINE#@#  Time was calculated for each run for each run and also averaged over all runs with the same number of feedbacks (Fig 6B).  #@NEW_LINE#@#  These values were used, as measurement of system resilience.  #@NEW_LINE#@#  
Demand of bacteria in each other was found to depend on quantity and types of feedbacks.  #@NEW_LINE#@#  Strong coherence of bacterial types helps system to keep a steady state.  #@NEW_LINE#@#  An initial state recovery occurs simultaneous for both bacterial types because their interactions promote maintenance of their population.  #@NEW_LINE#@#  Steady state recovery time in system decreases (Fig 6A) for system with 3 feedbacks with increase of treatment duration.  #@NEW_LINE#@#  This observation is counterintuitive, however the point is that the system with higher number of feedbacks adjusts to new conditions faster and finds a new possible steady state faster, while system with lower number of feedbacks continues to degrade.  #@NEW_LINE#@#  Further we observe that recovery from steady state to previous state is faster.  #@NEW_LINE#@#  State of balance between number of bacteria killed by antibiotics and born is a new "steady state" appearing during treatment.  #@NEW_LINE#@#  Observed decrease in number of bacteria die results from increase in bacterial density.  #@NEW_LINE#@#  Bacteria band together in community in mucin layer and protect each other from antibiotics.  #@NEW_LINE#@#  Bacteria on the upper layer detain antibiotics and after same time die, whereas bacteria inside have enough time to divide.  #@NEW_LINE#@#  
Systems with weak feedback interconnectivity between species show different pattern: the fast-growing type recovers faster and promotes recovery of the other.  #@NEW_LINE#@#  After continuous antibiotics treatment the community becomes almost completely extinct with only a small part of the bacterial population left in a mucin layer, where access of drugs is restricted.  #@NEW_LINE#@#  

Mutations_leading_to_antibiotic_resistance  #@NEW_LINE#@#  
Existence of antibiotics in an organism creates the conditions contributing to selection of bacteria with mutations leading to antibiotic resistance.  #@NEW_LINE#@#  Bacteria possessing antibiotic resistance have both advantages and disadvantages.  #@NEW_LINE#@#  They are protected from drug influence, yet, for example, they have to spend energy on production of proteins protecting against drugs like efflux pumpsthis type of bacterial expenditures are called fitness cost [62].  #@NEW_LINE#@#  
To introduce the antibiotic resistance mutation in the model the following assumptions were made:  #@NEW_LINE#@#  
Depending on a ratio of the parameters connected with advantages and disadvantages of resistance we obtained three structural variants of the bacterial community after recovery:  #@NEW_LINE#@#  
The modeling of antibiotic resistance spread using the parameters chosen demonstrated that over 50 per cent of models ended up with at least one of two bacterial types being dominated by resistant microbes (Fig 7D).  #@NEW_LINE#@#  The space of system parameters RC and k_ant_intake determines the most probable outcome (Fig 7E).  #@NEW_LINE#@#  The areas are overlapping as we consider different variants of feedbacks (similar to previous sections), nevertheless it is shown that ratio of these parameters play crucial role in the outcome of the treatment.  #@NEW_LINE#@#  In practice, RC can be calculated from experiment, as difference between growth of sensitive and resistant strains, and after that, we can choose appropriate dose of antibiotics according to graph Fig 7E.  #@NEW_LINE#@#  These could be potentially used to adopt the proper antibiotic treatment, dosage and gavage regimen to refrain completely resistant microbiome.  #@NEW_LINE#@#  
In the community the ratio of bacterial strains is influenced not only by probability of a mutation, but also by a spatial arrangement of bacteria in the artificial intestine.  #@NEW_LINE#@#  Strains compete for nutrition, and thus sensitive strains divide faster.  #@NEW_LINE#@#  Consequently, sensitive strains dominate after the treatment in well-mixed communities, forcing out the resistant ones.  #@NEW_LINE#@#  To reduce the competition after the treatment, different strains inhabit different areas of the intestine and thus, can coexist (Fig 8A).  #@NEW_LINE#@#  During the treatment course sensitive strains need protection, which is possible when both types are mixed or when sensitive strains are surrounded or stay behind the resistant ones.  #@NEW_LINE#@#  Fig 8B and 8C demonstrate sensitive strains tend to stay closer to the gut wall and to occupy the space in the lower part of the gut.  #@NEW_LINE#@#  Since the bacteria in this virtual intestine can move freely, in particular, under the influence of random processes, the final ration between strains for the same initial parameters was observed.  #@NEW_LINE#@#  
Proportion of resistant bacteria depends on amount of nutrients for this bacterial type (a lot of nutrients reduces competition) and bacterial spatial distribution (there are more resistant bacteria in the gut lumen, than sensitive one).  #@NEW_LINE#@#  These two parameters are defined by interactions network.  #@NEW_LINE#@#  
For example, base interactions network with FB 7 is set.  #@NEW_LINE#@#  The most of the type 2 bacteria are located in the gut lumen and top layer of mucin, whereas the most of the type 1 bacteria are located in mucin layer.  #@NEW_LINE#@#  Both bacterial types have two nutrient sources.  #@NEW_LINE#@#  In this case proportion of resistant is higher in bacterial type 1.  #@NEW_LINE#@#  

Real_world_observations  #@NEW_LINE#@#  
To compare our observations with real world data we have used profiles of microbiota compositions in from four major studies of nation wide microbiota, these data sets were recalculated by same approach in study of Russian micorbiome [63], additionally we used metabolic complementarity index [11] for each pair of bacterial species.  #@NEW_LINE#@#  We have observed in our model calculations that the more complimentarity there is in the system the more stable it is to anitbiotic treatment.  #@NEW_LINE#@#  The hypothsis was that we could find similar links in real world.  #@NEW_LINE#@#  
We presented each sample as a graph containing all complimentary relationships between all members of community (S3 Fig).  #@NEW_LINE#@#  Such a graph represents a crude estimate of metabolic feedbacks in a system, additionally graph parameters such as number of authorities, hubs, edges and vertices was calculated (Fig 9).  #@NEW_LINE#@#  We further speculate that the graphs rich in authorities and hubs are more stable.  #@NEW_LINE#@#  Interestingly that microbiomes from China are known to have more resistance [64], which is caused by much heavier antibiotic load on the gut.  #@NEW_LINE#@#  This coincides with our observation of their stability and we observe the same features in our model.  #@NEW_LINE#@#  One could say that microbiome adopts to constant perturbation by antibiotic by selecting those species which are more metabolically comlimentary to each other.  #@NEW_LINE#@#  We also know that microbiome in Russia has a resistance in between European and Chinese (data unpublished).  #@NEW_LINE#@#  


Discussion  #@NEW_LINE#@#  
The issue of modeling complex biological systems requires a balance between the simplicity of the model and its ability to demonstrate non-linear effects.  #@NEW_LINE#@#  The object of the studymicrobiomewas represented by minimal number of agents: gut wall, metabolites and bacteria.  #@NEW_LINE#@#  Using only two bacterial types allowed to keep the model simple and build complex interactions inside the community.  #@NEW_LINE#@#  The basic interaction in the microbiome is metabolic interconversion and one of the essential processes of SCFA biosynthesis was incorporated in the model.  #@NEW_LINE#@#  While the model itself does not pretend to simulate physiology of the gut and digestion, the physical and chemical parameters were chosen according to real world data.  #@NEW_LINE#@#  
Agent based modeling was selected to keep the model as simple as possible on the stage of model description.  #@NEW_LINE#@#  The algorithm of decision making itself was built upon rational thinking and according to general observations in microbiology, the parameters of the algorithm could be varied in a wide range.  #@NEW_LINE#@#  
The robustness of the system is supported by number of feedback loops discussed in literature.  #@NEW_LINE#@#  To our knowledge this is the first attempt to model the gut microbiota using the ABM.  #@NEW_LINE#@#  The aim of the ABM modeling is to capture emergent properties of the system built with simple components and simple properties.  #@NEW_LINE#@#  
We have shown the emergent properties of the system in three different domains:  #@NEW_LINE#@#  
The robustness of the system is acquired through feedback loops and even in the case of bacteria with profound capabilities of metabolizing the energy rich nutrients the bacteria has no chance for robustness unless it has a set up of numerous feedback loops.  #@NEW_LINE#@#  This observation is connected with two intriguing facts in intestinal microbiota studiestransient flora and inflammation induced bacterial pathogenesis.  #@NEW_LINE#@#  Observation in our model could be applied to both.  #@NEW_LINE#@#  
The transience of probiotic components is well known [6566] and in part could be attributed to absence of feedback loops between gut and probiotic component.  #@NEW_LINE#@#  On the other hand there are examples of pathogens creating the feedback loops themselvesand therefore promoting novel steady states in the gut, where they become persistent.  #@NEW_LINE#@#  Diarrhea causing Salmonella was shown to induce inflammation and use the respiratory electrons emerging from inflammation to promote its own growth [67].  #@NEW_LINE#@#  Such a feedback formation by pathogens is often called vicious circle.  #@NEW_LINE#@#  
The other aspect of robustness shown in the model is a bistable distributionthis aspect has not been predicted by initial setup and is indeed an emergent property of the model proposed.  #@NEW_LINE#@#  Interestingly the bistability that is shown in the two stable ratios between bacterial types.  #@NEW_LINE#@#  This could be interpreted as a variety of stable compositions in real world microbiota and could have a direct connection to observed enterotypes [68].  #@NEW_LINE#@#  In the model bistability is reached by spatial distribution or segregation.  #@NEW_LINE#@#  The bacteria in the gut are well known to segregate between the gut wall and the lumen [69], however the real mechanism is much more complex and includes the difference in functional states of the luminal and wall mucosal flora [70].  #@NEW_LINE#@#  The view proposed in the model could be generalized for the case of the real gut as a succession of steady states providing robustness through existence of stable configurations, whereas each level (segregation state) could be used by host organism as a stable marker of undergoing changes in the gut.  #@NEW_LINE#@#  We show in our model that each level is characterized by constant production rate of metaboliteswhich are know to be used by gut as a signal.  #@NEW_LINE#@#  There always exists one of the states with minimal entropy and other states could be used to dissipate energythereby providing means to damp the excessive stress.  #@NEW_LINE#@#  
The model for system perturbation was antibiotic treatment.  #@NEW_LINE#@#  There are numerous reports on the effects of antibiotic treatment and animal experimental models.  #@NEW_LINE#@#  Most reports show distinct diversity drop after antibiotic treatment [3].  #@NEW_LINE#@#  In the model proposed several parameters were used to simulate real world situation.  #@NEW_LINE#@#  The effect of the antibiotic on the particular bacterial type was different, and the sensitivity was chosen as a parameter.  #@NEW_LINE#@#  It is well known that in vitro model show different MICs (minimal inhibitory concentrations) for different bacterial species.  #@NEW_LINE#@#  Obvious effect of the perturbation in the model was extinction of the more sensitive bacterial type in the course of antibiotic treatment.  #@NEW_LINE#@#  However interesting was the idea of feedback connectivity protecting the bacterial types.  #@NEW_LINE#@#  It was shown that the more feedbacks there were in the system the less prone system was to continuous antibiotic course.  #@NEW_LINE#@#  Interestingly the number of sensitive species was diminishing slower in a tightly connected system than in the decoupled model, while the number of resistant species was decreasing faster in the model with maximal number of feedbacks.  #@NEW_LINE#@#  The situation could be comprehensively described as tighter coupling through feedbacks allowing for damping antibiotic treatment through the total community response, while uncoupled species are easier to eliminate.  #@NEW_LINE#@#  Application of this fact could be individual introduction or support of some key bacterial species in the gut before antibiotic gavagethis would allow to secure gut microbiome while antibiotics would kill the pathogens.  #@NEW_LINE#@#  This emergent effect of community sensitivity and could be used in collateral damage reduction approaches widely discussed [71].  #@NEW_LINE#@#  The modeling so far could predict the viability of the current community and the approaches to make the system more stable and prone to the disturbing interference.  #@NEW_LINE#@#  
Peculiar is the result on dynamics and spatial distribution acquired in the series of experiments.  #@NEW_LINE#@#  It was possible to model the spatial inhomogenity caused by antibiotic treatment (Fig 6D), this inhomogenity was produced by layering of bacterial types.  #@NEW_LINE#@#  It was shown that even in the case of both sensitive bacteria they can be structured into two layers.  #@NEW_LINE#@#  In the case of the model studied the innermost layer was taken by bacteria having a feedback loop with the gut and the outer layer was taken by bacteria without any connection to gut.  #@NEW_LINE#@#  Therefore the gut was providing antibiotic protecting environment and the bacteria having less (or no) connection to the gut were shown to be more prone to influence of the outer factors.  #@NEW_LINE#@#  
Modeling the whole amount of microbial interactions could lead to explanation of the results acquired by next-generation sequencing profilingit is clearly shown that some of the bacteria are more probable to be extinct after course of antibiotic treatment while others are prone to antibiotics [71].  #@NEW_LINE#@#  It is shown that antibiotic resistance genes are responsible for survival, however it is known that some of the bacteria can survive without genes specializing in resistance18.  #@NEW_LINE#@#  We hypothesize that this could be an emergent effect of the community where population dynamics could be dependent on the number of feedbacks and as the model shows the population can be organized into spatial structures.  #@NEW_LINE#@#  The crude calculation of community graph properties also support the idea that antibiotic resistance could be supported by more interconnected community, i.e.  #@NEW_LINE#@#  that microbiomes in China and Russia could be depleted from species with low feedback connectivity with others.  #@NEW_LINE#@#  
Antibiotic resistance acquisition modeling allowed us to speculate on the resistance rise and clearance.  #@NEW_LINE#@#  While most of the results were predictable and proportion of the resistant bacteria was the function of the treatment period.  #@NEW_LINE#@#  Antibiotic resistance was observed after the end of administration.  #@NEW_LINE#@#  Interestingly in the longer administration periods persistent antibiotic resistance appeared, resistant strains were observed long after the end of the administration.  #@NEW_LINE#@#  The modeled situation of persistent resistance, however the fitness cost, is explained by spatial factors.  #@NEW_LINE#@#  Resistant strains occupy the distinct areas of the gut and do not let more faster growing bacteria without resistance displace them.  #@NEW_LINE#@#  In part this could be due to the constant flow rate in the model, however this also allows to hypothesize the niche explanation.  #@NEW_LINE#@#  Although the fitness cost should lead to diminishing the number of resistant bacteria, niches could exist where resistant bacteria take over during the treatment and hinder sensitive bacteria from taking over no matter the fitness advantage.  #@NEW_LINE#@#  This is a good point to be experimentally tested, so far antibiotic resistance is averaged for the whole gut, but technologies will emerge to scan multiple niches at ease.  #@NEW_LINE#@#  
To conclude the study presents a simple model with a simple metabolic circuit.  #@NEW_LINE#@#  All the parameters of the model have a certain relation to realty.  #@NEW_LINE#@#  The system effect of layering and bistability after introduction of feedback loops is observed and antibiotic treatment is studied as a perturbation.  #@NEW_LINE#@#  System stability is shown to depend on spatial factors and community structure.  #@NEW_LINE#@#  Finally problem of resistance was modeled, the model parameters allow for observations connected to in vivo observations on resistance spread and provides insights on the niche hypothesis.  #@NEW_LINE#@#  

Methods  #@NEW_LINE#@#  
The model is constructed by means of object-oriented programming in the Java language.  #@NEW_LINE#@#  Multiple start of the program for receiving data files was made on a high-performance computing (HPC) clusters (12 nodes, single run 10 min = 105 ticks).  #@NEW_LINE#@#  For observation over system behavior the program was started on the personal computer.  #@NEW_LINE#@#  Statistical processing of the output data was carried out with using a software environment "R" (https://www.r-project.org/).  #@NEW_LINE#@#  
Kinetic_equations_describing_the_scheme_metabolism_of_polysaccharides_(Fig_1)  #@NEW_LINE#@#  
Change in the concentration of substances:  #@NEW_LINE#@#  
(1)  #@NEW_LINE#@#  
(2)  #@NEW_LINE#@#  
(3)  #@NEW_LINE#@#  
(4)  #@NEW_LINE#@#  
Speed of substances absorption in intestines:  #@NEW_LINE#@#  
(5)  #@NEW_LINE#@#  
where [C]substance concentration,  #@NEW_LINE#@#  
Kmcthe Michaelis constant corresponding to a given substance.  #@NEW_LINE#@#  
The production rate of substances:  #@NEW_LINE#@#  
(7)  #@NEW_LINE#@#  
(8)  #@NEW_LINE#@#  
(9)  #@NEW_LINE#@#  
(10)  #@NEW_LINE#@#  
The rate of excretion from the intestine:  #@NEW_LINE#@#  
(11)  #@NEW_LINE#@#  
where [C]substance concentration.  #@NEW_LINE#@#  

The_movement_of_nutrient_through_the_intestines  #@NEW_LINE#@#  
On the basis of kinetic equations for the concentrations (5,11), we calculate the absorption rates of nutrients in the intestines and speed along it for each "piece" of nutrient in the gut.  #@NEW_LINE#@#  From Eqs (5 and 11), we find the amount of material which must be inferred from the intestine and which must be absorbed in the intestine.  #@NEW_LINE#@#  We believe that the substance is distributed evenly through the intestines.  #@NEW_LINE#@#  Then find a distance dl, that the food, located at that distance from the exit/intestinal wall, in a time dt should be excreted /absorbed, i.e.  #@NEW_LINE#@#  most extreme piece of food must travel a distance dl.  #@NEW_LINE#@#  Thus, all the substance can be divided into n portions: n = [C] / d[C].  #@NEW_LINE#@#  Therefore, if the length of the intestine L, then the desired distance dl is given by: dl = L / n = L * d [C] / [C].  #@NEW_LINE#@#  This yields the general form of the equation for the velocity of food in the intestines: Speed = dl / dt = d [C] / dt * L * [C] = k * L.  #@NEW_LINE#@#  
From Eq (5), we find the absorption rate of substances in the intestine (velocity along the axis y):  #@NEW_LINE#@#  
(12)  #@NEW_LINE#@#  
where Ddiameter of intestine.  #@NEW_LINE#@#  
From Eq (11) we find the excretion rate of substances from the gut (velocity along the x axis):  #@NEW_LINE#@#  
(13)  #@NEW_LINE#@#  
The nutrients enters the intestine periodically some portions.  #@NEW_LINE#@#  
We do the assumption that the components passing near intestines walls cling to them and has speed smaller in comparison with food speed in the intestinal lumen.  #@NEW_LINE#@#  Thus, components of intestines move with a speed corresponding to some power law depending on location concerning the center of a gut.  #@NEW_LINE#@#  
(14)  #@NEW_LINE#@#  
where getYcurrent axial coordinate of object (location in the perpendicular section of a gut)  #@NEW_LINE#@#  
Ddiameter of intestine  #@NEW_LINE#@#  
Llength of intestine  #@NEW_LINE#@#  
Eq (14) is true for all components of the intestine, not only for nutrients.  #@NEW_LINE#@#  

System_parameters  #@NEW_LINE#@#  
External parameters of system are described in Table 1.  #@NEW_LINE#@#  The value of these parameters were chosen based on the effects observed in our system (e.g.  #@NEW_LINE#@#  radius, lifetime) and literature data (e.g.  #@NEW_LINE#@#  speed, reaction rate constant) and program calculation time (long lifetime leads to a large number of bacteria and increase the amount of information processed, in such event general trends in the behavior of the system do not change).  #@NEW_LINE#@#  Variation of parameters for studying their influence on the system carried out in the range of from 1% to 1000% with steps of 1% of the estimated value of the quantity.  #@NEW_LINE#@#  
The parameters are read from an external file when the program starts, as a result of the program creates a file with the values of the number of bacteria and metabolites in each run of the program.  #@NEW_LINE#@#  
Facts taken into account for model construction:  #@NEW_LINE#@#  

Algorithms_of_feedbacks_mechanisms  #@NEW_LINE#@#  
In order introduce feedback mechanisms into model following pseudo codes and suggestions were used:  #@NEW_LINE#@#  
FB1: if (bacterium of type 2 get acetate) {  #@NEW_LINE#@#  
Â Â Â Â Â Â Â Â if (random(100) less_than percentage of toxins) {bacterium produces toxin killing themselves}  #@NEW_LINE#@#  
Â Â Â Â Â Â Â Â else {bacterium produces butyrate}  #@NEW_LINE#@#  
FB2: if (abundance of bacterial type 2abundance of bacterial type 1  greater than  threshold) {  #@NEW_LINE#@#  
Â Â Â Â Â Â Â Â bacteria of type 1 produce toxins inhibiting growth of type 2}  #@NEW_LINE#@#  
Notice: toxins and other metabolite conversed from polysaccharides produced together by bacterial type 1  #@NEW_LINE#@#  
FB3: if (abundance of bacterial type 2abundance of bacterial type 1  greater than  threshold) {  #@NEW_LINE#@#  
Â Â Â Â Â Â Â Â gut produce toxins inhibiting growth of type 2}  #@NEW_LINE#@#  
FB4: if (amount of butyrateamount of propionate  greater than  100) {  #@NEW_LINE#@#  
Â Â Â Â Â Â Â Â gut produce toxins inhibiting growth of type 2}  #@NEW_LINE#@#  
FB5/6: if (amount of butyrate/propionate  greater than  threshold) {  #@NEW_LINE#@#  
Â Â Â Â Â Â Â Â gut produce toxins inhibiting growth of type 2/1}  #@NEW_LINE#@#  
FB7: if (amount of butyrate less_than threshold) {  #@NEW_LINE#@#  
Â Â Â Â Â Â Â Â gut produce polysaccharides for baterial type 1}  #@NEW_LINE#@#  
In most cases we used concentration as observed parameter rather than agent interaction rules in order to reduce calculating time of program.  #@NEW_LINE#@#  

Segregation_index_calculation  #@NEW_LINE#@#  
Artificial gut was divided into 3 areas:  #@NEW_LINE#@#  
where Dgut width, 0 coordinates if the top wall, Dcoordinated of the bottom wall.  #@NEW_LINE#@#  
Segregation index was calculated for each part of gut using methodology of Mitri et al.  #@NEW_LINE#@#  [68].  #@NEW_LINE#@#  Thirst, the segregation index of each bacterium (bi) is defined as:  #@NEW_LINE#@#  
(15)  #@NEW_LINE#@#  
where (bi, bj) = 0 if bi and bj belong to different bacterial type, or, (bi, bj) = 1 if bi and bj belong to the same bacterial type, and Nr is the number of neighborhood bacteria falling within distance of r = R = 30000 mkm.  #@NEW_LINE#@#  
Second, the segregation index seg1 (seg2) of bacterial type 1 (2) for each part of gut is defined using following equation:  #@NEW_LINE#@#  
(16)  #@NEW_LINE#@#  
where N1(2) is the number of bacteria of corresponding type.  #@NEW_LINE#@#  

Graphs_of_metabolic_complementarity  #@NEW_LINE#@#  
Metabolic complementarity graphs for each gut metagenome were constructed using its species-level taxonomic composition and metabolic complementarity index [11] (MCI) for each pair of the bacterial species.  #@NEW_LINE#@#  The taxonomic composition was calculated by mapping to a reference genomes catalog as described previously [63].  #@NEW_LINE#@#  The table of pair wise MCI between the species was obtained from [11].  #@NEW_LINE#@#  In the graph, each vertex corresponds to a species highly present in the metagenome (relative abundance  greater than 1%) whereas a directed edge directing from species A to species B corresponds a high MCI value between A and B (that is, A provides many nutrients to B; only the pairs with  greater than  0.35 were plotted).  #@NEW_LINE#@#  

Code_availability  #@NEW_LINE#@#  
Code for the model is available at https://github.com/dreamlab13/abmbiota  #@NEW_LINE#@#  




