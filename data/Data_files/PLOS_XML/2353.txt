article id="http://dx.doi.org/10.1371/journal.pbio.2005372"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Is the sky the limit?  #@NEW_LINE#@#  On the expansion threshold of a species range  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
More than 100 years after Griggs influential analysis of species borders, the causes of limits to species ranges still represent a puzzle that has never been understood with clarity.  #@NEW_LINE#@#  The topic has become especially important recently as many scientists have become interested in the potential for species ranges to shift in response to climate changeand yet nearly all of those studies fail to recognise or incorporate evolutionary genetics in a way that relates to theoretical developments.  #@NEW_LINE#@#  I show that range margins can be understood based on just two measurable parameters: (i) the fitness cost of dispersala measure of environmental heterogeneityand (ii) the strength of genetic drift, which reduces genetic diversity.  #@NEW_LINE#@#  Together, these two parameters define an expansion threshold: adaptation fails when genetic drift reduces genetic diversity below that required for adaptation to a heterogeneous environment.  #@NEW_LINE#@#  When the key parameters drop below this expansion threshold locally, a sharp range margin forms.  #@NEW_LINE#@#  When they drop below this threshold throughout the species range, adaptation collapses everywhere, resulting in either extinction or formation of a fragmented metapopulation.  #@NEW_LINE#@#  Because the effects of dispersal differ fundamentally with dimension, the second parameterthe strength of genetic driftis qualitatively different compared to a linear habitat.  #@NEW_LINE#@#  In two-dimensional habitats, genetic drift becomes effectively independent of selection.  #@NEW_LINE#@#  It decreases with neighbourhood sizethe number of individuals accessible by dispersal within one generation.  #@NEW_LINE#@#  Moreover, in contrast to earlier predictions, which neglected evolution of genetic variance and/or stochasticity in two dimensions, dispersal into small marginal populations aids adaptation.  #@NEW_LINE#@#  This is because the reduction of both genetic and demographic stochasticity has a stronger effect than the cost of dispersal through increased maladaptation.  #@NEW_LINE#@#  The expansion threshold thus provides a novel, theoretically justified, and testable prediction for formation of the range margin and collapse of the species range.  #@NEW_LINE#@#  

Author_summary  #@NEW_LINE#@#  
The flow of genetic diversity across environments has conflicting effects.  #@NEW_LINE#@#  On the beneficial side, it increases the genetic variation that is necessary for adaptation and counters the loss of genetic diversity due to genetic drift.  #@NEW_LINE#@#  However, it may also swamp adaptation to local conditions.  #@NEW_LINE#@#  This interplay is crucial for the expansion of a species range.  #@NEW_LINE#@#  In this work, I develop a theory that shows how range expansion depends on two dimensionless parameters: (i) the fitness cost of dispersala measure of environmental heterogeneityand (ii) the strength of genetic drifta measure of the reduction of genetic diversity.  #@NEW_LINE#@#  The more heterogeneous an environment, the more challenging it is to expand into, and the lower the genetic diversity, the more limited is the scope for potential adaptation.  #@NEW_LINE#@#  Together, these two parameters define an expansion threshold: adaptation fails when the number of individuals accessible by dispersal within one generation is so small that genetic drift reduces genetic diversity below that required for adaptation to a heterogeneous environment.  #@NEW_LINE#@#  This threshold provides a novel, theoretically justified, and testable prediction for the formation of a range margin and for the collapse of a species range in two-dimensional habitats.  #@NEW_LINE#@#  

Citation: Polechová J (2018) Is the sky the limit?  #@NEW_LINE#@#  On the expansion threshold of a species range.  #@NEW_LINE#@#  PLoS Biol 16(6):  #@NEW_LINE#@#  
           e2005372.  #@NEW_LINE#@#  

        https://doi.org/10.1371/journal.pbio.2005372  #@NEW_LINE#@#  
Academic Editor: Pedro Jordano, Estación Biológica de Doñana (EBD-CSIC), Spain  #@NEW_LINE#@#  
Received: January 13, 2018; Accepted: May 22, 2018; Published:  June 15, 2018  #@NEW_LINE#@#  
Copyright:  © 2018 Jitka Polechová.  #@NEW_LINE#@#  This is an open access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.  #@NEW_LINE#@#  
Data Availability: The code for the simulations, together with a working example, have been deposited as a single *.cdf file at Dryad Digital Repository, https://doi.org/10.5061/dryad.5vv37.  #@NEW_LINE#@#  This file can be viewed with CDF Player, a free application developed by Wolfram Research, and also contains all the Figures with their underlying data.  #@NEW_LINE#@#  
Funding: Austrian Science Fund (FWF) (grant number V458-B25).  #@NEW_LINE#@#  Elise Richter Programme.  #@NEW_LINE#@#  The funder had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.  #@NEW_LINE#@#  
Competing interests:  The authors have declared that no competing interests exist.  #@NEW_LINE#@#  
Introduction  #@NEW_LINE#@#  
Species borders are not just determined by the limits of their ecological niche [1, 2].  #@NEW_LINE#@#  A species edge is typically sharper than would be implied by continuous change in the species environment (reviewed in [3, Table 2]).  #@NEW_LINE#@#  Moreover, although species ranges are inherently dynamic, it is puzzling that they typically expand rather slowly [4].  #@NEW_LINE#@#  The usualbut tautologicalexplanation is that lack of genetic variation at the range margin prevents further expansion [5].  #@NEW_LINE#@#  Indeed, a species range edge is often associated with lower neutral genetic variation [3, 611], suggesting that adaptive genetic variation may be depleted as well [12].  #@NEW_LINE#@#  Yet why would selection for new variants near the edge of the range not increase adaptive genetic variance, thereby enabling it to continuously expand [5, 13]?  #@NEW_LINE#@#  Haldane [14] proposed a general explanation: even if environmental conditions vary smoothly, swamping by gene flow from central to marginal habitats will cause more severe maladaptation in marginal habitats, further reducing their population density.  #@NEW_LINE#@#  This would lead to a sharp edge to a species range, even if genetic variance at the range margin is large.  #@NEW_LINE#@#  However, the consequences of dispersal and gene flow for evolution of a species range continue to be debated [1518]: a number of studies suggest that intermediate dispersal may be optimal [1923].  #@NEW_LINE#@#  Gene flow across heterogeneous environments can be beneficial because the increase of genetic variance allows the population to adapt in response to selection [13].  #@NEW_LINE#@#  Current theory identifies that local population dynamics, dispersal, and evolution of niche-limiting traits (including their variance) and both genetic and demographic stochasticity are all important for species range dynamics [13, 1921, 2428].  #@NEW_LINE#@#  Yet these core aspects have not been incorporated into a single study that would provide testable predictions for range limits in two-dimensional habitats.  #@NEW_LINE#@#  
As Haldane [14] previously pointed out, it is important to consider population and evolutionary dynamics across a species range jointly, as their effects interact.  #@NEW_LINE#@#  Due to maladaptation, both the carrying capacity of the habitat and the population growth rate are likely to decreasesuch selection is called hard [29].  #@NEW_LINE#@#  Classic deterministic theory [24] shows that when genetic variance is fixed, there are two stable regimes of adaptation to a spatially varying optimum (see Fig 1): (i) a limited adaptation, in which a population is only adapted to a single optimum or becomes a patchy conglomerate of discrete phenotypes, or (ii) continuous or uniform adaptation, which is stable when the genetic variance, measured in terms of its cost in fitness (standing genetic load), is large relative to the maladaptation incurred by dispersal between environments (dispersal load).  #@NEW_LINE#@#  Under uniform adaptation, a species range gradually expandsa stable boundary only forms when the genetic variance is too small to allow continuous adaptation to the spatially variable environment, and hence, limited adaptation is stable.  #@NEW_LINE#@#  
Assuming that genetic variance is fixed, deterministic theory [24] predicts that there are two modes of adaptation to an environmental gradient.  #@NEW_LINE#@#  When the effective environmental gradient B is steep relative to the genetic potential for adaptation A, clinal adaptation fails, and the population only matches the optimum at the very centre of its range (limited adaptation).  #@NEW_LINE#@#  These parameters can be understood as fitness loads scaled relative to the strength of density dependence r* (see [24, 30] and [31, Appendix D]).  #@NEW_LINE#@#  A is a measure of standing load due to genetic variance Ar*, and B is a measure of dispersal load B2r*2the maladaptation incurred by dispersal across heterogeneous environment.  #@NEW_LINE#@#  Thus, conversely, when the standing load is large relative to the dispersal load AB2/2, a population adapts continuously, gradually expanding its range (uniform adaptation).  #@NEW_LINE#@#  Black dashed lines depict the trait optimum; blue lines depict the trait mean.  #@NEW_LINE#@#  Population density is shown in grey: it has a sharp and stable margin for limited adaptation, but it is steadily expanding under uniform adaptation.  #@NEW_LINE#@#  Two subpopulations (or perhaps species) are given for illustration of limited adaptationdepending on further parameters and initial conditions (discussed in this study), a wide species range with uniform adaptation can collapse to a single population or fragment to multiple subpopulations.  #@NEW_LINE#@#  


              https://doi.org/10.1371/journal.pbio.2005372.g001  #@NEW_LINE#@#  
When genetic variance can evolve, such a limit no longer exists in infinitely large populations: the population maintains continuous adaptation as the environmental gradient steepens [13].  #@NEW_LINE#@#  Deterministic theory thus predicts that a sharp and stable boundary to a species range does not form when the environment changes smoothly.  #@NEW_LINE#@#  Uniform adaptation is the only stable regime when genetic variance can freely evolve in the absence of genetic drift [13], yet there is a limit to the steepness of the gradient.  #@NEW_LINE#@#  This limit arises because both the standing genetic load and the dispersal load increase as the gradient steepens, reducing the mean fitness (growth rate) of the population: when the mean fitness approaches zero, the population becomes extinct.  #@NEW_LINE#@#  Obviously, ignoring genetic drift is then unrealistic.  #@NEW_LINE#@#  In finite populations, genetic drift reduces local genetic variance [32], potentially qualitatively changing the dynamics.  #@NEW_LINE#@#  Indeed, it has been shown that for one-dimensional habitats (such as rivers), a sharp range margin arises when the fitness cost of dispersal across environments becomes too large relative to the efficacy of selection versus genetic drift [26].  #@NEW_LINE#@#  However, most species live in two-dimensional habitats.  #@NEW_LINE#@#  There, allele frequencies can fluctuate over a local scale, as the correlations between them decline much faster across space than they do in linear habitats [33], and the effect of genetic drift changes qualitatively, becoming only weakly dependent on selection [34].  #@NEW_LINE#@#  Is there still an intrinsic threshold to range expansion in finite populations when dispersal and gene flow occur over two-dimensional space rather than along a line?  #@NEW_LINE#@#  If so, what is its biological interpretation?  #@NEW_LINE#@#  

Results  #@NEW_LINE#@#  
I study the problem of intrinsic limits to adaptation in a two-dimensional habitat.  #@NEW_LINE#@#  Throughout, I assume that the species niche is limited by stabilising selection on a composite phenotypic trait.  #@NEW_LINE#@#  This optimum varies across one dimension of the two-dimensional habitatsuch as temperature and humidity with altitude.  #@NEW_LINE#@#  Demography and evolution are considered together.  #@NEW_LINE#@#  Selection is hard: both the rate of density-dependent population growth and the attainable equilibrium density decrease with increasing maladaptation.  #@NEW_LINE#@#  Both trait mean and genetic variance can freely evolve via change in allele frequencies and the associations among them (linkage disequilibria).  #@NEW_LINE#@#  The populations are finite, and both genetic and demographic stochasticity are included.  #@NEW_LINE#@#  The model is first outlined at a population level in terms of coupled stochastic differential equations.  #@NEW_LINE#@#  While it is not possible to obtain analytical solutions to this model, this formalisation allows us to identify the effective dimensionless parameters that describe the dynamics.  #@NEW_LINE#@#  Next, individual-based simulations are used to determine the driving relationship between the key parameters and test its robustness.  #@NEW_LINE#@#  The details are described in the Model section of the Methods.  #@NEW_LINE#@#  
The dynamics of the evolution of a species range, as formalised by this model, are well described by three dimensionless parameters, which give a full description of the system.  #@NEW_LINE#@#  The first dimensionless parameter carries over from the phenotypic model [24]: the effective environmental gradient B measures the steepness of the environmental gradient in terms of maladaptation incurred by dispersal across a heterogeneous environment.  #@NEW_LINE#@#  The second parameter is the neighbourhood size of the population, , which can be understood as the number of diploid individuals within one generations dispersal range.  #@NEW_LINE#@#  Originally, neighbourhood size was defined by Wright [35] as the size of the single panmictic diploid population that would give the same probability of identity by descent in the previous generation.  #@NEW_LINE#@#  The inverse of neighbourhood size 1/  hence describes the local increase of homozygosity due to genetic drift.  #@NEW_LINE#@#  The third dimensionless parameter is the ratio s/r* of the strength of selection s per locus relative to the strength of density dependence, r*.  #@NEW_LINE#@#  Detailed description of the parameters and their rescaling can be found in the Methods sections Parameters and Continuous model: Rescaling.  #@NEW_LINE#@#  
In order to see how the rescaled parameters capture the evolution of a species range, I simulated 780 evolving populations, each based on different parameterisations, adapting to a linear gradient in the optimum.  #@NEW_LINE#@#  Depending on the parameters, the population either expands, gradually extending its phenotypic range by consecutive sweeps of loci advantageous at the edges, or the species range contracts or disintegrates as adaptation fails.  #@NEW_LINE#@#  Fig 2 shows the results of the projection from a 10-dimensional parameter space of the individual-based model (see Methods sections Individual-based simulations and Parameters) into a two-dimensional space.  #@NEW_LINE#@#  The axes of Fig 2 represent the first two compound dimensionless parameters: (i) the effective environmental gradient B and (ii) the inverse of neighbourhood size 1/ , which describes the effect of genetic drift on the allele frequencies.  #@NEW_LINE#@#  
The red line shows the fitted boundary between expanding populations (in blue) and collapsing ranges (red hues): populations expand above the expansion threshold when   6.3B + 0.56.  #@NEW_LINE#@#  The grey region gives 95% bootstrap confidence intervals, whilst the dashed lines depict the predicted expansion threshold for weak selection, s/r*less_than0.005 ( ), and for strong selection, s/r*0.005 ( ).  #@NEW_LINE#@#  Stagnant populations, changing by less than 5 demes per 1,000 generations, are shown in grey.  #@NEW_LINE#@#  Solid (blue, grey) dots depict populations with uniform adaptation (illustrated by Fig 3).  #@NEW_LINE#@#  Open circles denote populations in which continuous adaptation has collapsed and the population consists of many discrete phenotypes adapted to a single optimum each (limited adaptation, Fig 4), whilst local genetic variance is very small.  #@NEW_LINE#@#  (Specifically, these are defined by mean heterozygosity smaller than 10% of the predicted value in the absence of genetic drift.)  #@NEW_LINE#@#  Simulations were run for 5,000 generations, starting from a population adapted to a linearly changing optimum in the central part of the available habitat.  #@NEW_LINE#@#  Populations that went extinct are marked with a black dot.  #@NEW_LINE#@#  Note that both axes are on a log scale.  #@NEW_LINE#@#  The top corner legend gives the colour-coding for the rate of range collapse and expansion in units of demes per generation; rates of collapse are capped at 1.  #@NEW_LINE#@#  The expansion threshold is fitted as a step function changing linearly along B: all blue dots are assigned a value of 1; all red dots and open circles are assigned a value of 0.  #@NEW_LINE#@#  The expansion threshold has a coefficient of determination R2 = 0.94, calculated from 589 simulations (all but well-adapted stagnant populations).  #@NEW_LINE#@#  Data for this figureand all subsequent onesare deposited at Dryad Digital Repository, https://doi.org/10.5061/dryad.5vv37 [36].  #@NEW_LINE#@#  


              https://doi.org/10.1371/journal.pbio.2005372.g002  #@NEW_LINE#@#  
These two dimensionless parameters B and  give a clear separation between expanding populations, in which the neighbourhood size  is large relative to the effective environmental gradient B (shown in blue, Fig 2), and the rest, in which adaptation is failing.  #@NEW_LINE#@#  The separation gives an expansion threshold, estimated at   6.3B + 0.56 (red line).  #@NEW_LINE#@#  Above the expansion threshold, populations are predicted to expand (see Fig 3); below it, adaptation fails abruptly.  #@NEW_LINE#@#  If conditions change uniformly across space (as in these simulation runs, with constant gradient and carrying capacity), this means that adaptation fails everywherea species range then either collapses from the margins (Fig 2, red hues) and/or disintegrates (Fig 2, open circles), forming a fragmented metapopulation (i.e., a spatially structured population consisting of discrete locally adapted subpopulations with limited dispersal among them).  #@NEW_LINE#@#  
(a) Trait (in blue) closely matches the environmental gradient (grey) along the x-axis.  #@NEW_LINE#@#  (b) Population steadily expands, whilst population density stays continuous across space, with  (mean ± standard deviation).  #@NEW_LINE#@#  The prediction at  is shown by the blue contours; darker shading represents higher density.  #@NEW_LINE#@#  (c) Adaptation to the environmental gradient is maintained by a series of staggered clines: as each allele frequency changes from 0 to 1, the trait value increases by .  #@NEW_LINE#@#  Population starts from the centre (blue hues reflect initial cline position relative to the centre of the range), and as it expands, new clines arising from loci previously fixed to 0 or 1 contribute to the adaptation (in red hues).  #@NEW_LINE#@#  At each location, multiple clines contribute to the trait (and variance); clines are shown at Y = 25.  #@NEW_LINE#@#  (d) Genetic variance changes continuously across space with mean  and stays slightly lower than is the deterministic prediction (green contours, VG = 0.045; higher variance is illustrated by darker shading).  #@NEW_LINE#@#  Deterministic predictions are based on [13] and are explained in the Methods section, along with the specification of the unscaled parameters.  #@NEW_LINE#@#  The population evolves for 2,000 generations, starting from a population adapted to the central habitat.  #@NEW_LINE#@#  The predicted neighbourhood size is ; effective environmental gradient is B = 0.48.  #@NEW_LINE#@#  


              https://doi.org/10.1371/journal.pbio.2005372.g003  #@NEW_LINE#@#  
When a metapopulation forms, it exhibits an extinction and colonisation dynamics.  #@NEW_LINE#@#  The subpopulations drift freely along the neutral spatial axis.  #@NEW_LINE#@#  Because the trait distributions of the subpopulations are unstable, the subpopulations also drift slowly along the environmental gradient.  #@NEW_LINE#@#  Over time, the metapopulation very slowly collapses to a virtually single trait value, with many subpopulaitons along the neutral axis.  #@NEW_LINE#@#  The subpopulations forming this metapopulation have only a very narrow phenotypic range and maintain locally only minimal adaptive variance.  #@NEW_LINE#@#  They correspond to the limited adaptation regime identified for a phenotypic model with genetic variance as a parameter [24].  #@NEW_LINE#@#  In contrast to one-dimensional habitats [26], these patchy metapopulations are stabilised by dispersal from surrounding subpopulations in the two-dimensional habitat and can thus persist for a long time.  #@NEW_LINE#@#  An example of such a metapopulation is given in Fig 4.  #@NEW_LINE#@#  
The population fragments rapidly (within tens of generations) to small patches of tens to a few hundred individuals whilst losing local adaptive variation.  #@NEW_LINE#@#  In two-dimensional habitats, such a metapopulation with limited adaptation can persist for a long time.  #@NEW_LINE#@#  Nevertheless, the population very slowly contracts, eventually forming a narrow band adapted to a single optimum.  #@NEW_LINE#@#  (a) The distribution of phenotypes across space is fragmented.  #@NEW_LINE#@#  (b) The subpopulations are transient, although they are stabilised by dispersal across space, especially along the neutral direction with no change in the optimum (Y).  #@NEW_LINE#@#  Locally, the population density may be higher than under uniform adaptation; blue contours depict the deterministic prediction for population density under uniform adaptation, N = 3.  #@NEW_LINE#@#  The realised density is about  (standard deviation); darker shading represents higher density.  #@NEW_LINE#@#  (c) The adaptive genetic variance is low on average ()about an order of magnitude lower than would be maintained by gene flow under uniform adaptation (shown in green contours, VG = 0.23).  #@NEW_LINE#@#  Typically, only a few clines in allele frequencies contribute to the genetic variance within a subpopulation.  #@NEW_LINE#@#  The parameterisation and predictions are detailed in the Individual-based simulations section of the Methods; predicted neighbourhood size is , effective environmental gradient is B = 0.48.  #@NEW_LINE#@#  Shown here after 5000 generationsthe population collapses to a narrow band (at X = 45) after a further 20,000 generations and then appears persistent.  #@NEW_LINE#@#  


              https://doi.org/10.1371/journal.pbio.2005372.g004  #@NEW_LINE#@#  
Interestingly, the third dimensionless parameter s/r* has no detectable effect on the form of the expansion threshold.  #@NEW_LINE#@#  In other words, whilst the expansion threshold reflects the total fitness cost of dispersal in a heterogeneous environment, it appears independent of the strength of selection per locus s: the dashed lines in Fig 2 compare the estimated expansion threshold for small and large s/r*.  #@NEW_LINE#@#  Increasing the strength of selection is inefficient in aiding drift-limited adaptation, in line with the expectation that the effect of genetic drift is only very weakly dependent on selection in two-dimensional habitats [27](see also S1 Fig).  #@NEW_LINE#@#  This suggests that genetic basis of adaptation is not important for a drift-induced limit to a species range.  #@NEW_LINE#@#  Yet it is plausible that there is another limit, in which selection per locus becomes important [27], that arises when the optimum changes abruptly and even when the population (neighbourhood) size is large (i.e., in an entirely different regime).  #@NEW_LINE#@#  A dedicated synthesis connecting the step-limited and drift-limited regimes would be of a clear interest.  #@NEW_LINE#@#  Importantly, once genetic drift starts to have an effect, the habitat needs to be fairly broad to be two-dimensional [37].  #@NEW_LINE#@#  In narrow habitats (such as in [27]), some dependency of drift-induced expansion threshold on selection per loci would be expected [26].  #@NEW_LINE#@#  Note that the apparent independence of the expansion threshold on s/r* does not imply that rate of range expansion should also be independent of the strength of selection.  #@NEW_LINE#@#  
In nature, conditions are unlikely to change uniformly.  #@NEW_LINE#@#  Abiotic environment (such as temperature, precipitation, solar radiation) does not, in general, change in a linear and concordant manner [38], and neither does the biotic environment, such as the pressure from competitors and predators, which affects the attainable population density and can increase the asymmetry in gene flow [39, 40].  #@NEW_LINE#@#  I now investigate whether adaptation fails near the expansion threshold as conditions change across space.  #@NEW_LINE#@#  For example, we can imagine that the population starts well adapted in the central part of the available habitat, and as it expands, conditions become progressively more challenging (see S2A Fig); i.e., the effective environmental gradient B gets steeper.  #@NEW_LINE#@#  As the expanding population approaches the expansion threshold, adaptive genetic variance progressively decreases below the predicted value [13], which would be maintained by gene flow in the absence of genetic drift (Fig 5A, grey dashed line).  #@NEW_LINE#@#  This is a result of an increased frequency of demes with limited adaptation, leading to higher rates of extinctions and recolonisations, which reduce both adaptive and neutral diversity (see Fig 5B).  #@NEW_LINE#@#  Range expansion then ceases at the expansion threshold as the genetic variance drops to the critical value at which only limited adaptation is stable [24], assuming genetic variance is fixed (Fig 5A, dotted line).  #@NEW_LINE#@#  This is because although populations can persist with limited adaptation (Fig 4), the transient amount of genetic variance maintained under limited adaptation is almost never consistent with range expansion (see Fig 2, open circles).  #@NEW_LINE#@#  On a steepening gradient, a sharp and stable range margin forms.  #@NEW_LINE#@#  This contrasts to uniformly changing conditions (linear gradient, constant carrying capacity) in which populations steadily expand or contract.  #@NEW_LINE#@#  
This illustrative run shows that as the effective environmental gradient steepens away from the central location, adaptive genetic variance must increase correspondingly in order to maintain uniform adaptation.  #@NEW_LINE#@#  (a) Median population density stays fairly constant across the range (blue dots), following the deterministic prediction (, blue dashed line).  #@NEW_LINE#@#  Genetic variance (black dots) increases due to gene flow across the phenotypic gradientthe deterministic expectation is given by the grey dashed line (see Model section of Methods for details).  #@NEW_LINE#@#  Yet, as the environmental gradient steepens, genetic variance fails to increase fast enough, and near the expansion threshold, adaptation fails.  #@NEW_LINE#@#  The dotted line gives the corresponding critical genetic variance, below which only limited adaptation is expected in a phenotypic model with a fixed genetic variance (, in which  is the standing genetic load; [24]).  #@NEW_LINE#@#  (b) As the environmental gradient steepens, the frequency of limited adaptation within the metapopulation increases (black and grey), and hence neutral variation decreases (blue).  #@NEW_LINE#@#  The black line gives the proportion of demes with limited adaptation after 50,000 generations, when the range margin appears stable; grey gives the proportion after 40,000 generations (depicted is an average over a sliding window of 15 demes).  #@NEW_LINE#@#  The median is given over the neutral spatial axis Y (with constant optimum); the trait mean, the population trait mean, variance, and population density in two-dimensional space is shown in S3 Fig, which also lists all the parameters.  #@NEW_LINE#@#  


              https://doi.org/10.1371/journal.pbio.2005372.g005  #@NEW_LINE#@#  
In a large population, the ability to adapt to heterogeneous environments is independent of dispersal: this is because both the local genetic variance (measured by standing genetic load), which enables adaptation to spatially variable environments, and the perceived steepness of the environmental gradient (measured by dispersal load) increase at the same rate with gene flow [13].  #@NEW_LINE#@#  Yet, in small populations, dispersal is beneficial because the drift-reducing effect of dispersal overpowers its maladaptive effect.  #@NEW_LINE#@#  This is demonstrated in Fig 6the neighbourhood size  increases faster with dispersal than the effect of swamping by gene flow (B) does; hence, as dispersal increases, the population gets above the expansion threshold at which uniform adaptation can be sustained.  #@NEW_LINE#@#  Around the expansion threshold, a small change in dispersal (connectivity) can have an abrupt effect on adaptation across a species range and the species persistence.  #@NEW_LINE#@#  A small increase in dispersal can lead to recovery of uniform adaptation with an arbitrarily wide continuous range.  #@NEW_LINE#@#  Further increase of dispersal is merely enhancing the rate of range expansion at the expense of a slight cost to the mean fitness due to rising dispersal load and standing load and can be associated with further costs, such as Allee effect (see, e.g., [17]).  #@NEW_LINE#@#  Therefore, the expansion threshold provides an interpretation for optimality of an intermediate dispersal, benefiting the species persistence.  #@NEW_LINE#@#  
This chart shows a set of simulated populations, with dispersal increasing from left to right and bottom to top.  #@NEW_LINE#@#  The hue of the dots indicates the rate of expansion (light to dark blue and purple) or collapse (orange to red).  #@NEW_LINE#@#  The rates of expansion and collapse are shown in dependency on B and .  #@NEW_LINE#@#  Open circles indicate limited adaptation, in which a species range is fragmented and each subpopulation is only matching a single optimum, whilst its genetic variance is very small.  #@NEW_LINE#@#  As dispersal increases, population characteristics get above the expansion threshold (dashed line), and hence, uniform adaptation becomes stable throughout the species range.  #@NEW_LINE#@#  Local population density stays fairly constant, around N = 3.5, whilst total population size increases abruptly above the expansion threshold as the population maintains a wide range (not shown).  #@NEW_LINE#@#  Parameters for these simulations are given in the Individual-based simulations section of the Methods; the scaling of  and B with dispersal  is clear from the Methods, section Parameters.  #@NEW_LINE#@#  The rate of range change is not significantly different from zero for the first three simulations above the expansion threshold; black centre (bottom left) indicates extinction.  #@NEW_LINE#@#  


              https://doi.org/10.1371/journal.pbio.2005372.g006  #@NEW_LINE#@#  

Discussion  #@NEW_LINE#@#  
Here, I have shown that adaptation fails when positive feedback between genetic drift, maladaptation, and population size reduces adaptive genetic variance to levels that are incompatible with continuous adaptation.  #@NEW_LINE#@#  The revealed expansion threshold differs qualitatively from the limit to adaptation identified previously [26] for a population living along a one-dimensional habitat.  #@NEW_LINE#@#  This is because in two dimensions, dispersal mitigates the loss of diversity due to genetic drift more effectively, such that it becomes (almost) independent of selection [34].  #@NEW_LINE#@#  The expansion threshold implies that populations with very small neighbourhood sizes (  1/2), which suffer a severe reduction in neutral heterozygosity, will be prone to collapse based on demographic stochasticity alone.  #@NEW_LINE#@#  However, even in the absence of demographic stochasticity, genetic drift reduces the adaptive genetic variance required to sustain adaptation to a heterogeneous environment.  #@NEW_LINE#@#  The expansion threshold describes when this reduction due to genetic drift is incompatible with continuous adaptation, predicting a collapse of a species range.  #@NEW_LINE#@#  If the expansion threshold is reached as the species expands through its habitat, a sharp and stable range margin forms.  #@NEW_LINE#@#  If there is a drop below the expansion threshold throughout the species range, as after a sudden drop in carrying capacity, adaptation abruptly collapses throughout a species range.  #@NEW_LINE#@#  The result is either extinction or a fragmented metapopulation consisting of a conglomerate of subpopulations, each adapted to a single phenotypic optimum.  #@NEW_LINE#@#  It follows that near a range margin, we expect increased range fragmentation and a decrease in adaptive genetic variance.  #@NEW_LINE#@#  The threshold gives a theoretical base to the controversial issue of the importance of evolution (genetics) and ecology (demography) for assessing vulnerability of a species [41, 42].  #@NEW_LINE#@#  The predicted sharp species range edge is in agreement with the reported lack of evidence for abundant centre of a species range, which, although commonly assumed in macroecological theory, has little support in data [3, 11, 43, 44].  #@NEW_LINE#@#  Lack of abundant centre is consistent both with uniform adaptation and with limited adaptation in a metapopulation.  #@NEW_LINE#@#  
The expansion threshold provides a general foundation to species-specific eco-evolutionary models of range dynamics [45].  #@NEW_LINE#@#  Its components can be measured in wild populations, allowing us to test the robustness of the theory.  #@NEW_LINE#@#  First, the effective environmental gradient B can be measured as fitness loss associated with transplant experiments on a local scale, relative to a distance of generational dispersal along an environmental gradient.  #@NEW_LINE#@#  The environmental gradient can include both biotic and abiotic effects and their interactions [46]notably, the effective environmental gradient B steepens due to increased asymmetry in gene flow when carrying capacity varies across space, e.g., because of partial overlap with competitors [40].  #@NEW_LINE#@#  Second, the neighbourhood size  can be estimated from neutral allele frequencies [47, 48].  #@NEW_LINE#@#  Estimates of neighbourhood size are fairly robust to the distribution of dispersal distances [49].  #@NEW_LINE#@#  Though near the expansion threshold, both the noisiness of the statistics and the homozygosity will increase due to local extinctions and recolonisations [50].  #@NEW_LINE#@#  An alternative estimate of neighbourhood size can be also obtained from mark-recapture studies by measuring population density and dispersal (as an approximation for gene flow) independently [47].  #@NEW_LINE#@#  
Because the expansion threshold is free of any locus- or trait- specific measure, the result appears independent of genetic architecture, readily extending to multiple traits regardless of their correlations (compare to [5155])yet the mean fitness will decline because of drift load as the number of traits independently optimised by selection increases [56, 57].  #@NEW_LINE#@#  Hence, if the fitness landscape is highly complex, the expansion threshold constitutes a lower limit.  #@NEW_LINE#@#  Naturally, there can be further costs arising in a natural population that I have neglected here, such as the Allee effect [17].  #@NEW_LINE#@#  In general, while the numerical constants may change when natural populations deviate in their biology from our model assumptions, the scale-free parameters identified in this study remain core drivers of the intrinsic dynamics within a species range.  #@NEW_LINE#@#  Notably, the early classic studies assuming fixed genetic variance [24] predicted that dispersal into peripheral populations is detrimental because it only inflates the effective environmental gradient B.  #@NEW_LINE#@#  Yet, when genetic variance can evolve, dispersal into small marginal populations also aids adaptation by increasing local genetic variance and by countering genetic drift.  #@NEW_LINE#@#  The net effect of dispersal into small marginal populations (below the expansion threshold) is then beneficial because their neighbourhood size increases faster with dispersal than the effective environmental gradient B steepens.  #@NEW_LINE#@#  

Methods  #@NEW_LINE#@#  
Model  #@NEW_LINE#@#  
I model evolution of a species range in a two-dimensional habitat, in which both population dynamics and evolution (in many additive loci) are considered jointly.  #@NEW_LINE#@#  The coupling is via the mean fitness , which gives the growth rate of the population, and decreases with increasing maladaptation: .  #@NEW_LINE#@#  The ecological component of growth rate, , can take various forms: here, the regulation is logistic so that fitness declines linearly with density N: re = rm(1N/K), in which rm is the maximum per capita growth rate in the limit of the local population density N. The carrying capacity K (for a perfectly adapted phenotype) is assumed uniform across space.  #@NEW_LINE#@#  The second term, , is the reduction in growth rate due to deviation from the optimum.  #@NEW_LINE#@#  Selection is stabilising: the optimum  changes smoothly with one spatial dimension (x): for any individual, the drop in fitness due to maladaptation is rg(z) = (z)2/(2Vs).  #@NEW_LINE#@#  Here, Vs gives the width of stabilising selection; strength of stabilising selection is  = VP/(2Vs), in which VP = VG+VE is the phenotypic variance.  #@NEW_LINE#@#  A population with mean phenotype  has its fitness reduced by .  #@NEW_LINE#@#  The phenotype  is determined by many di-allelic loci with allelic effects ; the model is haploid, hence , in which pi is the allele frequency at locus i. Phenotypic variance is VP = VG+VE.  #@NEW_LINE#@#  The loss of fitness due to environmental variance VE can be included in ; VE is a redundant parameter.  #@NEW_LINE#@#  Selection is hard: both the mean fitness (growth rate) and the attainable equilibrium density  decrease with maladaptation.  #@NEW_LINE#@#  Expected genetic variance maintained by gene flow in the absence of genetic drift is  [13]; the contribution due to mutation is small, at mutation-section balance , in which  gives the mutation rate per locus and nl the number of loci.  #@NEW_LINE#@#  

Individual-based_simulations  #@NEW_LINE#@#  
Discrete-time individual-based simulations are set to correspond to the model with continuous time and space.  #@NEW_LINE#@#  The space is a two-dimensional lattice with spacing between demes of x = 1.  #@NEW_LINE#@#  Every generation, each individual mates with a partner drawn from the same deme, with probability proportional to its fitness, to produce a number of offspring drawn from a Poisson distribution with mean of Exp[r(z, N)] (this includes zero).  #@NEW_LINE#@#  The effective diploid population density Ne hence equals half of the haploid population density N, and  = 4Ne 2 = 2N2.  #@NEW_LINE#@#  The life cycle is selection  mutation  recombination  birth  migration.  #@NEW_LINE#@#  Generations are nonoverlapping, and selfing is allowed at no cost.  #@NEW_LINE#@#  The genome is haploid with unlinked loci (the probability of recombination between any two loci is 1/2).  #@NEW_LINE#@#  The allelic effects i of the loci combine in an additive fashion; the allelic effects are uniform throughout this study, i  .  #@NEW_LINE#@#  Mutation is set to  = 106, independently of the number of loci.  #@NEW_LINE#@#  Migration is diffusive with a Gaussian dispersal kernel.  #@NEW_LINE#@#  The tails of the dispersal kernel need to be truncated: truncation is set to two standard deviations of the dispersal kernel throughout, and dispersal probabilities and variance are adjusted so that the discretised dispersal kernel sums to 1 [58].  #@NEW_LINE#@#  Simulations were run at the computer cluster of IST Austria using Mathematica 9 (Wolfram).  #@NEW_LINE#@#  The code for the simulations, together with a working example, have been deposited as a single *.cdf file at Dryad Digital Repository, https://doi.org/10.5061/dryad.5vv37 [36].  #@NEW_LINE#@#  This file can be viewed with CDF Player, a free application developed by Wolfram Research, and also contains all the figures with their underlying data.  #@NEW_LINE#@#  

Continuous_model  #@NEW_LINE#@#  
For any given additive genetic variance VG (assuming a Gaussian distribution of breeding values), the change in the trait mean  over time satisfies:  #@NEW_LINE#@#  
(1)  #@NEW_LINE#@#  
The first term gives the change in the trait mean due to migration with mean displacement of ; the second term describes the effect of the asymmetric flow from areas of higher density.  #@NEW_LINE#@#  The third term gives the change due to selection, given by the product of genetic variance and gradient in mean fitness [59, Eq 2].  #@NEW_LINE#@#  The last term  gives the fluctuations in the trait variance due to genetic drift: , in which dW* represents white noise in space and time [34, 60].  #@NEW_LINE#@#  denotes genetic variance assuming linkage equilibrium.  #@NEW_LINE#@#  
The trait mean is  for a haploid model, in which pi is the i-th allele frequency, qi = 1pi and i is the effect of the allele on the traitthe change of the trait mean  as frequency of locus i changes from 0 to 1.  #@NEW_LINE#@#  For both haploid and diploid models, the allele frequencies pi change as:  #@NEW_LINE#@#  
(2)  #@NEW_LINE#@#  
The expected change of allele frequency due to a gradient in fitness and local heterozygosity is , in which selection at locus i is  and  [13, Appendix 3].  #@NEW_LINE#@#  Here, the fourth term describes the change due to (symmetric) mutation at rate .  #@NEW_LINE#@#  The last term  describes genetic drift [34, Eq 7]: , in which N is the haploid population density.  #@NEW_LINE#@#  
Population dynamics reflect diffusive migration in a two-dimensional habitat, growth due to the mean Malthusian fitness , and stochastic fluctuations.  #@NEW_LINE#@#  The number of offspring follows a Poisson distribution with mean and variance of N; fluctuations in population numbers are given by [61]: :  #@NEW_LINE#@#  
(3)  #@NEW_LINE#@#  

Continuous_model__Rescaling  #@NEW_LINE#@#  
The model can be simplified by rescaling [13, 59] time t relative to the strength of density dependence r*, distance x relative to dispersal , trait z relative to strength of stabilising selection  and local population size N relative to equilibrium population size with perfect adaptation: , T = r*.  #@NEW_LINE#@#  Note that near the equilibrium of a well-adapted population, .  #@NEW_LINE#@#  
The rescaled equations for evolution of allele frequencies and for demographic dynamics are  #@NEW_LINE#@#  
(4)  #@NEW_LINE#@#  
in which .  #@NEW_LINE#@#  
The rescaled Eqs 4 show that four parameters fully describe the system.  #@NEW_LINE#@#  First, the effective environmental gradient, .  #@NEW_LINE#@#  Second, the strength of genetic drift .  #@NEW_LINE#@#  The parameter  gives the neighbourhood size at an equilibrium with uniform adaptation.  #@NEW_LINE#@#  The third parameter is the strength of selection relative to the strength density dependence, s/r*; the scaled effect of a single substitution * also scales with s/r*: .  #@NEW_LINE#@#  The effect of this third parameter s/r* is expected to be small, because typically .  #@NEW_LINE#@#  Therefore, assuming throughout that s is uniform across loci is a reasonably justified simplification.  #@NEW_LINE#@#  The fourth parameter, /r*, will typically be very small and will be neglected throughout.  #@NEW_LINE#@#  Table 1 (top) summarises the full set that describes the system.  #@NEW_LINE#@#  


Supporting_information  #@NEW_LINE#@#  
S1_Fig_Effect_on_genetic_drift_on_a_cline_width_in_two-dimensional_habitats  #@NEW_LINE#@#  
The figure shows how the cline widthand hence the local genetic variancedecrease with genetic drift in two-dimensional habitats.  #@NEW_LINE#@#  In contrast to linear habitats [62], the effect of drift is nearly independent of selection.  #@NEW_LINE#@#  Genetic variance  decreases as the clines steepen due to genetic drift.  #@NEW_LINE#@#  Fewer clines then contribute to genetic variance because the spacing between clines stays at  in order for the trait mean to match the optimum.  #@NEW_LINE#@#  The numerical approximation for the cline width under selection and genetic drift w = wdet (110/)works well for weak genetic drift but breaks down for very small neighbourhood sizes (strong genetic drift, right).  #@NEW_LINE#@#  The deterministic cline width is given by .  #@NEW_LINE#@#  Cline width for each locus is estimated from a central transect using the total heterozygosity across the whole habitat [62]: , in which (x)  1 gives the spacing of the spatial lattice and the lattice is nd demes wide.  #@NEW_LINE#@#  In principle, (x) can vary across space, as long as the sampling is dense enough around the cline centre.  #@NEW_LINE#@#  The position of the clines in a two-dimensional habitat is stabilised because the clines contribute to adaptation to a spatially variable trait under stabilising selectionthe gradient in trait gives the direction for the transect.  #@NEW_LINE#@#  This figure represents a preliminary look at a complex problem that is a planned subject of a dedicated paper.  #@NEW_LINE#@#  
https://doi.org/10.1371/journal.pbio.2005372.s001  #@NEW_LINE#@#  
(EPS)  #@NEW_LINE#@#  

S2_Fig_With_a_steepening_environmental_gradient__a_sharp_range_margin_forms_due_to_genetic_drift  #@NEW_LINE#@#  
The figure shows the population trait mean, variance, and population density in two-dimensional space.  #@NEW_LINE#@#  (a) The gradient in trait mean follows the steepening environmental gradient, changing across one of the spatial axes, X (grey mesh).  #@NEW_LINE#@#  The red lines show the expansion threshold .  #@NEW_LINE#@#  (b) As the environmental gradient steepens, local population density gradually declines (the grey mesh gives the predicted density).  #@NEW_LINE#@#  (c) As the environmental gradient steepens, so does the predicted genetic variance maintained by gene flow in the absence of genetic drift (grey mesh; , [13]).  #@NEW_LINE#@#  Past the threshold, genetic variance starts to abruptly fall off the prediction, and adaptation begins to fail.  #@NEW_LINE#@#  The median values (across the neutral Y-space) are shown in Fig 5.  #@NEW_LINE#@#  Parameters:  = 0.2, Vs = 0.5, K0 = 10,  and  = 0.1, s = 0.01,  = 106, 2,000 genes.  #@NEW_LINE#@#  The environmental gradient steepens away from the centre with b0 = 0.05 according to b(x) = 1/40 Exp(1/40(x200))+1/40 Exp(1/40(x200)).  #@NEW_LINE#@#  The population was evolving for 50,000 generations, starting from a population adapted to the central part of the available habitat, about 100 demes wide.  #@NEW_LINE#@#  
https://doi.org/10.1371/journal.pbio.2005372.s002  #@NEW_LINE#@#  
(EPS)  #@NEW_LINE#@#  

S3_Fig_Distribution_of_the_parameters_used_in_the_780_randomised_simulation_runs_from_Fig_2  #@NEW_LINE#@#  
Grey: all unscaled parameters used in the continuous time and space model.  #@NEW_LINE#@#  The unscaled parameters and their [min, max] ranges are environmental gradient b = [0.012, 2], dispersal distance , carrying capacity for a well-adapted phenotype K = [3, 31], width of stabilising selection Vs = [0.005, 6], the maximum intrinsic rate of increase rm = [0.2, 2].  #@NEW_LINE#@#  White: the number of genes (an extra parameter in the individual-based model).  #@NEW_LINE#@#  The number of genes contributing to the adaptation across the species' range is nl = [5, 2, 996], with the number of locally polymorphic genes between 1 and 299.  #@NEW_LINE#@#  Light blue: composite parameters: the strength of selection, s = 2 /(2Vs) = [0.0002, 0.5], with median of s = 0.006.  #@NEW_LINE#@#  The effect size  = [0.01, 0.43].  #@NEW_LINE#@#  Dark green: scale-free parameters: the effective environmental gradient B = [0.01, 1], with median B = 0.14 the neighbourhood size  = [0.2, 60], with median 2.8; strength of selection relative to the strength of density dependence, s/r* = [0.00015, 1.34], with median s/r* = 0.006.  #@NEW_LINE#@#  Not pictured is the uniform mutation rate per locus ( = 106), the number of demes along the two spatial directions, which was set to be at least 10 deterministic cline widths wide along the spatial axis with environmental gradient (X), whereas along the neutral spatial axis (Y), the habitat width was 100.  #@NEW_LINE#@#  
https://doi.org/10.1371/journal.pbio.2005372.s003  #@NEW_LINE#@#  
(EPS)  #@NEW_LINE#@#  


Acknowledgments  #@NEW_LINE#@#  
I am especially grateful to Nick Barton for his lasting knowledgeable advice and support.  #@NEW_LINE#@#  I would also like to thank my friends and colleagues for their suggestions and comments: Andrea Betancourt, David Field, Jarrod Hadfield, Joachim Hermisson, Sebastian Matuszewski (who also created the flower art), Glenn Marion, Richard Nichols, Tiago Paixão, Pavel Payne, Derek Setter and Hildegard Uecker.  #@NEW_LINE#@#  Last, I would like to acknowledge the computer cluster team of IST Austria for their support long after I have left the institute.  #@NEW_LINE#@#  

References  #@NEW_LINE#@#  



