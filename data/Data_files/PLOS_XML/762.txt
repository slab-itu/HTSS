article id="http://dx.doi.org/10.1371/journal.pcbi.1005022"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
A Thalamocortical Neural Mass Model of the EEG during NREM Sleep and Its Response to Auditory Stimulation  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
Few models exist that accurately reproduce the complex rhythms of the thalamocortical system that are apparent in measured scalp EEG and at the same time, are suitable for large-scale simulations of brain activity.  #@NEW_LINE#@#  Here, we present a neural mass model of the thalamocortical system during natural non-REM sleep, which is able to generate fast sleep spindles (1215 Hz), slow oscillations (less_than1 Hz) and K-complexes, as well as their distinct temporal relations, and response to auditory stimuli.  #@NEW_LINE#@#  We show that with the inclusion of detailed calcium currents, the thalamic neural mass model is able to generate different firing modes, and validate the model with EEG-data from a recent sleep study in humans, where closed-loop auditory stimulation was applied.  #@NEW_LINE#@#  The model output relates directly to the EEG, which makes it a useful basis to develop new stimulation protocols.  #@NEW_LINE#@#  

Author_Summary  #@NEW_LINE#@#  
Sleep plays a pivotal role for the consolidation of memory.  #@NEW_LINE#@#  While REM sleep had originally been the focus of research due to its similarity with wakefulness, more recent studies suggest that different sleep stages are responsible for the consolidation of different types of memory.  #@NEW_LINE#@#  To better understand the changes in neuronal dynamics between the different sleep stages, neural mass models are a valuable tool, as they relate directly to the large-scale dynamics measured by an EEG.  #@NEW_LINE#@#  Here, we present a model of the sleeping thalamocortical system.  #@NEW_LINE#@#  We first show that the isolated thalamic submodule is able to generate different oscillatory behavior found in vivo.  #@NEW_LINE#@#  Furthermore, the full thalamocortical model reproduces the EEG of sleep stages N2 and N3 and preserves the temporal relationship between cortical K-complexes/slow oscillations and thalamic sleep spindles.  #@NEW_LINE#@#  A comparison with event related potential data from a recent sleep study in humans demonstrates its possible application in predicting the outcome of external stimulation on EEG rhythms.  #@NEW_LINE#@#  Our study shows, that a neural mass model incorporating few key mechanisms is sufficient to reproduce the complex brain dynamics observed during sleep.  #@NEW_LINE#@#  

Citation: Schellenberger Costa M, Weigenand A, Ngo H-VV, Marshall L, Born J, Martinetz T, et al.  #@NEW_LINE#@#  (2016) A Thalamocortical Neural Mass Model of the EEG during NREM Sleep and Its Response to Auditory Stimulation.  #@NEW_LINE#@#  PLoS Comput Biol 12(9):  #@NEW_LINE#@#  
           e1005022.  #@NEW_LINE#@#  

        https://doi.org/10.1371/journal.pcbi.1005022  #@NEW_LINE#@#  
Editor: Jean Daunizeau,  #@NEW_LINE#@#  
Brain and Spine Institute (ICM), FRANCE  #@NEW_LINE#@#  

Received: May 18, 2015; Accepted: June 17, 2016; Published:  September 1, 2016  #@NEW_LINE#@#  
Copyright:  Â© 2016 Schellenberger Costa et al.  #@NEW_LINE#@#  This is an open access article distributed under the terms of the Creative Commons Attribution License, which permits unrestricted use, distribution, and reproduction in any medium, provided the original author and source are credited.  #@NEW_LINE#@#  
Data Availability: All relevant data are within the paper and its Supporting Information files.  #@NEW_LINE#@#  
Funding: This work was supported by the grants "Plasticity and Sleep" (SFB 654) and the Graduate School "Computing in Medicine and Life Sciences" (GS-635) from the German Research Foundation and US-German Collaboration in Neuroscience (grant 01GQ1008) from the German Federal Ministry of Education and Research and the European Union Human Brain Project SP3 - Cognitive Architectures.  #@NEW_LINE#@#  The funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript.  #@NEW_LINE#@#  
Competing interests:  The authors have declared that no competing interests exist.  #@NEW_LINE#@#  
Introduction  #@NEW_LINE#@#  
In the human electroencephalogram (EEG) the most prominent features of non-rapid eye movement (NREM) sleep are neocortical slow oscillations (SO) at  0.8 Hz [1] and fast thalamocortical spindles characterized by a waxing and waning waveform, with a frequency of 12 to 15 Hz [2].  #@NEW_LINE#@#  The cellular basis of the slow oscillation is a widespread alternation of activity in neocortical networks between an active (up) state and a hyperpolarized silent (down) state [24].  #@NEW_LINE#@#  Fast sleep spindles are generated by the interaction of inhibitory reticular thalamic (RE) and excitatory thalamocortical (TC) neurons [5] and preferentially occur during the up state of SOs [6].  #@NEW_LINE#@#  
Many studies indicate a functional role of slow wave sleep (SWS) in the formation of memory [7, 8].  #@NEW_LINE#@#  The synchronization of fast spindle activity to the depolarized up state is mediated by the thalamocortical loop.  #@NEW_LINE#@#  It appears to be critical for consolidation as it provides a window of opportunity and favorable conditions for plastic changes [911].  #@NEW_LINE#@#  It has been shown that memory consolidation can be improved by transcranial electric and auditory stimulation [12, 13].  #@NEW_LINE#@#  Auditory stimulation in synchrony with the brains own rhythm turned out to be particularly effective.  #@NEW_LINE#@#  
Detailed knowledge of how different stimulation modalities effect critical brain rhythms as well as the ramifications of potential stimulation parameters on their efficacy would enable an optimization of stimulation protocols and consequently an advantage for experiments in basic research and clinical applications.  #@NEW_LINE#@#  Mathematical models and computational approaches can yield meaningful insights into the underlying dynamics as well as provide predictions for further experiments.  #@NEW_LINE#@#  Multiple models based on networks of single cells have addressed brain activity during sleep in the cortex [14], thalamus [1517], as well as the coupled thalamocortical system [1821].  #@NEW_LINE#@#  However, for investigations of macroscopic phenomena these models have disadvantages due to their complexity and computational load.  #@NEW_LINE#@#  
Neural mass models have shown great success in elucidating the generation of brain rhythms and evoked responses of the awake brain [2225].  #@NEW_LINE#@#  They describe the dynamics of a large number of cells by the evolution of a single population average and provide an output which directly relates to EEG signals [26, 27].  #@NEW_LINE#@#  By still allowing an integration of physiologically motivated cell dynamics via intrinsic currents, neural mass models represent a compromise between a very detailed and an abstract modeling approach and provide insights into the dynamic repertoire of the neural populations via bifurcation analysis [2830].  #@NEW_LINE#@#  
In previous work, we have shown that a cortical neural mass model equipped with an additive activity-dependent feedback current can generate a time series that closely resembles the EEG signal of sleep stages N2 and N3, without spindles [30].  #@NEW_LINE#@#  Here, we extend the cortical model by adding a thalamic module to incorporate spindle activity and investigate the underlying dynamics of the coupled system.  #@NEW_LINE#@#  We test the evocability of SOs and spindles by auditory stimulation during NREM sleep and validate our results with scalp EEG data from a recent sleep study in humans [13].  #@NEW_LINE#@#  Our findings add further support to the dynamic mechanisms proposed in [30].  #@NEW_LINE#@#  

Methods  #@NEW_LINE#@#  
In the following sections we detail the thalamocortical model.  #@NEW_LINE#@#  First we give a brief overview of the concept of neural mass models.  #@NEW_LINE#@#  We then introduce the cortical and thalamic modules and motivate the extensions with respect to sleep.  #@NEW_LINE#@#  The full equations of the thalamocortical model are given in S1 Text.  #@NEW_LINE#@#  
Neural_mass_framework  #@NEW_LINE#@#  
The conductance based neural mass model employed here is derived from [3134].  #@NEW_LINE#@#  Instead of considering the evolution of high-dimensional states in a large ensemble of single neurons, the population activity can be approximated by the evolution of the mean membrane voltage of that population.  #@NEW_LINE#@#  The complex spiking dynamics is replaced by an empirical firing rate function  #@NEW_LINE#@#  
(1)  #@NEW_LINE#@#  
with maximal firing rate , firing threshold  and neural gain k. It converts the average membrane voltage Vk of the population k to an output spike rate.  #@NEW_LINE#@#  Here, k  {p, i, t, r} stands for cortical pyramidal, cortical interneuron, thalamic relay and thalamic reticular populations, respectively.  #@NEW_LINE#@#  The firing rate function often has a sigmoidal shape and can be interpreted as stemming from the fluctuations of neuronal states or a distribution of thresholds in the population [35].  #@NEW_LINE#@#  
The spike rate Qk of the presynaptic population k then elicits a postsynaptic response smk within the receiving population k. The strength of this response can be calculated by the convolution  #@NEW_LINE#@#  
(2)  #@NEW_LINE#@#  
of the incoming spike rate Qk, scaled with the averaged connectivity constant Nkk between the presynaptic population k and the postsynaptic population k and an alpha function  #@NEW_LINE#@#  
(3)  #@NEW_LINE#@#  
representing the average synaptic response to a single spike.  #@NEW_LINE#@#  Here, m depicts the rate constant of the synaptic response, whereas m  {e, g, r} denotes the type of synapse with e standing for excitatory AMPA and g, r for inhibitory GABA synapses in the cortex and thalamus, respectively.  #@NEW_LINE#@#  
The evolution of the population membrane voltage Vk obeys  #@NEW_LINE#@#  
(4)  #@NEW_LINE#@#  
where w denotes a synaptic input rate that scales the input smk and E the corresponding Nernst potential.  #@NEW_LINE#@#  While we lean on the naming convention of Hodgkin-Huxley models to highlight the structural similarity, please note that the above quantities J and w have different units.  #@NEW_LINE#@#  For the sake of simplicity we have normalized the synaptic rates w to 1, absorbing their numerical values into the connectivities Nkk.  #@NEW_LINE#@#  
Intrinsic currents may additionally be included in the equation of the mean membrane voltage, given their time constant is large compared to the time constant of neuronal spiking [35, 36].  #@NEW_LINE#@#  To emphasize the connection to physiology and to better differentiate between the core neural mass model and the additional mechanisms we will denote them with I and introduce a capacitive coupling via to the neural mass via the membrane capacity Cm.  #@NEW_LINE#@#  
The signal measured in the EEG stems mainly from the activity of pyramidal neurons [37].  #@NEW_LINE#@#  We use the pyramidal membrane voltage as our model output, which is similar to other studies [38, 39].  #@NEW_LINE#@#  Populations comprising multiple clusters have been considered in [40] and lead to interesting effects.  #@NEW_LINE#@#  In order to keep the complexity of the model low we consider a single point source.  #@NEW_LINE#@#  Therefore, filtering effects by the skull/scalp can be approximated by a linear scaling and do not affect the interaction between thalamus and cortex.  #@NEW_LINE#@#  

Cortex  #@NEW_LINE#@#  
We use the neural mass model described in [30], which captures essential features of the EEG during NREM sleep.  #@NEW_LINE#@#  In brief, it consists of an excitatory and an inhibitory neural mass, representing populations of pyramidal neurons (p) and interneurons (i), respectively.  #@NEW_LINE#@#  The pyramidal population contains a slow, additive and activity-dependent firing rate adaptation,  #@NEW_LINE#@#  
(5)  #@NEW_LINE#@#  
which is believed to be the main driver for the transition to the silent (down) state, while the active (up) state is maintained by synaptic transmission [3, 14, 41].  #@NEW_LINE#@#  
The membrane potentials evolve according to  #@NEW_LINE#@#  
(6)  #@NEW_LINE#@#  
and are linked by the AMPA and GABAergic synaptic inputs.  #@NEW_LINE#@#  
The transition from N2 to N3 is achieved by changing the neural gain, p, and the strength of the adaptation, given by .  #@NEW_LINE#@#  Both parameters are known to be influenced by acetylcholine, serotonin, norepinephrine and dopamine [4252], whose levels change throughout the sleep-wake cycle [53].  #@NEW_LINE#@#  For consistency, we maintained the original model, adjusting only the excitatory connection strengths to compensate for additional input from the thalamic module.  #@NEW_LINE#@#  

Thalamus  #@NEW_LINE#@#  
The thalamic module comprises similarly an excitatory and an inhibitory neural mass, representing a thalamocortical (t) and the reticular (r) nucleus.  #@NEW_LINE#@#  As in the cortical module module they are coupled via AMPA and GABA synapses but have different synaptic time constants and only the RE population possesses a self-connection.  #@NEW_LINE#@#  
Both populations are equipped with additional currents.  #@NEW_LINE#@#  The inclusion of those currents within the thalamic submodule is necessary because spindle oscillations require rebound bursts.  #@NEW_LINE#@#  In classical neural mass models, this kind of bursting is not possible due to the monotonic firing rate function and demands the inclusion of additional mechanisms.  #@NEW_LINE#@#  The same argument was used in a previous neural mass model of spindle activity [54] and a thalamocortical neural mass model of epileptic activity [55].  #@NEW_LINE#@#  Finally, in [40] the authors arrive at a HH-type extension of their population model of thalamic burst activity, which has been derived from integrate-and-fire-or-burst neurons.  #@NEW_LINE#@#  The potassium leak current is given by  #@NEW_LINE#@#  
(7)  #@NEW_LINE#@#  
as well as T-type calcium currents  #@NEW_LINE#@#  
(8)  #@NEW_LINE#@#  
which deinactivate upon hyperpolarization.  #@NEW_LINE#@#  They are essential for the generation of low-threshold spikes (LTSs) and rebound bursts.  #@NEW_LINE#@#  We use the description of IT given in [56] for the RE and the one in [16] for the TC population.  #@NEW_LINE#@#  
The TC population further includes the anomalous rectifier current  #@NEW_LINE#@#  
(9)  #@NEW_LINE#@#  
responsible for the waxing and waning structure of spindle oscillations in the isolated thalamus [15].  #@NEW_LINE#@#  Other currents, such as the calcium-dependent potassium currents IKCa and ICAN, are also known to play a role in spindle oscillations, but are omitted for simplicity.  #@NEW_LINE#@#  The thalamic module is summarized by  #@NEW_LINE#@#  
(10)  #@NEW_LINE#@#  
Parameter settings for the currents are identical to [57], with the exception of the deactivation function  of the thalamic relay population, that is shifted towards more depolarized membrane voltages.  #@NEW_LINE#@#  

Full_model  #@NEW_LINE#@#  
The model consists of one thalamic and one cortical module.  #@NEW_LINE#@#  We assume the long range afferents from the cortical pyramidal population project to both populations of the thalamic nuclei, and the long range afferents of the thalamic relay population project to both populations of the cortex, as depicted in Fig 1.  #@NEW_LINE#@#  The delays introduced by these long range afferents might play a crucial role in cortical dynamics [58, 59].  #@NEW_LINE#@#  However, as the axonal conduction delay between thalamus and cortex is rather small [6063], we approximate it by a convolution with an alpha function [64], which can be written as  #@NEW_LINE#@#  
(11)  #@NEW_LINE#@#  
where k is the resulting delayed firing rate and  depicts the axonal rate constant of that connection.  #@NEW_LINE#@#  We have provided a justification for that approximation in the supporting information S2 Text.  #@NEW_LINE#@#  In the case of short range connections k can be replaced with Qk.  #@NEW_LINE#@#  The parameters of the full model are given in S1 Table.  #@NEW_LINE#@#  

Auditory_stimulation  #@NEW_LINE#@#  
We model an auditory stimulus as an elevation in background noise  (square pulse) being gated through the thalamus.  #@NEW_LINE#@#  For all stimuli, we use a duration of 80 ms and 70 spikes per second.  #@NEW_LINE#@#  

Event_triggered_averages  #@NEW_LINE#@#  
KCs and SOs were detected similar to [10].  #@NEW_LINE#@#  The model output was bandpass filtered between 0.25 and 4 Hz.  #@NEW_LINE#@#  Zero-crossings were detected to extract the negative half-waves.  #@NEW_LINE#@#  Negative half-waves with peaks below -69 mV were considered to be KCs/SOs.  #@NEW_LINE#@#  

Experimental_data  #@NEW_LINE#@#  
Experimental data has been described in [65].  #@NEW_LINE#@#  11 Subjects were measured during two experimental nights in balanced order in a stimulation and control condition.  #@NEW_LINE#@#  For averages of the endogenous activity, data was taken from the control condition.  #@NEW_LINE#@#  See S1 Dataset.  #@NEW_LINE#@#  

Computational_methods  #@NEW_LINE#@#  
The model was implemented in C++ and run within MATLAB R2015b, using a stochastic Runge-Kutta method of 4th order [66] with a step size of 0.1 ms.  #@NEW_LINE#@#  The code can be found at github [67, 68].  #@NEW_LINE#@#  


Results  #@NEW_LINE#@#  
In the following section we perform a bifurcation analysis and demonstrate the ability of the thalamic module to generate spindle oscillations and reproduce different experimental observations.  #@NEW_LINE#@#  Afterwards we investigate the interplay between thalamus and cortex to reproduce the characteristics of different sleep stages.  #@NEW_LINE#@#  Finally, we examine the effect of auditory stimulation in the model and compare different stimulation protocols with experimental findings.  #@NEW_LINE#@#  
Thalamic_spindle_oscillations  #@NEW_LINE#@#  
In the isolated thalamic module, incorporation of the intrinsic currents may lead to oscillations in the spindle band.  #@NEW_LINE#@#  We follow closely the mechanisms established in the models by [15, 19, 20].  #@NEW_LINE#@#  Physiologically, these oscillations are generated, through reciprocal interaction of the RE and TC populations.  #@NEW_LINE#@#  A LTS in the RE population causes hyperpolarization in the TC population, that deinactivates its T-type calcium current.  #@NEW_LINE#@#  Upon release from inhibition a rebound of activity occurs, that in turn drives the RE module to produce another LTS.  #@NEW_LINE#@#  Additionally, the deinactivation of the T-type calcium currents requires a strong tonic hyperpolarization by a potassium leak current [15, 19].  #@NEW_LINE#@#  
As previously shown in [5, 15, 20, 69], the rhythmicity of spindle occurrence and the waxing and waning of the spindle amplitude is caused by an anomalous rectifier channel Ih.  #@NEW_LINE#@#  A sequence of LTS leads to the build-up of calcium, which increases the effective conductivity  of Ih.  #@NEW_LINE#@#  The ensuing depolarization of the TC population increasingly counteracts its ability to produce a LTS and terminates the spindle oscillation [70, 71].  #@NEW_LINE#@#  
Therefore, we chose  and  as bifurcation parameters.  #@NEW_LINE#@#  A two-dimensional bifurcation analysis of the thalamic module reveals the existence of a Hopf bifurcation, as depicted in Fig 2, which generates continuous oscillations in the spindle band due to hyperpolarization induced rebound bursts, see Fig 3-CI and 3-CII for representative time series.  #@NEW_LINE#@#  
The torus bifurcations emerge from a blue sky catastrophe that is generated by the slow-fast interaction between the fast T-type channels and their slow modulation via Ih, which is similar to other models that exhibit switching between tonic spiking and structured bursting activity [72, 73].  #@NEW_LINE#@#  
As depicted in Fig 3-SI and 3-SII this leads to spindle like oscillations in the orange shaded regions in Fig 2.  #@NEW_LINE#@#  The spindles exhibit an oscillation frequency of around 13 Hz.  #@NEW_LINE#@#  The spindle frequency depends on the strength of the T-type calcium current .  #@NEW_LINE#@#  Importantly, spindle oscillations are initiated intrinsically.  #@NEW_LINE#@#  The thalamic module does not require modulatory input from external sources to initiate/terminate them.  #@NEW_LINE#@#  
Activation of Ih is responsible for a refractory period that follows a spindle.  #@NEW_LINE#@#  As long as Ih activation persists, LTS generation is impeded and stronger perturbations are necessary to trigger spindle oscillations.  #@NEW_LINE#@#  Consequently, an increase in  results in a larger inter-spindle interval.  #@NEW_LINE#@#  The left spindle regime (SI) is encased by the Hopf and the torus bifurcation, whereas the right spindle regime (SII) is constrained by two global bifurcations that are indicated by the dashed gray lines.  #@NEW_LINE#@#  The vertical line marks the emergence of the torus bifurcation, whereas the horizontal gray line marks the cusp bifurcation where the two saddle-nodes that accompany the left torus bifurcation vanish.  #@NEW_LINE#@#  
Furthermore, for larger values of  the model transitions from high frequency spindle oscillations to low frequency delta oscillations, e.g.  #@NEW_LINE#@#  Fig 3-DI and 3-DII.  #@NEW_LINE#@#  

K-complexes_and_spindles_during_sleep_stage_N2  #@NEW_LINE#@#  
In the coupled system, the cortex provides excitatory drive to the thalamic module, since it is predominantly in the active state.  #@NEW_LINE#@#  In order for the thalamic module to exhibit rhythmically occurring spindle oscillations we had to adjust  and  slightly to account for that additional depolarization (see Table 2).  #@NEW_LINE#@#  We choose the right spindle regime, as it was suitable for reproduction of both sleep stage N2 and N3.  #@NEW_LINE#@#  
As can be seen in Fig 4 spindles may be triggered by KCs in the full model, but may also occur independent of KCs.  #@NEW_LINE#@#  During a KC the sudden drop of excitatory drive hyperpolarizes the RE and TC population, leading to deinactivation of IT.  #@NEW_LINE#@#  The ensuing depolarization upon the transition back to the active state triggers a LTS and a spindle sequence in turn.  #@NEW_LINE#@#  The spindle then projects back into the depolarizing phase of the KC.  #@NEW_LINE#@#  This is in good agreement with the grouping of spindles and KCs observed experimentally [6, 74].  #@NEW_LINE#@#  
Although less likely the model can also give rise to KCs triggered by a spindle.  #@NEW_LINE#@#  This can be achieved by increasing the connection strength from the thalamic to the cortical module (model output not shown).  #@NEW_LINE#@#  During N2, KCs occur at a low rate.  #@NEW_LINE#@#  Hence, spindle initiation and termination are closely linked to the time course of Ih (Fig 3A), similar to the isolated thalamic module.  #@NEW_LINE#@#  The parameters for the output in Fig 4 are given in Table 2.  #@NEW_LINE#@#  
Given the parameter setting in Table 2, the cortical module is within a stable focus, close to a Hopf bifurcation accompanied by a canard explosion.  #@NEW_LINE#@#  This leads to noise driven medium amplitude background oscillations around the stable focus, that are interrupted by large amplitude deflections (KCs).  #@NEW_LINE#@#  In good agreement with experimental findings, KCs also appear within the isolated cortex, although they may be initiated through thalamic input.  #@NEW_LINE#@#  

SOs_and_spindles_during_sleep_stage_N3  #@NEW_LINE#@#  
On the transition to sleep stage N3 the canard phenomenon vanishes in a cusp bifurcation and only a high amplitude limit cycle remains.  #@NEW_LINE#@#  SOs are noise driven oscillations around a stable focus, close to a Hopf bifurcation [30].  #@NEW_LINE#@#  
In contrast to sleep stage N2 spindle initiation and termination are now dominated by the modulatory input from the cortical module, that overrules the Ih rhythm.  #@NEW_LINE#@#  Rather than occurring rhythmically spindles are time-locked to the depolarized phase of a SO.  #@NEW_LINE#@#  In Fig 5 an example time series is shown.  #@NEW_LINE#@#  Importantly, not every SO is able to trigger a spindle, as can be seen in Fig 5 (912 s, 1315 s).  #@NEW_LINE#@#  We observed that in a sequence of SOs the first triggers a spindle, which leads to an activation of Ih.  #@NEW_LINE#@#  This reduces spindle amplitude or even inhibits spindle initiation by the following SO.  #@NEW_LINE#@#  

Endogenous_event_triggered_averages  #@NEW_LINE#@#  
To further validate the model, we determined averages of the generated EEG signal and fast spindle power time-locked to the negative peak of the endogenous KCs/SOs during N2 and N3.  #@NEW_LINE#@#  This method is often used to illustrate the grouping of spindles by SOs and morphological features of SOs, e.g.  #@NEW_LINE#@#  in [6, 13, 65].  #@NEW_LINE#@#  Model output and data for N2 and N3 is depicted in Fig 6.  #@NEW_LINE#@#  
As can be seen in Fig 6, the grouping of spindles by SOs is present in the model.  #@NEW_LINE#@#  Spindle power is highest during the positive half-wave following the negative peak.  #@NEW_LINE#@#  However, there are some notable differences.  #@NEW_LINE#@#  Compared to the experimental data the initial depolarization preceding the transition to the down state is less prominent, leading to a shallower slope of the transition to the down state.  #@NEW_LINE#@#  In the thalamocortical model the transition to the depolarized up state occurs considerably earlier with a time to peak of 300 ms, compared to 440 ms in the data.  #@NEW_LINE#@#  This stems from strong depolarizing input by thalamic spindle bursts, which start directly after the negative peak of a KC/SO and push the cortex further into the depolarized state.  #@NEW_LINE#@#  However, this is still in line with other experimental studies, that find different timings of spindles for the supplementary motor area of the cortex [75].  #@NEW_LINE#@#  

Closed-loop_auditory_stimulation  #@NEW_LINE#@#  
In the following we show the ability of the model to reproduce data from a recent experiment in humans performing auditory closed-loop stimulation during NREM sleep [13].  #@NEW_LINE#@#  The stimulation protocol is as follows: After the negative peak of a SO was detected, two auditory stimuli were applied phase-locked to the following positive peak of the depolarized up phase of the detected and the subsequent SO.  #@NEW_LINE#@#  
In the experimental study the delay time between the negative peak and the ensuing positive half-wave peak was determined for every subject independently.  #@NEW_LINE#@#  The second stimulus followed after a fixed interval of 1075 ms.  #@NEW_LINE#@#  Detection was then paused for 2.5 s. We accordingly determined the delay time from the model output, resulting in a delay of 450 ms for the N3 parameter setting.  #@NEW_LINE#@#  The second stimulus was chosen to occur 1075 ms after the first one and we also paused detection for 2.5 s. Stimuli are given as elevations in mean background noise of the thalamic relay population for a duration of 80 ms.  #@NEW_LINE#@#  
Fig 7 shows the averaged EEG signal and model output time-locked to the first stimulus (t = 0).  #@NEW_LINE#@#  There is a good agreement between model output and the experimental data.  #@NEW_LINE#@#  Especially the large amplitude, late components of the ERP are very close to the original waveform.  #@NEW_LINE#@#  The early component of the evoked potential, the P200, can be seen in the experimental data after each stimulus, but it is more pronounced in the model output.  #@NEW_LINE#@#  
In addition, the evoked spindle responses of model and data also have similar time courses.  #@NEW_LINE#@#  In both cases spindle power is systematically increased during the depolarized up phases induced by the stimuli.  #@NEW_LINE#@#  However, the strong increase in spindle power seen in the data after the first stimulus is not visible in the model.  #@NEW_LINE#@#  We hypothesize this to stem from a recruitment effect, where the stimulus activates a larger fraction of the thalamus than the endogenous slow oscillation would.  #@NEW_LINE#@#  As our thalamic module is a point model without any spatial extent, these effects are excluded by construction.  #@NEW_LINE#@#  
Interestingly, in the experimental data there is a drop in spindle power after the second stimulus is applied.  #@NEW_LINE#@#  This seems to be a refractoriness of the thalamus after the second slow oscillation, which has also been observed in [76].  #@NEW_LINE#@#  Despite the model showing such a refractory period in the isolated thalamus (Fig 3A), as well as during trains of endogenous SOs in the full model (Fig 8A), it lacks it upon stimulation (Fig 8B).  #@NEW_LINE#@#  
This happens because stimulation disturbs the Ih mediated spindle termination mechanism.  #@NEW_LINE#@#  As the stimulation depolarizes the TC population, the calcium concentration drops, because calcium influx through the IT current stops and calcium leaks out with a time constant of 10ms.  #@NEW_LINE#@#  Without the elevated calcium concentration, Ih deactivates back to baseline levels and immediately allows for a new full fledged spindle.  #@NEW_LINE#@#  


Discussion  #@NEW_LINE#@#  
We developed a neural mass model of the thalamocortical system that produces realistic time courses of EEG signals during sleep stages N2 and N3 and correctly replicates the timing of KCs and spindles.  #@NEW_LINE#@#  We validated our model with SO triggered averages of the EEG signal and spindle power.  #@NEW_LINE#@#  Finally, we used the model to reproduce evoked responses from closed-loop auditory stimulation during human NREM sleep.  #@NEW_LINE#@#  
Mechanisms_of_spindle_generation  #@NEW_LINE#@#  
The model emphasizes the role of IT and Ih currents in the generation of thalamocortical rhythms as they were sufficient to reproduce the investigated EEG phenomena.  #@NEW_LINE#@#  It reproduces the grouping of spindles and KCs/SOs, observed in human EEG [6], that is thought to play a crucial role in the consolidation of memory [77, 78].  #@NEW_LINE#@#  Additionally, it exhibits refractoriness of spindle oscillations, i.e.  #@NEW_LINE#@#  not every SO in a train of endogenous SOs triggers a spindle.  #@NEW_LINE#@#  Although adding extra currents increases dimensionality and parameter space, the model still preserves the overall simplicity and computational efficacy common to neural mass models.  #@NEW_LINE#@#  

Spindle_timing  #@NEW_LINE#@#  
Relative to the negative deflection of a KC, spindles consistently start earlier than in the data.  #@NEW_LINE#@#  Consistently, the depolarizing up phase of endogenous KCs and SOs arrives earlier in the model than in the data.  #@NEW_LINE#@#  A comparison with the results from the isolated cortical module shows, that this is mostly due to strong depolarizing input from the thalamus.  #@NEW_LINE#@#  Yet, there is no clear explanation for the difference between model and experiment.  #@NEW_LINE#@#  It might be due to the simplification of the intrinsic mechanisms, e.g.  #@NEW_LINE#@#  firing rate adaptation in cortex and spindle dynamics in thalamus.  #@NEW_LINE#@#  On the other hand it could also be that finer details, e.g.  #@NEW_LINE#@#  spatial extension or the layered structure of the cortex are important for its temporal dynamics.  #@NEW_LINE#@#  Also the way conduction delays between cortex and thalamus were implemented, namely via an extra convolution with an alpha function, might play a role.  #@NEW_LINE#@#  

Auditory_stimulation  #@NEW_LINE#@#  
A recent experimental study suggests that the refractoriness of thalamic spindles is a limiting factor for the impact of auditory stimulation upon memory consolidation [76].  #@NEW_LINE#@#  They found, that longer trains of stimuli do not provide any benefit in memory consolidation compared to the two stimulus protocol.  #@NEW_LINE#@#  Remarkably, the first stimulus triggers a strong spindle, whereas the following stimuli show a diminished spindle response.  #@NEW_LINE#@#  This clearly indicates the importance of the grouping of spindles and SOs for the consolidation of memory.  #@NEW_LINE#@#  In contrast to these experimental findings, auditory stimulation in the model alleviates the refractoriness of the thalamic module, leading to spindle oscillations with similar amplitude following every stimulus.  #@NEW_LINE#@#  This is because strong depolarization of the thalamic populations by the stimulus interrupts the thalamic Ih rhythm.  #@NEW_LINE#@#  We see this as a challenge for the understanding of how auditory stimulation is processed during sleep and how it interacts with spindle generation.  #@NEW_LINE#@#  

Relation_to_other_work  #@NEW_LINE#@#  
Recently, Cona et al.  #@NEW_LINE#@#  also developed a neural mass model to describe the sleeping thalamocortical system [79].  #@NEW_LINE#@#  They combined two distinct firing modes via the activation of the T-type calcium current, showing that this multiplicative change in firing rate can lead to periodic spindle-like oscillations.  #@NEW_LINE#@#  However, in this study we include the currents directly into the equation of the membrane voltage, similar to [30, 54].  #@NEW_LINE#@#  Our model relates directly to scalp EEG signals during natural sleep and auditory stimulation.  #@NEW_LINE#@#  

Effect_of_neuromodulators_and_sleep_regulation  #@NEW_LINE#@#  
In our model, we induce the transition between the different sleep stages by changes of the three key parameters (gKNa and p in the cortex and  in the thalamus), that are directly linked to the action of neuromodulators [30, 8082].  #@NEW_LINE#@#  These parameters are known to be affected by neuromodulators, such as noradrenalin, serotonin and acetylcholine [44, 46, 50, 51, 83], whose concentrations vary over the night.  #@NEW_LINE#@#  Regulation of neuromodulator concentrations arises through complex interactions within different sleep regulatory networks [53, 84].  #@NEW_LINE#@#  Recently there has been progress in the mathematical description of sleep regulatory networks [8589].  #@NEW_LINE#@#  However, as we focus on the different dynamical modes the thalamocortical system can exhibit and how thalamus and cortex interact, we do not include sleep regulation in this manuscript.  #@NEW_LINE#@#  

Are_KCs_biphasic_or_triphasic?  #@NEW_LINE#@#  
The waveform of a KC has been described as being biphasic, consisting of a large negative deflection (down state) followed by a pronounced depolarization (up state)or triphasic, comprising an initial positive bump followed by a down state and an up state.  #@NEW_LINE#@#  Menicucci et al.  #@NEW_LINE#@#  [90] analyzed the shapes of KCs in N2 and N3 and found that on average a triphasic pattern, up-down-up, is present in both sleep stages.  #@NEW_LINE#@#  Our model does not show this sequence for sleep stage N2.  #@NEW_LINE#@#  In vivo, sleep stage N2 is rarely stationary and spans varying depths of sleep, as well as transitions to other sleep stages.  #@NEW_LINE#@#  In contrast, our model depicts idealized N2 at a single point in time, to separate it from wakefulness and N3.  #@NEW_LINE#@#  Choosing a parameter setting closer to N3 will naturally give rise to a depolarization preceding the down state.  #@NEW_LINE#@#  We predict that biphasic KCs should be found mostly in early N2 or very late N2, as in the second half of the night after the major SWS episodes.  #@NEW_LINE#@#  

Is_there_true_bistability_during_natural_sleep?  #@NEW_LINE#@#  
The model is consistent with the observation that during N2 and N3 of natural sleep the cortex is mostly in the active state [91].  #@NEW_LINE#@#  We adopt the view of [30], where KCs were characterized as transient eventsreversed spikesinitiated by a canard explosion.  #@NEW_LINE#@#  Consequently the down state is never stable in our model.  #@NEW_LINE#@#  This may seem counterintuitive as many intracellular recordings support the notion of bistability.  #@NEW_LINE#@#  However, neural mass models represent population averages, whereas intracellular recordings only sample individual members of a population, leaving open this alternative interpretation derived from stereotypical graphoelements in the EEG.  #@NEW_LINE#@#  




