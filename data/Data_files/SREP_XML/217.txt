article id="http://dx.doi.org/10.1038/srep23273"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
Tuning-free controller to accurately regulate flow rates in a microfluidic network  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
We describe a control algorithm that can improve accuracy and stability of flow regulation in a microfluidic network that uses a conventional pressure pump system.  #@NEW_LINE#@#  The algorithm enables simultaneous and independent control of fluid flows in multiple micro-channels of a microfluidic network, but does not require any model parameters or tuning process.  #@NEW_LINE#@#  We investigate robustness and optimality of the proposed control algorithm and those are verified by simulations and experiments.  #@NEW_LINE#@#  In addition, the control algorithm is compared with a conventional PID controller to show that the proposed control algorithm resolves critical problems induced by the PID control.  #@NEW_LINE#@#  The capability of the control algorithm can be used not only in high-precision flow regulation in the presence of disturbance, but in some useful functions for lab-on-a-chip devices such as regulation of volumetric flow rate, interface position control of two laminar flows, valveless flow switching, droplet generation and particle manipulation.  #@NEW_LINE#@#  We demonstrate those functions and also suggest further potential biological applications which can be accomplished by the proposed control framework.  #@NEW_LINE#@#  

Introduction  #@NEW_LINE#@#  
Accurate and stable flow control in microfluidic channels is a fundamental requirement in lab-on-a-chip devices to investigate biological systems1,2,3.  #@NEW_LINE#@#  Control of flow in a micro-channel is required for precise manipulation of a sample solution or reagent, and for stimulation of cells by mechanical shear force4.  #@NEW_LINE#@#  Many studies have focused on developing miniaturized valves and pumps to dynamically regulate flow in micro-channels5,6.  #@NEW_LINE#@#  However, those miniaturized systems do not provide reliable accuracy and precision; especially, mechanical valves or pumps use moving parts, which are often unreliable and can cause failure of accurate flow control7.  #@NEW_LINE#@#  
A flow source such as a syringe pump is typically used to generate a constant flow from the external macro-environment into a micro-channel.  #@NEW_LINE#@#  However, when a syringe pump is applied to a micro-channel, flow fluctuates due to the motion of the electric motor and deformation of elastic channel walls8,9,10.  #@NEW_LINE#@#  This fluctuation is unavoidable and causes inaccuracy and instability in flow regulation.  #@NEW_LINE#@#  A pressure source such as a pressure pump is also widely used to drive flow more stably with faster responses than those of the flow source.  #@NEW_LINE#@#  However, accurate control of the flow with the pressure source is difficult to achieve in the presence of parametric uncertainties or disturbances in a microfluidic network11.  #@NEW_LINE#@#  For example, fabrication error, air bubbles in the channel, wobble of tubes, suspended cells, and the swelling of the channel can degrade the accuracy of flow regulation12.  #@NEW_LINE#@#  
For this reason, some lab-on-a-chip devices adopt a feedback control scheme to achieve high precision in flow control.  #@NEW_LINE#@#  A feedback control scheme is suitable for complex networks and does not require exact model parameters (e.g., fluidic resistances or capacitances).  #@NEW_LINE#@#  Most research into feedback control schemes for microfluidic devices and commercialized pressure pump systems have only considered a proportional-integral-derivative (PID) controller13,14,15, which is insensitive to disturbance and has good control accuracy.  #@NEW_LINE#@#  However, a standard PID controller cannot be easily applied to a complex microfluidic network because a microfluidic network is a coupled multiple-input multiple-output (MIMO) system.  #@NEW_LINE#@#  Furthermore a PID controller requires a tedious gain-tuning process which affects control accuracy and is difficult to conduct for users who are not familiar with control theory.  #@NEW_LINE#@#  To the best of the authors knowledge, a control scheme for a complex microfluidic network has not been developed.  #@NEW_LINE#@#  
In this study, for the first time, we propose a robust control algorithm to accurately regulate flow in a microfluidic network in the presence of external disturbances and model uncertainties while maintaining stable steady-state flow.  #@NEW_LINE#@#  The proposed control algorithm can be broadly applied to microfluidic systems for accurate and precise flow regulation, and does not require a tedious gain-tuning process.  #@NEW_LINE#@#  We theoretically analyzed and experimentally validated the performances of the proposed control algorithm including the robustness, the optimality and the stability of the closed-loop system.  #@NEW_LINE#@#  We also demonstrated some useful applications for lab-on-a-chip devices that can use the proposed robust controller: regulation of volumetric flow rate, valveless flow switching, interface position control of two laminar flows, fine droplet generation, and particle manipulation.  #@NEW_LINE#@#  

Control_Framework  #@NEW_LINE#@#  
Fluidic_circuit_for_modeling_microfluidic_network_systems  #@NEW_LINE#@#  
To apply control theory and numerical simulations for analyzing the proposed controller, a dynamic model of fluid flow in a microfluidic network should be constructed.  #@NEW_LINE#@#  The laminar incompressible flow in a single channel can be modeled by a fluidic resistance R and a fluidic inductance L as  where p is a pressure drop between the ends of the single channel, and Q is volumetric flow rate.  #@NEW_LINE#@#  The compliance of the channel wall, compressibility of fluid, and effects of air bubbles in the microfluidic channel are represented by a fluidic capacitance C as  (Fig 1a).  #@NEW_LINE#@#  Using the three RLC components, we construct a model of a single microfluidic channel that has T-shaped geometry composed of two resistors, two inductors and a single capacitor (Fig 1b).  #@NEW_LINE#@#  An arbitrary microfluidic network can be modeled by connecting several T-models (Fig 1c) and represented by a coupled MIMO system.  #@NEW_LINE#@#  Here, it is worth noting that transient responses (flow rates) with respect to applied pressures of the network model rely on R, L, C and the network topology, whereas steady-state responses are only affected by the resistances and the network topology.  #@NEW_LINE#@#  
We define a perturbed system as G(s)+G(s) where G(s) is the transfer function matrix of an unperturbed microfluidic network composed of RLCs (nominal system) and G(s) is unknown perturbations such as unmeasurable fabrication error and the uncertain elasticity of tubes.  #@NEW_LINE#@#  We also define the steady-state gain Gss that is composed of only nominal resistances by removing the inductors and the capacitors from the nominal system G(s); i.e.  #@NEW_LINE#@#  Gss=G(s)|s=0 (see Methods for detailed construction method of the steady-state gain).  #@NEW_LINE#@#  The steady-state gain will be used to implement the proposed controller, whereas the perturbed system will be used to analyze the proposed controller and to conduct numerical simulations.  #@NEW_LINE#@#  

Robust_control_algorithm  #@NEW_LINE#@#  
The main objectives of the proposed controller are to eliminate perturbations and to minimize input pressure while guaranteeing stability of the closed-loop system; i.e., the closed-loop system is insensitive to model uncertainties G(s) (e.g., unknown resistances, capacitances, and inductances) and disturbances D(s) (e.g., flow agitation in tubes connected from a pressure pump to a microfluidic chip) while maintaining its high-accuracy flow regulation.  #@NEW_LINE#@#  The input vector  consists of Na pressures at each input port and the output vector  consists of Nc flow rates at each channel.  #@NEW_LINE#@#  The controller only uses a right inverse of the steady-state gain Gss to force the steady-state flow of the perturbed system G(s)+G(s) to become desired flow rate  (Fig 1d); hence, the proposed controller can be implemented without knowledge of the exact values of resistances, capacitances, and inductances.  #@NEW_LINE#@#  
The fact that the controller compensates for all undesirable effects at steady-state can be proved by computing a block diagram algebra of the control structure (Fig 1d) as  #@NEW_LINE#@#  
where the superscript  represents the right inverse of the matrix (i.e., A=AT(AAT)1).  #@NEW_LINE#@#  Here, Gss maps reference input u*(s) to desired output ydes(s) and the system output y(s) becomes the desired output ydes(s) by the control input uc(s).  #@NEW_LINE#@#  Hence, the controller makes the perturbed system G(s)+G(s) converge to the desired output in the presence of disturbances D(s).  #@NEW_LINE#@#  
From the control structure (Fig 1d), discrete control input to implement the controller in a microfluidic system is derived as  #@NEW_LINE#@#  
where the subscript k is the time-step index, yk is output measurement at step k, and  represents the maximum pressure at the input ports that does not saturate the pressure pump.  #@NEW_LINE#@#  The saturation function in (5) is defined by  #@NEW_LINE#@#  
It is interesting to note that the control structure can be converted to an integral controller (Fig 1e).  #@NEW_LINE#@#  The derivation of the conversion is as follows:  #@NEW_LINE#@#  
Here, if we assume that the initial control input uc,0 is zero, then the resulting discrete control input is  #@NEW_LINE#@#  
Therefore, the resulting control law is nothing but the integral control because (8) can be expressed as  where  and t is time interval (Fig 1e); in short, the structure of the controller can be interpreted as integral action with gain Kss.  #@NEW_LINE#@#  Whereas the conventional integral action in a PID controller has an integral gain which is a constant diagonal matrix, the gain  (or Kss) in our controller optimally distributes the error signals to the multiple input sources (as will be discussed in following section).  #@NEW_LINE#@#  The resulting closed-loop system is always stable because the closed-loop system is just the second order system cascaded by integral control.  #@NEW_LINE#@#  Please refer Supplementary Information Text S1 for the detailed stability analysis.  #@NEW_LINE#@#  

Optimality_of_control_input_and_tuning-free_property  #@NEW_LINE#@#  
The steady-state gain matrix Gss is a linear transformation from given input pressure u to output steady-state flow y. Physically, pressure applied to a microfluidic chip from several pressure sources generates the pressure drops across the microfluidic network, then the given pressure drops produce resultant steady-state flow in channels.  #@NEW_LINE#@#  Hence, the steady-state gain Gss is only composed of fluidic resistances and network topology because steady-state flow depends entirely on the fluidic resistances of the network.  #@NEW_LINE#@#  Mathematically, the steady-state gain Gss is an onto matrix and always has a right inverse matrix (see Supplementary Information Text S1 for the proof of existence of a right inverse matrix).  #@NEW_LINE#@#  A right inverse can be used to find a least-norm solution as uln=AT(AAT)1y=Ay where uln is the optimal solution of y=Au that minimizes ; i.e., uln is a solution of the optimization problem as follows  #@NEW_LINE#@#  
Here, for the case of the proposed control input (5) or (8), A=Gss and y=ydesyk(=ek) in (9).  #@NEW_LINE#@#  This means that the control gain  yields the same effect as using the simple closed-form in (5) or (8) to solve the optimization problem (9) at every time interval.  #@NEW_LINE#@#  This optimality implies that the pressure source requires only the minimum pressure whereas a PID controller does not optimize control input, and therefore wastes pump capability.  #@NEW_LINE#@#  
Moreover, due to the optimal property, the proposed controller yields a tuning-free property that is its key characteristic.  #@NEW_LINE#@#  The tuning-free property enables easy implementation of the proposed controller to a complicated microfluidic network without tedious and technical gain tuning process.  #@NEW_LINE#@#  For example, using a typical PID control scheme to simultaneously control several flows in a microfluidic network, the number of gains that should be finely tuned increases in proportion to the number of controllable channels; if gains that should be tuned 10, it is impractical to be implemented.  #@NEW_LINE#@#  In addition, we provide a single tuning parameter to adjust the closed-loop transient response that can be used when fast response is required (Supplementary Information Text S2).  #@NEW_LINE#@#  

Simulation  #@NEW_LINE#@#  
Numerical simulations were performed to verify the robustness, optimality, stability and accuracy of the proposed controller.  #@NEW_LINE#@#  As a network model for the simulation, a simple Y-junction network in which three channels are connected to each other was used (Fig 1c), and unknown parameter uncertainties were included in the network model.  #@NEW_LINE#@#  The control algorithm only used the steady-state gain which consists of nominal resistances of channels and the network topology, although the capacitance, inductance and uncertain parameters affect the resulting flow.  #@NEW_LINE#@#  
Set point regulation using the controller was performed with desired flow rates in each channel set to 10, 20 and 30L/min, respectively.  #@NEW_LINE#@#  The output flow rates converged to the desired flow rates quickly (less_than1sec) without steady-state error, whereas the redundant pressure p2 remained at zero due to the optimality of the control input (Fig 1f,g).  #@NEW_LINE#@#  Simulations were also performed at varying control frequencies (Fig 1h).  #@NEW_LINE#@#  As the control frequency increased, the response time decreased, but small oscillations occurred in the transient response if the control frequency was 20Hz.  #@NEW_LINE#@#  This is because the control frequency scales control gain (see Supplementary Information Text S1 for a relationship between the control frequency and the system stability).  #@NEW_LINE#@#  The control frequency affected only transient responses; the steady-state responses were the same at all frequencies.  #@NEW_LINE#@#  This means that the flow regulation accuracy is guaranteed at a wide range of control frequencies and that the transient response can be adjusted by a single tuning parameter (Supplementary Information Text S2).  #@NEW_LINE#@#  


Results  #@NEW_LINE#@#  
We conducted experiments in a microfluidic chip to confirm the characteristics of the proposed controller.  #@NEW_LINE#@#  The experimental setup is composed of the computer, pressure regulator, reservoirs, microfluidic device, flow sensors and flow reader (Fig 2a).  #@NEW_LINE#@#  Using the pressure regulator, pressure is independently applied to the reservoirs to force the fluids into the microfluidic chip through tubes.  #@NEW_LINE#@#  Two flow rates (Q2, Q3) are measured using independent flow sensors, one located at each of the tubes that connect the reservoirs to the microfluidic device.  #@NEW_LINE#@#  The flow reader sends the measured flow signal to the computer, which sends control signals to the pressure regulator.  #@NEW_LINE#@#  Using the experimental setup, basic flow-regulation experiments were performed to validate the robustness, optimality and accuracy of the proposed controller.  #@NEW_LINE#@#  In addition, a well-tuned PID controller was also tested for comparison with the robust controller.  #@NEW_LINE#@#  A Y-junction microfluidic network, which is the same model used in the simulations, was connected to three pressure sources.  #@NEW_LINE#@#  Three pressure input ports p1, p2, p3 were located one at the end of each channel.  #@NEW_LINE#@#  Flow rates Q1, Q2, Q3 of each channel are the outputs to be controlled, but only two flow rates Q2 and Q3 were measured by flow sensors in the experiments (see Supplementary Information Text S1 for the selection method of controllable channels).  #@NEW_LINE#@#  
Moreover, some lab-on-a-chip applications based on the basic flow control were also demonstrated to show versatile functions of the robust feedback control system.  #@NEW_LINE#@#  A video clip of those experiments is provided as Supplementary Information.  #@NEW_LINE#@#  
Basic_flow_regulation  #@NEW_LINE#@#  
Basic flow regulation experiments were performed to show that the proposed controller is robust against geometrical uncertainty and disturbances while maintaining accurate flow regulation with minimum pressure.  #@NEW_LINE#@#  In set point regulation experiments (Fig 2b), desired flow rate in channel 3 was changed manually from 10L/min to 60L/min while flow rate in channel 2 remained zero.  #@NEW_LINE#@#  The output flow rate shows fast transient responses with rise times less than 0.5 s in every case and stable steady-state responses with high-accuracy in the presence of unmeasurable fabrication error; i.e., the control performance is insensitive to fabrication quality (Fig 2, top of b).  #@NEW_LINE#@#  Moreover, the pressure input was minimally used due to the optimality of the proposed control algorithm as we mentioned in the previous section; one redundant pressure source p3 remained zero (Fig 2, bottom of b).  #@NEW_LINE#@#  

Comparison_with_PID_control  #@NEW_LINE#@#  
The proposed robust controller was compared with a conventional PID control scheme to show the better regulation performance and advantages of the tuning-free property (Fig 2c,d).  #@NEW_LINE#@#  Average error of the proposed controller is less_than0.1L/min, which is much less than the PID result of 1.94 to 4.55L/min; the maximum error of the proposed controller is less than 1/7 times that of PID control.  #@NEW_LINE#@#  Control input (i.e., pressure applied to the microfluidic chip) also shows the advantage of the proposed controller.  #@NEW_LINE#@#  The proposed controller required pressure input less than one fifth of those that the PID controller required.  #@NEW_LINE#@#  This optimality of the pressure input is appropriate for microfluidic chips in which high pressure cannot be easily applied16.  #@NEW_LINE#@#  

Robustness_to_the_disturbances_and_fluid_property  #@NEW_LINE#@#  
The presence of tube wobble is a usual event during use of a microfluidic device.  #@NEW_LINE#@#  To show the algorithms insensitivity to these disturbances, we intentionally jiggled the tubes connected from the pressure pump to the microfluidic chip while operating the control algorithm.  #@NEW_LINE#@#  The flow rate signals oscillated during the jiggling, but the oscillation was maintaining its center near the desired flow rates and the flow rate converged instantaneously to the desired steady-state after the jiggling ceased (Fig 2e).  #@NEW_LINE#@#  
The proposed controller is also insensitive to change of fluid properties (e.g., viscosity).  #@NEW_LINE#@#  To show the robustness to fluid variations, different fluids  water and isopropyl alcohol (IPA)  were used for flow regulation experiments.  #@NEW_LINE#@#  Although input pressures and transient responses with IPA were somewhat different from those of water, the comprehensive regulation accuracy was almost the same (Fig 2f).  #@NEW_LINE#@#  The proposed controller does not need gain tuning due to its tuning-free property, whereas conventional control methods need control gain modification that depends on the fluid dynamics.  #@NEW_LINE#@#  
These two experiments have confirmed that the proposed controller is insensitive to both external disturbances D(s) and internal parametric uncertainties G(s).  #@NEW_LINE#@#  This robustness is appropriate to applications that require long-term stability and high precision, e.g., cell culture in a lab-on-a-chip device in the presence of slowly-varying dynamics such as effects of absorption into poly(dimethylsiloxane) (PDMS)4,17.  #@NEW_LINE#@#  

Versatile_applications  #@NEW_LINE#@#  
Many lab-on-a-chip applications such as flow interface position control15,18,19, valveless flow switching16,20,21,22, droplet generation14,23 and particle manipulation can be easily realized using the proposed flow control method.  #@NEW_LINE#@#  In this study, those were implemented to show the versatility of the proposed flow controller in the Y-junction network.  #@NEW_LINE#@#  
In the valveless flow switching experiment (Fig 3), a dye solution and DI (deionized) water were used to visualize the flow.  #@NEW_LINE#@#  The experimental result shows a switching of the dye solution at a fork in the Y-junction network by simultaneously controlling both upper and lower flows (Q2 and Q3).  #@NEW_LINE#@#  During the Open Ch 2 stage, the upper channel was open and the lower channel was closed, both for 61s.  #@NEW_LINE#@#  The reference flow rate of the open channel was set to 40L/min and the flow rate of the closed channel was set to 0L/min.  #@NEW_LINE#@#  At this time, intensities (concentrations) at the centers of channels 1 and 2 both decreased (concentration increased) while intensity at the center of channel 3 was maintained (top of Fig 3b); as a result the solution darkened.  #@NEW_LINE#@#  At the same time, flow rates in channels 2 and 3 were maintained at their reference flow rates (bottom of Fig 3b).  #@NEW_LINE#@#  From 61.15s to 65.3s channels were cleaned to remove the dye solution, then the opposite side channel (channel 3) was opened to execute a valve switching.  #@NEW_LINE#@#  In this stage, intensities decreased in channels 1 and 3, but remained the same in channel 2.  #@NEW_LINE#@#  Also the flow rates in both channel 2 and channel 3 converge to the reference flow rates as in the previous step.  #@NEW_LINE#@#  The method to compute flow intensity is described in Supplementary Information Text S3.  #@NEW_LINE#@#  
In the laminar interface position control experiment (Fig 4), two laminar flows (dye solution; DI water) form a flow interface at the confluent channel; the position of the interface can be manipulated by controlling each flow (Qdye and QDI).  #@NEW_LINE#@#  Interface position was controlled to track a 0.25-Hz square-wave reference trajectory along the channel width.  #@NEW_LINE#@#  This trajectory tracking can confirm the precise controllability of interface position in a microfluidic network.  #@NEW_LINE#@#  The experimental result shows that interface position tracks the reference trajectory well at both the junction and downstream (Fig 4a).  #@NEW_LINE#@#  The corresponding intensity at the center of the downstream flow also behaves like the reference square-wave (Fig 4, top of b).  #@NEW_LINE#@#  At the same time, flow rates of each channel also successfully tracked the reference flows (Fig 4, bottom of b).  #@NEW_LINE#@#  
In the droplet-generation experiment (Fig 5), silicone oil-in-water emulsion was finely generated using the flow control.  #@NEW_LINE#@#  The size of droplets and the generation frequency are tunable by controlling flow rates of dispersed and continuous phases in two channels (QDI and Qoil).  #@NEW_LINE#@#  Six sets of experiments were performed by changing flow rates of water phase and oil phase, respectively (Supplementary Information Text S4, Table S1).  #@NEW_LINE#@#  We used a high-speed camera to record microscopic images at 500 fps for 4 s during each experiment.  #@NEW_LINE#@#  We measured the major axis length of droplets in each combination of water and oil flowrates.  #@NEW_LINE#@#  The size distribution of the droplets was very narrow; in the worst case, s.d./mean was ~0.04; this means that fine droplets can be generated consistently in the presence of fluctuating interface and the existence of droplets in the channel.  #@NEW_LINE#@#  Moreover, the experiment sets follow a scaling law that describes droplet size with respect to flow rates in a T-junction23.  #@NEW_LINE#@#  In addition, when the desired flows were changed from Experiment 1 to Experiment 6, flow rates smoothly converged to the desired flow rates (Fig 5b).  #@NEW_LINE#@#  Supplementary Information Text S4 provides detailed analysis of droplet size with respect to flow rates, and describes an image-processing algorithm to compute size of droplets.  #@NEW_LINE#@#  
In the particle-switching experiment (Fig 6), suspensions of spherical polystyrene particles with 15-m diameter were loaded in the microfluidic chip.  #@NEW_LINE#@#  At the beginning, desired flow rates at channel 2 and 3 were set to 30L/min and 5L/min, respectively.  #@NEW_LINE#@#  Due to the dominance of convective flow to channel 2, particles were transported to that channel (upward).  #@NEW_LINE#@#  The flow direction switched at 1.5s, at which time the transient started.  #@NEW_LINE#@#  After the transient region, particles were transported downward.  #@NEW_LINE#@#  The dominant factor that determines the motion of particles is the drag force of fluid flow, so particles suspended in the fluid can be manipulated by controlling the flow direction.  #@NEW_LINE#@#  Image sequences and its flow responses show this process well (Fig 6).  #@NEW_LINE#@#  
These experiments could be conducted by a pressure pump without the controller, but the controlled system enables consistently stable and accurate responses in the presence of disturbances and parametric uncertainties while maintaining the optimal pressures.  #@NEW_LINE#@#  Therefore, by applying the proposed controller, the accuracy and stability of these applications can be increased regardless of what sort of a microfluidic chip it uses.  #@NEW_LINE#@#  


Discussion  #@NEW_LINE#@#  
Lab-on-a-chip technologies have enabled both high-fidelity and high-throughput investigations of biological systems.  #@NEW_LINE#@#  Accurate and precise regulation of microenvironments for experiment has become increasingly important as the technologies have been expanded24.  #@NEW_LINE#@#  Direct control of flow from external pressure sources is an obvious method to change flow dynamically and temporarily, but was difficult to use due to lack of a control strategy for complex networks11.  #@NEW_LINE#@#  In this study, we provided a robust control algorithm which is applicable to complex microfluidic networks.  #@NEW_LINE#@#  There are many advantages in using the flow control based on pressure sources.  #@NEW_LINE#@#  Firstly, flow induced by a pressure source stabilizes quickly to steady-state, whereas a flow induced by a flow source (syringe pump) stabilizes slowly.  #@NEW_LINE#@#  Secondly, an independent pressure sources connected to inlet ports can simultaneously control multiple-channels.  #@NEW_LINE#@#  Those fast responsiveness and simultaneous controllability enable dynamic flow change that can displace an on-chip valve or pump (such as the Quake groups on-chip pneumatic valve25).  #@NEW_LINE#@#  Thirdly, the system is applicable to rigid microfluidic chips such as thermoplastic or glass because pressure is applied from external sources.  #@NEW_LINE#@#  For the case of the on-chip valve, a rigid microfluidic chip cannot be used because most of on-chip valves and pumps are fabricated by multi-layer soft lithography.  #@NEW_LINE#@#  This absence of a valve function for a rigid chip has troubled the commercialization of lab-on-a-chip devices.  #@NEW_LINE#@#  
We also compared the proposed control algorithm with a conventional PID control scheme for flow control by pressure sources.  #@NEW_LINE#@#  A well-tuned PID control may have better responses than the proposed method but requires tedious and technical tuning for many gains.  #@NEW_LINE#@#  For a Y-junction network that has three channels (two of them controllable), each gain (P, I, D) with respect to each channel (channel 2, 3) should be tuned; i.e., the number of tuning parameters is 3×2=6 and it is hard to be finely tuned in practice.  #@NEW_LINE#@#  If a complex network has 10 channels, the number of tuning parameters is 30.  #@NEW_LINE#@#  In this case, tuning is not practical; this is the main disadvantage of using a PID controller for a microfluidic network.  #@NEW_LINE#@#  In contrast, the proposed controller provides robustness and optimality of control input without such an impractical tuning process.  #@NEW_LINE#@#  
The controller also guarantees robustness to perturbations.  #@NEW_LINE#@#  By applying the controller, the system becomes insensitive to geometrical uncertainties, fluid properties and external disturbances; it enables high-accuracy and high-precision flow regulation regardless of variations, such as cross-sectional shape of the channel, fabrication quality, fluid property, and the presence of environmental fluctuation.  #@NEW_LINE#@#  The insensitivity to the fluid properties means that users do not need to know the exact fluid properties such as fluid viscosity or fluidic capacitances.  #@NEW_LINE#@#  The insensitivity to external disturbances empowers the controller to compensate for undesirable effects such as the tube wobble that commonly occur during experiments; thus, the controller improves the stability of microfluidic experiments which are sensitive to the cellular microenvironment.  #@NEW_LINE#@#  In all regulation experiments performed in the previous section, average steady-state error was less_than0.02L/min and response time was less_than1s.  #@NEW_LINE#@#  
To apply the proposed feedback control scheme, a measurement must be provided to the controller at every time interval.  #@NEW_LINE#@#  Any flow sensor that can reliably measure flow rate can be used in the feedback control system.  #@NEW_LINE#@#  We used a commercial calorimetric low-flow liquid flow meter that estimates flow rate by measuring temperature profile at different two points.  #@NEW_LINE#@#  This flow meter has nanoliter per minute resolution and is appropriate for use in microfluidic devices, but some limitations occur in particle experiments due to accumulation of particles in the sensor capillary.  #@NEW_LINE#@#  Therefore, to ensure that the flow rate feedback is accurate, the device must be cleaned after use to prevent deposition of solids.  #@NEW_LINE#@#  In general, closed-loop responses depend on the resolution of a sensor, so its accuracy must be checked before applying the feedback control.  #@NEW_LINE#@#  
In conclusion, we focused on the development of a robust control algorithm that is easy to use to any researchers for interdisciplinary study.  #@NEW_LINE#@#  The accurate and precise flow control has many potential applications in lab-on-a-chip devices.  #@NEW_LINE#@#  For example, control of pH concentration that is important to regulate cellular environments can be accomplished by the proposed robust flow controller24,26,27,28,29.  #@NEW_LINE#@#  In addition, the cellular environment can also be regulated in time and space by controlling flow over adherent cells4.  #@NEW_LINE#@#  

Methods  #@NEW_LINE#@#  
Construction_of_the_steady-state_gain  #@NEW_LINE#@#  
The steady-state gain matrix Gss is composed of only the network resistances because it only considers steady-state flow without dynamic motion of the fluid flow; this means that the function of Gss is to map input pressures to output steady-state flows.  #@NEW_LINE#@#  If flow rate vector is  and pressure vector is , then Q=Gssp represents the mapping of pressures to flow rates.  #@NEW_LINE#@#  Gss can be obtained by setting s to zero in the full nominal RLC transfer function G(s) (Gss=G(0)).  #@NEW_LINE#@#  However, this approach is a tedious process, and is impractical for use to obtain a full system model.  #@NEW_LINE#@#  Therefore we propose an easier method to construct the steady-state gain by considering an alternative network that consists of only resistances (resistance network).  #@NEW_LINE#@#  
A resistance network is composed of Nc channels, Nn nodes, and Na input ports.  #@NEW_LINE#@#  The continuity condition (Kirchhoffs current law) can be represented as  #@NEW_LINE#@#  
where  and  are constant matrices which represent the relationship of node pressures  and pressures at input ports .  #@NEW_LINE#@#  The pressure drops in the network is represented as  #@NEW_LINE#@#  
where the pressure drop vector  is composed of pressure drops of each channel, and  and  are constant matrices.  #@NEW_LINE#@#  Substituting (10) into (11) yields  #@NEW_LINE#@#  
Finally, the steady-state gain matrix can be obtained by Poiseuille law as follows:  #@NEW_LINE#@#  
where  is a conductance (reciprocal of a resistance) matrix and the matrix  is a network topology matrix that can be obtained using the relationships (10) and (11).  #@NEW_LINE#@#  The steady-state gain is the product of a conductance matrix and a topology matrix (14).  #@NEW_LINE#@#  Using this alternative method, the steady-state gain can be easily constructed.  #@NEW_LINE#@#  This construction method does not require any exact parameters (e.g., resistances, inductances, capacitances); it requires only nominal resistances.  #@NEW_LINE#@#  
As an example, consider the Y-junction network used in the Simulation section.  #@NEW_LINE#@#  R1, R2, and R3 are the nominal resistances of each channel, p1, p2, p3 are pressure sources at the input ports, and pn,1 is pressure at the node.  #@NEW_LINE#@#  Using (10) we can obtain  #@NEW_LINE#@#  
and, using (11) we can also obtain  #@NEW_LINE#@#  
Finally, the steady-state gain matrix can be computed as  #@NEW_LINE#@#  
where .  #@NEW_LINE#@#  A more-complex example is described in the Supplementary Information Text S1.  #@NEW_LINE#@#  

Fabrication_of_the_microfluidic_chips  #@NEW_LINE#@#  
A Y-junction channel was fabricated using soft lithography30.  #@NEW_LINE#@#  A 50-m-thick negative photoresist (KMPR 1025, Microchem, USA) pattern was prepared on a 4-inch silicon wafer using conventional photo-lithography to be used as a mold for the micro-channel structure.  #@NEW_LINE#@#  The PDMS base and curing agent (Sylgard 184 A/B, Dow Corning, USA) were mixed at 10:1 ratio, degassed, cast on the photoresist mold and cured at 100°C for 15min.  #@NEW_LINE#@#  After curing, the PDMS channel was detached from the mold and a biopsy punch was used to create access holes as the inlets and outlets of the channel.  #@NEW_LINE#@#  The PDMS channel was then bonded onto a slide glass using oxygen plasma treatment.  #@NEW_LINE#@#  Finally, the access holes were connected to external tubing (Tygon ND 100-80, Saint-Gobain, France) with pipette tips (T-300, Axygen Scientific, USA).  #@NEW_LINE#@#  Deionized water, isopropyl alcohol and silicone oil (OS-30, Dow corning, USA) were used as the controlled fluid and 15m spherical particles (Sigma-Aldrich, USA) diluted in deionized water were used in the particle-flow switching experiment.  #@NEW_LINE#@#  

Implementation_of_the_controller  #@NEW_LINE#@#  
The external system to implement the proposed control algorithm consists of a pressure regulator and flow sensor (MFCS-EZ, Fluigent, France).  #@NEW_LINE#@#  The pressure regulator applies desired input pressures to sample reservoirs, which are connected to inlets and outlets of the micro-channel.  #@NEW_LINE#@#  The flow sensor was placed in the middle of connection tubes to measure the flow rates in them.  #@NEW_LINE#@#  The measured flow rate was sent to a computer and used as a feedback signal.  #@NEW_LINE#@#  The computer used the control algorithm to calculate the control input and sent it to the pressure regulator in real time.  #@NEW_LINE#@#  See Supplementary Information Text S1 for the implementation pseudo-code.  #@NEW_LINE#@#  




