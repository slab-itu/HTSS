article id="http://dx.doi.org/10.1038/srep39877"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
In-silico experiments of zebrafish behaviour: modeling swimming in three dimensions  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
Zebrafish is fast becoming a species of choice in biomedical research for the investigation of functional and dysfunctional processes coupled with their genetic and pharmacological modulation.  #@NEW_LINE#@#  As with mammals, experimentation with zebrafish constitutes a complicated ethical issue that calls for the exploration of alternative testing methods to reduce the number of subjects, refine experimental designs, and replace live animals.  #@NEW_LINE#@#  Inspired by the demonstrated advantages of computational studies in other life science domains, we establish an authentic data-driven modelling framework to simulate zebrafish swimming in three dimensions.  #@NEW_LINE#@#  The model encapsulates burst-and-coast swimming style, speed modulation, and wall interaction, laying the foundations for in-silico experiments of zebrafish behaviour.  #@NEW_LINE#@#  Through computational studies, we demonstrate the ability of the model to replicate common ethological observables such as speed and spatial preference, and anticipate experimental observations on the correlation between tank dimensions on zebrafish behaviour.  #@NEW_LINE#@#  Reaching to other experimental paradigms, our framework is expected to contribute to a reduction in animal use and suffering.  #@NEW_LINE#@#  

Introduction  #@NEW_LINE#@#  
Experimental studies with animal subjects face ethical issues that demand the exploration of alternative approaches to reduce the number of subjects, refine experimental designs, and replace the use of live animals (3Rs)1.  #@NEW_LINE#@#  While animal studies are the ultimate cornerstone against which new hypotheses should be tested, computer simulations, or in-silico experiments, constitute a powerful tool in preclinical research.  #@NEW_LINE#@#  In-silico experiments could be used to: (i) gather preliminary evidence in favour or against a specific hypothesis through systematic pilot trials on the computer2; (ii) achieve statistical power in an animal study via careful selection of the number of trials, independent and dependent variables, and frequency of measurement3; and (iii) reinforce the scientific merit of existing observations through comparison against synthetic data and statistical analysis informed by modelling insight4,5,6,7.  #@NEW_LINE#@#  
In recent years, we have witnessed a surge in the number of in-silico experiments, including molecular biology8, genetic assays9, tumour growth10, dermatology11, bone remodelling12, organ failure13, and toxicology14.  #@NEW_LINE#@#  These studies have helped build thrust in the potential of in-silico experiments and develop a strong link between simulations and experiments, which are more often coupled in new preclinical studies.  #@NEW_LINE#@#  However, the use of computer simulations in behavioural neuroscience has been limited, partly due to the complexity of animal behaviour and partly because of the unavailability of refined three-dimensional (3D) data needed to calibrate and validate mathematical models underlying such simulations15,16,17,18,19,20.  #@NEW_LINE#@#  
Although animal research has mainly focused on rodents21 and primates22, zebrafish (Danio rerio) are attaining popularity for both technical and economic reasons.  #@NEW_LINE#@#  Zebrafish are genetically similar to humans, especially with respect to diseases23,24, where a strong genetic similarity is found25.  #@NEW_LINE#@#  Zebrafish embryos and larvae are transparent, which afford the possibility of monitoring inflammatory processes and indicators of disease without surgery24.  #@NEW_LINE#@#  Further, unlike mammalian animal models, zebrafish can be bred in large numbers26, have a short inter-generation time27, and can be stocked at high densities24.  #@NEW_LINE#@#  These factors are fuelling intensive research in zebrafish behavioural phenotyping, whereby locomotory patterns are continuously being identified and categorized to create a comprehensive catalogue to aid in measuring zebrafish behaviour28, for use in neurobehavioural research.  #@NEW_LINE#@#  
A large number of experimental protocols have been proposed to investigate zebrafish behaviour, often borrowing from murine models.  #@NEW_LINE#@#  For example, classical choice29, place preference30, open field31, and light/dark preference tests32 have been successfully used to investigate the neurobiological basis of social behaviour, study fear and anxiety, and explore the effect of psychoactive compounds and genetic manipulations33,34,35,36.  #@NEW_LINE#@#  In these experiments, zebrafish behaviour is measured in terms of locomotory patterns that are typically scored from labour intensive manual observations and seldom using automated computer tracking.  #@NEW_LINE#@#  Only recently, technical breakthroughs in automated tracking have enabled the complete reconstruction of zebrafish swimming in 3D17,37,38,39,40.  #@NEW_LINE#@#  In-silico experiments may significantly contribute to the design of new test batteries, by enabling the systematic analysis of dependent and independent variables while isolating key experimental factors that may act as confounds during testing.  #@NEW_LINE#@#  Further, in-silico experiments may be used to identify false positives and negatives, by providing an empirically-based ground truth on which to contextualize new experimental observations41,42.  #@NEW_LINE#@#  
The first computational model of zebrafish swimming has been proposed by our group in refs 43, 44, 45 and 46.  #@NEW_LINE#@#  In this series of studies, we have proposed a data-driven modelling framework to predict the turn rate dynamics and speed modulation of zebrafish swimming in a shallow water tank.  #@NEW_LINE#@#  To capture the burst-and-coast swimming style of zebrafish, where sporadic bursts of the tail are followed by coasting phases without tail beating47,48, we have proposed the use of jump processes, often employed in financial engineering to model extreme events in the time evolution of assets prices49,50.  #@NEW_LINE#@#  Specifically, in refs 43, 44, the turn rate dynamics of zebrafish is described through a mean reverting stochastic process that incorporates jumps.  #@NEW_LINE#@#  The jump persistent turning walker (JPTW) accounts for the sudden and fast turns observed in the yaw rate of zebrafish swimming.  #@NEW_LINE#@#  In ref.  #@NEW_LINE#@#  46, we have contemplated the possibility of speed modulation during in-plane manoeuvring, where fish slow down their motion when turning.  #@NEW_LINE#@#  This modelling framework has been recently extended to study social behaviour in ref.  #@NEW_LINE#@#  45 by demonstrating the role of speed modulation in regulating collective dynamics of a shoal of zebrafish.  #@NEW_LINE#@#  Using a similar approach based on stochastic processes, a recent study51 has simulated zebrafish orientation within a kinematic model, by sampling from a probability density function that accounts for a spherical visual perception field.  #@NEW_LINE#@#  These models, built and calibrated on 2D datasets, are expected to suffer from the same limitations that are attributed to 2D behavioural analysis, including unrealistic representation of swimming activity and novelty seeking behaviour17; incomplete characterization of stress-related behaviours, such as thigmotaxis and geotaxis28; and limited comparability of different experimental assays due to unmeasured variations in depth17.  #@NEW_LINE#@#  
Here, we present a new 3D model for zebrafish swimming, extending our previous work to three dimensions and encapsulating wall interaction and speed modulation.  #@NEW_LINE#@#  We model both yaw and pitch rates as JPTW, and we treat speed as a mean reverting square process52.  #@NEW_LINE#@#  Wall avoidance is modelled as a decaying function of time to collision53,54, and is further adapted to include collision avoidance at high speeds.  #@NEW_LINE#@#  Model parameters are calibrated with 3D trajectory data of adult zebrafish swimming in a parallelepipedal tank with a rectangular base for 10minutes38.  #@NEW_LINE#@#  Model validation is performed by conducting a simulation study and comparing speed and indirect behavioural measures, such as positional preference along the horizontal and vertical directions, with experimental observations.  #@NEW_LINE#@#  To further evaluate if our model can be used to contribute to replacement and reduction, we conduct a second simulation study, investigating the effect of tank dimensions on zebrafish behaviour.  #@NEW_LINE#@#  We systematically vary the tank dimensions for 60 combinations of length, width, and height, and compare our results with data collated from the literature.  #@NEW_LINE#@#  We demonstrate the use of in-silico experiments in a prospective study, which would require thousands of subjects and months of experiments to explore the parameter space utilized in our numerical simulations.  #@NEW_LINE#@#  

Results  #@NEW_LINE#@#  
First_in-silico_experiment_for_model_calibration  #@NEW_LINE#@#  
Position distribution from the top view over all of 10 trials show that fish explore all sections of the tank with a marked preference for the corners and side walls of the tank (Fig 1(a)).  #@NEW_LINE#@#  The lack of symmetry in the density along the tank width is related to the fact that the front portion of the tank is not covered with contact paper to enable tracking using the front camera.  #@NEW_LINE#@#  The front view indicates a similar exploratory behaviour along the depth of the tank (Fig 1(c)) with more time spent near the side walls.  #@NEW_LINE#@#  Model predictions yield a response that is qualitatively similar to experimental observations, with larger density toward the walls (Fig 1(b)).  #@NEW_LINE#@#  
However, the model does not anticipate the wall preference observed in the experimental data.  #@NEW_LINE#@#  Different from experiments, where fish tend to prefer the clear side of the tank to the side covered with contact paper, simulation results show no such preference for a particular side (Fig 1(d)).  #@NEW_LINE#@#  This is because the model implements the same interaction rule on each side.  #@NEW_LINE#@#  Along the front view simulation results do not reproduce preference to the smaller sides or to the water surface which is different from tank bottom (Fig 1(d)).  #@NEW_LINE#@#  
Experimental results show that speed distribution within the tank is asymmetric along the tank plane (Fig 2(a)) with fish swimming at a higher speed near the side walls and the front wall, which is open for the camera to record.  #@NEW_LINE#@#  An asymmetry in experimental data is also visible along tank depth with higher speeds near the water surface (Fig 2(c)).  #@NEW_LINE#@#  Simulation results (Fig 2(b) and (d)) are in agreement with experimental observations, whereby they predict larger speeds in the vicinity of the walls.  #@NEW_LINE#@#  Different from experiments, simulation results do not differ along the front wall, as the model implements the same interaction rule on each wall.  #@NEW_LINE#@#  In terms of individual motion characteristics, Fig 3 compares a sample trajectory of a live fish with a simulated fish, offering evidence for the model ability to replicate the sharp turn associated with avoidance manoeuvres and the fragmented tracks within the bulk of the tank.  #@NEW_LINE#@#  
Figures 4, 5 and 6 compare the behavioural response between live and simulated fish using a non-parametric Kruskal-Wallis test to examine the null hypothesis that the values are sampled from different distributions with different median.  #@NEW_LINE#@#  Figure 4 displays experimental observations and model predictions on fish activity, measured through the average speed.  #@NEW_LINE#@#  Specifically, we find that model predictions are not significantly different from experimental data (2(1)=0.8229, p=0.3643).  #@NEW_LINE#@#  
Figure 5 presents a detailed comparison between experimental data and model predictions on fish spatial preference along the water tank.  #@NEW_LINE#@#  The model is successful in anticipating the time budgeting along the water column, whereby simulation data and experiments are similar (time spent in the top third: 2(1)=0.0229, p=0.8798 and time spent in the bottom third: 2(1)=0.0229, p=0.8798).  #@NEW_LINE#@#  The number of entries predicted by the model is also statistically equivalent to experimental observations (number of entries in the top third: 2(1)=0.1169, p=0.7324 and number of entries in the bottom third: 2(1)=0.1450, p=0.7033).  #@NEW_LINE#@#  
Finally, Fig 6 offers validation for the model capability to anticipate fish positional preference along the length of the tank.  #@NEW_LINE#@#  In line with all the previous comparisons, model predictions are found to be statistically indistinguishable from experimental data (time spent in the lateral sides: 2(1)=1.12, p=0.2899 and number of entries in the lateral sides: 2(1)=0.2808, p=0.5961).  #@NEW_LINE#@#  

Second_in-silico_experiment_for_model_evaluation  #@NEW_LINE#@#  
Our simulation results presented in Fig 7 suggest that fish speed is an increasing function of the tank planar dimensions across different depths.  #@NEW_LINE#@#  Specifically, using a GLM analysis, fish speed is correlated to tank width for all the tested aspect ratios, namely, 0.25 (Dispersion=0.160, F1,13=15.8, pless_than0.01), 0.5 (Dispersion=0.247, F1,13=6.49, p=0.0243), 0.75 (Dispersion=0.222, F1,13=19.8, pless_than0.01), and 1 (Dispersion=0.145, F1,13=41.6, pless_than0.01).  #@NEW_LINE#@#  By aggregating the simulation data with respect to the total surface area (Fig 8), we find a strong correlation between the logarithm of the total surface area and the average speed (Dispersion=0.168, F1,58=94.4, pless_than0.01).  #@NEW_LINE#@#  By performing the same analysis on experimental data from Table 1, we uncover a similar, albeit weaker, trend between the average speed and the total surface area (Dispersion =2.01, F1,30=27.4, pless_than0.01).  #@NEW_LINE#@#  Although the GLM analysis shows a higher dispersion in experimental data compared to simulation results, the slope is also steeper.  #@NEW_LINE#@#  Thus, experimental data indicate the presence of a stronger effect than computational predictions.  #@NEW_LINE#@#  


Discussion  #@NEW_LINE#@#  
In cellular and molecular biology, mathematical models of regulatory networks, supported by high-throughput data collection, have enabled the seamless integration of computer simulations and experimental research8,11,12,13,14.  #@NEW_LINE#@#  Benefits of an in-silico approach include: the possibility of setting up advanced starting points for testing novel hypotheses; speeding up the validation of challenging propositions; and putting forward a direct, tangible opportunity to reduce the extent of animal use.  #@NEW_LINE#@#  A necessary step toward bringing such benefits to the field of animal behaviour is the formulation of mathematical models that can faithfully reconstruct animal locomotion of individuals53, which in turn better informs collective motion models55,56,57.  #@NEW_LINE#@#  In the case of zebrafish, a model organism for preclinical studies, a comprehensive catalogue of observed behaviours28 and high-volume datasets from the literature17,37,38,39,40 make a compelling case for the development of a framework to support in-silico experiments.  #@NEW_LINE#@#  
An accurate model that is able to robustly reproduce the full catalogue of zebrafish behaviours is far from accomplished.  #@NEW_LINE#@#  Instead, we describe here a model that conforms to basic zebrafish locomotory patterns in 3D, laying the foundations for in-silico zebrafish experiments.  #@NEW_LINE#@#  We extend our previous approach43,44 of using jump diffusion stochastic processes to reproduce segments of zebrafish turning motion in 2D to a more realistic scenario, where fish swim in 3D adjusting their speed and interacting with the tank walls throughout an entire experiment.  #@NEW_LINE#@#  Comparison with experimental data demonstrates that our model is successful in qualitatively reproducing zebrafish swimming behaviour, and quantitatively predicting activity and positional preference, in terms of average speed, time budgeting, and number of entries in longitudinal and transversal sections of the tank.  #@NEW_LINE#@#  Visual differences in positional preference and activity are likely due to complex interactions with clear tank walls, water surface, and tank bottom, as well as difference in interactions due to wall size.  #@NEW_LINE#@#  The model consists of 16 parameters, which are calibrated from complete experimental trajectories of zebrafish swimming in 3D.  #@NEW_LINE#@#  Although the parameter space is large, the identification procedure is relatively robust, as evidenced by the limited variability in model parameters across the nine subjects considered in the experiment.  #@NEW_LINE#@#  Also, by automatically isolating instances when fish interact with the wall, the procedure is effectively partitioned in two consequent steps, reducing the number of parameters to be determined at once.  #@NEW_LINE#@#  Model parameters indicate that yaw and pitch rate parameters, such as the relaxation rate and variability have similar values.  #@NEW_LINE#@#  This is because the fish orientation is defined in the tank inertial frame, and turning up towards the water surface sideways may be interpreted as pitching in the inertial frame.  #@NEW_LINE#@#  On the other hand, jump intensity in the pitching direction is higher than that in the yaw direction, which is likely caused by stress-related behaviour in experimental subjects17,35,58,59.  #@NEW_LINE#@#  In a novel environment, zebrafish have been shown to repeatedly change their swimming depth40,60,61, which in our model is associated with the jump process in the pitch direction.  #@NEW_LINE#@#  
The potential of the model to complement empirical research is demonstrated through in-silico experiments that seek to understand the effect of tank dimensions on zebrafish activitya study which would otherwise require thousands of animals and multiple experimental setups.  #@NEW_LINE#@#  These computational experiments reveal that the average speed of zebrafish should increase with all of the tank dimensions.  #@NEW_LINE#@#  By aggregating data with respect to the overall tank surface, we find a strong correlation with the average speed.  #@NEW_LINE#@#  A correlation between the tank surface and average speed is also evidenced from experimental data collated from the literature, even though the slope of the correlation is different from the simulation data.  #@NEW_LINE#@#  While it is likely that fish activity is influenced by a number of factors that are not constant across the collated dataset, such as illumination62 and habituation time63,64, we could explain the observed correlation between speed and surface area through two different reasons.  #@NEW_LINE#@#  First, fish speed may increase due to fewer instances of boundary avoidance as the tank size increases.  #@NEW_LINE#@#  Second, speed may increase due to thigmotaxis61, produced by thrashing or escape behaviours along the tank walls and corners28.  #@NEW_LINE#@#  This stress-related behaviour may be accompanied by high accelerations28, which would, in turn, result into a larger average speed.  #@NEW_LINE#@#  
In its present incarnation, our model appears to weight the second possibility more than the first.  #@NEW_LINE#@#  This is also evident from the speed distribution plots of simulated data, which suggest increasing speeds in the vicinity of the side walls, bottom wall, and free surface.  #@NEW_LINE#@#  Indeed, our model explicitly captures fish positional preference for walls and corners in the wall interaction function.  #@NEW_LINE#@#  However, our model does not directly encode for the first possibility, namely increased speed due to fewer encounters.  #@NEW_LINE#@#  This behaviour could be directly related to increased exploratory tendency in real fish, leading to higher average speeds59 for larger tanks size, and thus the steeper slope observed in the experimental data.  #@NEW_LINE#@#  Encoding such behaviours within our model may likely be accomplished by setting model parameters such as relaxation rate or wall avoidance as a function of tank dimensions.  #@NEW_LINE#@#  The nature of this dependence, however, will require detailed experiments that allow an accurate and reliable calibration of the model.  #@NEW_LINE#@#  Future work will focus on further validating this claim through new experiments with a wider range of tank sizes, and investigating the dependency of the model on other experimental factors, such as varying illumination62 and habituation time63,64, which could influence the observed correlation.  #@NEW_LINE#@#  
An approach similar to modelling wall interaction could be utilized to describe response to external stimuli, such as drawing towards novel objects or light, avoidance of predators, alarm reactions to sudden threats, and shoaling toward conspecifics.  #@NEW_LINE#@#  For example, with respect to shoaling behavior, the present model would be used to represent the individual dynamics of each zebrafish, interacting as a networked dynamical system.  #@NEW_LINE#@#  The network of interactions would then be based on relative orientation and position, with weights associated with each cue that can be calibrated using experimental data building on existing models for fish interactions in 2D53,65.  #@NEW_LINE#@#  The model could also be expanded to encapsulate innate behaviours, such as home-base behaviour and habituation64.  #@NEW_LINE#@#  Home-base behaviour may be integrated into the model by including preference for the initial region of the environment that decays as a function of time, with the rate of decay calibrated on the basis of actual experiments.  #@NEW_LINE#@#  Habituation, which manifests as a time effect in fish behaviour as it enters a new environment63,64, could entail creating a virtual, tighter boundary within the environment that expands to the full tank size as time progresses.  #@NEW_LINE#@#  
The model may also be expanded to describe the effect of psychoactive compounds, through a controlled dependence of model parameters on pharmacological treatment.  #@NEW_LINE#@#  For example, in the context of the 2D JPTW, we have demonstrated in ref.  #@NEW_LINE#@#  44 that alcohol treatment controls both relaxation rate and jump intensity.  #@NEW_LINE#@#  In the proposed 3D model, the effect of ethanol should also manifest in the speed modulation and wall interaction.  #@NEW_LINE#@#  As ethanol concentration is varied, zebrafish should modify their swimming style, since both the tail-beat amplitude and the tail-beat frequency have been shown to robustly decrease for high ethanol concentrations66.  #@NEW_LINE#@#  As a result, the parameters describing the instantaneous change in fish speed and the coupling with the turn rate dynamics should be adjusted as a function of ethanol concentration.  #@NEW_LINE#@#  The parameters related to the interaction with the wall should depend on ethanol concentration, whereby exposure to intermediate concentrations have been shown to reduce wall interaction, while higher concentration could influence the extent of the interaction67.  #@NEW_LINE#@#  
Creating the scientific and technical knowledge for affording comprehensive in-silico experiments on zebrafish will require a systems-level approach68.  #@NEW_LINE#@#  This entails not only identifying and modelling individual behaviours, but also understanding how one behaviour may lead to another.  #@NEW_LINE#@#  For example, habituation may lead to reduced activity and exploration, and interaction may lead to increased sociality.  #@NEW_LINE#@#  The proposed model should be considered as a first necessary step toward in-silico research.  #@NEW_LINE#@#  Among the several directions that will be pursued to improve model capability, zebrafish response to conspecifics is perhaps most promising, as it will require augmentation of data-driven response functions45,53 in 3D, to immediately test social behaviour.  #@NEW_LINE#@#  
Recent years have witnessed sustained movements that strenuously advocate the respectful treatment and welfare of animals in laboratory research.  #@NEW_LINE#@#  With approximately twenty million animals used in research and testing annually, policy-makers, citizens, and scientific authorities alike yearn for alternative approaches, while retaining the fundamental instrument of scientific investigation and the improvement of human health.  #@NEW_LINE#@#  Here, we have proposed the systematic integration of computer modelling as a new, unprecedented means to complement preclinical research on animal behaviour, focusing on the zebrafish-animal-model.  #@NEW_LINE#@#  While our simulations cannot replace in-vivo experiments, they can constitute an economical (time and budget-wise) complement to inform new experimental design and engineering approaches69,70,71,72, along with the definition of mathematically grounded measurable parameters73,74,75,76, leading to a consistent reduction of experimental subjects.  #@NEW_LINE#@#  

Materials_and_Methods  #@NEW_LINE#@#  
We begin by formulating the model for the time evolution of the yaw rate, pitch rate, and speed, all of which are assumed to be coupled.  #@NEW_LINE#@#  Environmental interactions with the boundariestank walls, tank bottom, and water surfaceare incorporated into the yaw and pitch rates in the form of avoidance reactions.  #@NEW_LINE#@#  We then detail the experimental data used to calibrate the 3D model, followed by model calibration where individual parameters are estimated using maximum likelihood estimation (MLE).  #@NEW_LINE#@#  
Ethics_statement  #@NEW_LINE#@#  
The data used in this paper are obtained from the control condition of trajectory dataset published in ref.  #@NEW_LINE#@#  38.  #@NEW_LINE#@#  The experimental methods in ref.  #@NEW_LINE#@#  38 were performed in accordance with the relevant guidelines and regulations, and were approved by the University Animal Welfare Committee of New York University under protocol number 131424, and the Animal Welfare Oversight Committee of the Polytechnic Institute of New York University (now New York University Tandon School of Engineering which was independent from New York University until 2013 with respect to animal care) under protocol number AWOC-2013-103.  #@NEW_LINE#@#  

Modelling_zebrafish_motion_in_3D  #@NEW_LINE#@#  
Fish yaw rate in the tank frame (Fig 9) is modelled as a jump persistent turning walker (JPTW), following our previous work on zebrafish 2D swimming in shallow water tanks43.  #@NEW_LINE#@#  Briefly, the instantaneous variation at time t of the yaw rate, dt (rad s1), is described as the sum of a deterministic term, which quantifies the deviation from a desired value, and two stochastic terms, which represent variability in the yaw rate in the form of increments of a Wiener process and intermittent large turns in the yaw direction in the form of a jump process.  #@NEW_LINE#@#  Specifically, the JPTW for the yaw rate reads  #@NEW_LINE#@#  
where (s1) is the relaxation rate at which the yaw tends to reach the desired value f, which encapsulates wall interaction;  is the standard Wiener process, whose time increment is a Gaussian with variance equal to dt; (rad s3/2) is a weighting parameter used to scale the Wiener process; and  is the yaw rate jump process.  #@NEW_LINE#@#  
We model the wall interaction f as a decaying function following the approach in ref.  #@NEW_LINE#@#  54, and parametrize this function with the time to collision53.  #@NEW_LINE#@#  Denoting by  (rad) the angle between the normal to the projected wall point of impact and the fish heading vector projected on the horizontal plane, the wall interaction function is  #@NEW_LINE#@#  
where sgn() is the sign function; kW0 characterizes the intensity of the wall interaction; wa(s1) is a non-negative parameter that captures the tendency to follow the wall; and t (s) is the time to collision, estimated as the time it takes for the fish to reach the wall at its current velocity.  #@NEW_LINE#@#  Note that the wall interaction function depends on the time t through both  and t. As such, the simulated fish turns away from the wall with higher intensity as the time-to-collision approaches zero, and for large values, the time-to-collision does not affect fish swimming.  #@NEW_LINE#@#  The wall interaction function (2) differs from the one proposed in ref.  #@NEW_LINE#@#  53 in terms of the second summand kWwacos , which is included to describe wall following or thigmotaxis, a commonly observed behaviour in zebrafish28.  #@NEW_LINE#@#  
Similar to ref.  #@NEW_LINE#@#  43, the yaw rate jump process, , is modelled as  #@NEW_LINE#@#  
Here, , for j=1, 2, , are independent and identically distributed (i.i.d.)  #@NEW_LINE#@#  Gaussian random variables with zero mean and standard deviation equal to  () and  is a counting process defined such that, for time rt,  is a Poisson random variable with parameter (tr).  #@NEW_LINE#@#  The parameters  (rad s1) and  (s1) measure the severity and frequency of the jumps in the yaw rate.  #@NEW_LINE#@#  
Fish pitch rate in the tank frame (Fig 9) is also modelled as a JPTW, since zebrafish pitch rate can reach values beyond three times the standard deviation with arrival time following an exponential distribution (Fig 10).  #@NEW_LINE#@#  The instantaneous change in pitch rate dt is thus modelled as  #@NEW_LINE#@#  
Here, (s1) is the relaxation rate in reaching the desired value f, which captures the tendency to avoid boundaries along the tank depth, that is, tank bottom surface and water surface;  is the standard Wiener process, which is weighted by the pitch rate variability (rad s3/2); and  is the pitch rate jump process.  #@NEW_LINE#@#  
Similar to boundary avoidance in the yaw rate, boundary avoidance along tank depth, f is parameterized by the time to collision t and the angle between the normal to the projected boundary point of impact and the fish heading vector projected on the vertical plane oriented along the tank depth  #@NEW_LINE#@#  
where kW0 and wa are defined in Eq (2).  #@NEW_LINE#@#  To reduce the number of parameters in the proposed model, we describe the interaction with the bottom wall and the free surface through the same parameters used for the side walls interaction.  #@NEW_LINE#@#  
Similar to the yaw, the pitch jump process is also modified to avoid collisions beyond a critical time by forcing a jump as  #@NEW_LINE#@#  
where , for j=1, 2, , are i.i.d.  #@NEW_LINE#@#  Gaussian random variables with zero mean and standard deviation , and  is a counting process defined such that, for time rt,  is a Poisson random variable with parameter (tr).  #@NEW_LINE#@#  
Fish speed is found to vary about an average mean value while always staying positive (Fig 11).  #@NEW_LINE#@#  We therefore model instantaneous change in fish speed, t(cm s1) as a Cox-Ingersoll-Ross process52  #@NEW_LINE#@#  
Here, (s1) is the adjustment rate controlling the rate at which fish speed reverts to its long term average value (cm s1); f=f(t, t) is a scaling function of ; and  is a standard Wiener process weighted by the speed volatility (cm1/2 s1).  #@NEW_LINE#@#  Different from Eqs (1) and (4), the Wiener process is weighted by the state variable, whereby we multiply the speed volatility by the square root of the speed.  #@NEW_LINE#@#  This allows for scaling the Wiener process proportionally to the instantaneous speed, ensuring that the speed is always nonnegative, provided that the remaining model parameters satisfy 2()2.  #@NEW_LINE#@#  The scaling function f is defined such that  #@NEW_LINE#@#  
where A(s1) is a positive parameter to be determined.  #@NEW_LINE#@#  This functional dependence ensures that the speed decreases with the pitch and yaw rate, whereby the fish is expected to reduce its speed when undertaking a manoeuvre in either the vertical or horizontal plane.  #@NEW_LINE#@#  The stochastic differential equations Eqs (1), (4) and (7) define the proposed 3D model of zebrafish swimming.  #@NEW_LINE#@#  
Beyond the coupling through the function f in Eqs (7) and (8), we assume that speed, pitch rate, and yaw rate processes are pairwise linearly correlated via the corresponding stochastic terms77.  #@NEW_LINE#@#  The proposed correlation structure is  #@NEW_LINE#@#  
where  is the correlation coefficient between the speed and the pitch rate Wiener processes;  is the correlation coefficient between the speed and the yaw rate Wiener processes; Based on experimental data where absence or low correlation is observed between yaw and pitch rate, we hypothesize no correlation between pitch and yaw rates, and between the speed Wiener process and the pitch and yaw rate jumps, that is,  #@NEW_LINE#@#  

Model_calibration  #@NEW_LINE#@#  
The experimental dataset of 3D zebrafish swimming used to calibrate the model is described first, followed by our approach for parameter estimation, which is a combination of MLE and locally weighted regression.  #@NEW_LINE#@#  Next, we present the discrete form of the 3D fish swimming dynamics that is utilized to simulate trajectories.  #@NEW_LINE#@#  Finally, we detail the in-silico experiments that are used to validate and evaluate the proposed model.  #@NEW_LINE#@#  

Experimental_dataset_for_model_calibration  #@NEW_LINE#@#  
We calibrate the model using a subset of the dataset collected as part of an earlier study38.  #@NEW_LINE#@#  Specifically, the data comprises of 3D trajectories of 10 experimentally naive zebrafish, filmed one at a time, in a 56×30×30×cm compartment within a 76×30×30×cm glass tank (Fig 12) for 10minutes each after 10minutes of habituation.  #@NEW_LINE#@#  The 56cm length compartment was separated from two side regions, 10cm in length each, with a glass partition.  #@NEW_LINE#@#  The water depth in the tank was maintained at 26cm.  #@NEW_LINE#@#  The zebrafish were filmed using two camera arranged to view the top and front side of the tank thus obtaining orthogonal views.  #@NEW_LINE#@#  The tank surface on four sides, where camera view was not required was covered with white contact paper for increased contrast during tracking.  #@NEW_LINE#@#  A custom tracking system was utilized to obtain horizontal and vertical trajectories of fish swimming which were then merged to form three-dimensional trajectory data.  #@NEW_LINE#@#  Additional details on the experimental procedure and the tracking algorithm can be found in ref.  #@NEW_LINE#@#  38.  #@NEW_LINE#@#  
Fish 3D position data was filtered using a Daubechies wavelet filter78 to remove body movement due to tail-beat motion54.  #@NEW_LINE#@#  Similar to refs 43, 54, the curvature of the fish centroid trajectory was utilized to estimate the time trace of fish speed, pitch rate, and yaw rate.  #@NEW_LINE#@#  Stress-related measures, including freezing and thrashing, were computed automatically from the trajectory data79.  #@NEW_LINE#@#  A single trial where fish was found to freeze more than 70% of the time was discarded from the analysis, reducing the total number of trials to nine.  #@NEW_LINE#@#  

Parameter_estimation  #@NEW_LINE#@#  
The full 3D swimming model excluding boundary avoidance consists of 16 parameters denoted by =(, , , P).  #@NEW_LINE#@#  These include: four independents parameters and two identical parameters each for yaw rate =(, , , , kW, wa) and pitch rate =(, , , , kW, wa) ; four independent parameters for speed =(, , , A); and two correlation coefficients .  #@NEW_LINE#@#  Model parameters were estimated using MLE with a discrete time Euler approximation80.  #@NEW_LINE#@#  Denoting the time index by k=1, 2, , where tktk1=t (s), the discrete forms of Eqs (1), (4) and (7) are  #@NEW_LINE#@#  
Similar to ref.  #@NEW_LINE#@#  43, we hypothesize that a single jump occurs at most in a time step and accordingly, approximate the jump processes (kt) and (kt) by Bernoulli random variables with parameters t, and t respectively.  #@NEW_LINE#@#  In Eqs (14), (15) and (16), (k), (k) and (k) are all correlated Gaussian random variables.  #@NEW_LINE#@#  
We estimate the model parameters separately for fish swimming near the boundary and far from it.  #@NEW_LINE#@#  Specifically, we partition the fish trajectory data based on the distance from the wall, where position data further from 2 body-lengths (BL) 6cm of the wall is considered to be not affected by the wall interaction response.  #@NEW_LINE#@#  This threshold of 2BL represents a rounded up value for measuring zebrafish peripheral activity61,81.  #@NEW_LINE#@#  Accordingly, we first estimate the fish state at time index k denoted by X(k)=[(k), (k), (k)]T, and at k1 without the boundary avoidance functions as .  #@NEW_LINE#@#  Using the above notation, the fish discrete state X(k) admits the following distribution:  #@NEW_LINE#@#  
where  and , with 0=[0, 0, 0]T being the 3D null vector, and the covariance matrices for Wiener process, , and jump processes, , are  #@NEW_LINE#@#  
with  #@NEW_LINE#@#  
and  #@NEW_LINE#@#  
We introduce the system augmented covariance matrix , assumed positive definite, as  #@NEW_LINE#@#  
where  and  are equal to 1 when a jump occurs in the pitch or yaw rates respectively, and 0 otherwise.  #@NEW_LINE#@#  Using this augmented covariance matrix, the likelihood probability density function for the state of the fish at a given time index k is  #@NEW_LINE#@#  
where  is the probability of a jump to occur in either pitch or yaw turn rate and det() is the matrix determinant.  #@NEW_LINE#@#  Considering a given 3D time series of zebrafish speed, pitch, and yaw turn rates , where T is the length of the dataset, model calibration is performed by maximizing the log-likelihood function50  #@NEW_LINE#@#  
The MLE is implemented using the non-linear constraint algorithm available in the optimization toolbox of MATLAB (R2015a; MathWorks, Natick, Massachusetts, USA)82.  #@NEW_LINE#@#  To initialize and reduce the size of the large parameter set, three separate likelihood functions, corresponding to the three stochastic differential equations associated with, yaw rate, pitch rate, and speed, are utilized to estimate the values of a subset of the parameter set, consisting of the 11 independent parameters, with no correlation.  #@NEW_LINE#@#  Next, these values are used as initial values to maximize the 3D likelihood function in Eq (30).  #@NEW_LINE#@#  Table 2 lists the average value of estimated parameters.  #@NEW_LINE#@#  The full set of calibrated model parameters for each fish are available in the supporting information.  #@NEW_LINE#@#  
For wall interaction functions f and f, regression fits are unable to capture two behaviours: wall interaction with low times-to-collision during which the fish performs a jump manoeuvre to prevent a collision, and wall following28.  #@NEW_LINE#@#  While simulating wall interaction with jumps require further complexity in the form of additional jump term, wall following is likely not captured due to the fit performed on trajectories.  #@NEW_LINE#@#  Specifically, trajectories will be rendered discontinuous due to specific threshold used to partition them into free swimming or wall interaction.  #@NEW_LINE#@#  In reality, this threshold may not be even a constant value.  #@NEW_LINE#@#  Accordingly, an instance of wall following may be captured in the form of two different collision avoidance manoeuvres if the fish swims beyond the assigned threshold even once.  #@NEW_LINE#@#  
During our simulations we found that we can achieve both these behaviours by increasing the value of kW.  #@NEW_LINE#@#  Accordingly, we select the value of kW=2.33 for wa=0.88 s1.  #@NEW_LINE#@#  The parameter A for the scaling function f is estimated in two steps by utilizing a locally weighted regression to estimate the decay function of the absolute turn rate and the speed, and by applying a simple linear regression to approximate the decay rate which is averaged to 2.92 for the 9 fish datasets.  #@NEW_LINE#@#  

Simulation_of_fish_trajectories  #@NEW_LINE#@#  
Fish are simulated using Eqs (14), (15) and (16), that is, by Euler integrating the stochastic differential equations to obtain fish heading velocity at each time step.  #@NEW_LINE#@#  In particular, identifying fish position at k as  and its orientation in 3D through the azimuth (k)[, ) and elevation  in the tank frame (Fig 9), the position and orientation at the next time index is  #@NEW_LINE#@#  
where (k), (k), and (k) are obtained as in Eqs (14), (15) and (16).  #@NEW_LINE#@#  The correlated Gaussian random variables (k), (k), and (k) are sampled on uncorrelated standard Gaussian random variables (k), (k), and (k) with zero mean and unit standard deviation through77  #@NEW_LINE#@#  

In-silico_experiments  #@NEW_LINE#@#  
Beyond demonstrating the accuracy of the proposed model on the experimental dataset in ref.  #@NEW_LINE#@#  38, we consider an independent in-silico experiment addressing conditions which were not part of the dataset used for model calibration.  #@NEW_LINE#@#  
In the first computational experiment, a total number of 10 fish are simulated, each for 600seconds with t=0.04s within a 56×30×30×cm bounded environment, replicating the experimental setup in ref.  #@NEW_LINE#@#  83.  #@NEW_LINE#@#  Fish position is initialized so that all fish start at right top corner of the tank and the azimuth and elevation are oriented at a uniformly random direction.  #@NEW_LINE#@#  Model parameters are selected randomly to uniformly lie within one standard deviation of the average values (Table 2) obtained after model calibration on the real experimental data.  #@NEW_LINE#@#  This selection for the model parameters attempts at facilitating the process of replicating model predictions, and mitigating the dependence of inter-individual variability of the subjects on the predictions of ethological observables.  #@NEW_LINE#@#  
In the second computational experiment, we explore the role of tank dimensions (length, width, and depth) on zebrafish response.  #@NEW_LINE#@#  For a rectangular parallelepiped, we consider three different values for the depth (10, 20 and 30cm), five different values for the tank width (5, 10, 20, 50 and 100cm), and four different values aspect ratios (ratio of width to length: 0.25, 0.5, 0.75 and 1) width.  #@NEW_LINE#@#  Overall, we, simulate a total of 60 different tanks, spanning typical sizes considered in the literature (Table 1).  #@NEW_LINE#@#  We perform a total of 10 simulations for each tank geometry, similar to the first computational experiment.  #@NEW_LINE#@#  Each simulation is initialized as the first in-silico experiment.  #@NEW_LINE#@#  We set t=0.04s and we simulate each fish for 12minutes.  #@NEW_LINE#@#  Model parameters are randomized as in the first experiment.  #@NEW_LINE#@#  

Analysis  #@NEW_LINE#@#  
The trajectories of the 10 simulated fish in the first experiment are utilized to generate a distribution of position and speed along the horizontal and vertical sections of the environment for visual comparison with the experimental data.  #@NEW_LINE#@#  All 10 simulated fish trajectories are then processed to compute ethological observables used for analysis in fish behaviour experiments31,36,84, such as: average speed; spatial preference along the water column scored from the time spent and number of entries in the top or bottom third of the tank; and the spatial preference along the tank length, measured from number of entries in either of the left or right third of the tank and the time spent therein.  #@NEW_LINE#@#  These observables are then compared with experimental data from38 using a non-parametric Kruskal-Wallis test85 which returns the chi-square statistics (2(·)) with degree of freedom (·), and the p-value.  #@NEW_LINE#@#  
For the simulations of the second experiment, fish behaviour is analysed in terms of the average speed, which is often reported in the technical literature as a measure of activity60,86 (Table 1).  #@NEW_LINE#@#  The correlation between the fish speed and each tank dimension is assessed using a generalized linear regression model (GLM)87.  #@NEW_LINE#@#  The same model is used to aggregate the simulation data and demonstrate the dependence of the speed on the overall tank surface area.  #@NEW_LINE#@#  The latter dependence is verified through comparison with experimental observations, which are also aggregated in terms of the total surface area.  #@NEW_LINE#@#  The total surface area accounts for the entire surface of the water, including the tank sides and the free surface.  #@NEW_LINE#@#  The experimental data listed in Table 1 is collated from 32 different zebrafish experiments, across a range of tank geometries and dimensions.  #@NEW_LINE#@#  We utilize the command glmfit of Matlab which returns the dispersion, the F-test statistics, and the p-value on the regression model assuming Gaussian error distribution.  #@NEW_LINE#@#  All the statistical tests are performed with a significance level set at 0.05.  #@NEW_LINE#@#  




