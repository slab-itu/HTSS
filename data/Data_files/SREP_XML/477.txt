article id="http://dx.doi.org/10.1038/srep35363"  #@NEW_LINE#@#  
title  #@NEW_LINE#@#  
An open-hardware platform for optogenetics and photobiology  #@NEW_LINE#@#  

Abstract  #@NEW_LINE#@#  
In optogenetics, researchers use light and genetically encoded photoreceptors to control biological processes with unmatched precision.  #@NEW_LINE#@#  However, outside of neuroscience, the impact of optogenetics has been limited by a lack of user-friendly, flexible, accessible hardware.  #@NEW_LINE#@#  Here, we engineer the Light Plate Apparatus (LPA), a device that can deliver two independent 310 to 1550nm light signals to each well of a 24-well plate with intensity control over three orders of magnitude and millisecond resolution.  #@NEW_LINE#@#  Signals are programmed using an intuitive web tool named Iris.  #@NEW_LINE#@#  All components can be purchased for under $400 and the device can be assembled and calibrated by a non-expert in one day.  #@NEW_LINE#@#  We use the LPA to precisely control gene expression from blue, green, and red light responsive optogenetic tools in bacteria, yeast, and mammalian cells and simplify the entrainment of cyanobacterial circadian rhythm.  #@NEW_LINE#@#  The LPA dramatically reduces the entry barrier to optogenetics and photobiology experiments.  #@NEW_LINE#@#  

Introduction  #@NEW_LINE#@#  
In 2005, a light activated microbial ion channel (opsin) was expressed in mammalian neurons and used for millisecond timescale control of their activity in vitro1.  #@NEW_LINE#@#  However, because no instrument existed for delivering the necessary intensity of light to specific brain regions in live animals without major side effects, optogenetics contributed few neurobiological insights between 2005 and 20092.  #@NEW_LINE#@#  During this period, the optical neural interface (ONI)  a brain-implantable optical fiber with a laser diode light source  was developed.  #@NEW_LINE#@#  The ONI was rapidly adopted by the neuroscience community and combined with opsins and other photoreceptors, resulting in a wave of breakthroughs in a short time period2.  #@NEW_LINE#@#  
In 2002, a red/far red light-reversible transcriptional regulatory (promoter) system was developed for optical control of gene expression in S. cerevisiae3.  #@NEW_LINE#@#  In the 14 years that have followed, photoreceptors with diverse spectral properties have been used to control a remarkable range of cell biological processes in mechanistically tractable model organisms.  #@NEW_LINE#@#  For example, light-switchable promoter systems have been engineered in E. coli4,5,6,7,8,9, cyanobacteria10, yeast11,12, mammalian cells13,14,15,16,17,18,19,20,21,22, fruit flies23, zebrafish19,24 and plants25.  #@NEW_LINE#@#  Translation26,27, proteolysis28, membrane recruitment11,29, signaling13,29,30,31,32,33,34,35,36, ER-to-cytoplasm37 and nuclear38,39,40,41 translocation, and genome editing11,42,43 have also been placed under optogenetic control.  #@NEW_LINE#@#  
However, no optical hardware has been developed to enable the broad research community to properly utilize these non-neural optogenetic tools, limiting their impact.  #@NEW_LINE#@#  For example, we recently engineered the Light Tube Array (LTA), a light emitting diode (LED)-based device that exposes 64 shaking incubated culture tubes to programmable light signals with an intensity range over three orders of magnitude and millisecond resolution44.  #@NEW_LINE#@#  Though the LTA enables unrivaled control of gene expression dynamics44, construction requires custom machined components, specialized assembly tools, and knowledge of electronic system design and programming is done in computer language.  #@NEW_LINE#@#  Additionally, experiments are not scalable due to the large instrument size (0.02m3) and requirement for connection to an external computer.  #@NEW_LINE#@#  Furthermore, the tubes are costly (~$0.10/each) and restrict experiments to suspension culture organisms such as bacteria and yeast.  #@NEW_LINE#@#  Finally, the LEDs are permanently soldered, limiting optical flexibility.  #@NEW_LINE#@#  In another example, Moglich and coworkers modified the injection port of a Tecan microplate reader with an optical fiber and eight LEDs from 385850nm45.  #@NEW_LINE#@#  While this clever design enables programmable sample illumination via the commercial software, the Tecan instrument costs ~$40,000.  #@NEW_LINE#@#  Other recent designs13,39,46,47,48,49,50 suffer various limitations and have not found widespread adoption.  #@NEW_LINE#@#  
We have designed the LPA for compatibility with a wide range of optogenetics and photobiology experiments and model organisms, low device and consumable costs, high scalability and throughput, and accessibility by laboratories without hardware expertise.  #@NEW_LINE#@#  We demonstrate its capabilities by recapitulating and extending our LTA results in E. coli, performing yeast and mammalian optogenetic gene expression control experiments, and easing the entrainment of cyanobacterial circadian rhythm.  #@NEW_LINE#@#  Additionally, because the LPA and Iris are open source, they may be freely modified and extended by the community for additional functionalities.  #@NEW_LINE#@#  

Results  #@NEW_LINE#@#  
LPA_design_and_assembly  #@NEW_LINE#@#  
The core of the LPA is a printed circuit board (PCB) (Supplementary Fig S1) outfitted with a Secure Digital (SD) card reader (Supplementary Figs S1 and S2), an Atmel ATMega328a microcontroller (Supplementary Figs S1 and S3), 3 LED drivers (Supplementary Figs S1 and S4), 48 solder-free LED sockets (Supplementary Fig S1), a power regulating circuit (Supplementary Fig S5), and other standard electronics components (Supplementary Table S1).  #@NEW_LINE#@#  The only external connection is to a 5V power supply (Fig 1a and Supplementary Fig S6).  #@NEW_LINE#@#  The unpopulated PCB can be ordered from a commercial supplier using the provided fabrication files (Supplementary Methods, Supplementary Files).  #@NEW_LINE#@#  The PCB can be assembled (populated with electronic components) via do-it-yourself (DIY) or commercial soldering procedures (Supplementary Methods and Supplementary Table S2).  #@NEW_LINE#@#  We recommend DIY installation of the LED sockets using a 3D printed socket alignment tool (Supplementary Fig S7 and Supplementary Methods) to ensure consistent geometries and illumination across the wells.  #@NEW_LINE#@#  We have provided a video tutorial demonstrating PCB assembly (Supplementary Video S1).  #@NEW_LINE#@#  
The microcontroller is programmed to convert an Iris-generated file stored on the SD card to LED driver control signals.  #@NEW_LINE#@#  (Supplementary Figs S8S14, Supplementary Tables S3 and S4, and Supplementary Notes).  #@NEW_LINE#@#  Each LED driver individually regulates the intensity of 16 LEDs over 4096 levels with a 1ms refresh rate via 12-bit pulse width modulation of output current up to 20mA.  #@NEW_LINE#@#  The output of each driver, and thus LED intensity, can be further controlled with 6-bit resolution by adjusting the devices dot correction settings, Supplementary Methods).  #@NEW_LINE#@#  
Each socket secures a 5mm through-hole LED via a friction fit (Supplementary Fig S15).  #@NEW_LINE#@#  These LEDs are commercially available with wavelengths from 310 to 1550nm (Supplementary Table S5), enabling plug-and-play optical reconfiguration (Supplementary Methods).  #@NEW_LINE#@#  The 20mA driver output permits full range control of most 5mm LEDs.  #@NEW_LINE#@#  
A 3D printed chassis houses the assembled PCB and 24-well plate (Fig 1ac).  #@NEW_LINE#@#  The chassis comprises i) a mounting plate, ii) LED spacer, iii) plate adapter, and iv) plate lid (Supplementary Fig S16).  #@NEW_LINE#@#  We have designed 4 mounting plates, ensuring compatibility with most shaker platforms.  #@NEW_LINE#@#  The mounting plates contain recessed holes (Fig 1c) for upward-facing bolts that align and stack the remaining 3 modules.  #@NEW_LINE#@#  The LED spacer creates a fixed distance between each LED socket pair and overhead well, and optical isolation between wells.  #@NEW_LINE#@#  The spacer is mated with the PCB and the resulting assembly stacked atop the mounting plate.  #@NEW_LINE#@#  The plate adapter is placed atop the spacer.  #@NEW_LINE#@#  A black-walled, transparent plastic bottomed 24 well plate (Supplementary Fig S17 and Supplementary Table S6) is aligned and held in place by the plate adapter.  #@NEW_LINE#@#  An adhesive foil plate cover (Supplementary Table S6) provides a sealed environment for each well.  #@NEW_LINE#@#  Laser cut nitrile gaskets (Supplementary Fig S18 and Supplementary Methods) are placed at each of the 3 interfaces above the PCB to reduce optical contamination.  #@NEW_LINE#@#  Finally, the lid is placed atop the plate and the complete assembly is secured with wing nuts (Fig 1b and Supplementary Table S6).  #@NEW_LINE#@#  All chassis modules can be 3D printed using supplied files (Supplementary Files, Supplementary Methods).  #@NEW_LINE#@#  We have provided a written procedure and instructional video demonstrating LPA assembly (Supplementary Methods and Supplementary Video S2).  #@NEW_LINE#@#  

LPA_programming_with_Iris  #@NEW_LINE#@#  
Iris can be freely accessed at http://iris.taborlab.rice.edu or run locally using the provided source code (Supplementary Notes).  #@NEW_LINE#@#  Light programs are specified in Steady State, Dynamic, or Advanced Modes (SSM, DM, AM).  #@NEW_LINE#@#  In SSM, time-invariant intensities for each LED are entered within an Input Panel (Fig 2a, left).  #@NEW_LINE#@#  In DM, constant, step, sinusoidal, or piecewise light signals are specified using parameters such as initial and final intensity, time of step, or wave period, amplitude, and offset (Supplementary Notes).  #@NEW_LINE#@#  The same signal is run by all 24 top LEDs, and the same, or a second signal can be run by all 24 bottom LEDs.  #@NEW_LINE#@#  AM (Fig 2b, left) implements DM signals via our recent staggered-start protocol, which allows kinetic experiments to be performed with far less sample handling44 (Supplementary Fig S19, Supplementary Table S7).  #@NEW_LINE#@#  The light signal run in each well can be randomized (Supplementary Notes) to mitigate any well-to-well variability.  #@NEW_LINE#@#  We have provided videos demonstrating Iris light signal programming in all 3 modes (Supplementary Videos S3S5).  #@NEW_LINE#@#  
Light programs can be viewed and debugged at the plate (Fig 2a, right) or individual well (Fig 2b, right) levels using the Simulation Panel.  #@NEW_LINE#@#  When the program is satisfactory, the download button (Fig 2a,b) is pressed.  #@NEW_LINE#@#  Iris then generates a zip file containing i) a device-readable binary file (.lpf, Supplementary Table S8) used to run the LPA, ii) a session file for reloading a program into Iris at a later time, and iii) a CSV file containing user-readable well randomization information.  #@NEW_LINE#@#  The .lpf is then transferred to an SD card, which is inserted into the LPA, and the Reset Button (Supplementary Fig S1) is pressed to run the light program.  #@NEW_LINE#@#  Included Python scripts can be used to automate .lpf design (Supplementary Files, Supplementary Notes), increasing throughput.  #@NEW_LINE#@#  

LPA_calibration  #@NEW_LINE#@#  
We have developed a simple method utilizing a gel imager and MATLAB script to calibrate the outputs of multiple LPA LEDs of the same spectrum to one another (Supplementary Files, Supplementary Methods).  #@NEW_LINE#@#  To calibrate absolute outputs, or the outputs of LEDs with different spectra, we have developed a method combining a probe spectrophotometer and 3D printed adapter that fits the LPA wells (Supplementary Fig S20 and Supplementary Methods).  #@NEW_LINE#@#  Using either method, outputs are adjusted by loading two manually generated text files specifying the grayscale and dot correction values for each LED (Supplementary Methods, examples in Supplementary Files) on to the SD card before running an experiment.  #@NEW_LINE#@#  Calibration typically reduces LED output variability to less_than1% (Supplementary Fig S21).  #@NEW_LINE#@#  

Benchmarking_the_LPA_with_E_coli_CcaS-CcaR  #@NEW_LINE#@#  
CcaS-CcaR is a green light activated, red de-activated two component system (TCS) that we previously engineered to control gene expression in E. coli (Fig 3a)6.  #@NEW_LINE#@#  Using the LTA and a superfolder GFP (sfGFP) output, we characterized the relationship between green and red light inputs and transcriptional output dynamics (i.e.  #@NEW_LINE#@#  I/O)44.  #@NEW_LINE#@#  We developed a predictive mathematical model of the I/O, which we used to pre-compute green light time courses to drive CcaS-CcaR output to follow tailor-made (reference) gene expression signals with high predictability44.  #@NEW_LINE#@#  
We aimed to benchmark the LPA by repeating these CcaS-CcaR experiments.  #@NEW_LINE#@#  First, we measured the steady state response to green light intensity by outfitting the bottom positions of an LPA with 533nm (green) LEDs and programming them to emit between 0.00 and 20.10mol m2 s1 photons.  #@NEW_LINE#@#  We grew our previous strain in a shaking LPA under these conditions and measured sfGFP output using flow cytometry (Methods).  #@NEW_LINE#@#  We observed that sfGFP increases sigmoidally with green intensity with a 5.3-fold dynamic range and Hill parameter (nH)=2.6 (Fig 3b), tightly consistent with LTA measurements.  #@NEW_LINE#@#  The intensity resulting in half maximal output (k1/2) is 0.22mol m2 s1, 4.8-fold greater than the LTA value.  #@NEW_LINE#@#  This discrepancy is likely due to the shorter length between LED and sample in the LPA and small spectrophotometer probe diameter.  #@NEW_LINE#@#  Because LED emission is conical (Fig 1c), this length difference concentrates photons on the probe, artificially elevating measured intensity values.  #@NEW_LINE#@#  This discrepancy could be eliminated using improved probe designs.  #@NEW_LINE#@#  
Next, we benchmarked the effect of red light by outfitting the bottom and top positions with 533 and 678nm (red) LEDs and re-measured the green light response in the presence of 2.0012.00mol m2 s1 red photons.  #@NEW_LINE#@#  We observed that dynamic range and nH remain unchanged while k1/2 increases by 0.11mol m2 s1 green light per 1.00mol m2 s1 red light (Fig 3b and Supplementary Table S9), consistent with our previous data.  #@NEW_LINE#@#  
Finally, we used the LPA to characterize the kinetic response of CcaS-CcaR to step changes in green intensity.  #@NEW_LINE#@#  We observed a 4.5min delay, an 11min transcription rate switching time, and sfGFP switching dynamics set by the cell division time (Fig 3c), equivalent to LTA results.  #@NEW_LINE#@#  We used these data to re-calibrate the parameters of our model to the LPA conditions (Methods and Supplementary Table S10).  #@NEW_LINE#@#  Finally, we successfully used the model to program sfGFP expression to follow a challenging waveform comprising linear ramps, a hold, and a sine wave with high predictability (Fig 3d).  #@NEW_LINE#@#  We conclude that the LPA meets the same performance standards at the LTA.  #@NEW_LINE#@#  

Characterizing_CcaS-CcaR_forward_and_reverse_action_spectra  #@NEW_LINE#@#  
The action spectrum is the relationship between input wavelength and output activity.  #@NEW_LINE#@#  While all optogenetic tools have forward (ground state) action spectra (FAS), photoreversible tools also have reverse (activated state) action spectra (RAS).  #@NEW_LINE#@#  
We next aimed to demonstrate that the LPA can be used to characterize the FAS and RAS of optogenetic tools using CcaS-CcaR as a model.  #@NEW_LINE#@#  To this end, we outfitted the bottom position of a device with LEDs of output wavelength between 364 and 947nm (Fig 1d and Supplementary Table S5) and programmed each to emit 0.40mol m2 s1, or 2*k1/2 for the 533nm LED (Fig 3b).  #@NEW_LINE#@#  We then measured the steady state response of CcaS-CcaR to each input as before.  #@NEW_LINE#@#  This experiment reveals a maximal activating wavelength of 533nm and 50% maximal activation between 533 and 571nm (Fig 4).  #@NEW_LINE#@#  We previously generated a course-grained map of the CcaS-CcaR FAS using six wavelengths with a rudimentary instrument in an experiment that required approximately one week6.  #@NEW_LINE#@#  By contrast, the LPA enables us to measure a 24 wavelength FAS in a single day.  #@NEW_LINE#@#  
To characterize the RAS, we outfitted the top positions of a device with the 533nm LED and the bottom positions with the same LEDs used in the FAS experiment.  #@NEW_LINE#@#  We set the 533nm LED to 0.40mol m2 s1 and each bottom LED to 3.21mol m2 s1 because CcaS-CcaR has approximately 10-fold greater sensitivity to green than red light (Fig 3b).  #@NEW_LINE#@#  Consistent with in vitro absorbance measurements of activated CcaS51, exposure of our CcaS-CcaR expressing strain to these inputs reveals maximal deactivation by the 678nm LED (Fig 4).  #@NEW_LINE#@#  To our knowledge, this is the first measurement of the RAS of an optogenetic tool.  #@NEW_LINE#@#  

Characterizing_the_S_cerevisiae_CRY2-CIB1_yeast_two_hybrid_system  #@NEW_LINE#@#  
Tucker and coworkers previously engineered a blue light activated S. cerevisiae promoter system by fusing Cryptochrome 2 (CRY2) to the Gal4 DNA binding domain (DBD), and the interaction domain of its blue-light dependent heterodimerizing partner CIB1 to the Gal4 activation domain in a yeast two-hybrid (Y2H) system11 (Fig 5a).  #@NEW_LINE#@#  
To demonstrate compatibility of the LPA with yeast, we characterized the CRY2-CIB1 Y2H I/O.  #@NEW_LINE#@#  We outfitted the top and bottom positions of an LPA with 467nm (blue) LEDs, and programmed them to emit intensities between 0.26 and 1057.00mol m2 s1.  #@NEW_LINE#@#  We grew yeast expressing CRY2-CIB1 Y2H with an mCherry output in a shaking LPA under these conditions for 18 or 24h and measured output using flow cytometry (Methods).  #@NEW_LINE#@#  Between 0.26 and 93.50mol m2 s1, mCherry increases in a Hill-like manner with 5.6-fold dynamic range, nH of 1.3 and k1/2 of 10.74mol m2 s1 (Fig 5b), consistent with previous reports11,24,52.  #@NEW_LINE#@#  Though mCherry increases slightly at higher intensities, we observe growth defects, likely due to heating or phototoxicity (Supplementary Fig S22).  #@NEW_LINE#@#  
To characterize CRY2-CIB1 Y2H dynamics, we performed a step increase and decrease in blue light and measured the mCherry response over time (Methods).  #@NEW_LINE#@#  We observe a delay followed by an exponential increase (step-on) or decrease (step-off) in mCherry to a final steady state (Fig 5c).  #@NEW_LINE#@#  By fitting the data to a first order ODE model with a delay (Methods), we quantify the delay to be 75.13min, and the subsequent time to reach 50% of the final mCherry level to be 222min (Supplementary Table S11).  #@NEW_LINE#@#  The slower dynamics compared to CcaS-CcaR are likely due to slower rates of transcriptional activation and cell division, as well as the additional steps of mRNA processing and nuclear/cytoplasmic transport.  #@NEW_LINE#@#  
Next, we measured the CRY2/CIB1 Y2H FAS by outfitting the bottom position of an LPA with LEDs between 382 and 849nm and programming their outputs to 88.80mol m2 s1, the highest intensity of the dimmest (533nm) LED.  #@NEW_LINE#@#  This experiment reveals peak activation in response to the 382nm and 467nm LEDs and broad wavelength responsivity in the blue (50% response from 382 to 503nm) which matches the broad, multipeaked in-vitro absorbance spectrum of CRY253 (Fig 5d).  #@NEW_LINE#@#  We conclude that the LPA is compatible with yeast optogenetic tools.  #@NEW_LINE#@#  

Spatial_control_of_mammalian_cell_gene_expression_with_PHYB_VNP-PIF6  #@NEW_LINE#@#  
We recently modified the surface of viral nanoparticles (VNPs) with Phytochrome Interacting Factor 6 (VNP-PIF6) to bind a heterologously expressed nuclear localization sequence tagged Phytochrome B (PHYB-NLS) and deliver a transgene to the mammalian cell nucleus in a red light activated, far-red deactivated manner54 (Fig 6a).  #@NEW_LINE#@#  Using an early LPA prototype, we tuned delivery of gfp to HeLa cells from 35 to 600% that of wild-type virus.  #@NEW_LINE#@#  Using custom photomasks, we also patterned GFP expression within different regions of a confluent culture well.  #@NEW_LINE#@#  Delivery of red light alone resulted in low contrast between cells inside and outside the pattern.  #@NEW_LINE#@#  Co-delivering far red reduced expression in unwanted areas and increased contrast.  #@NEW_LINE#@#  However, this prototype had numerous shortcomings including a requirement for a glass bottom plate that often fractured during experiments.  #@NEW_LINE#@#  
To validate compatibility with mammalian cells and extend our previous results, we outfitted the top and bottom LED positions of an LPA with 647 (red) and 733nm (far red) LEDs and replaced the plate adapter gasket (Supplementary Fig S17) with a laser-cut black nitrile photomask (Supplementary Fig S17).  #@NEW_LINE#@#  We preconditioned HeLa cells in 6 wells of a single plate with 2.00mol m2 s1 far red light for 30min and then reduced it to 1.00mol m2 s1 while introducing variable red light between 0.25 and 4mol m2 s1 for 1h.  #@NEW_LINE#@#  We allowed GFP to accumulate during a 48h dark incubation and then imaged the resulting expression patterns by fluorescence microscopy (Methods).  #@NEW_LINE#@#  As expected, GFP expression increases with red intensity (Fig 6b).  #@NEW_LINE#@#  Additionally, the contrast ratio (GFP intensity in exposed divided by that in non-exposed regions) reaches an optimal value of 16.6, near the maximum dynamic range of the system, at an intermediate red:far red ratio of 2.5 (Fig 6c).  #@NEW_LINE#@#  

Using_the_LPA_to_entrain_the_cyanobacterial_circadian_clock  #@NEW_LINE#@#  
The cyanobacterium Synechococcus elongatus PCC7942 is a model for studying circadian rhythm55.  #@NEW_LINE#@#  Exposing cells to 12h dark/12h light cycles entrains the circadian clock.  #@NEW_LINE#@#  After entrainment, a roughly 24h transcriptional oscillation56,57 is maintained for roughly 3064% of the genome, even under constant light58.  #@NEW_LINE#@#  
The time-intensive nature of the entrainment protocol makes it difficult to conduct multiple parallel experiments in order to study clock properties and one group has recently sought to simplify the procedure by using a computer-controlled LED array48.  #@NEW_LINE#@#  To examine whether the LPA can be used to automate circadian entrainment, we outfitted the top and bottom positions of three devices with 647 and 467nm LEDs to provide a balanced photosynthetic active radiation spectrum typical of grow lights.  #@NEW_LINE#@#  We programmed 6 different signals across the devices wherein cells were exposed to 3 cycles starting at different times (Fig 7a).  #@NEW_LINE#@#  Luminescence from a commonly used reporter system58,59 wherein luciferase substrate is produced from the dusk-peaking promoter psbAI and luciferase from the dawn-peaking promoter kaiBC was then measured.  #@NEW_LINE#@#  As expected, the oscillations of cultures that were entrained starting at different times showed different phases (Fig 7b).  #@NEW_LINE#@#  The order of peaks in luminescence was also as expected, with the cultures entrained starting at 0h (red) peaking before cultures entrained starting at 4h (orange), 8h (yellow), 12h (green), 16h (blue) and 20h (purple) (Fig 7b,c).  #@NEW_LINE#@#  However, the position of the peaks exhibits some dispersion, potentially due to heating of the LPA or the transition of cultures from the LPA to the plate reader.  #@NEW_LINE#@#  


Discussion  #@NEW_LINE#@#  
The LPA establishes new standards of flexibility, user-friendliness, and affordability in non-neural optogenetics and photobiology hardware  features that should facilitate widespread adoption.  #@NEW_LINE#@#  In terms of flexibility, the LPA is compatible with bacteria, yeast, and mammalian cells and other common model organisms.  #@NEW_LINE#@#  The ~1mL well volume and the shaker adapters make the device compatible with most model organism growth protocols.  #@NEW_LINE#@#  The diversity of available LEDs theoretically makes the LPA compatible with all known genetically encoded photoreceptors and most photobiological processes.  #@NEW_LINE#@#  The second LED position allows improved spatial and dynamical control of photoreversible optogenetic tools and characterization of reverse action spectra.  #@NEW_LINE#@#  Different spatial patterns can easily be applied by using laser cut gaskets.  #@NEW_LINE#@#  In addition to these features, the LPA retains the high standards of programmability and experimental precision of the LTA44.  #@NEW_LINE#@#  
The ease of assembly, intuitive Iris interface, simplified liquid handling, and automated calibration script make the LPA user friendly.  #@NEW_LINE#@#  The LPA can be assembled easily and quickly by a non-expert using fully documented assembly instructions and tutorial videos.  #@NEW_LINE#@#  Iris converts high-level light function specifications into low level hardware operations, eliminating programming requirements.  #@NEW_LINE#@#  LPA samples can be loaded and harvested using a multichannel pipettor, and the plate can be sealed and unsealed with an adhesive lid in a single step, facilitating high throughput experimentation.  #@NEW_LINE#@#  The plate is also compatible with plate readers and plate-based flow cytometers, enabling direct measurements of absorbance, fluorescence, or luminescence without additional liquid handling.  #@NEW_LINE#@#  Finally, our MATLAB script simplifies calibration for experiments where the same LED is used in multiple wells.  #@NEW_LINE#@#  
The LPA is more economical than comparable devices (Supplementary Table 12).  #@NEW_LINE#@#  The 24-well plate costs $7.70 and can be reused dozens of times, lowering per sample cost to less_than$0.01.  #@NEW_LINE#@#  Furthermore, the $400 component cost drops to $150 with access to a 3D printer.  #@NEW_LINE#@#  These low costs make the LPA practical for large scale experiments (Supplementary Fig S23).  #@NEW_LINE#@#  
The action spectra of optogenetic tools are seldom measured due to the lack of convenient hardware.  #@NEW_LINE#@#  Using the LPA, both the FAS and RAS can be measured with 24 wavelength resolution in one experiment.  #@NEW_LINE#@#  This feature should permit improved characterization of light responsive signaling pathways and enable cross-talk to be minimized when using multiple optogenetic photoreceptors.  #@NEW_LINE#@#  
Despite early efforts60,61, there is little data directly comparing the performance features of optogenetic tools.  #@NEW_LINE#@#  Accordingly, researchers may have difficulty selecting the best tool for a given experiment.  #@NEW_LINE#@#  On the other hand, the LPA can be used to directly compare optogenetic tools, including those in different organisms.  #@NEW_LINE#@#  For example, in this study we found that CRY2/CIB1 Y2H is 50 times less sensitive to light than CcaS-CcaR (compare k1/2 in Figs 3b and 5b).  #@NEW_LINE#@#  Using the basic protocols established here, the LPA could be used to quantitatively compare the spectral, intensity dependent, and dynamical properties of all published optogenetic tools with gene expression outputs in bacteria, yeast, mammalian cells and other organisms, providing much needed information to the community that should accelerate the adoption of optogenetics.  #@NEW_LINE#@#  
Many circadian assays, such as those measuring the sensitivity of the rhythm to optical perturbations as a function of time of day, are onerous and present a significant barrier to the researcher.  #@NEW_LINE#@#  The LPA provides a compact and economical solution to this problem.  #@NEW_LINE#@#  Additionally, the ability to program two wavelengths may ease studies of organisms and processes that respond differently to different wavelengths such as phase resetting in the green algae C. reinhardtii in which shifts in the circadian rhythm are wavelength dependent as a function of cellular status.  #@NEW_LINE#@#  The ability to program 24 light signals simultaneously may also ease experiments such as testing growth of mutants with longer or shorter circadian periods with different lengths of light and dark62,63,64.  #@NEW_LINE#@#  
By releasing the LPA and Iris with an open-source license, we aim to incorporate other researchers as developers to extend and improve the platform.  #@NEW_LINE#@#  Similar to a recent example65, we have made all design files, a bill of materials, and protocols needed to fabricate, assemble, and operate the device, as well as standard format source code on a public version control system freely available.  #@NEW_LINE#@#  From this repository, the community can download up-to-date file versions, suggest or make improvements and modifications, design new accessories, and upload all updates for others to use and build upon further.  #@NEW_LINE#@#  Future designs could incorporate more LEDs per well, lids compatible with gas exchange membranes, sample injection and aspiration, and on-board sensors for measurement of absorbance, fluorescence, or luminescence, enabling optogenetic feedback control66.  #@NEW_LINE#@#  Better heat dissipation for high intensity experiments could be achieved through addition of heat sinks, fans, chassis parts with better ventilation, or even active temperature feedback control.  #@NEW_LINE#@#  96-well or greater plate format designs should also be possible.  #@NEW_LINE#@#  With 3D printing and microcontroller technologies becoming increasingly inexpensive and accessible, such advances can be made by researchers without formal electrical and mechanical engineering backgrounds.  #@NEW_LINE#@#  We hope that this work not only enables new researchers to perform optogenetics and photobiology experiments, but also motivates them join the growing open-hardware community.  #@NEW_LINE#@#  

Methods  #@NEW_LINE#@#  
LPA  #@NEW_LINE#@#  
CAD files, firmware, and detailed documentation on LPA design, fabrication, assembly, calibration, and operation are included in the Supplementary Information and Supplementary Files.  #@NEW_LINE#@#  The most up-to-date documentation and file versions can be found at http://taborlab.rice.edu/hardware.  #@NEW_LINE#@#  

Iris  #@NEW_LINE#@#  
Source code and detailed descriptions of the staggered start algorithm, waveform handling, file specifications, randomization and de-randomization procedure, and LPF creation using Python are included in the Supplementary Information and Supplementary Files.  #@NEW_LINE#@#  The most up-to-date documentation and source code can be accessed at http://taborlab.rice.edu/software.  #@NEW_LINE#@#  

CcaS-CcaR  #@NEW_LINE#@#  
All CcaS-CcaR experiments were performed in E. coli strain JT2 (RU1012 PompC-lacZ) with previously constructed plasmids pJT119b and pPLPCB(S)6.  #@NEW_LINE#@#  To make frozen starter aliquots, a 3mL LB+50g/mL kanamycin, 100g/mL spectinomycin and 34g/mL chloramphenicol culture was inoculated from a 80°C stock and grown (37°C, 250rpm) to OD600 less_than0.3.  #@NEW_LINE#@#  30% glycerol was added, absorbance measured, and 50L aliquots made and stored at 80°C.  #@NEW_LINE#@#  For experiments, M9+antibiotics was inoculated with a starter aliquot, to OD600=0.00015.  #@NEW_LINE#@#  500L of experimental culture was added to each well of the 24-well plate and the plate was sealed with adhesive foil.  #@NEW_LINE#@#  The plate was placed into the LPA and the assembly mounted on a shaker/incubator at 37°C, 250rpm for 8h.  #@NEW_LINE#@#  The plate was then removed and chilled in an ice-water bath.  #@NEW_LINE#@#  Cells were chilled for 15min and the foil removed.  #@NEW_LINE#@#  200L from each well was transferred to flow cytometry tubes containing 1mL PBS, and cells were treated with rifampicin as before44.  #@NEW_LINE#@#  

CRY2-CIB1_Y2H  #@NEW_LINE#@#  
All CRY2-CIB1 Y2H experiments were performed with the previously described S. cerevisiae strain yMM1081 (MAT , trp63, leu21, ura352, gal1mCherry-caURA3) which carries plasmids pGal4AD-CIB1 and pGal4BD-CRY211,52.  #@NEW_LINE#@#  A 3 mL SD (-Ura, -Trp, -Leu) medium starter culture was inoculated from a 80°C stock and grown (30°C, 250r.p.m) overnight to a final density of approximately OD600=2.  #@NEW_LINE#@#  The starter culture was diluted into fresh SD to OD600=0.001.  #@NEW_LINE#@#  The culture plate was prepared and loaded/unloaded as done with E. coli.  #@NEW_LINE#@#  Cells were grown in the LPA (30°C, 250rpm) for 24h (step-off dynamics experiments) or 18h (all other experiments).  #@NEW_LINE#@#  Samples were harvested as described for E. coli without rifampicin treatment.  #@NEW_LINE#@#  

Flow_cytometry  #@NEW_LINE#@#  
Cytometry was performed with a BD FACScan flow cytometer as previously described45.  #@NEW_LINE#@#  Settings used for each experiment are listed in Supplementary Table S13.  #@NEW_LINE#@#  Typical count rates of 1,0002,000 events/s were used and approximately 20,000 events were captured for each sample.  #@NEW_LINE#@#  Calibration beads (RCP-30-5A, Spherotech) were measured at each session.  #@NEW_LINE#@#  Data was processed and sfGFP and mCherry fluorescence were calibrated to Molecules of Equivalent Fluorescein (MEFL) and Molecules of Equivalent Cy5 (MECY) with FlowCal67.  #@NEW_LINE#@#  

CcaS-CcaR_model  #@NEW_LINE#@#  
Data was modeled as previously44.  #@NEW_LINE#@#  Parameter fitting was performed in GraphPad.  #@NEW_LINE#@#  All parameters were constrained to 0, and delay and kg are shared between step-on and step-off data sets.  #@NEW_LINE#@#  

CRY2-CIB1_Y2H_model  #@NEW_LINE#@#  
We apply a first order linear ODE model  #@NEW_LINE#@#  
where the rate of change of mCherry, m(t), is a function of the difference between the mCherry set-point,  and the current mCherry concentration.  #@NEW_LINE#@#  is blue light intensity, Ib, mapped to mCherry units through the steady-state transfer function at time .  #@NEW_LINE#@#  At , mCherry is equal to its initial value, which is determined by the preconditioning set-point, .  #@NEW_LINE#@#  The solution to this ODE has the following piece-wise form:  #@NEW_LINE#@#  
where mCherry remains at its initial value, m0, for tdelay, and exponentially increases or decreases with rate constant  for tdelay.  #@NEW_LINE#@#  
Parameter fitting was performed by nonlinear least squares in GraphPad.  #@NEW_LINE#@#  All parameters were constrained to 0, and delay and  were shared between step-on and step-off data sets.  #@NEW_LINE#@#  

PHYB_VNP-PIF6  #@NEW_LINE#@#  
Experimental protocols were similar to those described previously54.  #@NEW_LINE#@#  Briefly, VNP-PIF6 was isolated by iodixanol gradient centrifugation from HEK293T cells 48h after a quadruple transfection with pAAV-GFP, pXX6-80, pVP2A-PIF6, and pVP1/3.  #@NEW_LINE#@#  Patterned gene expression experiments were performed by coating each culture plate well with poly-L-lysine (PLL) and seeding HeLa cells at a density of 1×105 per well in DMEM supplemented with 10% fetal bovine serum and 1% penicillin-streptomycin.  #@NEW_LINE#@#  After 24h, cells were transfected with PEI-DNA (pKM017)18 complexes encoding PhyB908 with a C-terminal NLS fusion.  #@NEW_LINE#@#  24h later, cell media was exchanged for DMEM supplemented with 10% serum, 15M phycocyanobilin, and VNP-PIF6 at a multiplicity of infection of 1,000.  #@NEW_LINE#@#  The culture plate was then loaded into the LPA, placed inside an incubator, and exposed to light time courses described in the results.  #@NEW_LINE#@#  After 24h, the culture plate was removed from the LPA and wells were given fresh media without phycocyanobilin or VNP-PIF6.  #@NEW_LINE#@#  Cells were incubated for an additional 24h in the dark to allow accumulation of GFP, and were then treated with 4% paraformaldehyde in PBS and imaged.  #@NEW_LINE#@#  All incubation steps were performed at 37°C, 5% CO2, and without shaking.  #@NEW_LINE#@#  All manipulations after addition of PCB were performed under a green safelight.  #@NEW_LINE#@#  Three diffuser sheets (#3008, Rosco) were used in place of the LED spacer gasket and adhesive foil was omitted to avoid light reflections interfering with the pattern.  #@NEW_LINE#@#  Though we observed no changes in cell or media appearance, the LPA plate lid likely reduced or prevented gas exchange during the 24 h cells spent inside the device.  #@NEW_LINE#@#  

Microscopy  #@NEW_LINE#@#  
Imaging was performed with a Nikon A1 microscope with 2X objective and 488nm sample illumination.  #@NEW_LINE#@#  4×4 arrays of images for each pattern condition were stitched together and given pseudocolor using NIS Elements Software (Nikon).  #@NEW_LINE#@#  Images shown are cropped to the border of the pattern area.  #@NEW_LINE#@#  

Cyanobacterial_Circadian_Rhythm  #@NEW_LINE#@#  
All circadian rhythm experiments were performed with S. elongatus PCC 7942 strain AMC46268.  #@NEW_LINE#@#  1.5ml of exponential phase culture diluted to OD750 0.05 was pipetted into each well of the 24-well culture plate.  #@NEW_LINE#@#  Extra distilled water was pipetted between wells to reduce evaporation, and the plate was covered with a transparent lid (Visiplate 24-TC Part: 1450-6045) with adhesive foil (F96VWR100).  #@NEW_LINE#@#  The cells were then grown in the LPA at 30°C with shaking at 255rpm for 4 days.  #@NEW_LINE#@#  Photon flux of 647 and 467nm LEDs were 68.86 and 244.76mol m2 s1, respectively.  #@NEW_LINE#@#  

Luminescence_data_acquisition_and_analysis  #@NEW_LINE#@#  
Luminescence of 150l of culture in a 96-well black with clear bottom plate with transparent lid was measured using a Tecan M200 with a luminescence module and an integration time of 1000ms.  #@NEW_LINE#@#  Between readings, the plate was moved out of the machine for 20min and kept under a fluorescent lamp at 4500 lux.  #@NEW_LINE#@#  Readings were taken for a total of 160h.  #@NEW_LINE#@#  
Luminesce data was fitted with BRASS (Biological Rhythms Analysis Software System; A. J. Millar laboratory, University of Edinburgh, Scotland, United Kingdom) and FFT-NLLS (Fast Fourier Transform-Nonlinear Least Squares)69,70.  #@NEW_LINE#@#  At least 72h of each culture was included in the analysis.  #@NEW_LINE#@#  
The best fits for the expected phases were calculated by minimizing the root mean square distance from the location of the expected phase to the location of experimental phase using the GRG Nonlinear solving method in Excel.  #@NEW_LINE#@#  

Iris_session_files  #@NEW_LINE#@#  
Iris session (savefile.irs) files for each experiment are available in the Supplementary Files.  #@NEW_LINE#@#  

Strain_and_Plasmid_Accession_Information  #@NEW_LINE#@#  
Accession information for strains and plasmids used in this study are available in Supplementary Tables S14 and S15.  #@NEW_LINE#@#  




